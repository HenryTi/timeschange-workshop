{"version":3,"sources":["tonwa-core/res/inputRes.ts","tonwa-core/res/listRes.ts","tonwa-core/core/Navigo.ts","tonwa-core/tool/local.ts","tonwa-core/tool/date.ts","tonwa-core/tool/caseString.ts","tonwa-core/tool/rules.ts","tonwa-core/core/Tonwa.ts","tonwa-uq/net/caller.ts","tonwa-uq/net/UqTokens.ts","tonwa-uq/net/httpChannel.ts","tonwa-uq/net/apiBase.ts","tonwa-uq/net/wsChannel.ts","tonwa-uq/net/uqApi.ts","tonwa-uq/net/centerApi.ts","tonwa-uq/net/guestApi.ts","tonwa-uq/net/messageHub.ts","tonwa-uq/net/Net.ts","tonwa-uq/uqBuild/TsTemplate.ts","tonwa-uq/uqCore/uqMan.ts","tonwa-uq/uqBuild/UqBuildContext.ts","tonwa-uq/uqCore/entity.ts","tonwa-uq/uqCore/caller.ts","tonwa-uq/uqCore/tuid/idCache.ts","tonwa-uq/uqCore/tuid/tuid.tsx","tonwa-uq/uqCore/tuid/tuidsCache.ts","tonwa-uq/uqCore/action.ts","tonwa-uq/uqCore/sheet.ts","tonwa-uq/uqCore/query.ts","tonwa-uq/uqCore/book.ts","tonwa-uq/uqCore/history.ts","tonwa-uq/uqCore/map.ts","tonwa-uq/uqCore/pending.ts","tonwa-uq/uqCore/enum.ts","tonwa-uq/uqCore/ID.ts","tonwa-uq/uqCore/IDCache/IDCache.ts","tonwa-uq/uqCore/uqsMan.ts","tonwa-uq/uqCore/uqsLoader.ts","tonwa-uq/uqCore/uqStringify.ts","tonwa-uq/Model/Model.ts","tonwa-uq/Model/MDraft.ts","tonwa-uq/tool/user.ts","tonwa-uq/tool/uid.ts","tonwa-uq/tool/UqError.ts","tonwa-uq/tool/LocalDb.ts","tonwa-uq/tool/caseString.ts","tonwa-uq/tool/getObjPropIgnoreCase.ts","tonwa-react/components/inputRules.ts","tonwa-react/components/form/widgets/widget.tsx","tonwa-react/components/form/widgets/textWidget.tsx","tonwa-react/components/form/widgets/textareaWidget.tsx","tonwa-react/components/form/widgets/passwordWidget.tsx","tonwa-react/components/form/widgets/numberWidget.tsx","tonwa-react/components/form/widgets/updownWidget.tsx","tonwa-react/components/form/widgets/dateWidget.tsx","tonwa-react/components/form/widgets/checkBoxWidget.tsx","tonwa-react/components/form/widgets/selectWidget.tsx","tonwa-react/components/form/widgets/radioWidget.tsx","tonwa-react/components/form/widgets/rangeWidget.tsx","tonwa-react/components/form/widgets/idWidget.tsx","tonwa-react/components/form/widgets/unknown.tsx","tonwa-react/components/form/widgets/buttonWidget.tsx","tonwa-react/components/form/context.tsx","tonwa-react/components/form/widgets/arrComponent.tsx","tonwa-react/components/image.tsx","tonwa-react/components/loading.tsx","tonwa-react/components/simple/Badge.tsx","tonwa-react/components/simple/LMR.tsx","tonwa-react/components/simple/FA.tsx","tonwa-react/components/simple/IconText.tsx","tonwa-react/components/resUploader.tsx","tonwa-react/components/edit/itemEdit.tsx","tonwa-react/components/edit/imageItemEdit.tsx","tonwa-react/components/form/widgets/imageWidget.tsx","tonwa-react/components/form/widgets/tagWidget.tsx","tonwa-react/components/form/widgets/pickWidget.tsx","tonwa-react/components/form/widgets/factory.tsx","tonwa-react/components/form/form.tsx","tonwa-react/components/form/field.tsx","tonwa-react/components/edit/stringItemEdit.tsx","tonwa-react/components/edit/radioItemEdit.tsx","tonwa-react/components/edit/selectItemEdit.tsx","tonwa-react/components/edit/idItemEdit.tsx","tonwa-react/components/edit/tagItemEdit.tsx","tonwa-react/components/edit/textAreaItemEdit.tsx","tonwa-react/components/edit/checkBoxItemEdit.tsx","tonwa-react/components/edit/rangeItemEdit.tsx","tonwa-react/components/edit/numberItemEdit.tsx","tonwa-react/components/edit/edit.tsx","tonwa-react/components/list/base.tsx","tonwa-react/components/list/clickable.tsx","tonwa-react/components/list/static.tsx","tonwa-react/components/list/selectable.tsx","tonwa-react/components/list/index.tsx","tonwa-react/components/easyDate/index.tsx","tonwa-react/components/dropDownActions/index.tsx","tonwa-react/components/propGrid/row.tsx","tonwa-react/components/propGrid/propView.tsx","tonwa-react/components/propGrid/PropGrid.tsx","tonwa-react/components/searchBox.tsx","tonwa-react/components/media.tsx","tonwa-react/components/ax/index.tsx","tonwa-react/components/input/input.tsx","tonwa-react/components/input/inputs/inputNumber.tsx","tonwa-react/components/input/inputs/checkBox.tsx","tonwa-uq/uqBuild/tools.ts","tonwa-react/vm/ControllerWithWeb.ts","tonwa-react/vm/View.tsx","tonwa-react/vm/VPage.tsx","tonwa-react/vm/components/CStringEdit.tsx","tonwa-react/components/page/page.tsx","tonwa-core/tool/env.ts","tonwa-react/vm/Controller.tsx","tonwa-react/components/page/scrollView.tsx","tonwa-core/tool/localDb.ts","tonwa-react/nav/NavView.tsx","tonwa-react/ui/res.ts","tonwa-react/components/login.tsx","tonwa-core/tool/62.ts","tonwa-react/components/page/pageHeader.tsx","tonwa-react/components/page/tabs.tsx","tonwa-uq/uqBuild/buildFieldItem.ts","tonwa-react/auth/VLogout.tsx","tonwa-react/auth/VLogin.tsx","tonwa-react/auth/VChangePassword.tsx","tonwa-react/auth/VUserQuit.tsx","tonwa-react/auth/CLogin.tsx","tonwa-react/img/logo.svg","tonwa-react/auth/tools.tsx","tonwa-uq/net/host.ts","tonwa-core/res/res.ts","tonwa-uq/uqBuild/TsUqFolder.ts","tonwa-uq/uqBuild/TsUQ.ts","uq-app/uqs/BzWorkshop/BzWorkshop.ts","uq-app/uqs/BzWorkshop/Draft.ui.tsx","uq-app/uqs/BzWorkshop/Biz.ui.tsx","uq-app/uqs/BzWorkshop/BizPack.ui.tsx","uq-app/uqs/BzWorkshop/Op.ui.tsx","uq-app/uqs/BzWorkshop/Item.ui.tsx","uq-app/uqs/BzWorkshop/OpiBooking.ui.tsx","uq-app/uqs/BzWorkshop/Opi.ui.tsx","uq-app/uqs/BzWorkshop/ItemHistory.ui.tsx","uq-app/uqs/BzWorkshop/OpiHistory.ui.tsx","uq-app/uqs/BzWorkshop/Note.ui.tsx","uq-app/uqs/BzWorkshop/Person.ui.tsx","uq-app/uqs/BzWorkshop/ClientSurvey.ui.tsx","uq-app/uqs/BzWorkshop/TagGroup.ui.tsx","uq-app/uqs/BzWorkshop/Tag.ui.tsx","uq-app/uqs/BzWorkshop/TagItem.ui.tsx","uq-app/uqs/BzWorkshop/Workshop.ui.tsx","uq-app/uqs/BzWorkshop/Session.ui.tsx","uq-app/uqs/BzWorkshop/SessionPerson.ui.tsx","uq-app/uqs/BzWorkshopBusTest/BzWorkshopBusTest.ts","uq-app/uqs/BzWorkshopBusTest/id1.ui.tsx","uq-app/uqs/BzWorkshopBusTest/id2.ui.tsx","uq-app/uqs/BzWorkshopBusTest/id3.ui.tsx","uq-app/uqs/BzWorkshopBusTest/id4.ui.tsx","uq-app/uqs/index.ts","uq-app/uqs/BzWorkshop/index.ts","uq-app/uqs/BzWorkshopBusTest/index.ts","uq-app/appConfig.ts","uq-app/App.tsx","tonwa-react/auth/meInfo.tsx","tonwa-react/app/vMain.tsx","tonwa-react/uq/Uq.ts","tonwa-react/uq/uqsProxy.tsx","tonwa-react/app/CAppBase.ts","tonwa-react/app/start.ts","tonwa-react/app/CBase.ts","tonwa-react/app/UqBuildContext.ts","tonwa-react/CStringEdit.tsx","tonwa-react/views/userIcon.tsx","tonwa-react/tool/cacheIds.ts","tonwa-react/components/reloadPage.tsx","tonwa-react/TonwaReact.tsx","tonwa-contoller/View.tsx","tonwa-contoller/Page.tsx","tonwa-contoller/PError.tsx","tonwa-contoller/PWaiting.tsx","tonwa-contoller/Reactive.ts","tonwa-contoller/Controller.ts","tonwa-contoller/CIdBase/CIdBase.ts","tonwa-contoller/AppBase.ts","tonwa-contoller/CIdBase/VSelect.tsx","tonwa-contoller/CIdBase/CSelect.ts","tonwa-contoller/CIdBase/VAdd.tsx","tonwa-contoller/CIdBase/VStart.tsx","tonwa-contoller/CIdBase/VEditId.tsx","tonwa-contoller/CIdBase/IdCache.ts","tonwa-contoller/tool/mutedSmall.tsx","tonwa-contoller/CEdit/VRef.tsx","tonwa-contoller/CEdit/CEdit.ts","tonwa-contoller/CEdit/CCheckEdit.tsx","tonwa-contoller/CEdit/CInputEdit.tsx","tonwa-contoller/CEdit/CIdEdit.tsx","tonwa-contoller/CEdit/CPickEdit.tsx","tonwa-contoller/CEdit/createEdit.tsx","tonwa-contoller/CAdminBase/CAdminBase.ts","tonwa-contoller/CTagBase/VAddTag.tsx","tonwa-contoller/CTagBase/VAddTagItem.tsx","tonwa-contoller/CTagBase/VDeleteTagItem.tsx","tonwa-contoller/CTagBase/VEditTag.tsx","tonwa-contoller/CTagBase/VStart.tsx","tonwa-contoller/CTagBase/VTagGroup.tsx","tonwa-contoller/CTagBase/CTagBase.ts","tonwa-contoller/CTagBase/VTagInput.tsx","tonwa-contoller/CTagBase/CTagInput.ts","tonwa-contoller/CAdminBase/VMeSysAdmin.tsx","tonwa-contoller/CAdminBase/VStart.tsx","tonwa-contoller/CAdminBase/VUser.tsx","App/tool/mutedSmall.tsx","App/tool/renderDate.tsx","App/tool/AutoRun.ts","tonwa-contoller/CUser/VSelectUser.tsx","tonwa-contoller/CUser/CUser.ts","App/CControl.ts","App/CActs/CAct.ts","App/CActs/CClientNotes/VAddNote.tsx","App/CActs/CClientNotes/VClient.tsx","App/CActs/CClientNotes/VStart.tsx","App/CActs/CClientNotes/CClientNotes.ts","App/CActs/CTest/PMain.tsx","App/CActs/CTest/CTest.ts","App/CActs/CWorkshops/VAttendee.tsx","App/CActs/CWorkshops/VSession.tsx","App/CActs/CWorkshops/CSessionAct.ts","App/CActs/CWorkshops/VStart.tsx","App/CActs/CWorkshops/CWorkshops.ts","App/CActs/VStart.tsx","App/CActs/CActs.ts","App/CIds/CId.ts","App/CIds/CPerson/renderPerson.tsx","App/CIds/CPerson/VEditPerson.tsx","App/CIds/CPerson/CPerson.ts","App/CIds/CPerson/CClient/CClient.ts","tonwa-contoller/CEnumBase/CEnumBase.ts","tonwa-contoller/CEnumBase/VEnumSingle.tsx","App/CIds/CPerson/CStaff/renderStaff.tsx","App/CIds/CPerson/CStaff/VEditStaff.tsx","App/CIds/CPerson/CStaff/CStaff.ts","App/CIds/CWorkshop/renderItem.tsx","App/CIds/CWorkshop/VEditWorkshop.tsx","App/CIds/CWorkshop/VSessionList.tsx","App/CIds/CWorkshop/CSession.ts","App/CIds/CIdPick.tsx","App/CIds/CWorkshop/VAddWorkshop.tsx","App/CIds/CWorkshop/CWorkshop.ts","App/CIds/VStart.tsx","App/CIds/CIds.ts","App/CMe/VAbout.tsx","App/CMe/VMe.tsx","App/CMe/VEditMe.tsx","App/CAdmin/VRoleSettings.tsx","App/CAdmin/CAdmin.ts","App/CMe/CMe.ts","App/CTag/CTag.ts","App/VMain.tsx","App/CMain.ts","App/CRouter/CRouter.ts","App/CRouter/CClientSurvey/PClientForm.tsx","App/CRouter/CClientSurvey/PInvalid.tsx","App/CRouter/CClientSurvey/PMain.tsx","App/CRouter/CClientSurvey/CClientSurvey.ts","App/CRouter/routers.ts","logo.svg","App/CHome/VHome.tsx","App/CHome/CHome.ts","App/App.ts","uq-app/res/index.ts","uq-app/res/zh.ts","uq-app/res/en.ts","uq-app/CApp.ts","uq-app/startApp.tsx","index.tsx"],"names":["inputRes","_","required","number","integer","min","max","zh","listRes","none","Navigo","r","useHash","hash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_genericHooks","_historyUpdateMethod","timout","_onLocationChange","console","log","resolve","this","isPushStateAvailable","replace","_cLoc","split","_listen","updatePageLinks","path","to","absolute","_getRoot","_historyUpdate","window","RegExp","location","href","arg0","arg1","handler","hooks","orderedRoutes","Object","keys","sort","compareUrlDepth","forEach","route","on","length","uses","_add","reduce","result","push","current","c","url","GETParameters","extractGETParameters","onlyURL","getOnlyURL","startsWith","query","already","params","matched","match","manageHooks","_callLeave","isHashedRoot","m","name","slice","clearTimeout","removeEventListener","document","_findLinks","link","hasListenerAttached","addEventListener","e","ctrlKey","metaKey","currentTarget","tagName","toLowerCase","getLinkPath","preventDefault","navigate","data","key","toString","status","pause","value","destroy","getAttribute","encodeURI","as","undefined","title","Error","history","pushState","replaceState","cLocRoot","isHashChangeAPIAvailable","cached","check","setTimeout","cleanUrl","call","querySelectorAll","lastRouteResolved","leave","s","names","index","decodeURIComponent","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","map","replaceDynamicURLParts","clean","regExpResultToParams","filter","findMatchedRoutes","colonExp","routeExp","fallbackURL","len","matched0","join","cleanGETParam","str","exHooks","before","shouldRoute","after","LocalData","user","env","localDb","child","guest","unit","_user","_guest","_unit","get","set","d","remove","minute2020_01_01","dateFromMinuteId","id","timeZone","envTimezone","Math","pow","Date","charCodeAt","logMark","tonwa","mobileRegex","emailRegex","logs","TonwaBase","net","testing","createWeb","a","host","start","Tonwa","wsHost","local","navigo","navSettings","language","culture","resUrl","resetAll","hashParam","arrs","forceDevelopment","reloadUser","curUser","logined","logout","notLogined","userPassword","onChangeLogin","reload","waiting","Promise","reject","navigator","race","serviceWorker","ready","registration","unregister","plus","webview","webView","navLogin","showLogin","back","navLogout","showLogout","navRegister","showRegister","navForget","showForget","navPageRoutes","doneSysRoutes","sysRoutes","createLogin","login","lang","resOptions","district","g","msg","messageHub","dispatch","unitJsonPath","fetch","unitRes","json","res","settings","htmlTitle","html0","getElementsByTagName","oem","origin","pathname","item","endsWith","substr","isDevelopment","ws","resHost","resUrlFromHost","setCenterUrl","guestApi","setGuest","init","beforeStart","isMobile","onselectstart","oncontextmenu","nav","clear","ret","userName","password","userApi","pwd","logindUser","error","isWebNav","historyAPIUpdateMethod","alert","showPage","setNetToken","token","uq","roles","me","icon","nick","callback","isUserLogin","logoutApis","saveLocalUser","showAppView","internalLogined","defaultTop","loginTop","logoutClear","setCenterToken","date","getTime","toTimeString","step","navPage","queryStr","routeFromNavPage","internalOnNavRoutes","assign","navOns","indexOf","text","parser","DOMParser","htmlDoc","parseFromString","elHtml","newVersion","getLogin","showChangePassword","showUserQuit","withBack","Caller","$$user","_params","method","UqTokens","uqTokens","i","uqTokenApi","clearLocal","uqOwner","uqName","props","uqToken","centerToken","db","urlTest","realUrl","getUrlOrTest","methodsWithBody","HttpChannel","hostUrl","apiToken","timeout","post","urlPrefix","caller","options","buildOptions","headers","h","p","buildParams","body","JSON","stringify","innerFetch","k","innerFetchResult","now","timeOutHandler","ok","statusText","ct","then","retJson","Array","isArray","retError","catch","err","buildHeaders","CenterHttpChannel","u","UqHttpChannel","subAppWindow","ApiBase","getHttpChannel","channel","xcall","callFetch","put","delete","UqApi","basePath","buildAppUq","channels","uqChannels","arr","getUqToken","role","assigned","parts","trim","theUser","page","entities","CenterApiBase","getCenterChannel","UqTokenApi","localMap","createLocalMap","removeAll","un","localCache","loginedUserId","nowTick","floor","tick","uqParams","CallCenterApi","CenterAppApi","appOwner","appName","uqs","param","UserApi","decodeUserToken","account","type","verify","prop","CenterApi","app","userId","email","mobile","GuestApi","decodeGuestToken","unitName","MessageHub","handlerSeed","anyHandlers","msgHandlers","seed","args0","handlerId","$type","postWsToSubApp","postMessage","WsBase","wsBaseSeed","WsBridge","wsBaseId","WSChannel","that","WebSocket","onopen","ev","onerror","onmessage","wsMessage","onclose","close","event","parse","receive","netThis","connect","send","Net","centerHost","centerChannel","centerApi","callCenterapi","wsBridge","isBuildingUQ","_uqs","process","createLocalDb","Host","createHost","logoutUqTokens","t","EnumResultType","TsTemplate","buildContext","tsHeader","uiPlatform","UqBuildContext","uqsLoader","uqTsSrcPath","tsTemplate","ln","chars","codeBackSlash","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","jName","schema","ver","sys","schemaLocal","uqApi","fields","arrFields","returns","face","fieldMaps","find","v","f","loadEntitySchema","buildSchema","loadValues","setSchema","buildFieldsTuid","version","setJName","setKeys","buildFieldTuid","buildArrFieldsTuid","fieldName","arrName","fn","getTuid","an","fieldArr","tuid","buildFieldsParams","arrResult","pa","rowResult","field","val","buildDateTimeParam","getFullYear","getMonth","getDate","_tuid","getIdFromObj","dt","toISOString","packRow","arrData","getObjPropIgnoreCase","packArr","row","ch","substring","escape","values","boxId","unpackRow","unpackArr","sep","ch0","fLen","reverseNT","n","Number","isNaN","p0","vals","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","uqVersion","en","rebuildSchema","buildEntities","ActionCaller","QueryQueryCaller","unpackReturns","QueryPageCaller","pageStart","pageSize","IdCache","tuidLocal","queue","cache","localArr","waitingIds","tuidInner","createObservableMap","initLocalArr","defer","has","cacheTuids","findIndex","moveToHead","shift","splice","removeItem","_id","getValue","useId","cacheSet","loadIds","tuidValues","cacheIdValues","tuids","unpackTuidIds","tuidValue","cacheValue","cacheTuidFieldValues","ids","loadTuidIdsOrLocal","localedValues","getItem","loadingIds","netIds","loadValuesFromIds","netRet","pos","setItem","IdDivCache","div","divName","UqTuid","noCache","typeName","idName","unique","isImport","TuidBox","obj","id1","ix","Tuid","idValue","TuidInner","divs","cacheFields","idCache","tuidDiv","TuidDiv","valueFromId","resetCache","assureObj","cacheIds","modifyIds","IdsCaller","request","GetCaller","cacheFieldsInValue","arrValues","mainFields","$create","$update","stampOnMain","unpackTuidIdsOfFields","SaveCaller","SavePropCaller","AllCaller","searchArr","owner","SearchCaller","LoadArrCaller","SaveArrCaller","order","ArrPosCaller","TuidNoCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","$order","year","month","TuidImport","from","getObj","assureBox","hasDiv","loadMain","load","save","saveProp","all","search","loadArr","saveArr","posArr","no","ownerField","TuidBoxDiv","TuidsCache","modifyMax","cacheTimer","clearCacheTimer","localModifyMax","seconds","tuidCached","innerPullModify","tuidLists","queueModify","group","modify","UqAction","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","Action","pack","UqSheet","states","ops","op","actions","action","discription","SaveDirectCaller","flow","state","ActionDirectCaller","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","Sheet","SheetCaller","suffix","resVerify","count","UqQuery","isPaged","showWaiting","pageCaller","queryCaller","table","Query","UqBook","queryApiName","BookQueryCaller","Book","UqHistory","History","UqMap","queries","schemaFrom","actionSchema","newAction","querySchema","newQuery","AddCaller","DelCaller","PageCaller","qc","QueryCaller","Map","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","UqPending","Pending","UqEnum","UqID","create","update","ID","global","QueryID","IDX","UqIDX","UqIX","IX","IDCache","uqMan","timeoutHandler","timeOut","TvIdValues","IDTv","UqMan","uqData","entityTypes","enums","idxs","ixs","sheets","books","maps","histories","pendings","tuidsCache","localEntities","proxy","$proxy","config","allRoles","tuidArr","actionArr","queryArr","idArr","idxArr","ixArr","enumArr","sheetArr","bookArr","mapArr","historyArr","pendingArr","Acts","apiActs","retArr","retActs","AdminGetList","getAdmins","AdminSetMe","setMeAdmin","AdminSet","setAdmin","AdminIsMe","isAdmin","IDValue","valueFromString","$Acts","sql","ActIX","apiActIX","$ActIX","ActIXSort","apiActIxSort","$ActIXSort","ActIDProp","ActDetail","apiActDetail","items","main","detail","detail2","detail3","$ActDetail","apiQueryID","$QueryID","apiIDTv","retValues","$tv","nameNoVice","$IDTv","IDNO","apiIDNO","IDEntity","$IDNO","IDDetailGet","apiIDDetailGet","$IDDetailGet","apiID","$ID","KeyID","apiKeyID","$KeyID","apiIX","$IX","IXValues","apiIXValues","IXr","apiIXr","$IXr","KeyIX","apiKeyIX","$KeyIX","IDLog","apiIDLog","$IDLog","IDSum","apiIDSum","$IDSum","IDinIX","apiIDinIX","$IDinIX","IDxID","apiIDxID","$IDxID","IDTree","apiIDTree","$IDTree","getRoles","sheet","loadEntities","access","buildTuids","buildIds","buildAccess","newTuid","newID","entityName","allSchemas","fromType","fromObj","enm","setEntity","book","pending","lName","idEntity","idx","newIDX","newIX","newBook","newMap","newHistory","newSheet","newPending","newEnum","buildSheet","build","buildTuidBox","buildTuidDivBox","uqKey","dev","alias","capitalCase","Proxy","target","receiver","lk","func","errUndefinedEntity","String","UqError","undefined_entity","api","resultType","apiParam","j","nv","tv","prototype","apiPost","IXs","postParam","toScalars","IDXToString","stamp","IX1","ID2","UQsMan","collection","uqMans","uqDataArr","uqConfigs","localCacheVersion","cacheVersion","retErrors","setTuidImportsLocal","uqConfig","ownerAlias","uqLower","buildUQs","uqsData","promiseInits","uqAlias","uqFullName","uqFull","lower","promises","results","setUq","createProxy","getUqKey","getUqKeyWithConfig","errUndefinedUq","message","undefined_uq","setInner","tuidImport","fromName","iName","setFrom","buildingUq","UQsLoader","uqConfigVersion","uqsMan","loadUqs","loadUqData","buildUqs","centerAppApi","uqStringify","Model","MDraft","content","$","IDRet","IDname","IdMain","draftName","details","IdDetail","xi","jwtDecode","ALPHABET","uid","rtn","charAt","random","LocalDb","LocalMap","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","localStorage","sk","LocalArr","keyForRemove","ks","unshift","pop","saveIndex","l","ls","firstCharUppercase","camelCase","ACode","ZCode","fromCharCode","firstCharLowercase","aCode","zCode","Rule","defaultInputRes","resLang","RuleCustom","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","isInteger","Widget","context","itemSchema","fieldProps","children","_itemSchema","_ui","defaultValue","rules","readOnly","disabled","errors","contextErrors","visible","isChanging","onInputChange","evt","changeValue","container","observer","form","inNode","align","render","label","requiredFlag","className","FieldContainer","renderBody","makeObservable","observable","hasError","computed","isOk","getUiItem","ui","buildRules","rule","removeErrorWidget","addErrorWidget","initData","newValue","fromElement","onChanging","onChanged","prev","allowChange","setDataValue","setElementValue","fieldClass","classNames","FieldClass","elDiscription","discriptionClassName","uiLabel","Templet","errorList","tag","React","TextWidget","inputType","input","hasFocus","onKeyDown","internalOnKeyDown","keyCode","onEnter","blur","setError","onBlur","runInAction","checkRules","checkContextRules","onFocus","clearError","clearErrors","focus","select","placeholder","renderTemplet","cn","ref","onChange","maxLength","renderErrors","TextAreaWidget","setValue","rows","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","trueValue","falseValue","checked","onClick","cnAlign","defaultChecked","SelectWidget","option","list","radioStyle","height","RadioWidget","inputs","rowKey","isRow","style","RangeWidget","IdWidget","pickId","clearContextError","Unknown","dataType","uiType","dataTypes","ButtonWidget","submit","onButtonClick","observerRender","caption","widgetType","widget","button","ButtonClass","Context","uiSchema","subContexts","widgets","errorWidgets","arrRowContexts","itemName","getDisabled","setDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","ew","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","checkHasError","clearContextErrors","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","onDeleted","onRestored","arrLabel","ArrContainer","RowContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","first","rowContent","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","Image","src","altImage","alt","onError","Loading","b","badge","size","color","badgeAlign","badgeVertical","LMR","cursor","left","right","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","IconText","iconClass","textClass","ResUploader","fileInput","fileName","upload","formData","buildFormData","Headers","append","onFilesChange","files","maxSize","FormData","file","multiple","display","formatSize","pointLength","units","toFixed","xlargeSize","mediumSize","ImageUploader","imgBaseSize","imageTypes","resUploader","desImgWidth","desImgHeight","desImgSize","srcImgWidth","srcImgHeight","isChanged","resId","enableUploadButton","srcImage","desImage","fileError","uploaded","onFileChange","lastIndexOf","reader","FileReader","readAsDataURL","onload","setSize","compress","img","width","w","scale","round","canvas","createElement","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","onSaved","showOrgImage","header","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","levelDiv","padding","ItemEdit","fileSize","uploading","AudioUploader","audioTypes","edit","uiItem","_uiItem","internalStart","internalEnd","divValue","labelHide","templet","verifyRule","ImageItemEdit","ImageWidget","imageSrc","end","TagWidget","TagSingleWidget","valuesView","wrapClassName","inputName","renderRadios","TagMultiWidget","defaultArr","def","renderChecks","PickWidget","pick","stringWidget","widgetFactories","string","textarea","datetime","time","updown","checkbox","image","checkboxes","radio","tagSingle","tagMulti","range","typeWidget","getItemSchema","getTypeWidget","hiden","widgetFactory","WidgetClass","Form","formContext","disposer","Container","watch","calcSelectOrDelete","DefaultContainer","onSubmit","DefaultFieldContainer","fieldLabelSize","fieldLabelAlign","labelView","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","autorun","dv","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","FormField","contextType","StringItemEdit","preValue","verifyValue","onSave","inputOptions","element","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","CheckBoxItemEdit","onItemChanged","RangeItemEdit","NumberItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","editInRow","onItemClick","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","ie","createItemEdit","divLabel","requireFlag","ListBase","loading","pageItems","Clickable","Static","Selectable","_items","inputItems","buildItems","itemsArray","isItemSelected","selectedItems","compare","retItems","selected","labelId","comp","selectItem","si","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","some","List","listBase","_$scroll","direct","buildBase","prevProps","prevState","isEqual","forceUpdate","dispose","selectAll","unselectAll","footer","waitingMore","tabIndex","isLoading","staticRow","timeRes","md","ymd","yesterday","today","tomorrow","$zh","$en","tt","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","getMinutes","appendTime","dPart","hm","setRes","EasyTime","PropRow","PropBorder","borderTop","PropGap","valueAlignStart","valueAlignCenter","valueAlignEnd","LabeledPropRow","gridProps","_prop","col","labelFixLeft","bk","renderLabel","renderProp","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","component","PropView","buildRows","isGap","setValues","PropGrid","propView","SearchBox","allowEmptySearch","initKey","onSearch","inputSize","autoComplete","inputClassName","buttonText","Ax","axProps","aClassName","naClassName","openSysPage","Input","requiredFlagElement","ruleMessage","defaultRequiredFlagElement","onValueChange","inp","containerClassName","ruleClassName","defaultRuleClassName","valueFromInput","Component","InputNumber","defaultClassName","parseFloat","parseValue","InputCheckBox","red","lastBuildTime","saveSrcTsFileIfNotExists","saveTsFileIfNotExists","saveTsFile","srcFile","tsFile","fs","existsSync","renameSync","writeFileSync","overrideTsFile","tsFilePath","getNameFromUq","devPart","uqPart","devName","ControllerWithWeb","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","webNav","registerReceiveHandler","afterStart","vp","open","Controller","View","controller","x","getTonwa","shallow","deep","V","bind","vm","afterBack","go","view","onClosePage","openPage","replacePage","backPage","level","closePage","ceasePage","removeCeased","confirmClose","regConfirmClose","popToTopPage","VPage","retOnClosePage","_onClosePage","openPageElement","renderPage","replacePageElement","onScroll","onPageScroll","onScrollTop","scroller","onPageScrollTop","onScrollBottom","onPageScrollBottom","headerClassName","tabsProps","pageWebNav","Page","tabsView","TabsView","inWebNav","pageHeaderProps","center","rph","renderPageHeader","elFooter","errorInfo","renderHeader","renderFooter","pl","decode","exec","sUnit","tc","from62","test","el","getElementById","innerText","innerHTML","parseInt","languages","toUpperCase","getTimezoneOffset","userAgent","initEnv","browser","detectBrowser","ms","args","handle","setInterval","clearInterval","documentMode","internalT","isDev","topPageKey","buildReactiveProps","ob","beforeInit","getPageWebNav","afterInit","$lang","$district","replaceOpen","onEvent","ceaseTop","topKey","popTo","yes","buttons","Scroller","scrollTo","scrollTop","offsetHeight","scrollTimeGap","ScrollViewBase","bottomTime","topTime","refDiv","onResize","sh","scrollHeight","top","Children","eachChild","ScrollView","WebNavScrollView","vHeader","vFooter","navHeader","navRawHeader","navFooter","navRawFooter","__ls","stackKey","notSupportedBrowsers","NavView","stack","waitCount","waitTimeHandler","isHistoryBack","navBack","confirm","self","backIcon","closeIcon","notSupportedBrowser","wait","ceased","refresh","backLevel","popAndDispose","elWait","zIndex","visibility","position","setState","onLogined","onNotLogined","resGlobal","importCLogin","CLogin","importCRegister","CRegister","CForget","digits","c0","c9","A","Z","z","NaN","onBack","ex","vBack","debugLogout","rightView","Tab","loaded","contentBuilder","notify","onShown","_content","TabCaptionComponent","tabBg","selectedTab","tabArr","tabClick","tab","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","num","displayNone","pageHeader","pageFooter","tabBack","isSelected","buildFieldItem","isKey","$FieldItemType","fieldItemType","VLogout","onLogout","VLogin","onLogin","username","sender","getSender","defaultLoginTop","privacyEntry","VChangePassword","orgPassword","newPassword","newPassword1","waitingTime","VUserQuitBase","button1Caption","onClickButton1","button2Caption","onClickButton2","note","renderButton1","renderButton2","VUserQuit","openVPage","VQuitConfirm","userQuit","VQuitDone","userLogined","vPage","getVChangePassword","changePassword","logo","senders","regex","rootCenterHost","uqDebugHost","hosts","centerhost","reshost","uqhost","unitxhost","httpArr","urlFromHost","isAbsoluteUrl","centerUrlFromHost","centerWsFromHost","https","fetchOptions","mode","doc","tryLocal","getCenterHost","getResHost","includes","testProd","getUrlOrDebug","urlDebug","localCheck","HostForDeveloping","hostArr","fetchUrl","debugHostUrl","hostValue","debugHost","fetchLocalCheck","setResOptions","setGlobalRes","fieldItemReplaceProps","TsUqFolder","uqsFolder","uqFolder","mkdirSync","tsUq","TsUQ","saveTuidAndIDTsIndexAndRender","imports","sets","coll","sName","cName","tsUI","toLocaleLowerCase","buildFields","tsFieldArr","buildFieldArr","replaceTsFileFields","tsImportFieldItemsBegin","tsImportFieldItemsEnd","replaceTsFileString","begin","tsIndex","readdirSync","fileEntityName","unFile","unlinkSync","buildIDFields","buildIDXFields","buildIXFields","ts","buildIDFieldArr","buildIDXFieldArr","buildIXFieldArr","readFileSync","startStr","lBrace","rBrace","oldText","fieldsText","buildFieldsFromOldText","setFieldOldProp","buildFieldText","fieldStart","fieldText","eval","sec","fieldTypeMap","sysFields","buildTuid","buildTuidInterface","buildAction","buildActionInterface","buildArrs","buildReturns","buildEnumInterface","buildQuery","buildQueryInterface","buildSheetInterface","buildBook","buildBookInterface","buildMap","buildMapInterface","buildHistory","buildHistoryInterface","buildPending","buildPendingInterface","buildID","buildIDX","buildIX","buildIDInterface","schemaKeys","others","buildIDXInterface","repeat","buildIDXActParamInterface","buildIXInterface","tsImport","appendArr","tsBuild","tsLen","uqEntityInterface","buildActsInterface","uqBlock","buildInterface","entityCode","isInID","indent","buildField","q","af","retName","EnumOpType","Gender","Role","hasEntity","biz","opType","postItem","ratio","span","ratioInit","memo","object","opi","itemHistory","booking","staff","client","sensitive","vice","firstName","lastName","middleName","gender","day","mobileCountry","single","workshop","session","person","deleted","setUI","BzWorkshop","Draft","Biz","BizPack","Op","Item","OpiBooking","Opi","ItemHistory","OpiHistory","Note","Person","ClientSurvey","TagGroup","Tag","TagItem","Workshop","Session","SessionPerson","Id1","Id2","Id3","Id4","BzWorkshopBusTest","appConfig","devs","uqsFromConfigs","noUnit","VErrorsPage","VStartError","Uq","$_uqMan","$_uqSql","IDRender","renderIDUnknownType","IDType","IDV","IDLocalV","IDLocalRender","$_createUqSqlProxy","uqsProxy","TuidView","uqReacts","$_createProxy","onUqProxyError","CAppBase","timezone","unitTimezone","unitBizMonth","unitBizDate","uqsUser","$getTimezone","tz","unitTimeZone","bm","bd","afterBuiltUQs","onNavRoutes","initUQs","resolveRoute","userFromId","userFromKey","userRoles","getUqUserRoles","setUqRoles","CApp","html","cApp","staticUserCache","UserCache","loader","onLoaded","reason","getUserCache","noneImage","idProp","userCache","useUser","use","ReloadPage","timerHandler","ConfirmReloadPage","TonwaReact","navView","windowOnError","source","lineno","colno","windowOnUnhandledRejection","showPrivacyPage","privacy","getPrivacyContent","privacyPage","htmlString","__html","dangerouslySetInnerHTML","showReloadPage","upgradeUq","setCreateLogin","WebInReact","onunhandledrejection","onfocus","show","LocalStorageDb","ObservableMap","renderAdmin","renderRole","renderAdminOrRole","beforeWaiting","afterWaiting","offsetWidth","setAttribute","elWaiting","appendChild","removeChild","callValue","renderError","react","openError","PError","PWaiting","deepReact","shallowReact","setReact","EnumSelectType","isWaiting","Pg","afterClose","promise","AppBase","VSelect","cId","VSelectOne","renderItem","vItem","vIcon","valueRender","renderItemOnSelect","callReturn","vNew","allowNew","onNew","shallowData","CSelect","setAfterAdd","loadItemsFromIds","onAdd","listAll","CSelectOne","VAdd","onSaveId","VSucceed","renderForm","onNext","onExit","VStart","renderItemInList","deepData","onEditItem","VEditId","propValueSave","savePropValue","currentItem","vProps","onEdit","cEdit","createEdit","renderEditIcon","renderRef","renderProps","renderTagInput","vTagInput","loadValue","setCache","mutedSmall","CIdBase","initNO","addedIds","afterAddCallback","initAdd","afterAdded","loadToList","beforeEdit","VEdit","getID","isGlobal","loadList","setIDDeepList","saveId","renderIdValue","getIdValue","VRef","shallowValue","VEditIcon","CEdit","CCheckEdit","CEditWithPage","VEditPage","exView","InputType","CStringEdit","VStringPage","CDateEdit","VDatePage","CDateTimeEdit","VDateTimePage","CTimeEdit","VTimePage","CIdEdit","VIdEditPage","CPickEdit","EnumAdminRoleInEdit","VAddTag","onSaveTag","VAddTagItem","onSaveTagItem","VDeleteTagItem","stopPropagation","VEditTag","onRemoveTag","currentTag","removeTag","tagItem","onEditTagItem","onAddTagItem","tagPropSave","groups","openTagGroup","VTagGroup","renderTag","onTagClick","onEditTag","currentGroup","onAddTag","tags","CTagBase","tagGroups","groupsLoaded","IxTag","resetGroups","onTagItemChanged","onTagItemDeleted","loadGroups","groupName","tagGroup","tagColl","VTagInput","renderTagItem","radioName","Fragment","tagMap","onCheckChange","CTagInput","cTag","IxID","itemId","pid","idOfItem","checkValue","tagGroupName","loadGroup","InputView","cnRow","cnBg","cnMYLg","cnSmallMuted","info","VMeSysAdmin","meAdmin","renderQuiting","renderAm","dateUpdate","dateUpdateNextDay","showMeSysAdmin","toLocaleDateString","toLocaleTimeString","onMeSystemAdmin","sysAdmins","renderAdminItem","admin","cUser","renderUser","renderMe","renderSysAdmins","renderAdmins","nSys","renderMeSystemAdmin","quiting","rightAngle","renderAdd","onUser","admins","onAddAdmin","VUser","onDelAdmin","vDel","operator","onEditRemark","CAdminBase","adminsChanged","onAdmin","removeAdmin","cStringEdit","loadAdmins","retAdmins","openMain","captionSelectUser","listAdd","listDel","toDateString","renderHourMinute","gaps","AutoRun","poke","refreshAction","timer","refreshTime","gapIndex","callTick","stop","VSelectUser","onSelected","searchUser","vContent","CUser","userFromName","userFromCache","loadUser","CControl","CAct","cActs","VAddNote","saveNote","VClient","renderLog","renderLogContent","showAddNote","notes","renderNote","renderSessionPerson","vLock","noteContent","isPersonMe","sessionPerson","cIds","cWorkshop","cStaff","cSession","renderId","cClient","cSelectOne","showClient","clients","CClientNotes","IxPersonLog","SaveNote","submitReturns","loadClients","MyClients","PMain","waitingEvent","onTestSave","onTestLoad","CTest","mDraft","saveMain","saveDetail","IxDraft","VAttendee","changeSessionClient","VSession","renderAttendee","attendee","vChanged","onAddAttendee","addAttendee","substitue","done","showAttendee","CSessionAct","cWorkshops","sessionId","clientId","ixValue","SaveSessionAttendee","IxSessionClient","renderWorkshopItem","sessions","onWorkshopClick","renderSessionItem","onSessionClick","openSession","workshopItems","CWorkshops","MySessions","workshopItem","wa","wb","showClientNotes","showRegisterWorkshop","showTest","CActs","CId","cTagInput","IxGlobalIdTag","initID","renderInput","renderPerson","vUser","VEditPerson","rightIcon","onBindUser","renderCurrentUser","VBound","onChangeUser","onRemoveBound","btnRemove","CPerson","IxUserPerson","GetPersonList","personRole","retRoles","mPerson","isInRole","IxPersonRole","PersonSearch","renderSelectPerson","CClient","isAdminOrRole","counselor","CEnumBase","enumCaptions","VInput","CEnumSingle","saveIxEnum","OnEnumChanged","VEnumSingle","roleCaption","volunteer","VEditStaff","renderBindUser","renderRoles","cRoleSingle","staffRoles","staffRoleCaptions","CStaff","onRoleChanged","CRoleSingle","vRole","renderStaff","VEditWorkshop","renderStaffPick","renderList","VSessionList","CSession","IxWorkshopSession","IxSessionStaff","CIdPick","deepValue","renderInit","renderNA","VAddWorkshop","CWorkshop","SaveWorkshopStaff","isVisible","CIds","onWorkshop","onClient","onStaff","VAbout","VMe","meInfo","showEditMe","userSpan","about","aboutRows","cAdmin","VEditMe","userSetProp","gridRows","VRoleSettings","CAdmin","CMe","unitOwner","rootUnits","backend","myRolesChanged","CTag","IxLocalIdTag","VMain","cHome","cMe","CMain","CRouter","pathParam","PClientForm","PInvalid","onStart","CClientSurvey","VHome","CHome","App","autoRun","appNav","meRoles","poked","$poked","Control","routers","openLogin","isRole","buildRoles","typeValues","home","relation","discover","supervise","debug","aboutTheApp","pleaseLogin","AppNav","loadBaseData","appStart","loginedOnly","renderNavView","setSettings","ReactDOM","StrictMode","startApp"],"mappings":"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","file":"static/js/main.8fdfdda9.chunk.js","sourcesContent":["import { KeyValueRes, Res } from './res';\r\n\r\nexport interface InputRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const inputRes:Res<InputRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '必须填',\r\n            number: '需要数字',\r\n            integer: '需要整数',\r\n            min: '不能小于${min}',\r\n            max: '不能大于${max}',\r\n        }\r\n    },\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[无]',\r\n        }\r\n    },\r\n}\r\n","// typescript version of krasimir/navigo\r\n\r\nexport type RouteFunc = (params?: string | { [name: string]: string }, query?: string) => void;\r\n\r\nexport interface NamedRoute {\r\n\tas: string;\r\n\tuses: RouteFunc;\r\n\thooks?: Hooks;\r\n}\r\nexport interface Hooks {\r\n\tbefore: (done: () => void, params: object) => void;\r\n\tafter: (params: object) => void;\r\n\tleave: (params: object) => void;\r\n\talready: (params: object) => void;\r\n}\r\ninterface Handler {\r\n\thandler: RouteFunc;\r\n\thooks: Hooks;\r\n}\r\ninterface LastResolved {\r\n\turl: string;\r\n\tquery: string;\r\n\thooks: Hooks;\r\n\tparams?: { [name: string]: string };\r\n\tname?: string;\r\n}\r\ninterface Route {\r\n\troute: string | RegExp;\r\n\thandler: RouteFunc,\r\n\tname: string,\r\n\thooks: Hooks\r\n}\r\n\r\nexport class Navigo {\r\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\r\n\tprivate static WILDCARD_REGEXP = /\\*/g;\r\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// 单\\，编译错误 ([^\\/]+)\r\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\r\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// 单\\，编译错误 (?:\\/$|$)\r\n\tprivate static MATCH_REGEXP_FLAGS = '';\r\n\r\n\tprivate static isPushStateAvailable() {\r\n\t\treturn !!(\r\n\t\t\ttypeof window !== 'undefined' &&\r\n\t\t\twindow.history &&\r\n\t\t\twindow.history.pushState\r\n\t\t);\r\n\t}\r\n\r\n\tprivate static clean(s: string | RegExp) {\r\n\t\tif (s instanceof RegExp) return s;\r\n\t\treturn Navigo.cleanUrl(s);\r\n\t}\r\n\tprivate static cleanUrl(s: string) {\r\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\r\n\t}\r\n\r\n\tprivate static regExpResultToParams(match: any[], names: string[]) {\r\n\t\tif (names.length === 0) return null;\r\n\t\tif (!match) return null;\r\n\t\treturn match\r\n\t\t\t.slice(1, match.length)\r\n\t\t\t.reduce((params, value, index) => {\r\n\t\t\t\tif (params === null) params = {};\r\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\r\n\t\t\t\treturn params;\r\n\t\t\t}, null);\r\n\t}\r\n\r\n\tprivate static replaceDynamicURLParts(route: string | RegExp) {\r\n\t\tlet paramNames: string[] = [], regexp: RegExp;\r\n\r\n\t\tif (route instanceof RegExp) {\r\n\t\t\tregexp = route;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregexp = new RegExp(\r\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\r\n\t\t\t\t\tparamNames.push(name);\r\n\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\r\n\t\t\t\t})\r\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\r\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\r\n\t\t}\r\n\t\treturn { regexp, paramNames };\r\n\t}\r\n\r\n\tprivate static getUrlDepth(url: string): number {\r\n\t\treturn url.replace(/\\/$/, '').split('/').length;\r\n\t}\r\n\r\n\tprivate static compareUrlDepth(urlA: string, urlB: string) {\r\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\r\n\t}\r\n\r\n\tprivate static findMatchedRoutes(url: string, routes: Route[] = []) {\r\n\t\treturn routes.map(route => {\r\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\r\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\r\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\r\n\t\t\treturn match ? { match, route, params } : false;\r\n\t\t}).filter(m => m);\r\n\t}\r\n\r\n\tprivate static match(url: string, routes: Route[]) {\r\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\r\n\t}\r\n\r\n\tprivate static root(url: string, routes: Route[]) {\r\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\r\n\t\tconst exp = ''; // '($|\\\\/)';  // 单\\，编译报错 ($|\\/)\r\n\t\tlet matched = routes.map(\r\n\t\t\troute => {\r\n\t\t\t\tlet r = route.route;\r\n\t\t\t\tif (r === '' || r === '*') return url;\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/(\\\\w|%|[\\u4E00-\\u9FCC])+');\r\n\t\t\t\t}\r\n\t\t\t\tlet routeExp = r + exp;\r\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\r\n\t\tlet len = matched.length;\r\n\t\tif (len === 0) return fallbackURL;\r\n\t\tlet matched0 = matched[0];\r\n\t\tif (len === 1) return matched0;\r\n\t\treturn matched.reduce((result, url) => {\r\n\t\t\tif (result.length > url.length) result = url;\r\n\t\t\treturn result;\r\n\t\t}, matched0);\r\n\t}\r\n\r\n\tprivate static isHashChangeAPIAvailable() {\r\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\r\n\t}\r\n\r\n\tprivate static extractGETParameters(url: string): string {\r\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\r\n\t}\r\n\r\n\tprivate static getOnlyURL(url: string, useHash: boolean, hash: string) {\r\n\t\tlet onlyURL = url, split: string[];\r\n\t\tvar cleanGETParam = (str: string) => str.split(/\\?(.*)?$/)[0];\r\n\r\n\t\tif (typeof hash === 'undefined') {\r\n\t\t\t// To preserve BC\r\n\t\t\thash = '#';\r\n\t\t}\r\n\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t\tonlyURL = cleanGETParam(url).split(hash)[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsplit = url.split(hash);\r\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\r\n\t\t}\r\n\t\treturn onlyURL;\r\n\t}\r\n\r\n\tprivate static manageHooks(handler: RouteFunc, hooks: Hooks, params?: any, exHooks?: Hooks) {\r\n\t\tif (hooks && typeof hooks === 'object') {\r\n\t\t\tif (hooks.before) {\r\n\t\t\t\thooks.before((shouldRoute = true) => {\r\n\t\t\t\t\tif (!shouldRoute) return;\r\n\t\t\t\t\thandler();\r\n\t\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\t}, params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (hooks.after) {\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler();\r\n\t}\r\n\r\n\tprivate static isHashedRoot(url: string, useHash: boolean, hash: string) {\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!url.match(hash)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tlet split = url.split(hash);\r\n\r\n\t\treturn split.length < 2 || split[1] === '';\r\n\t}\r\n\r\n\tprivate root: string;\r\n\tprivate _routes: Route[] = [];\r\n\tprivate _useHash: boolean;\r\n\tprivate _hash: string;\r\n\tprivate _paused: boolean;\r\n\tprivate _destroyed: boolean;\r\n\tprivate _lastRouteResolved: LastResolved;\r\n\tprivate _notFoundHandler: Handler;\r\n\tprivate _defaultHandler: Handler;\r\n\tprivate _usePushState: boolean;\r\n\tprivate _genericHooks: Hooks;\r\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\r\n\tprivate timout: any; //NodeJS.Timeout;\r\n\r\n\tconstructor(r: string = null, useHash: boolean = false, hash: string = '#') {\r\n\t\tthis.root = null;\r\n\t\tthis._useHash = useHash;\r\n\t\tthis._hash = (!hash) ? '#' : hash;\r\n\t\tthis._paused = false;\r\n\t\tthis._destroyed = false;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._notFoundHandler = null;\r\n\t\tthis._defaultHandler = null;\r\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\r\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\r\n\t\tthis._genericHooks = null;\r\n\t\tthis._historyUpdateMethod = 'pushState';\r\n\r\n\t\tif (r) {\r\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\r\n\t\t} else if (useHash) {\r\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\r\n\t\t}\r\n\r\n\t\tthis._listen();\r\n\t\tthis.updatePageLinks();\r\n\t}\r\n\r\n\tnavigate(path: string, absolute: boolean = false): Navigo {\r\n\t\tlet to: string;\r\n\t\tpath = path || '';\r\n\t\tif (this._usePushState) {\r\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\r\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\r\n\t\t\tto = to.replace('/#test/', '/');\r\n\t\t\tthis._historyUpdate({}, '', to);\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t\telse if (typeof window !== 'undefined') {\r\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\r\n\t\t\tlet { location } = window;\r\n\t\t\tlocation.href = location.href\r\n\t\t\t\t.replace(/#$/, '')\r\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ton(routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(url: string, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(regex: RegExp, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(options: { [url: string]: RouteFunc | NamedRoute }): Navigo;\r\n\ton(...args: any[]): Navigo {\r\n\t\tlet arg0 = args[0];\r\n\t\tlet arg1 = args[1];\r\n\t\tswitch (typeof arg0) {\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\r\n\t\t\t\tif (!this._notFoundHandler) {\r\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'object':\r\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\r\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (args.length < 2) break;\r\n\t\t\t\tif (arg0 === '/') {\r\n\t\t\t\t\tthis._defaultHandler = {\r\n\t\t\t\t\t\thandler: typeof arg1 === 'object' ? arg1.uses : arg1,\r\n\t\t\t\t\t\thooks: args[2],\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis._add(arg0, arg1, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(handler: RouteFunc): Navigo {\r\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\r\n\t\t\tthis._defaultHandler = null;\r\n\t\t}\r\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\r\n\t\t\tthis._notFoundHandler = null;\r\n\t\t}\r\n\t\tthis._routes = this._routes.reduce((result, r) => {\r\n\t\t\tif (r.handler !== handler) result.push(r);\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnotFound(handler: RouteFunc, hooks: Hooks): Navigo {\r\n\t\tthis._notFoundHandler = { handler, hooks };\r\n\t\treturn this;\r\n\t}\r\n\r\n\tresolve(current?: string) {\r\n\t\tlet c = current || this._cLoc();\r\n\t\tlet root = this._getRoot();\r\n\t\tlet url = c.replace(root, '');\r\n\r\n\t\tif (this._useHash) {\r\n\t\t\tconst exp = '^\\\\/';  // 单\\，编译报错 ^\\/\r\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\r\n\t\t}\r\n\r\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\r\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\r\n\t\tif (onlyURL.startsWith('/') === false) {\r\n\t\t\tonlyURL = '/' + onlyURL;\r\n\t\t}\r\n\r\n\t\tif (this._paused) return false;\r\n\r\n\t\tif (\r\n\t\t\tthis._lastRouteResolved &&\r\n\t\t\tonlyURL === this._lastRouteResolved.url &&\r\n\t\t\tGETParameters === this._lastRouteResolved.query\r\n\t\t) {\r\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\r\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\r\n\r\n\t\tlet manageHooks = (handler: Handler) => {\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\thooks: handler.hooks\r\n\t\t\t\t\t};\r\n\t\t\t\t\thandler.handler(GETParameters);\r\n\t\t\t\t}, handler.hooks);\r\n\t\t\t}, this._genericHooks);\r\n\t\t}\r\n\r\n\t\tif (matched === false) {\r\n\t\t\tif (this._defaultHandler && (\r\n\t\t\t\tonlyURL === '' ||\r\n\t\t\t\tonlyURL === '/' ||\r\n\t\t\t\tonlyURL === this._hash ||\r\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\r\n\t\t\t)) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._defaultHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._defaultHandler);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (this._notFoundHandler) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._notFoundHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._notFoundHandler);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tlet m = matched;\r\n\t\tif (m) {\r\n\t\t\tthis._callLeave();\r\n\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\turl: onlyURL,\r\n\t\t\t\tquery: GETParameters,\r\n\t\t\t\thooks: m.route.hooks,\r\n\t\t\t\tparams: m.params,\r\n\t\t\t\tname: m.route.name\r\n\t\t\t};\r\n\t\t\tlet handler = m.route.handler;\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tm.route.route instanceof RegExp ?\r\n\t\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\r\n\t\t\t\t\t\thandler(m.params, GETParameters);\r\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\r\n\t\t\t}, this._genericHooks, m.params);\r\n\t\t\treturn m;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._routes = [];\r\n\t\tthis._destroyed = true;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._genericHooks = null;\r\n\t\tclearTimeout(this.timout);\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\r\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePageLinks() {\r\n\t\t//var self = this;\r\n\t\tif (typeof document === 'undefined') return;\r\n\t\tthis._findLinks().forEach(link => {\r\n\t\t\tif (!link.hasListenerAttached) {\r\n\t\t\t\tlink.addEventListener('click', (e: any) => {\r\n\t\t\t\t\t// e: React.MouseEvent<HTMLElement>\r\n\t\t\t\t\tif ((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a') { return false; }\r\n\t\t\t\t\tvar location = this.getLinkPath(link);\r\n\r\n\t\t\t\t\tif (!this._destroyed) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlink.hasListenerAttached = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgenerate(name: string, data: any = {}) {\r\n\t\tlet result = this._routes.reduce((result, route) => {\r\n\t\t\tif (route.name === name) {\r\n\t\t\t\tresult = route.route.toString();\r\n\t\t\t\tfor (let key in data) {\r\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}, '');\r\n\r\n\t\treturn this._useHash ? this._hash + result : result;\r\n\t}\r\n\r\n\tlink(path: string) {\r\n\t\treturn this._getRoot() + path;\r\n\t}\r\n\r\n\tpause(status: boolean = true) {\r\n\t\tthis._paused = status;\r\n\t\tif (status) {\r\n\t\t\tthis._historyUpdateMethod = 'replaceState';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tthis.pause(false);\r\n\t}\r\n\r\n\thistoryAPIUpdateMethod(value: 'pushState' | 'replaceState') {\r\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\r\n\t\tthis._historyUpdateMethod = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdisableIfAPINotAvailable() {\r\n\t\tif (!Navigo.isPushStateAvailable()) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tlastRouteResolved() {\r\n\t\treturn this._lastRouteResolved;\r\n\t}\r\n\r\n\tgetLinkPath(link: any) {\r\n\t\treturn link.getAttribute('href');\r\n\t}\r\n\r\n\thooks(hooks: Hooks) {\r\n\t\tthis._genericHooks = hooks;\r\n\t}\r\n\r\n\tprivate _add(route: string | RegExp, handler: RouteFunc | NamedRoute, hooks: Hooks) {\r\n\t\tif (typeof route === 'string') {\r\n\t\t\troute = encodeURI(route);\r\n\t\t}\r\n\t\tthis._routes.push(\r\n\t\t\ttypeof handler === 'object' ?\r\n\t\t\t\t{\r\n\t\t\t\t\troute,\r\n\t\t\t\t\thandler: handler.uses,\r\n\t\t\t\t\tname: handler.as,\r\n\t\t\t\t\thooks: hooks || handler.hooks\r\n\t\t\t\t}\r\n\t\t\t\t:\r\n\t\t\t\t{\r\n\t\t\t\t\troute,\r\n\t\t\t\t\thandler,\r\n\t\t\t\t\tname: undefined,\r\n\t\t\t\t\thooks,\r\n\t\t\t\t}\r\n\t\t);\r\n\t\treturn this._add;\r\n\t}\r\n\r\n\tprivate _historyUpdate(data: any, title: string, url?: string) {\r\n\t\tswitch (this._historyUpdateMethod) {\r\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\r\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\r\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getRoot() {\r\n\t\tif (this.root === null) {\r\n\t\t\tlet cLoc = this._cLoc();\r\n\t\t\tlet cLocRoot = cLoc.split('?')[0];\r\n\t\t\tthis.root = Navigo.root(cLocRoot, this._routes);\r\n\t\t}\r\n\t\tlet root = this.root.replace('#test', '');\r\n\t\treturn root;\r\n\t}\r\n\r\n\tprivate _listen() {\r\n\t\tif (this._usePushState) {\r\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\r\n\t\t}\r\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\r\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cached = this._cLoc();\r\n\r\n\t\t\tlet check = () => {\r\n\t\t\t\tlet current = this._cLoc();\r\n\t\t\t\tif (cached !== current) {\r\n\t\t\t\t\tcached = current;\r\n\t\t\t\t\tthis.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\r\n\t\t\t\tthis.timout = setTimeout(check, 200);\r\n\t\t\t};\r\n\t\t\tcheck();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _cLoc() {\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\r\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\r\n\t\t\t//}\r\n\t\t\tlet { href } = window.location;\r\n\t\t\treturn Navigo.cleanUrl(href);\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate _findLinks() {\r\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\r\n\t}\r\n\r\n\tprivate _onLocationChange = () => {\r\n\t\tconsole.log('_onLocationChange');\r\n\t\tthis.resolve();\r\n\t}\r\n\r\n\tprivate _callLeave() {\r\n\t\tconst lastRouteResolved = this._lastRouteResolved;\r\n\t\tif (lastRouteResolved) {\r\n\t\t\tlet { params, hooks } = lastRouteResolved;\r\n\t\t\tif (hooks) {\r\n\t\t\t\tif (hooks.leave) {\r\n\t\t\t\t\thooks.leave(params);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","import { env } from \"./env\";\r\n\r\nconst options:Intl.DateTimeFormatOptions = { \r\n\tweekday: 'long', \r\n\tyear: 'numeric', \r\n\tmonth: 'long', \r\n\tday: 'numeric' \r\n}\r\n\r\nexport function toLocaleDateString(date:Date) {\r\n\tif (!date) return '';\r\n\treturn date.toLocaleDateString('zh-cn', options);\r\n}\r\n\r\nexport const minute2020_01_01 = 26297280;  // 2020-1-1 到 1970-1-1 的毫秒数\r\nexport function dateFromMinuteId(id: number, timeZone?: number): Date {\r\n\tlet envTimezone = env.timeZone;\r\n\tlet m = (id / Math.pow(2, 20)) + (- envTimezone + (timeZone??envTimezone)) * 60;\r\n\treturn new Date((m + minute2020_01_01) * 60000);\r\n}\r\n\r\nexport function dateFromHourId(id: number, timeZone?: number): Date {\r\n\tlet envTimezone = env.timeZone;\r\n\tlet m = id + (- envTimezone + (timeZone??envTimezone));\r\n\treturn new Date((m + minute2020_01_01/60) * 60 * 60000);\r\n}\r\n","export function capitalCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\treturn parts.map(v => firstCharUppercase(v)).join('_');\r\n}\r\n\r\nexport function camelCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\tlet len = parts.length;\r\n\tparts[0] = firstCharLowercase(parts[0]);\r\n\tfor (let i=1; i<len; i++) {\r\n\t\tparts[1] = firstCharUppercase(parts[1]);\r\n\t}\r\n\treturn parts.join('_');\r\n}\r\n\r\nconst aCode = 'a'.charCodeAt(0);\r\nconst zCode = 'z'.charCodeAt(0);\r\nfunction firstCharUppercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= aCode && c <= zCode) {\r\n\t\treturn String.fromCharCode(c - 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\nconst ACode = 'A'.charCodeAt(0);\r\nconst ZCode = 'Z'.charCodeAt(0);\r\nfunction firstCharLowercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= ACode && c <= ZCode) {\r\n\t\treturn String.fromCharCode(c + 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\n","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\r\n}\r\n","import { Navigo, Hooks, NamedRoute, RouteFunc } from \"./Navigo\";\r\nimport { Nav, NavPage } from './Nav';\r\nimport { Net, User, Guest } from 'tonwa-uq';\r\nimport { resOptions } from '../res';\r\nimport { LocalData, env } from '../tool';\r\nimport { Login } from './Login';\r\n\r\nexport interface NavSettings {\r\n\toem?: string;\r\n\tloginTop?: any; // JSX.Element\r\n\tprivacy?: string;\r\n\thtmlTitle?: string;\r\n}\r\n\r\nlet logMark: number;\r\nconst logs: string[] = [];\r\n\r\nexport let tonwa: Tonwa;\r\n\r\nexport abstract class TonwaBase {\r\n\treadonly net: Net;\r\n\ttesting: boolean;\r\n\r\n\tconstructor() {\r\n\t\tthis.testing = false;\r\n\t\tthis.net = this.createWeb();\r\n\t}\r\n\tabstract createWeb(): Net;\r\n\tabstract createObservableMap<K, V>(): Map<K, V>;\r\n\tasync init() {\r\n\t\tthis.testing = env.testing;\r\n\t\tawait this.net.host.start(this.testing);\r\n\t}\r\n}\r\n\r\nexport abstract class Tonwa extends TonwaBase {\r\n\tprivate wsHost: string;\r\n\tprivate local: LocalData = new LocalData();\r\n\tprivate navigo: Navigo;\r\n\t//isWebNav:boolean = false;\r\n\tnavSettings: NavSettings;\r\n\tuser: User = null;\r\n\tlanguage: string;\r\n\tculture: string;\r\n\tresUrl: string;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\ttonwa = this;\r\n\t\tlet { lang, district } = resOptions;\r\n\t\tthis.language = lang;\r\n\t\tthis.culture = district;\r\n\t}\r\n\r\n\t/*\r\n\tprotected abstract startWait(): void;\r\n\tprotected abstract endWait(): void;\r\n\t*/\r\n\t//protected abstract showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean): Promise<void>;\r\n\tprotected abstract showRegister(): Promise<void>;\r\n\tprotected abstract showForget(): Promise<void>;\r\n\r\n\tabstract get nav(): Nav;\r\n\r\n\tabstract privacyEntry(): void;\r\n\t//abstract showLogout(callback?: ()=>Promise<void>): Promise<void>;\r\n\t//abstract openSysPage(url: string):boolean;\r\n\t//abstract changePassword(): Promise<void>;\r\n\t//abstract userQuit(): Promise<void>;\r\n\tabstract resetAll: () => void;\r\n\tabstract showAppView(isUserLogin?: boolean): Promise<void>;\r\n\t//abstract clear(): void;\r\n\r\n\tget guest(): number {\r\n\t\tlet guest = this.local.guest;\r\n\t\tif (guest === undefined) return 0;\r\n\t\tlet g = guest.get();\r\n\t\tif (g === undefined) return 0;\r\n\t\treturn g.guest;\r\n\t}\r\n\tasync onReceive(msg: any) {\r\n\t\t//if (this.ws === undefined) return;\r\n\t\tawait this.net.messageHub.dispatch(msg);\r\n\t}\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tsetSettings(settings?: NavSettings) {\r\n\t\tthis.navSettings = settings;\r\n\t\tlet { htmlTitle } = settings;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget oem(): string {\r\n\t\treturn this.navSettings && this.navSettings.oem;\r\n\t}\r\n\r\n\thashParam: string;\r\n\tprivate arrs = ['/test', '/test/'];\r\n\tprivate unitJsonPath(): string {\r\n\t\tlet { origin, pathname } = document.location;\r\n\t\tpathname = pathname.toLowerCase();\r\n\t\tfor (let item of this.arrs) {\r\n\t\t\tif (pathname.endsWith(item) === true) {\r\n\t\t\t\tpathname = pathname.substr(0, pathname.length - item.length);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n\t\t\tpathname = pathname.substr(0, pathname.length - 1);\r\n\t\t}\r\n\t\treturn origin + pathname + '/unit.json';\r\n\t}\r\n\t/*\r\n\tprivate windowOnClick = (ev: MouseEvent) => {\r\n\t\tconsole.error('windowOnClick');\r\n\t}\r\n\tprivate windowOnMouseMove = (ev: MouseEvent) => {\r\n\t\tconsole.log('navigator.userAgent: ' + navigator.userAgent);\r\n\t\tconsole.log('mouse move (%s, %s)', ev.x, ev.y);\r\n\t}\r\n\tprivate windowOnScroll = (ev: Event) => {\r\n\t\tconsole.log('scroll event');\r\n\t}\r\n\t*/\r\n\tforceDevelopment: boolean;\r\n\r\n\tasync init() {\r\n\t\tawait super.init();\r\n\t\tif (this.forceDevelopment === true) {\r\n\t\t\tenv.isDevelopment = true;\r\n\t\t}\r\n\t\tlet { url, ws, resHost } = this.net.host;\r\n\t\tthis.resUrl = this.net.resUrlFromHost(resHost);\r\n\t\tthis.wsHost = ws;\r\n\t\tthis.net.setCenterUrl(url);\r\n\r\n\t\tlet guest: Guest = this.local.guest.get();\r\n\t\tif (guest === undefined) {\r\n\t\t\tguest = await this.net.guestApi.guest();\r\n\t\t}\r\n\t\tif (!guest) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error('guest can not be undefined');\r\n\t\t}\r\n\t\tthis.setGuest(guest);\r\n\t}\r\n\r\n\treloadUser = () => {\r\n\t\tlet user: User = this.local.user.get();\r\n\t\tlet curUser = this.user;\r\n\t\tif (!user && !curUser) return;\r\n\t\tif (user?.id === curUser?.id) return;\r\n\t\tif (!user) {\r\n\t\t\tthis.logout();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.logined(user);\r\n\t\t}\r\n\t}\r\n\r\n\t//private appStarted:boolean = false;\r\n\tprivate notLogined?: () => Promise<void>;\r\n\tprivate userPassword?: () => Promise<{ user: string; password: string; }>\r\n\tasync appStart(notLogined?: () => Promise<void>, userPassword?: () => Promise<{ user: string; password: string; }>) {\r\n\t\t//if (this.appStarted === true) return;\r\n\t\t//this.appStarted = true;\r\n\t\tthis.notLogined = notLogined;\r\n\t\tthis.userPassword = userPassword;\r\n\t\tawait this.init();\r\n\t\tawait this.start();\r\n\t}\r\n\r\n\tprotected abstract beforeStart(): void;\r\n\r\n\tasync start() {\r\n\t\ttry {\r\n\t\t\tthis.beforeStart();\r\n\t\t\tif (env.isMobile === true) {\r\n\t\t\t\tdocument.onselectstart = function () { return false; }\r\n\t\t\t\tdocument.oncontextmenu = function () { return false; }\r\n\t\t\t}\r\n\t\t\tthis.nav.clear();\r\n\r\n\t\t\tlet user: User = this.local.user.get();\r\n\t\t\tif (user === undefined) {\r\n\t\t\t\t//throw new Error('user logout to be implemented');\r\n\t\t\t\t//let {userPassword} = this.navView.props;\r\n\t\t\t\tif (this.userPassword) {\r\n\t\t\t\t\tlet ret = await this.userPassword();\r\n\t\t\t\t\tif (ret) {\r\n\t\t\t\t\t\tlet { user: userName, password } = ret;\r\n\t\t\t\t\t\tlet logindUser = await this.net.userApi.login({\r\n\t\t\t\t\t\t\tuser: userName,\r\n\t\t\t\t\t\t\tpwd: password,\r\n\t\t\t\t\t\t\tguest: this.guest,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuser = logindUser;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (user === undefined) {\r\n\t\t\t\t\t//let {notLogined} = this.navView.props;\r\n\t\t\t\t\tif (this.notLogined !== undefined) {\r\n\t\t\t\t\t\tawait this.notLogined();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tawait this.showLogin(undefined);\r\n\t\t\t\t\t\t//nav.navigateToLogin();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tawait this.logined(user);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tfinally {\r\n\t\t}\r\n\t}\r\n\r\n\tresolveRoute() {\r\n\t\t//if (this.isRouting === false) return;\r\n\t\tif (this.navigo === undefined) return;\r\n\t\tthis.navigo.resolve();\r\n\t}\r\n\r\n\ton(routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(url: string, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(regex: RegExp, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(options: { [url: string]: RouteFunc | NamedRoute }): Navigo;\r\n\ton(...args: any[]): Navigo {\r\n\t\tif (this.navigo === undefined) {\r\n\t\t\tthis.navigo = new Navigo();\r\n\t\t\tif (this.nav.isWebNav !== true) this.navigo.historyAPIUpdateMethod('replaceState');\r\n\t\t}\r\n\t\treturn this.navigo.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tnavigateToLogin() {\r\n\t\tthis.navigate('/login');\r\n\t}\r\n\r\n\tnavigate(url: string, absolute?: boolean) {\r\n\t\tif (!this.navigo) {\r\n\t\t\talert('Is not in webnav state, cannot navigate to url \"' + url + '\"');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.testing === true) {\r\n\t\t\turl += '#test';\r\n\t\t}\r\n\t\treturn this.navigo.navigate(url, absolute);\r\n\t}\r\n\r\n\tgo(showPage: () => void, url: string, absolute?: boolean) {\r\n\t\tif (this.navigo !== undefined) {\r\n\t\t\tthis.navigate(url, absolute);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshowPage();\r\n\t\t}\r\n\t}\r\n\r\n\tsetGuest(guest: Guest) {\r\n\t\tthis.local.guest.set(guest);\r\n\t\tthis.net.setNetToken(0, guest.token);\r\n\t}\r\n\r\n\tsaveLocalUser() {\r\n\t\tthis.local.user.set(this.user);\r\n\t}\r\n\r\n\tsetUqRoles(uq: string, roles: string[]) {\r\n\t\tlet { roles: userRoles } = this.user;\r\n\t\tif (!userRoles) {\r\n\t\t\tthis.user.roles = {};\r\n\t\t}\r\n\t\tthis.user.roles[uq] = roles;\r\n\t\tthis.local.user.set(this.user);\r\n\t}\r\n\r\n\tasync loadMe() {\r\n\t\tlet me = await this.net.userApi.me();\r\n\t\tthis.user.icon = me.icon;\r\n\t\tthis.user.nick = me.nick;\r\n\t}\r\n\r\n\tprivate async internalLogined(user: User, callback: (user: User) => Promise<void>, isUserLogin: boolean) {\r\n\t\tthis.net.logoutApis();\r\n\t\tthis.user = user;\r\n\t\tthis.saveLocalUser();\r\n\t\tthis.net.setNetToken(user.id, user.token);\r\n\t\tthis.nav.clear();\r\n\r\n\t\tawait this.onChangeLogin?.(this.user);\r\n\t\tif (callback !== undefined) {\r\n\t\t\tawait callback(user);\r\n\t\t}\r\n\t\telse if (this.nav.isWebNav === true) {\r\n\t\t\tthis.navigate('/index');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait this.showAppView(isUserLogin);\r\n\t\t}\r\n\t}\r\n\r\n\tonChangeLogin: (user: User) => Promise<void>;\r\n\r\n\t// 缓冲登录\r\n\tasync logined(user: User, callback?: (user: User) => Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, false);\r\n\t}\r\n\r\n\t// 用户操作之后登录\r\n\tasync userLogined(user: User, callback?: (user: User) => Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, true);\r\n\t}\r\n\r\n\tloginTop(defaultTop: any /*JSX.Element*/) {\r\n\t\treturn (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n\t}\r\n\r\n\tasync logout(callback?: () => Promise<void>) { //notShowLogin?:boolean) {\r\n\t\tthis.local.logoutClear();\r\n\t\tthis.user = undefined; //{} as User;\r\n\t\tthis.net.logoutApis();\r\n\t\tlet guest = this.local.guest.get();\r\n\t\tthis.net.setCenterToken(0, guest && guest.token);\r\n\t\tthis.nav.clear();\r\n\t\tif (callback === undefined)\r\n\t\t\tawait this.start();\r\n\t\telse\r\n\t\t\tawait callback();\r\n\t\tthis.onChangeLogin?.(undefined);\r\n\t}\r\n\r\n\r\n\tget logs() { return logs };\r\n\tlog(msg: string) {\r\n\t\tlogs.push(msg);\r\n\t}\r\n\tlogMark() {\r\n\t\tlet date = new Date();\r\n\t\tlogMark = date.getTime();\r\n\t\tlogs.push('log-mark: ' + date.toTimeString());\r\n\t}\r\n\tlogStep(step: string) {\r\n\t\tlogs.push(step + ': ' + (new Date().getTime() - logMark));\r\n\t}\r\n\r\n\treload = async () => {\r\n\t\tlet waiting: Promise<void> = new Promise<void>((resolve, reject) => {\r\n\t\t\tsetTimeout(resolve, 100);\r\n\t\t});\r\n\r\n\t\tif ('serviceWorker' in navigator) {\r\n\t\t\tlet registration = await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n\t\t\tif (registration) registration.unregister();\r\n\t\t}\r\n\t\twindow.document.location.reload();\r\n\t\t// dcloud hbuilder里面的app自动升级，需要清webview的缓存\r\n\t\tlet plus = (window as any).plus;\r\n\t\tif (plus) {\r\n\t\t\tlet webview = plus.webview;\r\n\t\t\tif (webview) {\r\n\t\t\t\tif (webview.reload) webview.reload(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet webView = plus.webView;\r\n\t\t\t\tif (webView) {\r\n\t\t\t\t\tif (webView.reload) webView.reload(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//plus.webview.reload(true)\r\n\t\t}\r\n\t}\r\n\r\n\topenSysPage(url: string): boolean {\r\n\t\tlet navPage: NavPage = this.sysRoutes[url];\r\n\t\tif (navPage === undefined) {\r\n\t\t\t//alert(url + ' is not defined in sysRoutes');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tnavPage(undefined);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate navLogin: NavPage = async (params: any) => {\r\n\t\tthis.showLogin(async (user: User) => window.history.back(), false);\r\n\t}\r\n\r\n\tprivate navLogout: NavPage = async (params: any) => {\r\n\t\tthis.showLogout(async () => window.history.back());\r\n\t}\r\n\r\n\tprivate navRegister: NavPage = async (params: any) => {\r\n\t\tthis.showRegister();\r\n\t}\r\n\r\n\tprivate navForget: NavPage = async (params: any) => {\r\n\t\tthis.showForget();\r\n\t}\r\n\r\n\r\n\tprivate navPageRoutes: { [url: string]: NavPage };\r\n\tprivate routeFromNavPage(navPage: NavPage) {\r\n\t\treturn (params: any, queryStr: any) => {\r\n\t\t\tif (navPage) {\r\n\t\t\t\tif (this.nav.isWebNav) this.nav.clear();\r\n\t\t\t\tnavPage(params);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonNavRoute(navPage: NavPage) {\r\n\t\tthis.on(this.routeFromNavPage(navPage));\r\n\t}\r\n\tprivate doneSysRoutes: boolean = false;\r\n\tprivate sysRoutes: { [route: string]: NavPage } = {\r\n\t\t'/login': this.navLogin,\r\n\t\t'/logout': this.navLogout,\r\n\t\t'/register': this.navRegister,\r\n\t\t'/forget': this.navForget,\r\n\t}\r\n\t/*\r\n\tonSysNavRoutes() {\r\n\t\tthis.onNavRoutes(this.sysRoutes);\r\n\t}\r\n\t*/\r\n\tonNavRoutes(navPageRoutes: { [url: string]: NavPage }) {\r\n\t\tif (this.doneSysRoutes === false) {\r\n\t\t\tthis.doneSysRoutes = true;\r\n\t\t\tthis.internalOnNavRoutes(this.sysRoutes);\r\n\t\t}\r\n\t\tthis.internalOnNavRoutes(navPageRoutes);\r\n\t}\r\n\r\n\tprivate internalOnNavRoutes(navPageRoutes: { [url: string]: NavPage }) {\r\n\t\tif (!navPageRoutes) return;\r\n\t\tthis.navPageRoutes = Object.assign(this.navPageRoutes, navPageRoutes);\r\n\t\tlet navOns: { [route: string]: (params: any, queryStr: any) => void } = {};\r\n\t\tfor (let route in navPageRoutes) {\r\n\t\t\tlet navPage = navPageRoutes[route];\r\n\t\t\tnavOns[route] = this.routeFromNavPage(navPage);\r\n\t\t}\r\n\t\tthis.on(navOns);\r\n\t}\r\n\r\n\tasync checkVersion(): Promise<string> {\r\n\t\tlet { href } = document.location;\r\n\t\thref += (href.indexOf('?') >= 0 ? '&' : '?') + '_t_t_=' + new Date().getTime();\r\n\t\tlet ret = await fetch(href);\r\n\t\tlet r = await ret.text();\r\n\t\tlet parser = new DOMParser();\r\n\t\tlet htmlDoc = parser.parseFromString(r, 'text/html');\r\n\t\tlet elHtml = htmlDoc.getElementsByTagName('html');\r\n\t\tlet newVersion = elHtml[0].getAttribute('data-version');\r\n\t\treturn newVersion;\r\n\t}\r\n\r\n\tprivate createLogin: (tonwa: Tonwa) => Promise<Login>;\r\n\tsetCreateLogin(createLogin: (tonwa: Tonwa) => Promise<Login>) {\r\n\t\tthis.createLogin = createLogin;\r\n\t}\r\n\r\n\tasync changePassword() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showChangePassword();\r\n\t}\r\n\r\n\tasync userQuit() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showUserQuit();\r\n\t}\r\n\r\n\tprivate login: Login;\r\n\tprivate async getLogin(): Promise<Login> {\r\n\t\tif (this.login) return this.login;\r\n\t\treturn this.login = await this.createLogin(this);\r\n\t}\r\n\tasync showLogin(callback?: (user: User) => Promise<void>, withBack?: boolean) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogin(callback, withBack);\r\n\t}\r\n\r\n\tasync showLogout(callback?: () => Promise<void>) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogout(callback);\r\n\t}\r\n}\r\n","export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, $$user:number = undefined, waiting: boolean) {\r\n        this._params = params;\r\n        this.$$user = $$user;\r\n        this.waiting = waiting;\r\n    }\r\n    readonly $$user: number;\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","// import { UqTokenApi } from './uqApi';\r\nimport { Net } from './Net';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\n\r\n/*\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\n*/\r\nexport class UqTokens {\r\n    private readonly net: Net;\r\n    private readonly uqTokens: { [uqName: string]: UqToken } = {};\r\n\r\n    constructor(net: Net) {\r\n        this.net = net;\r\n    }\r\n\r\n    logoutUqTokens() {\r\n        for (let i in this.uqTokens) {\r\n            this.uqTokens[i] = undefined;\r\n        }\r\n        this.net.uqTokenApi.clearLocal();\r\n    }\r\n\r\n    //private readonly uqTokenActions: { [uq: string]: UqTokenAction } = {};\r\n\r\n    async buildAppUq(uq: string, uqOwner: string, uqName: string): Promise<void> {\r\n        //let unit = getUnit();\r\n        let { unit } = this.net.props;\r\n        let uqToken = await this.net.uqTokenApi.uq({ unit, uqOwner, uqName });\r\n        if (uqToken.token === undefined) uqToken.token = this.net.centerToken;\r\n        let { db, url, urlTest } = uqToken;\r\n        let realUrl = this.net.host.getUrlOrTest(db, url, urlTest);\r\n        console.log('realUrl: %s', realUrl);\r\n        uqToken.url = realUrl;\r\n        this.uqTokens[uq] = uqToken;\r\n        return uqToken;\r\n    }\r\n\r\n    getUqToken(uq: string): UqToken {\r\n        let uts = this.uqTokens;\r\n        return uts[uq];\r\n    }\r\n}\r\n","//import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport { Caller } from './caller';\r\n//import { env } from '../tool';\r\nimport { Net } from './Net';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected net: Net;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(net: Net, hostUrl: string, apiToken: string) {\r\n        this.net = net;\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.timeout = net.isDevelopment === true ? 30000 : 50000;\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix: string, caller: Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let { headers, path, method } = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n                //h.append(i, encodeURI(headers[i]));\r\n                h[i] = encodeURI(headers[i]);\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any): Promise<any> {\r\n        let ret = await this.innerFetch(url, options);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options);\r\n    }\r\n\r\n    async post(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options);\r\n    }\r\n\r\n    async put(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options);\r\n    }\r\n\r\n    async delete(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options);\r\n    }\r\n    async fetch(url: string, options: any, resolve: (value?: any) => any, reject: (reason?: any) => void): Promise<void> {\r\n        let path = url;\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = setTimeout(\r\n                () => {\r\n                    throw new Error(`webapi timeout: ${(Date.now() - now)}ms ${url}`);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                clearTimeout(timeOutHandler);\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json') >= 0) {\r\n                return res.json().then(async retJson => {\r\n                    clearTimeout(timeOutHandler);\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        reject('not valid tonwa json');\r\n                    }\r\n                    else {\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    reject(error);\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch (error) {\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true || err.startsWith('$roles') === true) {\r\n                    this.net.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n        };\r\n    }\r\n\r\n    protected abstract innerFetch(url: string, options: any): Promise<any>;\r\n\r\n    async callFetch(url: string, method: string, body: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, resolve, reject);\r\n        });\r\n    }\r\n\r\n    //private buildOptions(): {method:string; headers:Headers; body:any} {\r\n    private buildOptions(): { method: string; headers: { [name: string]: string }; body: any } {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n    /*\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n    }\r\n    */\r\n    protected buildHeaders(): { [name: string]: string } {\r\n        let { language, culture } = this.net;\r\n        let headers: { [name: string]: string } = {}; //new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        //headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        headers['Content-Type'] = 'application/json;charset=UTF-8';\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        //headers.append('Accept-Language', lang);\r\n        headers['Accept-Language'] = lang;\r\n        if (this.apiToken) {\r\n            //headers.append('Authorization', this.apiToken); \r\n            headers['Authorization'] = this.apiToken;\r\n        }\r\n        return headers;\r\n    }\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import { HttpChannel } from './httpChannel';\r\nimport { Caller } from './caller';\r\nimport { Net } from './Net';\r\n\r\nexport async function refetchApi(channel: HttpChannel, url: string, options: any,\r\n    resolve: (values: any) => any, reject: (reason: any) => void) {\r\n    await channel.fetch(url, options, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected readonly net: Net;\r\n    protected token: string;\r\n    protected path: string;\r\n\r\n    constructor(net: Net, path: string) {\r\n        this.net = net;\r\n        this.path = path || '';\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller: Caller<any>): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url: string, method: string, body: any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path: string, params: any = undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path: string, params: any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path: string, params: any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path: string, params: any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import { Net } from \"./Net\";\r\n\r\nlet subAppWindow: any; // Window;\r\nfunction postWsToSubApp(msg: any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win: any) {  // Window\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg: any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n    protected net: Net;\r\n    constructor(net: Net) {\r\n        this.net = net;\r\n    }\r\n\r\n    async receive(msg: any) {\r\n        this.net.messageHub.dispatch(msg);\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId: string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId: string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken: string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(net: Net, wsHost: string, token: string) {\r\n        super(net);\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n\r\n    connect(): Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event: any): Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg: any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import { HttpChannel, UqHttpChannel } from './httpChannel';\r\nimport { ApiBase } from './apiBase';\r\nimport { LocalMap, decodeUserToken } from '../tool';\r\nimport { Net, PromiseValue } from './Net';\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\n\r\nexport class UqApi extends ApiBase {\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(net: Net, basePath: string, uqOwner: string, uqName: string) {\r\n        super(net, basePath);\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n    }\r\n\r\n    async init() {\r\n        await this.net.uqTokens.buildAppUq(this.uq, this.uqOwner, this.uqName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: { [name: string]: HttpChannel | (PromiseValue<any>[]) };\r\n        channels = this.net.uqChannels;\r\n        let channel = channels[this.uq];\r\n        if (channel !== undefined) {\r\n            if (Array.isArray(channel) === false) return channel as HttpChannel;\r\n        }\r\n        else {\r\n            channel = channels[this.uq] = [];\r\n        }\r\n        let arr = channel as PromiseValue<any>[];\r\n        return new Promise(async (resolve, reject) => {\r\n            arr.push({ resolve, reject });\r\n            if (arr.length !== 1) return;\r\n            let uqToken = this.net.uqTokens.getUqToken(this.uq); //, this.uqOwner, this.uqName);\r\n            if (!uqToken) {\r\n                //debugger;\r\n                await this.init();\r\n                uqToken = this.net.uqTokens.getUqToken(this.uq);\r\n            }\r\n            let { url, token } = uqToken;\r\n            this.token = token;\r\n            channel = new UqHttpChannel(this.net, url, token);\r\n            channels[this.uq] = channel;\r\n            for (let pv of arr) {\r\n                pv.resolve(channel);\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    async loadEntities(): Promise<any> {\r\n        let ret = await this.get('entities');\r\n        return ret;\r\n    }\r\n    async getAdmins(): Promise<any[]> {\r\n        let ret = await this.get('get-admins');\r\n        return ret;\r\n    }\r\n    async setMeAdmin(): Promise<void> {\r\n        await this.get('set-me-admin');\r\n    }\r\n    async setAdmin(user: number, role: number, name: string, nick: string, icon: string, assigned: string): Promise<void> {\r\n        await this.post('set-admin', { user, role, name, nick, icon, assigned });\r\n    }\r\n    async isAdmin(): Promise<boolean> {\r\n        let ret = await this.get('is-admin');\r\n        return ret;\r\n    }\r\n    async getRoles(): Promise<string[]> {\r\n        let ret = await this.get('get-roles',);\r\n        if (!ret) return null;\r\n        let parts: string[] = (ret as string).split('|');\r\n        let s: string[] = [];\r\n        for (let p of parts) {\r\n            p = p.trim();\r\n            if (!p) continue;\r\n            s.push(p);\r\n        }\r\n        if (s.length === 0) return null;\r\n        return s;\r\n    }\r\n    async getAllRoleUsers(): Promise<{ user: number, admin: number, roles: string }[]> {\r\n        let ret = await this.get('get-all-role-users');\r\n        return ret;\r\n    }\r\n    async setUserRoles(theUser: number, roles: string): Promise<void> {\r\n        await this.post('set-user-roles', { theUser, roles });\r\n    }\r\n    async deleteUserRoles(theUser: number): Promise<void> {\r\n        await this.get('delete-user-roles', { theUser });\r\n    }\r\n\r\n    async allSchemas(): Promise<any> {\r\n        return await this.get('all-schemas');\r\n    }\r\n\r\n    async schema(name: string): Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start: number, page: number, entities: string) {\r\n        return await this.post('queue-modify', { start: start, page: page, entities: entities });\r\n    }\r\n}\r\n\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        return this.net.getCenterChannel();\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n    private readonly localMap: LocalMap;\r\n\r\n    constructor(net: Net, path: string) {\r\n        super(net, path);\r\n        this.localMap = net.localDb.createLocalMap(uqTokensName);\r\n    }\r\n\r\n    clearLocal() {\r\n        this.localMap.removeAll();\r\n    }\r\n\r\n    async uq(params: { unit: number, uqOwner: string, uqName: string }): Promise<any> {\r\n        let { uqOwner, uqName } = params;\r\n        let un = uqOwner + '/' + uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken: UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let { unit, user } = uqToken;\r\n                if (unit !== params.unit || user !== this.net.loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let { tick, value } = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24 * 3600) {\r\n                    return Object.assign({}, value);\r\n                }\r\n            }\r\n            let uqParams: any = Object.assign({}, params);\r\n            uqParams.testing = this.net.host.testing;\r\n            let ret = await this.get('uq-token', uqParams);\r\n            if (ret === undefined) {\r\n                let { unit, uqOwner, uqName } = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: this.net.loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return Object.assign({}, ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url: string, method: string, body: any): Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n    ownerAlias: string;\r\n    uqName: string;\r\n    uqAlias: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    async appUqs(appOwner: string, appName: string): Promise<UqAppData> {\r\n        let ret: UqAppData = await this.get('tie/app-uqs', { appOwner, appName });\r\n        return ret;\r\n    }\r\n    async uqs(uqs: { owner: string; name: string; version: string }[]): Promise<UqData[]> {\r\n        return await this.post('tie/pure-uqs', uqs);\r\n    }\r\n    async unitxUq(unit: number): Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', { unit: unit });\r\n    }\r\n    async changePassword(param: { orgPassword: string, newPassword: string }) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n\r\n    async userQuit(): Promise<void> {\r\n        await this.get('tie/user-ask-quit', {});\r\n    }\r\n}\r\n\r\nexport interface RegisterParameter {\r\n    nick: string,\r\n    user: string,\r\n    pwd: string,\r\n    country: number,\r\n    mobile: number,\r\n    mobileCountry: number,\r\n    email: string,\r\n    verify: string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: { user: string, pwd: string, guest: number }): Promise<any> {\r\n        let ret = await this.post('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let { nick, icon } = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n    }\r\n    async register(params: RegisterParameter): Promise<any> {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account: string, type: 'mobile' | 'email', oem: string) {\r\n        return await this.post('user/set-verify', { account: account, type: type, oem: oem });\r\n    }\r\n\r\n    async checkVerify(account: string, verify: string) {\r\n        return await this.post('user/check-verify', { account: account, verify: verify });\r\n    }\r\n\r\n    async isExists(account: string) {\r\n        return await this.get('user/is-exists', { account: account });\r\n    }\r\n\r\n    async resetPassword(account: string, password: string, verify: string, type: 'mobile' | 'email'): Promise<any[]> {\r\n        return await this.post('user/reset-password', { account: account, password, verify, type });\r\n    }\r\n\r\n    async userSetProp(prop: string, value: any) {\r\n        await this.post('tie/user-set-prop', { prop: prop, value: value });\r\n    }\r\n\r\n    async me(): Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id: number): Promise<any> {\r\n        return await this.get('tie/user', { id: id });\r\n    }\r\n\r\n    async fromKey(key: string): Promise<{ id: number, name: string, nick: string, icon: string }> {\r\n        return await this.get('tie/user-from-key', { key });\r\n    }\r\n}\r\n","import { User } from '../tool';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app: number): Promise<any[]> {\r\n        return await this.get('tie/user-app-units', { app: app });\r\n    }\r\n    async userFromKey(userName: string): Promise<User> {\r\n        return await this.get('tie/user-from-key', { key: userName });\r\n    }\r\n    async userFromId(userId: number): Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', { userId: userId });\r\n    }\r\n    async userFromName(userName: string): Promise<User> {\r\n        return await this.get('tie/user-from-key', { key: userName });\r\n    }\r\n    async usersFromEmail(email: string): Promise<any> {\r\n        return await this.get('tie/users-from-email', { email });\r\n    }\r\n    async userFromMobile(mobile: string): Promise<User> {\r\n        return await this.get('tie/users-from-mobile', { mobile });\r\n    }\r\n}\r\n","import { decodeGuestToken } from '../tool';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n","import { Net } from \"./Net\";\r\n\r\nexport class MessageHub {\r\n    net: Net;\r\n    constructor(net: Net) {\r\n        this.net = net;\r\n    }\r\n    private handlerSeed = 1;\r\n    private anyHandlers: { [id: number]: (msg: any) => Promise<void> } = {};\r\n    private msgHandlers: { [id: number]: { type: string, handler: (msg: any) => Promise<void> } } = {};\r\n    registerReceiveHandler(handler: (msg: any) => Promise<void>): number;\r\n    registerReceiveHandler(type: string, handler: (msg: any) => Promise<void>): number;\r\n    registerReceiveHandler(...args: any[]): number {\r\n        let seed = this.handlerSeed++;\r\n        let args0 = args[0];\r\n        let handler: (msg: any) => Promise<void>;\r\n        switch (typeof args0) {\r\n            case 'string':\r\n                handler = args[1];\r\n                this.msgHandlers[seed] = { type: args0, handler };\r\n                break;\r\n            case 'function':\r\n                this.anyHandlers[seed] = args0;\r\n                break;\r\n        }\r\n        return seed;\r\n    }\r\n    unregisterReceiveHandler(handlerId: number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async dispatch(msg: any) {\r\n        let { $type } = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let { type, handler } = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n","/* eslint-disable */\r\nimport { UqTokens } from \"./UqTokens\";\r\nimport { CenterApi } from \"./centerApi\";\r\nimport { CallCenterApi, UqTokenApi, UserApi } from \"./uqApi\";\r\nimport { HttpChannel, CenterHttpChannel } from './httpChannel';\r\nimport { GuestApi } from \"./guestApi\";\r\nimport { MessageHub } from \"./messageHub\";\r\nimport { WsBridge, WSChannel } from \"./wsChannel\";\r\nimport { Host, resUrlFromHost } from './host';\r\nimport { LocalDb } from \"tonwa-uq\";\r\n\r\nexport interface PromiseValue<T> {\r\n    resolve: (value?: T | PromiseLike<T>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\n\r\nexport interface NetProps {\r\n    unit: number;\r\n    testing: boolean;\r\n    buildingUq?: boolean;           // default false\r\n}\r\n\r\nexport abstract class Net {\r\n    logout() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    centerHost: string;\r\n    centerToken: string | undefined = undefined;\r\n    loginedUserId: number = 0;\r\n    centerChannel: HttpChannel;\r\n\r\n    readonly props: NetProps;\r\n    readonly isDevelopment: boolean;\r\n    readonly localDb: LocalDb;\r\n    readonly uqChannels: { [name: string]: HttpChannel | (PromiseValue<any>[]) } = {};\r\n    readonly centerApi: CenterApi;\r\n    readonly uqTokens: UqTokens;\r\n    readonly userApi: UserApi;\r\n    readonly uqTokenApi: UqTokenApi;\r\n    readonly callCenterapi: CallCenterApi;\r\n    readonly guestApi: GuestApi;\r\n    readonly messageHub: MessageHub;\r\n    readonly wsBridge: WsBridge;\r\n    readonly host: Host;\r\n\r\n    language: string;\r\n    culture: string;\r\n\r\n    // 下面的变量应该以后会去掉\r\n    isBuildingUQ: boolean;\r\n    _uqs: any;\r\n    user: any;\r\n    // -- end -------------------\r\n\r\n\r\n    constructor(props: NetProps) {\r\n        this.props = props;\r\n        this.isDevelopment = process.env.NODE_ENV === 'development';\r\n        this.localDb = this.createLocalDb();\r\n        this.centerApi = new CenterApi(this, 'tv/');\r\n        this.uqTokens = new UqTokens(this);\r\n        this.userApi = new UserApi(this, 'tv/');\r\n        this.uqTokenApi = new UqTokenApi(this, 'tv/tie/');\r\n        this.callCenterapi = new CallCenterApi(this, '');\r\n        this.guestApi = new GuestApi(this, 'tv/guest/');\r\n        this.messageHub = new MessageHub(this);\r\n        this.wsBridge = new WsBridge(this);\r\n        this.host = Host.createHost(this.isDevelopment);\r\n    }\r\n\r\n    abstract createLocalDb(): LocalDb;\r\n    abstract createObservableMap(): Map<number, any>;\r\n\r\n    logoutApis() {\r\n        this.uqTokens.logoutUqTokens();\r\n    }\r\n\r\n    setCenterUrl(url: string) {\r\n        console.log('setCenterUrl %s', url);\r\n        this.centerHost = url;\r\n        this.centerChannel = undefined;\r\n    }\r\n\r\n    setCenterToken(userId: number, t?: string) {\r\n        this.loginedUserId = userId;\r\n        this.centerToken = t;\r\n        this.centerChannel = undefined;\r\n    }\r\n\r\n    getCenterChannel(): HttpChannel {\r\n        if (this.centerChannel !== undefined) return this.centerChannel;\r\n        return this.centerChannel = new CenterHttpChannel(this, this.centerHost, this.centerToken);\r\n    }\r\n\r\n    setNetToken(userId: number, token: string) {\r\n        this.setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    }\r\n\r\n    clearNetToken() {\r\n        this.setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n\r\n    resUrlFromHost(host: string): string {\r\n        return resUrlFromHost(host);\r\n    }\r\n}\r\n","import { UqBuildContext } from \"./UqBuildContext\";\r\n\r\nexport class TsTemplate {\r\n    private readonly buildContext: UqBuildContext;\r\n\r\n    constructor(buildContext: UqBuildContext) {\r\n        this.buildContext = buildContext;\r\n        this.tsHeader = `//=== UqApp builder created on ${new Date()} ===//`;\r\n    }\r\n\r\n    readonly tsHeader: string;\r\n\r\n    get tsApp(): string {\r\n        return `${this.tsHeader}\r\nimport { NavView, start, nav } from 'tonwa-${this.buildContext.uiPlatform}';\r\nimport { CApp } from './CApp';\r\nimport { appConfig } from './appConfig';\r\n\r\nexport const App: React.FC = () => {\r\n    nav.setSettings(appConfig);\r\n    const onLogined = async (isUserLogin?:boolean) => {\r\n        await start(CApp, appConfig, isUserLogin);\r\n    }\r\n    return <NavView onLogined={onLogined} />;\r\n}\r\n\r\n`;\r\n    }\r\n\r\n    get tsCApp(): string {\r\n        return `${this.tsHeader}\r\nimport { CUqApp } from \"./CBase\";\r\nimport { res } from \"./res\";\r\nimport { VMain } from \"./VMain\";\r\nimport { setUI } from \"./uqs\";\r\n\r\nconst gaps = [10, 3,3,3,3,3,5,5,5,5,5,5,5,5,10,10,10,10,15,15,15,30,30,60];\r\n\r\nexport class CApp extends CUqApp {\r\n    protected async internalStart(isUserLogin: boolean) {\r\n        this.setRes(res);\r\n        setUI(this.uqs);\r\n        \r\n        this.openVPage(VMain, undefined, this.dispose);\r\n    }\r\n\r\n    private timer:any;\r\n    protected onDispose() {\r\n        clearInterval(this.timer);\r\n        this.timer = undefined;\r\n    }\r\n\r\n    private tick = 0;\r\n    private gapIndex = 0;\r\n    private callTick = async () => {\r\n        try {\r\n            if (!this.user) return;\r\n            ++this.tick;\r\n            if (this.tick<gaps[this.gapIndex]) return;\r\n            this.tick = 0;\r\n            if (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n            let ret = await this.uqs.BzHelloTonwa.$poked.query(undefined, false);\r\n            let v = ret.ret[0];\r\n            if (v === undefined) return;\r\n            if (!v.poke) return;\r\n            this.gapIndex = 1;\r\n\r\n            // 数据服务器提醒客户端刷新，下面代码重新调入的数据\r\n            //this.cHome.refresh();\r\n        }\r\n        catch {\r\n        }\r\n    }\r\n}\r\n`;\r\n    }\r\n\r\n    get tsCBase(): string {\r\n        return `${this.tsHeader}\r\nimport { CSub, CBase, CAppBase, IConstructor } from 'tonwa-${this.buildContext.uiPlatform}';\r\nimport { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase<CApp, UQs> {\r\n    protected async internalStart(param?:any, ...params:any[]):Promise<void> {}\r\n}\r\n\r\nexport abstract class CUqSub<A extends CAppBase<U>, U, T extends CBase<A,U>> extends CSub<A, U, T> {\r\n}\r\n\r\nexport abstract class CUqApp extends CAppBase<UQs> {\r\n    newC<T extends CUqBase>(type: IConstructor<T>, ...param:any[]): T {\r\n        let c = new type(this);\r\n        c.internalInit(...param);\r\n        return c;\r\n    }\r\n}\r\n`;\r\n    }\r\n\r\n    get tsIndex(): string {\r\n        return `${this.tsHeader}\r\nexport { CUqApp, CUqBase, CUqSub } from './CBase';\r\nexport { CApp } from './CApp';\r\nexport * from './uqs';\r\nexport * from './App';\r\nexport * from './startApp';\r\n`;\r\n    }\r\n\r\n    get tsVMain(): string {\r\n        return `${this.tsHeader}\r\nimport { VPage, Page } from 'tonwa-${this.buildContext.uiPlatform}';\r\nimport { CApp } from './CApp';\r\n\r\nexport class VMain extends VPage<CApp> {\r\n    header() { return 'TEST'; }\r\n    content() {\r\n        return <div className=\"m-3\">\r\n            <div>{this.renderMe()}</div>\r\n            <div className=\"mb-5\">同花样例主页面</div>\r\n        </div>;\r\n    }\r\n}\r\n`;\r\n    }\r\n}\r\n","/* eslint-disable */\r\nimport { UqApi, UqData } from '../net';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\nimport { capitalCase, LocalCache, LocalMap, UqConfig, UqError } from '../tool';\r\nimport { UqEnum } from './enum';\r\nimport { Entity } from './entity';\r\nimport { ID, IX, IDX } from './ID';\r\nimport { IDCache } from './IDCache';\r\nimport { Net } from '../net';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'float' | 'double' | 'char' | 'text'\r\n\t| 'datetime' | 'date' | 'time' | 'timestamp' | 'enum';\r\n\r\nexport function fieldDefaultValue(type: FieldType) {\r\n\tswitch (type) {\r\n\t\tcase 'tinyint':\r\n\t\tcase 'smallint':\r\n\t\tcase 'int':\r\n\t\tcase 'bigint':\r\n\t\tcase 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\tcase 'enum':\r\n\t\t\treturn 0;\r\n\t\tcase 'char':\r\n\t\tcase 'text':\r\n\t\t\treturn '';\r\n\t\tcase 'datetime':\r\n\t\tcase 'date':\r\n\t\t\treturn '2000-1-1';\r\n\t\tcase 'time':\r\n\t\t\treturn '0:00';\r\n\t}\r\n}\r\n\r\nexport interface Field {\r\n\tname: string;\r\n\ttype: FieldType;\r\n\ttuid?: string;\r\n\tarr?: string;\r\n\tnull?: boolean;\r\n\tsize?: number;\r\n\towner?: string;\r\n\t_tuid?: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n\tname: string;\r\n\tfields: Field[];\r\n\tid?: string;\r\n\torder?: string;\r\n}\r\nexport interface FieldMap {\r\n\t[name: string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n\towner: string;\r\n\tuq: string;\r\n}\r\nexport interface TuidModify {\r\n\tmax: number;\r\n\tseconds: number;\r\n}\r\n\r\ninterface ParamPage {\r\n\tstart: number;\r\n\tsize: number;\r\n}\r\n\r\nexport interface ParamActIX<T> {\r\n\tIX: IX;\r\n\tID?: ID;\r\n\tIXs?: { IX: IX, ix: number }[];\t\t\t\t// 一次写入多个IX\r\n\tvalues: { ix: number, xi: number | T }[];\r\n}\r\n\r\nexport interface ParamActIXSort {\r\n\tIX: IX;\r\n\tix: number;\r\n\tid: number;\t\t\t\t\t// id to be moved\r\n\tafter: number;\t\t\t\t// insert after id. if before first, then 0\r\n}\r\n\r\nexport interface ParamActDetail<M, D> {\r\n\tmain: {\r\n\t\tID: ID;\r\n\t\tvalue: M;\r\n\t};\r\n\tdetail: {\r\n\t\tID: ID;\r\n\t\tvalues: D[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail {\r\n\tmain: number;\r\n\tdetail: number[];\r\n}\r\n\r\nexport interface ParamActDetail2<M, D, D2> extends ParamActDetail<M, D> {\r\n\tdetail2: {\r\n\t\tID: ID;\r\n\t\tvalues: D2[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail2 extends RetActDetail {\r\n\tdetail2: number[];\r\n}\r\n\r\nexport interface ParamActDetail3<M, D, D2, D3> extends ParamActDetail2<M, D, D2> {\r\n\tdetail3: {\r\n\t\tID: ID;\r\n\t\tvalues: D3[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail3 extends RetActDetail2 {\r\n\tdetail3: number[];\r\n}\r\n\r\nexport interface ParamQueryID {\r\n\tID?: ID;\r\n\tIX?: (IX | string)[];\r\n\tIDX?: (ID | IDX)[];\r\n\tid?: number | number[];\r\n\tkey?: { [key: string]: string | number };\r\n\tix?: number;\r\n\tidx?: number | number[];\r\n\tkeyx?: { [key: string]: string | number };\r\n\tpage?: ParamPage;\r\n\torder?: 'desc' | 'asc';\r\n}\r\n\r\nexport interface ParamIDNO {\r\n\tID: ID;\r\n\tstamp?: undefined,\r\n}\r\n\r\nexport interface ParamIDDetailGet {\r\n\tid: number;\r\n\tmain: ID;\r\n\tdetail: ID;\r\n\tdetail2?: ID;\r\n\tdetail3?: ID;\r\n}\r\n\r\nexport interface ParamID {\r\n\tIDX: (ID | IDX) | (ID | IDX)[];\r\n\tid: number | number[];\r\n\torder?: 'asc' | 'desc',\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyID {\r\n\tID: ID;\r\n\tIDX?: (ID | IDX)[];\r\n\tIX?: IX[];\r\n\tkey: { [key: string]: string | number };\r\n\tix?: number;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIX {\r\n\tIX: IX;\r\n\tIX1?: IX;\r\n\tix: number | number[];\r\n\tIDX?: (ID | IDX)[];\r\n\tpage?: ParamPage;\r\n\torder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface ParamIXValues {\r\n\tIX: IX;\r\n\tix?: number;\r\n\tpage?: ParamPage;\r\n\torder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface ParamKeyIX {\r\n\tID: ID;\r\n\tkey: { [key: string]: string | number };\r\n\tIX: IX;\r\n\tIDX?: (ID | IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDLog {\r\n\tIDX: (ID | IDX);\r\n\tfield: string;\r\n\tid: number;\r\n\tlog: 'each' | 'day' | 'week' | 'month' | 'year';\r\n\ttimeZone?: number;\r\n\tfar?: number;\r\n\tnear?: number;\r\n\tpage: ParamPage;\r\n}\r\n\r\nexport interface ParamIDSum {\r\n\tIDX: IDX;\r\n\tfield: string[];\r\n\tid: number | number[];\r\n\tfar?: number;\t\t\t\t// 以前\r\n\tnear?: number;\t\t\t\t// 最近\r\n}\r\n\r\nexport interface ParamIDxID {\r\n\tID: ID;\r\n\tIX: IX;\r\n\tID2: ID;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface IDXValue {\r\n\tvalue: number;\r\n\ttime?: number | Date;\r\n\tsetAdd: '=' | '+';\r\n}\r\n\r\nexport interface ParamIDinIX {\r\n\tID: ID;\r\n\tid: number;\r\n\tIX: IX;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDTree {\r\n\tID: ID;\r\n\tparent: number;\r\n\tkey: string | number;\r\n\tlevel?: number;\t\t\t\t// 无值，默认1一级\r\n\tpage?: ParamPage;\r\n}\r\n\r\nfunction IDPath(path: string): string { return path; }\r\nenum EnumResultType { data, sql };\r\n\r\nexport interface Uq {\r\n\tAdminGetList(): Promise<any[]>;\r\n\tAdminSetMe(): Promise<void>;\r\n\tAdminSet(user: number, role: number, assigned: string): Promise<void>;\r\n\tAdminIsMe(): Promise<boolean>;\r\n\r\n\tIDValue(type: string, value: string): object;\r\n\t$: Uq;\r\n\tActs(param: any): Promise<any>;\r\n\tActIX<T>(param: ParamActIX<T>): Promise<number[]>;\r\n\tActIXSort(param: ParamActIXSort): Promise<void>;\r\n\tActIDProp(ID: ID, id: number, name: string, value: any): Promise<void>;\r\n\tQueryID<T>(param: ParamQueryID): Promise<T[]>;\r\n\tIDNO(param: ParamIDNO): Promise<string>;\r\n\tIDEntity(typeId: number): ID;\r\n\tID<T = any>(param: ParamID): Promise<T[]>;\r\n\tIXr<T>(param: ParamIX): Promise<T[]>; // IX id 反查IX list\r\n\tKeyID<T>(param: ParamKeyID): Promise<T[]>;\r\n\tIX<T = any>(param: ParamIX): Promise<T[]>;\r\n\tIXValues(param: ParamIXValues): Promise<{ type: string, value: string }[]>;\r\n\tKeyIX<T>(param: ParamKeyIX): Promise<T[]>;\r\n\tIDxID<T, T2>(param: ParamIDxID): Promise<[T[], T2[]]>; // ID list with IX 对应的子集\r\n\tIDinIX<T>(param: ParamIDinIX): Promise<T & { $in: boolean }[]>;\r\n\r\n\tIDTv(ids: number[]): Promise<any[]>;\r\n\r\n\tIDTree<T>(param: ParamIDTree): Promise<T[]>;\r\n\tIDLog<T>(param: ParamIDLog): Promise<T[]>;\r\n\tIDSum<T>(param: ParamIDSum): Promise<T[]>;\r\n\tIDDetailGet<M, D>(param: ParamIDDetailGet): Promise<[M[], D[]]>;\r\n\tIDDetailGet<M, D, D2>(param: ParamIDDetailGet): Promise<[M[], D[], D2[]]>;\r\n\tIDDetailGet<M, D, D2, D3>(param: ParamIDDetailGet): Promise<[M[], D[], D2[], D3[]]>;\r\n\tActDetail<M, D>(param: ParamActDetail<M, D>): Promise<RetActDetail>;\r\n\tActDetail<M, D, D2>(param: ParamActDetail2<M, D, D2>): Promise<RetActDetail2>;\r\n\tActDetail<M, D, D2, D3>(param: ParamActDetail3<M, D, D2, D3>): Promise<RetActDetail3>;\r\n}\r\n\r\nexport class UqMan {\r\n\treadonly entities: { [name: string]: Entity } = {};\r\n\treadonly entityTypes: { [id: number]: Entity } = {};\r\n\tprivate readonly enums: { [name: string]: UqEnum } = {};\r\n\tprivate readonly actions: { [name: string]: Action } = {};\r\n\tprivate readonly queries: { [name: string]: Query } = {};\r\n\treadonly ids: { [name: string]: ID } = {};\r\n\tprivate readonly idxs: { [name: string]: IDX } = {};\r\n\tprivate readonly ixs: { [name: string]: IX } = {};\r\n\r\n\tprivate readonly sheets: { [name: string]: Sheet } = {};\r\n\tprivate readonly books: { [name: string]: Book } = {};\r\n\tprivate readonly maps: { [name: string]: Map } = {};\r\n\tprivate readonly histories: { [name: string]: History } = {};\r\n\tprivate readonly pendings: { [name: string]: Pending } = {};\r\n\tprivate readonly tuidsCache: TuidsCache;\r\n\tprivate readonly localEntities: LocalCache;\r\n\tidCache: IDCache;\r\n\tproxy: any;\r\n\t$proxy: any;\r\n\treadonly localMap: LocalMap;\r\n\treadonly localModifyMax: LocalCache;\r\n\treadonly tuids: { [name: string]: Tuid } = {};\r\n\treadonly newVersion: boolean;\r\n\treadonly uqOwner: string;\r\n\treadonly uqName: string;\r\n\treadonly name: string;\r\n\treadonly uqApi: UqApi;\r\n\treadonly id: number;\r\n\treadonly net: Net;\r\n\r\n\tuqVersion: number;\r\n\tconfig: UqConfig;\r\n\r\n\tconstructor(net: Net, uqData: UqData) {\r\n\t\tthis.net = net;\r\n\t\tlet { id, uqOwner, uqName, newVersion } = uqData;\r\n\t\tthis.newVersion = newVersion;\r\n\t\tthis.uqOwner = uqOwner;\r\n\t\tthis.uqName = uqName;\r\n\t\tthis.id = id;\r\n\t\tthis.name = uqOwner + '/' + uqName;\r\n\t\tthis.uqVersion = 0;\r\n\t\tthis.localMap = net.localDb.createLocalMap(this.name);\r\n\t\tthis.localModifyMax = this.localMap.child('$modifyMax');\r\n\t\tthis.localEntities = this.localMap.child('$access');\r\n\t\tlet baseUrl = 'tv/';\r\n\r\n\t\tthis.uqApi = new UqApi(this.net, baseUrl, uqOwner, uqName);\r\n\t\tthis.tuidsCache = new TuidsCache(this);\r\n\t}\r\n\r\n\tgetID(name: string): ID { return this.ids[name.toLowerCase()]; };\r\n\tgetIDX(name: string): IDX { return this.idxs[name.toLowerCase()]; };\r\n\tgetIX(name: string): IX { return this.ixs[name.toLowerCase()]; };\r\n\r\n\t/*\r\n\tprivate createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n\t\tlet {name} = tuid;\r\n\t\treturn new ReactBoxId(id, tuid, this.tvs[name]);\r\n\t}\r\n\t*/\r\n\r\n\tprivate roles: string[];\r\n\tasync getRoles(): Promise<string[]> {\r\n\t\tif (this.roles !== undefined) return this.roles;\r\n\t\tthis.roles = await this.uqApi.getRoles();\r\n\t\treturn this.roles;\r\n\t}\r\n\r\n\ttuid(name: string): Tuid { return this.tuids[name.toLowerCase()] }\r\n\ttuidDiv(name: string, div: string): TuidDiv {\r\n\t\tlet tuid = this.tuids[name.toLowerCase()]\r\n\t\treturn tuid && tuid.div(div.toLowerCase());\r\n\t}\r\n\taction(name: string): Action { return this.actions[name.toLowerCase()] }\r\n\tsheet(name: string): Sheet { return this.sheets[name.toLowerCase()] }\r\n\tquery(name: string): Query { return this.queries[name.toLowerCase()] }\r\n\tbook(name: string): Book { return this.books[name.toLowerCase()] }\r\n\tmap(name: string): Map { return this.maps[name.toLowerCase()] }\r\n\thistory(name: string): History { return this.histories[name.toLowerCase()] }\r\n\tpending(name: string): Pending { return this.pendings[name.toLowerCase()] }\r\n\r\n\tsheetFromTypeId(typeId: number): Sheet {\r\n\t\tfor (let i in this.sheets) {\r\n\t\t\tlet sheet = this.sheets[i];\r\n\t\t\tif (sheet.typeId === typeId) return sheet;\r\n\t\t}\r\n\t}\r\n\r\n\tallRoles: string[];\r\n\treadonly tuidArr: Tuid[] = [];\r\n\treadonly actionArr: Action[] = [];\r\n\treadonly queryArr: Query[] = [];\r\n\treadonly idArr: ID[] = [];\r\n\treadonly idxArr: IDX[] = [];\r\n\treadonly ixArr: IX[] = [];\r\n\treadonly enumArr: UqEnum[] = [];\r\n\treadonly sheetArr: Sheet[] = [];\r\n\treadonly bookArr: Book[] = [];\r\n\treadonly mapArr: Map[] = [];\r\n\treadonly historyArr: History[] = [];\r\n\treadonly pendingArr: Pending[] = [];\r\n\r\n\tasync init() {\r\n\t\tawait this.uqApi.init();\r\n\t}\r\n\r\n\tasync loadEntities(): Promise<string> {\r\n\t\ttry {\r\n\t\t\tlet entities = this.localEntities.get();\r\n\t\t\tif (!entities) {\r\n\t\t\t\tentities = await this.uqApi.loadEntities();\r\n\t\t\t}\r\n\t\t\tif (!entities) return;\r\n\t\t\tthis.buildEntities(entities);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\treturn err as any;\r\n\t\t}\r\n\t}\r\n\r\n\tbuildEntities(entities: any) {\r\n\t\tif (entities === undefined) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tthis.localEntities.set(entities);\r\n\t\tlet { access, tuids, role, version, ids } = entities;\r\n\t\tthis.uqVersion = version;\r\n\t\tthis.allRoles = role?.names;\r\n\t\tthis.buildTuids(tuids);\r\n\t\tthis.buildIds(ids);\r\n\t\tthis.buildAccess(access);\r\n\t}\r\n\r\n\tprivate buildTuids(tuids: any) {\r\n\t\tfor (let i in tuids) {\r\n\t\t\tlet schema = tuids[i];\r\n\t\t\tlet { typeId, from } = schema;\r\n\t\t\tlet tuid = this.newTuid(i, typeId, from);\r\n\t\t\ttuid.sys = true;\r\n\t\t}\r\n\t\tfor (let i in tuids) {\r\n\t\t\tlet schema = tuids[i];\r\n\t\t\tlet tuid = this.getTuid(i);\r\n\t\t\ttuid.setSchema(schema);\r\n\t\t}\r\n\t\tfor (let i in this.tuids) {\r\n\t\t\tlet tuid = this.tuids[i];\r\n\t\t\ttuid.buildFieldsTuid();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildIds(ids: any) {\r\n\t\tfor (let i in ids) {\r\n\t\t\tlet schema = ids[i];\r\n\t\t\tlet { typeId } = schema;\r\n\t\t\tlet ID = this.newID(i, typeId);\r\n\t\t\tID.setSchema(schema);\r\n\t\t}\r\n\t}\r\n\r\n\tasync loadEntitySchema(entityName: string): Promise<any> {\r\n\t\treturn await this.uqApi.schema(entityName);\r\n\t}\r\n\r\n\tasync loadAllSchemas(): Promise<void> {\r\n\t\tlet ret = await this.uqApi.allSchemas();\r\n\t\tlet entities: Entity[][] = [\r\n\t\t\tthis.actionArr,\r\n\t\t\tthis.enumArr,\r\n\t\t\tthis.sheetArr,\r\n\t\t\tthis.queryArr,\r\n\t\t\tthis.bookArr,\r\n\t\t\tthis.mapArr,\r\n\t\t\tthis.historyArr,\r\n\t\t\tthis.pendingArr,\r\n\t\t\tthis.idArr,\r\n\t\t\tthis.idxArr,\r\n\t\t\tthis.ixArr,\r\n\t\t];\r\n\t\tentities.forEach(arr => {\r\n\t\t\tarr.forEach(v => {\r\n\t\t\t\tlet entity = ret[v.name.toLowerCase()];\r\n\t\t\t\tif (!entity) return;\r\n\t\t\t\tlet schema = entity.call;\r\n\t\t\t\tif (!schema) return;\r\n\t\t\t\tv.buildSchema(schema);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tgetTuid(name: string): Tuid {\r\n\t\treturn this.tuids[name];\r\n\t}\r\n\r\n\tprivate buildAccess(access: any) {\r\n\t\tfor (let a in access) {\r\n\t\t\tlet v = access[a];\r\n\t\t\tswitch (typeof v) {\r\n\t\t\t\tcase 'string': this.fromType(a, v); break;\r\n\t\t\t\tcase 'object': this.fromObj(a, v); break;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcacheTuids(defer: number) {\r\n\t\tthis.tuidsCache.cacheTuids(defer);\r\n\t}\r\n\r\n\tprivate setEntity(name: string, entity: Entity) {\r\n\t\tthis.entities[name] = entity;\r\n\t\tthis.entities[name.toLowerCase()] = entity;\r\n\t\tthis.entityTypes[entity.typeId] = entity;\r\n\t}\r\n\r\n\tnewEnum(name: string, id: number): UqEnum {\r\n\t\tlet enm = this.enums[name];\r\n\t\tif (enm !== undefined) return enm;\r\n\t\tenm = this.enums[name] = new UqEnum(this, name, id);\r\n\t\tthis.setEntity(name, enm);\r\n\t\tthis.enumArr.push(enm);\r\n\t\treturn enm;\r\n\t}\r\n\tnewAction(name: string, id: number): Action {\r\n\t\tlet action = this.actions[name];\r\n\t\tif (action !== undefined) return action;\r\n\t\taction = this.actions[name] = new Action(this, name, id);\r\n\t\tthis.setEntity(name, action);\r\n\t\tthis.actionArr.push(action);\r\n\t\treturn action;\r\n\t}\r\n\tprivate newTuid(name: string, id: number, from: SchemaFrom): Tuid {\r\n\t\tlet tuid = this.tuids[name];\r\n\t\tif (tuid !== undefined) return tuid;\r\n\t\tif (from !== undefined)\r\n\t\t\ttuid = new TuidImport(this, name, id, from);\r\n\t\telse\r\n\t\t\ttuid = new TuidInner(this, name, id);\r\n\t\tthis.tuids[name] = tuid;\r\n\t\tthis.setEntity(name, tuid);\r\n\t\tthis.tuidArr.push(tuid);\r\n\t\treturn tuid;\r\n\t}\r\n\tnewQuery(name: string, id: number): Query {\r\n\t\tlet query = this.queries[name];\r\n\t\tif (query !== undefined) return query;\r\n\t\tquery = this.queries[name] = new Query(this, name, id)\r\n\t\tthis.setEntity(name, query);\r\n\t\tthis.queryArr.push(query);\r\n\t\treturn query;\r\n\t}\r\n\tprivate newBook(name: string, id: number): Book {\r\n\t\tlet book = this.books[name];\r\n\t\tif (book !== undefined) return book;\r\n\t\tbook = this.books[name] = new Book(this, name, id);\r\n\t\tthis.setEntity(name, book);\r\n\t\tthis.bookArr.push(book);\r\n\t\treturn book;\r\n\t}\r\n\tprivate newMap(name: string, id: number): Map {\r\n\t\tlet map = this.maps[name];\r\n\t\tif (map !== undefined) return map;\r\n\t\tmap = this.maps[name] = new Map(this, name, id)\r\n\t\tthis.setEntity(name, map);\r\n\t\tthis.mapArr.push(map);\r\n\t\treturn map;\r\n\t}\r\n\tprivate newHistory(name: string, id: number): History {\r\n\t\tlet history = this.histories[name];\r\n\t\tif (history !== undefined) return;\r\n\t\thistory = this.histories[name] = new History(this, name, id)\r\n\t\tthis.setEntity(name, history);\r\n\t\tthis.historyArr.push(history);\r\n\t\treturn history;\r\n\t}\r\n\tprivate newPending(name: string, id: number): Pending {\r\n\t\tlet pending = this.pendings[name];\r\n\t\tif (pending !== undefined) return;\r\n\t\tpending = this.pendings[name] = new Pending(this, name, id)\r\n\t\tthis.setEntity(name, pending);\r\n\t\tthis.pendingArr.push(pending);\r\n\t\treturn pending;\r\n\t}\r\n\tprivate newSheet(name: string, id: number): Sheet {\r\n\t\tlet sheet = this.sheets[name];\r\n\t\tif (sheet !== undefined) return sheet;\r\n\t\tsheet = this.sheets[name] = new Sheet(this, name, id);\r\n\t\tthis.setEntity(name, sheet);\r\n\t\tthis.sheetArr.push(sheet);\r\n\t\treturn sheet;\r\n\t}\r\n\tprivate newID(name: string, id: number): ID {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet idEntity = this.ids[lName];\r\n\t\tif (idEntity !== undefined) return idEntity;\r\n\t\tidEntity = this.ids[lName] = new ID(this, name, id);\r\n\t\tthis.setEntity(name, idEntity);\r\n\t\tthis.idArr.push(idEntity);\r\n\t\treturn idEntity;\r\n\t}\r\n\tprivate newIDX(name: string, id: number): IDX {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet idx = this.idxs[lName];\r\n\t\tif (idx !== undefined) return idx;\r\n\t\tidx = this.idxs[lName] = new IDX(this, name, id);\r\n\t\tthis.setEntity(name, idx);\r\n\t\tthis.idxArr.push(idx);\r\n\t\treturn idx;\r\n\t}\r\n\tprivate newIX(name: string, id: number): IX {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet ix = this.ixs[lName];\r\n\t\tif (ix !== undefined) return ix;\r\n\t\tix = this.ixs[lName] = new IX(this, name, id);\r\n\t\tthis.setEntity(name, ix);\r\n\t\tthis.ixArr.push(ix);\r\n\t\treturn ix;\r\n\t}\r\n\tprivate fromType(name: string, type: string) {\r\n\t\tlet parts = type.split('|');\r\n\t\ttype = parts[0];\r\n\t\tlet id = Number(parts[1]);\r\n\t\tswitch (type) {\r\n\t\t\t//case 'uq': this.id = id; break;\r\n\t\t\tcase 'tuid':\r\n\t\t\t\t// Tuid should not be created here!;\r\n\t\t\t\t//let tuid = this.newTuid(name, id);\r\n\t\t\t\t//tuid.sys = false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'id': this.newID(name, id); break;\r\n\t\t\tcase 'idx': this.newIDX(name, id); break;\r\n\t\t\tcase 'ix': this.newIX(name, id); break;\r\n\t\t\tcase 'action': this.newAction(name, id); break;\r\n\t\t\tcase 'query': this.newQuery(name, id); break;\r\n\t\t\tcase 'book': this.newBook(name, id); break;\r\n\t\t\tcase 'map': this.newMap(name, id); break;\r\n\t\t\tcase 'history': this.newHistory(name, id); break;\r\n\t\t\tcase 'sheet': this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'enum': this.newEnum(name, id); break;\r\n\t\t}\r\n\t}\r\n\tprivate fromObj(name: string, obj: any) {\r\n\t\tswitch (obj['$']) {\r\n\t\t\tcase 'sheet': this.buildSheet(name, obj); break;\r\n\t\t}\r\n\t}\r\n\tprivate buildSheet(name: string, obj: any) {\r\n\t\tlet sheet = this.sheets[name];\r\n\t\tif (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n\t\tsheet.build(obj);\r\n\t}\r\n\tbuildFieldTuid(fields: Field[], mainFields?: Field[]) {\r\n\t\tif (fields === undefined) return;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { tuid } = f;\r\n\t\t\tif (tuid === undefined) continue;\r\n\t\t\tlet t = this.getTuid(tuid);\r\n\t\t\tif (t === undefined) continue;\r\n\t\t\tf._tuid = t.buildTuidBox();\r\n\t\t}\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { owner } = f;\r\n\t\t\tif (owner === undefined) continue;\r\n\t\t\tlet ownerField = fields.find(v => v.name === owner);\r\n\t\t\tif (ownerField === undefined) {\r\n\t\t\t\tif (mainFields !== undefined) {\r\n\t\t\t\t\townerField = mainFields.find(v => v.name === owner);\r\n\t\t\t\t}\r\n\t\t\t\tif (ownerField === undefined) {\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tthrow new Error(`owner field ${owner} is undefined`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet { arr, tuid } = f;\r\n\t\t\tlet t = this.getTuid(ownerField._tuid.tuid.name);\r\n\t\t\tif (t === undefined) continue;\r\n\t\t\tlet div = t.div(arr || tuid);\r\n\t\t\tf._tuid = div && div.buildTuidDivBox(ownerField);\r\n\t\t\t/*\r\n\t\t\tif (f._tuid === undefined) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\tthrow new Error(`owner field ${owner} is not tuid`);\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\tbuildArrFieldsTuid(arrFields: ArrFields[], mainFields: Field[]) {\r\n\t\tif (arrFields === undefined) return;\r\n\t\tfor (let af of arrFields) {\r\n\t\t\tlet { fields } = af;\r\n\t\t\tif (fields === undefined) continue;\r\n\t\t\tthis.buildFieldTuid(fields, mainFields);\r\n\t\t}\r\n\t}\r\n\r\n\tpullModify(modifyMax: number) {\r\n\t\tthis.tuidsCache.pullModify(modifyMax);\r\n\t}\r\n\r\n\tgetUqKey() {\r\n\t\tlet uqKey: string = this.uqName.split(/[-._]/).join('').toLowerCase();\r\n\t\treturn uqKey;\r\n\t}\r\n\r\n\tgetUqKeyWithConfig() {\r\n\t\tif (!this.config) return;\r\n\t\tlet uqKey: string = this.uqName.split(/[-._]/).join('').toLowerCase();\r\n\t\tlet { dev, alias } = this.config;\r\n\t\tuqKey = capitalCase(dev.alias || dev.name) + capitalCase(alias ?? uqKey);\r\n\t\treturn uqKey;\r\n\t}\r\n\r\n\thasEntity(name: string): boolean {\r\n\t\treturn this.entities[name] !== undefined\r\n\t\t\t|| this.entities[name.toLowerCase()] !== undefined;\r\n\t}\r\n\r\n\tcreateProxy(): any {\r\n\t\tlet ret = new Proxy(this.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tif (lk === '$') {\r\n\t\t\t\t\treturn this.$proxy;\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet func = (this as any)[key];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tthis.errUndefinedEntity(String(key));\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.proxy = ret;\r\n\t\tthis.$proxy = new Proxy(this.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet func = (this as any)['$' + (key as string)];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tthis.errUndefinedEntity(String(key));\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.idCache = new IDCache(this);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate errUndefinedEntity(entity: string) {\r\n\t\tlet err = new Error(`entity ${this.name}.${entity} not defined`);\r\n\t\terr.name = UqError.undefined_entity;\r\n\t\tthrow err;\r\n\t}\r\n\r\n\tprivate async apiPost(api: string, resultType: EnumResultType, apiParam: any): Promise<any> {\r\n\t\tif (resultType === EnumResultType.sql) api = 'sql-' + api;\r\n\t\tlet ret = await this.uqApi.post(IDPath(api), apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async apiActs(param: any, resultType: EnumResultType): Promise<any> {\r\n\t\t// 这边的obj属性序列，也许会不一样\r\n\t\tlet arr: string[] = [];\r\n\t\tlet apiParam: any = {};\r\n\t\tfor (let i in param) {\r\n\t\t\tarr.push(i);\r\n\t\t\tapiParam[i] = (param[i] as any[]).map(v => {\r\n\t\t\t\tlet obj: any = {};\r\n\t\t\t\tfor (let j in v) {\r\n\t\t\t\t\tlet val = v[j];\r\n\t\t\t\t\tif (typeof val === 'object') {\r\n\t\t\t\t\t\tlet nv: any = {};\r\n\t\t\t\t\t\tfor (let n in val) {\r\n\t\t\t\t\t\t\tlet tv = val[n];\r\n\t\t\t\t\t\t\tif (tv && typeof tv === 'object') {\r\n\t\t\t\t\t\t\t\tif (n === 'time') {\r\n\t\t\t\t\t\t\t\t\tif (Object.prototype.toString.call(tv) === '[object Date]') {\r\n\t\t\t\t\t\t\t\t\t\ttv = (tv as Date).getTime();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tlet id = tv['id'];\r\n\t\t\t\t\t\t\t\t\ttv = id;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tnv[n] = tv;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobj[j] = nv;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tobj[j] = val;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn obj;\r\n\t\t\t});\r\n\t\t}\r\n\t\tapiParam['$'] = arr;\r\n\t\tlet ret = await this.apiPost('acts', resultType, apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected Acts = async (param: any): Promise<any> => {\r\n\t\t//let apiParam = this.ActsApiParam(param);\r\n\t\tlet ret = await this.apiActs(param, EnumResultType.data); // await this.apiPost('acts', apiParam);\r\n\t\tlet retArr = (ret[0].ret as string).split('\\n');\r\n\t\tlet arr: string[] = [];\r\n\t\tfor (let i in param) arr.push(i);\r\n\t\tlet retActs: { [key: string]: number[] } = {};\r\n\t\tfor (let i = 0; i < arr.length; i++) {\r\n\t\t\tretActs[arr[i]] = ids(retArr[i].split('\\t'));\r\n\t\t}\r\n\t\treturn retActs;\r\n\t}\r\n\r\n\tprotected AdminGetList = async (): Promise<any[]> => {\r\n\t\treturn await this.uqApi.getAdmins();\r\n\t}\r\n\r\n\tprotected AdminSetMe = async (): Promise<void> => {\r\n\t\treturn await this.uqApi.setMeAdmin();\r\n\t}\r\n\r\n\tprotected AdminSet = async (user: number, role: number, name: string, nick: string, icon: string, assigned: string): Promise<void> => {\r\n\t\treturn await this.uqApi.setAdmin(user, role, name, nick, icon, assigned);\r\n\t}\r\n\r\n\tprotected AdminIsMe = async (): Promise<boolean> => {\r\n\t\treturn await this.uqApi.isAdmin();\r\n\t}\r\n\r\n\tprotected IDValue = (type: string, value: string): object => {\r\n\t\tif (!type) return;\r\n\t\tlet ID = this.ids[type.toLowerCase()];\r\n\t\tif (ID === undefined) return;\r\n\t\t/*\r\n\t\tif (ID.fields === undefined) {\r\n\t\t\tawait ID.loadSchema();\r\n\t\t}\r\n\t\t*/\r\n\t\treturn ID.valueFromString(value)\r\n\t};\r\n\r\n\tprotected $Acts = async (param: any): Promise<any> => {\r\n\t\treturn await this.apiActs(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiActIX(param: any, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, ID, values, IXs } = param;\r\n\t\tlet apiParam: any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIXs: IXs?.map((v: any) => ({ IX: entityName(v.IX), ix: v.ix })),\r\n\t\t\tvalues,\r\n\t\t};\r\n\t\tlet ret = await this.apiPost('act-ix', resultType, apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected ActIX = async (param: ParamActIX<any>): Promise<number[]> => {\r\n\t\tlet ret = await this.apiActIX(param, EnumResultType.data);\r\n\t\treturn (ret[0].ret as string).split('\\t').map(v => Number(v));\r\n\t}\r\n\r\n\tprotected $ActIX = async (param: ParamActIX<any>): Promise<string> => {\r\n\t\tlet ret = await this.apiActIX(param, EnumResultType.sql);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async apiActIxSort(param: ParamActIXSort, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, ix, id, after } = param;\r\n\t\tlet apiParam: any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tix,\r\n\t\t\tid,\r\n\t\t\tafter,\r\n\t\t};\r\n\t\treturn await this.apiPost('act-ix-sort', resultType, apiParam);\r\n\t}\r\n\r\n\tprotected ActIXSort = async (param: ParamActIXSort): Promise<void> => {\r\n\t\treturn await this.apiActIxSort(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $ActIXSort = async (param: ParamActIXSort): Promise<string> => {\r\n\t\treturn await this.apiActIxSort(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprotected ActIDProp = async (ID: ID, id: number, name: string, value: any) => {\r\n\t\tawait this.uqApi.post('act-id-prop', { ID: ID.name, id, name, value });\r\n\t}\r\n\r\n\tprivate async apiActDetail(param: ParamActDetail<any, any>, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { main, detail, detail2, detail3 } = param as unknown as ParamActDetail3<any, any, any, any>;\r\n\t\tlet postParam: any = {\r\n\t\t\tmain: {\r\n\t\t\t\tname: entityName(main.ID),\r\n\t\t\t\tvalue: toScalars(main.value),\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tname: entityName(detail.ID),\r\n\t\t\t\tvalues: detail.values?.map(v => toScalars(v)),\r\n\t\t\t},\r\n\t\t}\r\n\t\tif (detail2) {\r\n\t\t\tpostParam.detail2 = {\r\n\t\t\t\tname: entityName(detail2.ID),\r\n\t\t\t\tvalues: detail2.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (detail3) {\r\n\t\t\tpostParam.detail3 = {\r\n\t\t\t\tname: entityName(detail3.ID),\r\n\t\t\t\tvalues: detail3.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = await this.apiPost('act-detail', resultType, postParam);\r\n\t}\r\n\r\n\tprotected ActDetail = async (param: ParamActDetail<any, any>) => {\r\n\t\tlet ret = await this.apiActDetail(param, EnumResultType.data);\r\n\t\tlet val: string = ret[0].ret;\r\n\t\tlet parts = val.split('\\n');\r\n\t\tlet items = parts.map(v => v.split('\\t'));\r\n\t\tret = {\r\n\t\t\tmain: ids(items[0])[0],\r\n\t\t\tdetail: ids(items[1]),\r\n\t\t\tdetail2: ids(items[2]),\r\n\t\t\tdetail3: ids(items[3]),\r\n\t\t};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected $ActDetail = async (param: ParamActDetail<any, any>) => {\r\n\t\treturn await this.apiActDetail(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiQueryID(param: ParamQueryID, resultType: EnumResultType): Promise<any[]> {\r\n\t\tlet { ID, IX, IDX } = param;\r\n\t\tif (!IDX) {\r\n\t\t\tIDX = [ID];\r\n\t\t}\r\n\t\tlet ret = await this.apiPost('query-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: IX?.map(v => entityName(v)),\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected QueryID = async (param: ParamQueryID) => {\r\n\t\treturn await this.apiQueryID(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $QueryID = async (param: ParamQueryID) => {\r\n\t\treturn await this.apiQueryID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDTv(ids: number[], resultType: EnumResultType): Promise<any[]> {\r\n\t\tlet ret = await this.apiPost('id-tv', resultType, ids);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tIDTv = async (ids: number[]): Promise<any[]> => {\r\n\t\tlet ret = await this.apiIDTv(ids, EnumResultType.data);\r\n\t\tlet retValues: any[] = [];\r\n\t\tfor (let row of ret) {\r\n\t\t\tlet { $type, $tv } = row;\r\n\t\t\tif (!$tv) continue;\r\n\t\t\tlet ID = this.ids[$type];\r\n\t\t\tif (!ID) continue;\r\n\t\t\tlet { schema } = ID;\r\n\t\t\tif (!schema) {\r\n\t\t\t\tawait ID.loadSchema();\r\n\t\t\t\tschema = ID.schema;\r\n\t\t\t}\r\n\t\t\tlet { nameNoVice } = schema;\r\n\t\t\tif (!nameNoVice) continue;\r\n\t\t\tlet values = ($tv as string).split('\\n');\r\n\t\t\tlet len = nameNoVice.length;\r\n\t\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\t\tlet p = nameNoVice[i];\r\n\t\t\t\trow[p] = values[i];\r\n\t\t\t}\r\n\t\t\tdelete row.$tv;\r\n\t\t\tretValues.push(row);\r\n\t\t}\r\n\t\treturn retValues;\r\n\t}\r\n\r\n\tprotected $IDTv = async (ids: number[]): Promise<any> => {\r\n\t\treturn await this.apiIDTv(ids, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDNO(param: ParamIDNO, resultType: EnumResultType): Promise<string> {\r\n\t\tlet { ID, stamp } = param;\r\n\t\tlet ret = await this.apiPost('id-no', resultType, { ID: entityName(ID), stamp });\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected IDNO = async (param: ParamIDNO): Promise<string> => {\r\n\t\treturn await this.apiIDNO(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected IDEntity = (typeId: number): ID => {\r\n\t\treturn this.entityTypes[typeId] as ID;\r\n\t};\r\n\r\n\tprotected $IDNO = async (param: ParamIDNO): Promise<string> => {\r\n\t\treturn await this.apiIDNO(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDDetailGet(param: ParamIDDetailGet, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { id, main, detail, detail2, detail3 } = param;\r\n\t\tlet ret = await this.apiPost('id-detail-get', resultType, {\r\n\t\t\tid,\r\n\t\t\tmain: entityName(main),\r\n\t\t\tdetail: entityName(detail),\r\n\t\t\tdetail2: entityName(detail2),\r\n\t\t\tdetail3: entityName(detail3),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tIDDetailGet = async (param: ParamIDDetailGet): Promise<any> => {\r\n\t\treturn await this.apiIDDetailGet(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $IDDetailGet = async (param: ParamIDDetailGet): Promise<any> => {\r\n\t\treturn await this.apiIDDetailGet(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate IDXToString(p: ID | IDX | ((ID | IDX)[])): string | string[] {\r\n\t\tif (Array.isArray(p) === true) return (p as (ID | IDX)[]).map(v => entityName(v));\r\n\t\treturn entityName(p as ID | IDX);\r\n\t}\r\n\tprivate async apiID(param: ParamID, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected ID = async (param: ParamID): Promise<any[]> => {\r\n\t\treturn await this.apiID(param, EnumResultType.data);\r\n\t}\r\n\tprotected $ID = async (param: ParamID): Promise<string> => {\r\n\t\treturn await this.apiID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiKeyID(param: ParamKeyID, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IDX } = param;\r\n\t\tlet ret = await this.apiPost('key-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected KeyID = async (param: ParamKeyID): Promise<any[]> => {\r\n\t\treturn await this.apiKeyID(param, EnumResultType.data);\r\n\t}\r\n\tprotected $KeyID = async (param: ParamKeyID): Promise<string> => {\r\n\t\treturn await this.apiKeyID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIX(param: ParamIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, IX1, IDX } = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.apiPost('ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IX = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IX = async (param: ParamIX): Promise<string> => {\r\n\t\treturn await this.apiIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIXValues(param: ParamIXValues, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX } = param;\r\n\t\tlet ret = await this.apiPost('ix-values', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IXValues = async (param: ParamIXValues): Promise<any[]> => {\r\n\t\treturn await this.apiIXValues(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprivate async apiIXr(param: ParamIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, IX1, IDX } = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.apiPost('ixr', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IXr = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIXr(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IXr = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIXr(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiKeyIX(param: ParamKeyIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IX, IDX } = param;\r\n\t\t//this.checkParam(ID, IDX, IX, null, key, page);\r\n\t\tlet ret = await this.apiPost('key-ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected KeyIX = async (param: ParamKeyIX): Promise<any[]> => {\r\n\t\treturn await this.apiKeyIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $KeyIX = async (param: ParamKeyIX): Promise<any[]> => {\r\n\t\treturn await this.apiKeyIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDLog(param: ParamIDLog, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-log', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDLog = async (param: ParamIDLog): Promise<any[]> => {\r\n\t\treturn await this.apiIDLog(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDLog = async (param: ParamIDLog): Promise<string> => {\r\n\t\treturn await this.apiIDLog(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDSum(param: ParamIDSum, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-sum', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDSum = async (param: ParamIDSum): Promise<any[]> => {\r\n\t\treturn await this.apiIDSum(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDSum = async (param: ParamIDSum): Promise<string> => {\r\n\t\treturn await this.apiIDSum(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDinIX(param: ParamIDinIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-in-ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDinIX = async (param: ParamIDinIX): Promise<any | { $in: boolean }[]> => {\r\n\t\treturn await this.apiIDinIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDinIX = async (param: ParamIDinIX): Promise<string> => {\r\n\t\treturn await this.apiIDinIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDxID(param: ParamIDxID, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IX, ID2 } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-x-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID2: entityName(ID2),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDxID = async (param: ParamIDxID): Promise<any[]> => {\r\n\t\treturn await this.apiIDxID(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDxID = async (param: ParamIDxID): Promise<string> => {\r\n\t\treturn await this.apiIDxID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDTree(param: ParamIDTree, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID } = param;\r\n\t\tlet ret = await this.apiPost('id-tree', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDTree = async (param: ParamIDTree): Promise<any[]> => {\r\n\t\treturn await this.apiIDTree(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDTree = async (param: ParamIDTree): Promise<string> => {\r\n\t\treturn await this.apiIDTree(param, EnumResultType.sql);\r\n\t}\r\n}\r\n\r\nfunction ids(item: string[]): number[] {\r\n\tif (!item) return;\r\n\tlet len = item.length;\r\n\tif (len <= 1) return;\r\n\tlet ret: number[] = [];\r\n\tfor (let i = 0; i < len - 1; i++) ret.push(Number(item[i]));\r\n\treturn ret;\r\n}\r\n\r\nfunction entityName(entity: Entity | string): string {\r\n\tif (!entity) return;\r\n\tif (typeof entity === 'string') return entity;\r\n\treturn entity.name;\r\n}\r\n\r\nfunction toScalars(value: any): any {\r\n\tif (!value) return value;\r\n\tlet ret: any = {};\r\n\tfor (let i in value) {\r\n\t\tlet v = value[i];\r\n\t\tif (typeof v === 'object') v = v['id'];\r\n\t\tret[i] = v;\r\n\t}\r\n\treturn ret;\r\n}\r\n","import { UQsBuildingLoader } from \"../uqCore\";\r\nimport { TsTemplate } from \"./TsTemplate\";\r\n\r\nexport abstract class UqBuildContext {\r\n\treadonly uqsLoader: UQsBuildingLoader;\r\n\treadonly uqTsSrcPath: string;\r\n\treadonly tsTemplate: TsTemplate;\r\n\r\n\tconstructor(uqsLoader: UQsBuildingLoader, uqTsSrcPath: string) {\r\n\t\tthis.uqsLoader = uqsLoader;\r\n\t\tthis.uqTsSrcPath = uqTsSrcPath;\r\n\t\tthis.tsTemplate = new TsTemplate(this);\r\n\t}\r\n\r\n\tabstract get uiPlatform():string;\r\n\tabstract get uiPlatformUpper():string;\r\n\tabstract get uiPlatformCamel():string;\r\n\tabstract get element(): string;\r\n}\r\n","import { UqApi } from '../net';\r\nimport { getObjPropIgnoreCase, LocalCache } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\nconst chars = '\\\\ntbfvr';\r\nconst codeBackSlash = chars.charCodeAt(0);\r\nconst codeN = chars.charCodeAt(1);\r\nconst codeT = chars.charCodeAt(2);\r\nconst codeB = chars.charCodeAt(3);\r\nconst codeF = chars.charCodeAt(4);\r\nconst codeV = chars.charCodeAt(5);\r\nconst codeR = chars.charCodeAt(6);\r\n\r\nconst codes = '\\n\\t\\b\\f\\v\\r';\r\nconst codeBN = codes.charCodeAt(0);\r\nconst codeBT = codes.charCodeAt(1);\r\nconst codeBB = codes.charCodeAt(2);\r\nconst codeBF = codes.charCodeAt(3);\r\nconst codeBV = codes.charCodeAt(4);\r\nconst codeBR = codes.charCodeAt(5);\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly schemaLocal: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName(): string { return this.jName || this.name }\r\n    fields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq: UqMan, name: string, typeId: number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.schemaLocal = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: { [arr: string]: FieldMap } = {};\r\n    fieldMap(arr?: string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields: Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema(): Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.schemaLocal.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        //this.setSchema(schema);\r\n        //this.buildFieldsTuid();\r\n        this.buildSchema(schema);\r\n        await this.loadValues();\r\n    }\r\n\r\n    buildSchema(schema: any) {\r\n        this.setSchema(schema);\r\n        this.buildFieldsTuid();\r\n        //await this.loadValues();\r\n    }\r\n\r\n    protected async loadValues(): Promise<any> { }\r\n\r\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema: any) {\r\n        if (schema === undefined) return;\r\n        let { name, version } = schema;\r\n        this.ver = version || 0;\r\n        this.setJName(name);\r\n        this.schemaLocal.set(schema);\r\n        this.schema = schema;\r\n        this.buildFieldsTuid();\r\n    }\r\n\r\n    protected setJName(name: string) {\r\n        if (name !== this.name) this.jName = name;\r\n    }\r\n\r\n    protected setKeys() {\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        let { fields, arrs, returns } = this.schema;\r\n        this.fields = fields;\r\n        this.setKeys();\r\n        this.uq.buildFieldTuid(fields);\r\n        this.arrFields = arrs;\r\n        this.uq.buildArrFieldsTuid(arrs, fields);\r\n        this.returns = returns;\r\n        this.uq.buildArrFieldsTuid(returns, fields);\r\n    }\r\n\r\n    schemaStringify(): string {\r\n        return JSON.stringify(this.schema, (key: string, value: any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName: string, arrName?: string): Tuid {\r\n        if (this.schema === undefined) return;\r\n        let { fields, arrs } = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn: string, fieldArr: Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params: any): any {\r\n        let result: any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let { name, fields } = arr;\r\n                let paramsArr: any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult: any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result: any, fields: Field[], params: any) {\r\n        for (let field of fields) {\r\n            let { name, type } = field;\r\n            let d = params[name];\r\n            let val: any;\r\n            switch (type) {\r\n                case 'datetime':\r\n                    val = this.buildDateTimeParam(d);\r\n                    break;\r\n                case 'date':\r\n                    if (d instanceof Date) {\r\n                        val = `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;\r\n                    }\r\n                    else {\r\n                        val = d;\r\n                    }\r\n                    break;\r\n                default:\r\n                    switch (typeof d) {\r\n                        default: val = d; break;\r\n                        case 'object':\r\n                            if (d instanceof Date) {\r\n                                val = d;\r\n                                break;\r\n                            }\r\n                            let tuid = field._tuid;\r\n                            if (tuid === undefined) val = d.id;\r\n                            else val = tuid.getIdFromObj(d);\r\n                            break;\r\n                    }\r\n                    break;\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val: any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return undefined;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime() / 1000);\r\n    }\r\n\r\n    buildDateParam(val: any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p > 0 ? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data: any): string {\r\n        let ret: string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let { name, fields } = arr;\r\n                let arrData = getObjPropIgnoreCase(data, name);\r\n                //if (!arrData) arrData = data[name.toLowerCase()];\r\n                this.packArr(ret, fields, arrData);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row: any, field: Field): any {\r\n        let d = row[field.name];\r\n        if (d === null) return '';\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i = 0; i < len; i++) {\r\n                            let c: number = d.charCodeAt(i), ch: string;\r\n                            switch (c) {\r\n                                default: continue;\r\n                                case codeBackSlash: ch = '\\\\\\\\'; break;\r\n                                case codeBT: ch = '\\\\t'; break;\r\n                                case codeBN: ch = '\\\\n'; break;\r\n                                case codeBF: ch = '\\\\f'; break;\r\n                                case codeBV: ch = '\\\\v'; break;\r\n                                case codeBB: ch = '\\\\b'; break;\r\n                                case codeBR: ch = '\\\\r'; break;\r\n                            }\r\n                            r += d.substring(p, i) + ch;\r\n                            p = i + 1;\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result: string[], fields: Field[], data: any) {\r\n        let len = fields.length;\r\n        if (len === 0) {\r\n            result.push(ln);\r\n            return;\r\n        }\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i = 1; i < len; i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result: string[], fields: Field[], data: any[]) {\r\n        if (data !== undefined) {\r\n            if (data.length === 0) {\r\n                result.push(ln);\r\n            }\r\n            else {\r\n                for (let row of data) {\r\n                    this.packRow(result, fields, row);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            result.push(ln);\r\n        }\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values: any, fields: Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let { name, _tuid } = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values: string[], fields: Field[]): any[] {\r\n        if (fields === undefined) {\r\n            return values as any[];\r\n        }\r\n        let ret: any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p < len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data: string): any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackReturns(data: string, returns?: ArrFields[]): { [name: string]: any[] } {\r\n        if (data === undefined) debugger;\r\n        let ret = {} as any;\r\n        let p = 0;\r\n        let arrs = returns || this.returns;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    protected unpackRow(ret: any, fields: Field[], data: string, p: number, sep: number = 9): number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (; p < len; p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === sep) {\r\n                let f = fields[i];\r\n                let { name } = f;\r\n                if (ch0 !== 8) {\r\n                    if (p > c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p + 1;\r\n                ++i;\r\n                if (i >= fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let { name } = f;\r\n                if (ch0 !== 8) {\r\n                    if (p > c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let { name } = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret: any, v: string, f: Field): any {\r\n        switch (f.type) {\r\n            default: return v;\r\n            case 'text':\r\n            case 'char':\r\n                return this.reverseNT(v);\r\n            //case 'time':\r\n            case 'datetime':\r\n            case 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true ? new Date(v) : new Date(n * 1000);\r\n                return date;\r\n            /*\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1]) - 1, Number(parts[2]));\r\n            */\r\n            case 'enum':\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n            case 'float':\r\n            case 'double':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let { _tuid } = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    private reverseNT(text: string): string {\r\n        if (text === undefined) return;\r\n        if (text === null) return;\r\n        let len = text.length;\r\n        let r = '';\r\n        let p = 0;\r\n        for (let i = 0; i < len; i++) {\r\n            let c = text.charCodeAt(i);\r\n            if (c === codeBackSlash) {\r\n                if (i === len - 1) break;\r\n                let c1 = text.charCodeAt(i + 1);\r\n                let ch: string;\r\n                switch (c1) {\r\n                    default: continue;\r\n                    case codeBackSlash: ch = '\\\\'; break;\r\n                    case codeN: ch = '\\n'; break;\r\n                    case codeT: ch = '\\t'; break;\r\n                    case codeB: ch = '\\b'; break;\r\n                    case codeF: ch = '\\f'; break;\r\n                    case codeV: ch = '\\v'; break;\r\n                    case codeR: ch = '\\r'; break;\r\n                }\r\n                r += text.substring(p, i) + ch;\r\n                p = i + 2;\r\n                ++i;\r\n            }\r\n        }\r\n        r += text.substring(p, len);\r\n        return r;\r\n    }\r\n\r\n    private unpackArr(ret: any, arr: ArrFields, data: string, p: number): number {\r\n        let p0 = p;\r\n        let vals: any[] = [], len = data.length;\r\n        let { name, fields } = arr;\r\n        while (p < len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n                if (p === p0) {\r\n                    ch = data.charCodeAt(p);\r\n                    if (ch !== 10) {\r\n                        throw new Error('upackArr: arr第一个字符是10，则必须紧跟一个10，表示整个arr的结束')\r\n                    }\r\n                    ++p;\r\n                }\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import { Caller } from '../net';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params: T, $$user: number = undefined, waiting: boolean = true) {\r\n        super(params, $$user, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity { return this._entity; }\r\n\r\n    //大多的entityCaller都不需要这个\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n\r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let { $uq, $modify, res } = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            let ret = this.xresult(res);\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res: any): any { return res }\r\n\r\n    get headers(): { [header: string]: string } {\r\n        let { ver, uq } = this.entity;\r\n        let { uqVersion } = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error(`${schema.entity.name} can not get right uq response schema, 5 tries`);\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let { uq, entity } = schema;\r\n        if (uq !== undefined) {\r\n            this.entity.uq.buildEntities(uq);\r\n        }\r\n        if (entity !== undefined) {\r\n            this.entity.setSchema(entity);\r\n        }\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action { return this._entity as Action; }\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query { return this._entity as Query };\r\n    get path(): string { return `query/${this.entity.name}`; }\r\n    xresult(res: any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() { return this.entity.buildParams(this.params); }\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): { pageStart: any; pageSize: number, params: any } { return this._params };\r\n    protected get entity(): Query { return this._entity as Query };\r\n    //results: {[name:string]:any[]};\r\n    get path(): string { return `query-page/${this.entity.name}`; }\r\n    buildParams() {\r\n        let { pageStart, pageSize, params } = this.params;\r\n        let p: any;\r\n        if (params === undefined) {\r\n            p = { key: '' };\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res: any): { [name: string]: any[] } {\r\n        let ret = this.entity.unpackReturns(res);\r\n        //return this.results.$page;// as any[];\r\n        return ret;\r\n    }\r\n}\r\n","import { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 10000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];                   // 每次使用，都排到队头\r\n    private readonly cache: Map<number, any>;    // 已经缓冲的\r\n\r\n    protected localArr: LocalArr;\r\n    protected waitingIds: number[] = [];          // 等待loading的\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.cache = tuidLocal.uq.net.createObservableMap();\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.schemaLocal.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    cacheSet(id: number, val: any) {\r\n        this.cache.set(id, val);\r\n    }\r\n\r\n    useId(id: number, defer?: boolean) {\r\n        if (!id) return;\r\n        if (typeof id !== 'number') {\r\n            console.error('id cache ' + id + ' is not number');\r\n            return;\r\n        }\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer === true ? 70 : 20);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n        return;\r\n    }\r\n\r\n    private moveToHead(id: number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id: number) {\r\n        return this.cache.get(id);\r\n    }\r\n\r\n    remove(id: number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id: number | BoxId): any {\r\n        let _id: number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id: number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val: any): boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n        this.cacheSet(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val: any) { return this.tuidInner.getIdFromObj(val) }\r\n\r\n    async cacheIds(): Promise<void> {\r\n        let tuidValues = await this.loadIds();\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    protected cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === true) {\r\n                this.cacheTuidFieldValues(tuidValue);\r\n            }\r\n        }\r\n    }\r\n    async modifyIds(ids: any[]): Promise<void> {\r\n        let tuidValues: string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p < 0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected async loadIds(): Promise<any[]> {\r\n        if (this.waitingIds.length === 0) return;\r\n        let loadingIds = [...this.waitingIds];\r\n        this.waitingIds = [];\r\n        return await this.loadTuidIdsOrLocal(loadingIds);\r\n    }\r\n    protected unpackTuidIds(values: string[]): any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id: number): Promise<object | number> {\r\n        let val = this.cache.get(id);\r\n        if (val !== undefined) return val;\r\n        /*\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            // case 'number': this.cache.set(id, undefined); break;\r\n        }\r\n        */\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        this.cacheIdValues(ret);\r\n    }\r\n\r\n    protected async loadValuesFromIds(netIds: number[]): Promise<any[]> {\r\n        let netRet = await this.tuidInner.loadValuesFromIds(undefined, netIds);\r\n        return netRet;\r\n    }\r\n\r\n    private async loadTuidIdsOrLocal(ids: number[]): Promise<string[]> {\r\n        let ret: string[] = [];\r\n        let netIds: number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // 值不存在或者是空字符串，重新获取\r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len === 0) return ret;\r\n\r\n        let netRet = await this.loadValuesFromIds(netIds);\r\n        for (let i = 0; i < len; i++) {\r\n            //有些id可能没有内容，不会返回\r\n            //let id = netIds[i]; \r\n            let row: string = netRet[i];\r\n            if (!row) continue;\r\n            let p = row.indexOf('\\t');\r\n            if (p < 0) p = row.length;\r\n            let id = Number(row.substr(0, p));\r\n            let pos = netIds.findIndex(v => v === id);\r\n            if (pos >= 0) netIds.splice(pos, 1);\r\n            ret.push(row);\r\n            this.localArr.setItem(id, row);\r\n        }\r\n        len = netIds.length;\r\n        for (let i = 0; i < len; i++) {\r\n            this.localArr.setItem(netIds[i], '');\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName: string;\r\n\r\n    constructor(tuidLocal: TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.schemaLocal.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // 这个不需要，必须去掉\r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val: any) { return this.div.getIdFromObj(val) }\r\n    protected unpackTuidIds(values: string[]): any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n    protected async loadValuesFromIds(netIds: number[]): Promise<any[]> {\r\n        let netRet = await this.tuidInner.loadValuesFromIds(this.divName, netIds);\r\n        return netRet;\r\n    }\r\n}\r\n","import { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport interface TuidNOResult {\r\n\tdate: string;\r\n\tno: number;\r\n}\r\n\r\nexport abstract class UqTuid<M> extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    unique: string[];\r\n\t//render: Render<M>;\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    //abstract tv(id:number, render?:Render<M>):JSX.Element;\r\n    abstract getObj(id:number):M;\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n\tabstract assureBox<T> (id:number|BoxId): Promise<T>;\r\n\tstatic idValue(id: {id:number}|number):number {\r\n\t\tlet t = typeof id;\r\n\t\tswitch (t) {\r\n\t\t\tdefault: debugger; throw new Error('unknown id type: ' + t);\r\n\t\t\tcase 'undefined': return undefined;\r\n\t\t\tcase 'object': return (id as any).id;\r\n\t\t\tcase 'number': return id as number;\r\n\t\t}\r\n\t}\r\n    static equ(id1:{id:number}|number, ix:{id:number}|number): boolean {\r\n        if (id1 === undefined || id1 === null) return false;\r\n\t\tif (ix === undefined || ix === null) return false;\r\n\t\treturn Tuid.idValue(id1) === Tuid.idValue(ix);\r\n\t\t/*\r\n        if (typeof id1 === 'object') {\r\n\t\t\tlet id1Id = id1.id;\r\n            return typeof ix === 'object'? id1Id === ix.id : id1Id === ix;\r\n        }\r\n        if (typeof ix === 'object') {\r\n\t\t\tlet id2Id = ix.id;\r\n            return typeof id1 === 'object'? id2Id === id1.id : id2Id === id1;\r\n        }\r\n\t\treturn id1 === ix;\r\n\t\t*/\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract loadMain(id:number|BoxId):Promise<M>;\r\n\tabstract load(id:number|BoxId):Promise<M>;\r\n    abstract all():Promise<M[]>;\r\n\tabstract save(id:number, props:M):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract search(key:string, pageStart:string|number, pageSize:number):Promise<M[]>;\r\n    abstract searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n\tabstract posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n\tabstract no():Promise<TuidNOResult>;\r\n}\r\n\r\nexport abstract class Tuid extends UqTuid<any> {\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.schemaLocal.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    getObj(id:number):any {\r\n        let obj = this.valueFromId(id);\r\n        if (obj) return obj;\r\n        this.useId(id);\r\n        return {id};\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //let {createBoxId} = this.uq;\r\n        //if (!createBoxId) \r\n        return {id: id} as BoxId;\r\n        //return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadValuesFromIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, undefined, false).request();\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n\t}\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await new TuidNoCaller(this, undefined).request();\r\n\t}\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = Object.assign({}, props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\nclass TuidNoCaller extends TuidCaller<{}> {\r\n    get path():string {\r\n        return `tuid-no/${this.entity.name}/`;\r\n    }\r\n    buildParams():any {\r\n\t\tlet d = new Date();\r\n\t\tlet year = d.getFullYear();\r\n\t\tlet month = d.getMonth() + 1;\r\n\t\tlet date = d.getDate();\r\n        return {year, month, date};\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    getObj(id:number): any {return this.tuidLocal?.getObj(id)}\r\n    /*\r\n\ttv(id:number, render?:Render<any>):JSX.Element {\r\n\t\treturn this.tuidLocal?.tv(id, render);\r\n\t}\r\n    */\r\n\r\n    useId(id:number) {this.tuidLocal?.useId(id);}\r\n    boxId(id:number):BoxId {\r\n\t\tif (!this.tuidLocal) debugger;\r\n\t\treturn this.tuidLocal?.boxId(id);\r\n\t}\r\n    valueFromId(id:number) {return this.tuidLocal?.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal?.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal?.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal?.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await this.tuidLocal.no();\r\n\t}\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer: number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = setTimeout(this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let { tuids } = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n\r\n    pullModify(modifyMax: number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let { max, seconds } = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached: string[] = [];\r\n        let { tuids } = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists: string): Promise<void> {\r\n        let { uqApi, tuids } = this.uq;\r\n        let { max } = this.modifyMax;\r\n        let ret: { queue: Modify[], queueMax: number } = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group: { [entity: string]: { tuid: Tuid; ids: string[] } } = {};\r\n        let modifyMax: number = 0;\r\n        for (let modify of ret.queue) {\r\n            let { id, entity, key } = modify;\r\n            if (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = { tuid: tuid, ids: [] };\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let { tuid, ids } = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class UqAction<P, R> extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:P, $$user:number = undefined, waiting: boolean = true) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data, $$user, waiting)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:P, $$user:number = undefined):Promise<R> {\r\n       return await new SubmitReturnsCaller(this, data, $$user).request();\r\n    }\r\n    async submitConvert(data:P, $$user:number = undefined) {\r\n        return await new SubmitConvertCaller(this, data, $$user).request();\r\n    }\r\n}\r\n\r\nexport class Action extends UqAction<any, any> {\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {\r\n\t\treturn {\r\n            $$user: this.$$user,\r\n            data: this.entity.pack(this.params)\r\n        };\r\n\t}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            $$user: this.$$user,\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { EntityCaller } from './caller';\r\nimport { ArrFields } from './uqMan';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport interface SheetSaveReturnV<V> {\r\n\tid: number;\r\n\tflow: number;\r\n\tstate: string;\r\n\tverify: V[];\r\n}\r\n\r\nexport interface SheetSaveReturn extends SheetSaveReturnV<any> {\r\n}\r\n\r\ninterface GetSheetReturn<M> {\r\n\tbrief: any;\r\n\tdata: M;\r\n\tflows: any[];\r\n}\r\n\r\nexport class UqSheet<M, V> extends Entity {\r\n    get typeName(): string { return 'sheet';}\r\n\tstates: SheetState[];\r\n\tverify: {returns: ArrFields[]};\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n\t\tthis.states = schema.states;\r\n\t\tthis.verify = schema.verify;\r\n    }\r\n    build(obj:any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({name: op, actions:undefined});\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    async save(discription:string, data:M):Promise<SheetSaveReturnV<V>> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveCaller(this, params).request();\r\n    }\r\n    async saveDebugDirect(discription:string, data:M):Promise<SheetSaveReturn> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveDirectCaller(this, params).request();\r\n    }\r\n    async action(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    async actionDebugDirect(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionDirectCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    private unpack(data:any):GetSheetReturn<M> {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart:number, pageSize:number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {pageStart:pageStart, pageSize:pageSize};\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    //createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\r\n\r\n    async stateSheetCount():Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state:string, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        let params = {state:state, user:user, pageStart:pageStart, pageSize:pageSize};\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\nexport class Sheet extends UqSheet<any, any> {\r\n}\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet {return this._entity as Sheet;}\r\n    protected readonly suffix:string;\r\n    get path():string {return `sheet/${this.entity.name}/${this.suffix}`;}\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{app:number; discription:string; data:any}> {\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    buildParams() {\r\n        let {app, discription, data} = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n    xresult(res:any):any {\r\n\t\tlet {verify} = this.entity;\r\n\t\tif (verify === undefined) return res;\r\n\t\tlet resVerify = res.verify;\r\n\t\tif (resVerify === undefined || resVerify.length === 0) {\r\n\t\t\tres.verify = undefined;\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\tlet {returns} = verify;\r\n\t\tres.verify = this.entity.unpackReturns(resVerify, returns);\r\n        return res;\r\n    }\r\n}\r\n\r\nclass SaveDirectCaller extends SaveCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{id:number, flow:number, state:string, action:string}> {\r\n    method = 'PUT';\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n}\r\n\r\nclass ActionDirectCaller extends ActionCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/get/${this.params}`;}\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/archive/${this.params}`;}\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res:any):any {\r\n        let {states} = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{state:string, user:number, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n/*\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n\t}\r\n\tprotected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\treturn item === undefined? 0 : (item as any).id;\r\n\t}\r\n}\r\n*/\r\n","import { /*Field, */ArrFields } from './uqMan';\r\nimport { Entity } from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class UqQuery<P, R> extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    /*\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    */\r\n    //list:IObservableArray; \r\n    returns: ArrFields[];\r\n\tisPaged: boolean;\r\n\t\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n    /*\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        //this.list = undefined;\r\n    }\r\n    */\r\n    //get hasMore() {return this.more;}\r\n    /*\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = (ret as any).$page;\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n    }\r\n    */\r\n    protected pageCaller(params: any, $$user:number = undefined, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, $$user, showWaiting);\r\n    }\r\n\r\n    async page(params:P, pageStart:any, pageSize:number, $$user:number = undefined, showWaiting: boolean = true):Promise<R> {\r\n        let p = {pageStart, pageSize, params};\r\n        let res = await this.pageCaller(p, $$user, showWaiting).request();\r\n        return res;\r\n    }\r\n    protected queryCaller(params: P, $$user:number = undefined, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, $$user, showWaiting);\r\n    }\r\n    async query(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<R> {\r\n        let res = await this.queryCaller(params, $$user, showWaiting).request();\r\n        return res;\r\n    }\r\n    async table(params:P, $$user:number = undefined, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, $$user, showWaiting);\r\n        for (let i in ret) {\r\n            return (ret as any)[i];\r\n        }\r\n    }\r\n    async obj(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, $$user,showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, $$user, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Query extends UqQuery<any, any> {\r\n}\r\n","import { UqQuery} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class UqBook<P, R> extends UqQuery<P, R> {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class Book extends UqBook<any, any> {\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    get path():string {return `book/${this.entity.name}`;}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqHistory<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n\r\nexport class History extends UqHistory<any, any> {\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class UqMap extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Map extends UqMap {\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqPending<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n\r\nexport class Pending extends UqPending<any, any> {\r\n}\r\n","import { Entity } from \"./entity\";\r\n\r\nexport class UqEnum extends Entity {\r\n    get typeName(): string { return 'enum';}\r\n}","import { Entity } from \"./entity\";\r\nimport { Field, Uq } from \"./uqMan\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqID<M extends { id: number }> extends Entity {\r\n\tget typeName() { return 'id' }\r\n\tcreate: boolean;\r\n\tupdate: boolean;\r\n\towner: boolean;\r\n\tkeys: Field[];\r\n\tasync NO(): Promise<string> {\r\n\t\tlet ret = await this.uqApi.post('id-no', { ID: this.name });\r\n\t\treturn ret;\r\n\t};\r\n\tprotected setKeys() {\r\n\t\tthis.keys = this.schema.keys;\r\n\t}\r\n\tget isGlobal(): boolean {\r\n\t\treturn this.schema.global;\r\n\t}\r\n\tgetIdFromObj(value: any): number { return value['id']; }\r\n\tvalueFromString(str: string): M {\r\n\t\tif (!str) return undefined;\r\n\t\tlet ret: M = {} as M;\r\n\t\tthis.unpackRow(ret, this.fields, str, 0, 12);\r\n\t\treturn ret;\r\n\t}\r\n\tcacheTuids(defer: number): void { }\r\n\tasync loadValuesFromIds(divName: string, ids: number[]): Promise<M[]> {\r\n\t\tlet ret = await (this.uq as unknown as Uq).QueryID<M>({\r\n\t\t\tIDX: [this],\r\n\t\t\tid: ids\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tcacheTuidFieldValues(value: any): void { }\r\n\tunpackTuidIds(values: string[]): any[] { return; }\r\n}\r\n\r\nexport class ID extends UqID<any> {\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIDX<M> extends Entity {\r\n\tget typeName() { return 'idx' }\r\n}\r\n\r\nexport class IDX extends UqIDX<any> {\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIX<M> extends Entity {\r\n\tget typeName() { return 'ix' }\r\n}\r\n\r\nexport class IX extends UqIX<any> {\r\n}\r\n\r\n/* eslint-enable no-unused-vars */\r\n","import { UqMan } from '../uqMan';\r\n\r\nconst maxCacheSize = 1000;\r\nconst delayLoad = 30; \t// 延迟loading的时间\r\nexport class IDCache {\r\n\tprotected uqMan: UqMan;\r\n\tprivate queue: number[] = [];               \t\t\t\t\t\t\t// 每次使用，都排到队头\r\n\tprivate cache: Map<number, object | number>;    // 已经缓冲的, 如果是数值，则是重复取的次数\r\n\tprivate waitingIds: number[] = [];          \t\t\t\t\t\t\t// 等待loading的\r\n\tprivate timeoutHandler: any;\r\n\r\n\tconstructor(uqMan: UqMan) {\r\n\t\tthis.uqMan = uqMan;\r\n\t\tthis.cache = uqMan.net.createObservableMap();\r\n\t}\r\n\r\n\tgetValue(id: number): object {\r\n\t\tlet ret = this.cache.get(id);\r\n\t\tif (ret === null) return;\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.useId(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (typeof ret === 'number') return;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected async TvIdValues(waitingIds: number[]) {\r\n\t\treturn await this.uqMan.IDTv(waitingIds);\r\n\t}\r\n\r\n\tprivate timeOut = async () => {\r\n\t\tlet waitingIds = this.waitingIds;\r\n\t\tthis.waitingIds = [];\r\n\t\tif (waitingIds.length === 0) return;\r\n\t\tlet values = await this.TvIdValues(waitingIds);\r\n\t\tfor (let val of values) {\r\n\t\t\tlet { id } = val;\r\n\t\t\tif (waitingIds[0] < 0) id = -id;\r\n\t\t\tthis.cache.set(id, val);\r\n\t\t\tlet index = waitingIds.findIndex(v => v === id);\r\n\t\t\tif (index >= 0) waitingIds.splice(index, 1);\r\n\t\t}\r\n\t\tfor (let id of waitingIds) {\r\n\t\t\tthis.cache.set(id, null);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate useId(id: number) {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id !== 'number') {\r\n\t\t\tconsole.error('id cache ' + id + ' is not number');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.cache.has(id) === true) {\r\n\t\t\tthis.moveToHead(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tclearTimeout(this.timeoutHandler);\r\n\t\tthis.timeoutHandler = setTimeout(this.timeOut, delayLoad);\r\n\t\t//this.cache.set(id, 0);\r\n\t\tif (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n\t\t\tthis.moveToHead(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.queue.length >= maxCacheSize) {\r\n\t\t\t// 缓冲已满，先去掉最不常用的\r\n\t\t\tlet r = this.queue.shift();\r\n\t\t\tif (r === id) {\r\n\t\t\t\t// 如果移除的，正好是现在用的，则插入\r\n\t\t\t\tthis.queue.push(r);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t//let rKey = String(r);\r\n\t\t\tif (this.cache.has(r) === true) {\r\n\t\t\t\t// 如果移除r已经缓存\r\n\t\t\t\tthis.cache.delete(r);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// 如果移除r还没有缓存\r\n\t\t\t\tlet index = this.waitingIds.findIndex(v => v === r);\r\n\t\t\t\tthis.waitingIds.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.waitingIds.push(id);\r\n\t\tthis.queue.push(id);\r\n\t\treturn;\r\n\t}\r\n\r\n\tprivate moveToHead(id: number) {\r\n\t\tlet index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.queue.push(id);\r\n\t}\r\n\r\n\tremove(id: number) {\r\n\t\tthis.cache.delete(id);\r\n\t\tlet index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\t//this.localArr.removeItem(id);\r\n\t}\r\n\r\n\tresetCache(id: number) {\r\n\t\tthis.remove(id);\r\n\t\tthis.useId(id);\r\n\t}\r\n}\r\n","import { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { Net, UqData } from '../net';\r\nimport { UqConfig, UqError } from '../tool';\r\n\r\nexport class UQsMan {\r\n\tprivate readonly net: Net;\r\n\tprivate collection: { [uqLower: string]: UqMan };\r\n\tproxy: any;\r\n\tuqMans: UqMan[] = [];\r\n\r\n\tconstructor(net: Net) {\r\n\t\tthis.net = net;\r\n\t\tthis.uqMans = [];\r\n\t\tthis.collection = {};\r\n\t}\r\n\r\n\tasync buildUqs(uqDataArr: UqData[], version: string, uqConfigs: UqConfig[], isBuildingUQ: boolean): Promise<string[]> {\r\n\t\tawait this.init(uqDataArr);\r\n\r\n\t\tlet localMap = this.net.localDb.createLocalMap('$app');\r\n\t\tlet localCacheVersion = localMap.child('version');\r\n\t\tlet cacheVersion = localCacheVersion.get();\r\n\t\tif (version !== cacheVersion) {\r\n\t\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t\tuqMan.localMap.removeAll();\r\n\t\t\t}\r\n\t\t\tlocalCacheVersion.set(version);\r\n\t\t}\r\n\r\n\t\tlet retErrors = await this.load();\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tif (isBuildingUQ === false) {\r\n\t\t\tthis.setTuidImportsLocal();\r\n\t\t}\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tif (uqConfigs) {\r\n\t\t\tfor (let uqConfig of uqConfigs) {\r\n\t\t\t\tlet { dev, name, alias } = uqConfig;\r\n\t\t\t\tlet { name: owner, alias: ownerAlias } = dev;\r\n\t\t\t\tlet uqLower = (ownerAlias ?? owner).toLowerCase() + '/' + (alias ?? name).toLowerCase();\r\n\t\t\t\tlet uq = this.collection[uqLower];\r\n\t\t\t\tuq.config = uqConfig;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.proxy = this.buildUQs();\r\n\t}\r\n\r\n\tuq(uqName: string): UqMan {\r\n\t\treturn this.collection[uqName.toLowerCase()];\r\n\t}\r\n\r\n\tasync getUqUserRoles(uqLower: string): Promise<string[]> {\r\n\t\tlet uqMan = this.collection[uqLower];\r\n\t\tif (uqMan === undefined) return null;\r\n\t\tlet roles = await uqMan.getRoles();\r\n\t\treturn roles;\r\n\t}\r\n\r\n\tasync init(uqsData: UqData[]): Promise<void> {\r\n\t\tlet promiseInits: PromiseLike<void>[] = [];\r\n\t\tfor (let uqData of uqsData) {\r\n\t\t\tlet { uqOwner, ownerAlias, uqName, uqAlias } = uqData;\r\n\r\n\t\t\t// 原名加入collection\r\n\t\t\tlet uqFullName = uqOwner + '/' + uqName;\r\n\t\t\tlet uqFull = this.collection[uqFullName];\r\n\t\t\tlet uq: UqMan;\r\n\t\t\tif (uqFull) {\r\n\t\t\t\tuq = uqFull;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tuq = new UqMan(this.net, uqData/*, undefined, this.tvs[uqFullName] || this.tvs[uqName]*/);\r\n\t\t\t\tthis.collection[uqFullName] = uq;\r\n\t\t\t\tpromiseInits.push(uq.init());\r\n\t\t\t}\r\n\t\t\tthis.uqMans.push(uq);\r\n\t\t\tlet lower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\r\n\t\t\t// 别名加入collection\r\n\t\t\tif (uqAlias) uqName = uqAlias;\r\n\t\t\tif (ownerAlias) uqOwner = ownerAlias;\r\n\t\t\tuqFullName = uqOwner + '/' + uqName;\r\n\t\t\tlower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\t\t}\r\n\t\tawait Promise.all(promiseInits);\r\n\t}\r\n\r\n\tasync load(): Promise<string[]> {\r\n\t\tlet retErrors: string[] = [];\r\n\t\tlet promises: PromiseLike<string>[] = [];\r\n\t\t//let lowerUqNames:string[] = [];\r\n\t\t// collection有小写名字，还有正常名字\r\n\t\t//for (let i in this.collection) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t//let lower = (i as string).toLowerCase();\r\n\t\t\t//if (lowerUqNames.indexOf(lower) >= 0) continue;\r\n\t\t\t//lowerUqNames.push(lower);\r\n\t\t\t//let uq = this.collection[i];\r\n\t\t\tpromises.push(uqMan.loadEntities());\r\n\t\t}\r\n\t\tlet results = await Promise.all(promises);\r\n\t\tfor (let result of results) {\r\n\t\t\tlet retError = result; // await cUq.loadSchema();\r\n\t\t\tif (retError !== undefined) {\r\n\t\t\t\tretErrors.push(retError);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n\r\n\tprivate buildUQs(): any {\r\n\t\tlet uqs: any = {};\r\n\t\tfunction setUq(uqKey: string, proxy: any): void {\r\n\t\t\tif (!uqKey) return;\r\n\t\t\tlet lower = uqKey.toLowerCase();\r\n\t\t\tuqs[uqKey] = proxy;\r\n\t\t\tif (lower !== uqKey) uqs[lower] = proxy;\r\n\t\t}\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tlet proxy = uqMan.createProxy();\r\n\t\t\tsetUq(uqMan.getUqKey(), proxy);\r\n\t\t\tsetUq(uqMan.getUqKeyWithConfig(), proxy);\r\n\t\t}\r\n\t\treturn new Proxy(uqs, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tthis.errUndefinedUq(String(key));\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tprivate errUndefinedUq(uq: string) {\r\n\t\tlet message = `UQ ${uq} not defined`;\r\n\t\tlet err = new Error(message);\r\n\t\terr.name = UqError.undefined_uq;\r\n\t\tthrow err;\r\n\t}\r\n\r\n\tgetUqMans() {\r\n\t\treturn this.uqMans;\r\n\t}\r\n\r\n\tsetTuidImportsLocal(): string[] {\r\n\t\tlet ret: string[] = [];\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tfor (let tuid of uqMan.tuidArr) {\r\n\t\t\t\tif (tuid.isImport === true) {\r\n\t\t\t\t\tlet error = this.setInner(tuid as TuidImport);\r\n\t\t\t\t\tif (error) ret.push(error);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate setInner(tuidImport: TuidImport): string {\r\n\t\tlet { from } = tuidImport;\r\n\t\tlet fromName = from.owner + '/' + from.uq;\r\n\t\tlet uq = this.collection[fromName];\r\n\t\tif (uq === undefined) {\r\n\t\t\t//debugger;\r\n\t\t\tif (this.net.props.buildingUq !== true) {\r\n\t\t\t\tconsole.error(`setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet iName = tuidImport.name\r\n\t\tlet tuid = uq.tuid(iName);\r\n\t\tif (tuid === undefined) {\r\n\t\t\t//debugger;\r\n\t\t\treturn `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n\t\t}\r\n\t\tif (tuid.isImport === true) {\r\n\t\t\t//debugger;\r\n\t\t\treturn `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n\t\t}\r\n\t\ttuidImport.setFrom(tuid as TuidInner);\r\n\t}\r\n}\r\n","import { UQsMan } from \"./uqsMan\";\r\nimport { UqData, CenterAppApi, Net } from '../net';\r\nimport { UqConfig } from \"tonwa-uq\";\r\n\r\nexport class UQsLoader {\r\n\tprotected readonly net: Net;\r\n\tprotected readonly uqConfigVersion: string;\r\n\tprotected readonly uqConfigs: UqConfig[];\r\n\tprotected isBuildingUQ: boolean = false;\r\n\tuqsMan: UQsMan;         // value\r\n\r\n\tconstructor(net: Net, uqConfigVersion: string, uqConfigs: UqConfig[]) {\r\n\t\tthis.net = net;\r\n\t\tthis.uqConfigVersion = uqConfigVersion;\r\n\t\tthis.uqConfigs = uqConfigs;\r\n\t}\r\n\r\n\tasync build() {\r\n\t\treturn await this.loadUqs();\r\n\t}\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tasync loadUqs(): Promise<string[]> {\r\n\t\tthis.uqsMan = new UQsMan(this.net);\r\n\t\tlet uqs = await this.loadUqData(this.uqConfigs);\r\n\t\treturn await this.uqsMan.buildUqs(uqs, this.uqConfigVersion, this.uqConfigs, this.isBuildingUQ);\r\n\t}\r\n\r\n\tprivate async loadUqData(uqConfigs: UqConfig[]): Promise<UqData[]> {\r\n\t\tlet uqs: { owner: string; ownerAlias: string; name: string; alias: string; version: string }[] = uqConfigs.map(\r\n\t\t\tv => {\r\n\t\t\t\tlet { dev, name, version, alias } = v;\r\n\t\t\t\tlet { name: owner, alias: ownerAlias } = dev;\r\n\t\t\t\treturn { owner, ownerAlias, name, version, alias };\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet centerAppApi = new CenterAppApi(this.net, 'tv/');\r\n\t\tlet ret: UqData[] = uqs.length === 0 ? [] : await centerAppApi.uqs(uqs);\r\n\t\tif (ret.length < uqs.length) {\r\n\t\t\tlet err = `下列UQ：\\n${uqs.map(v => `${v.owner}/${v.name}`).join('\\n')}之一不存在`;\r\n\t\t\tconsole.error(err);\r\n\t\t\tthrow Error(err);\r\n\t\t}\r\n\t\tfor (let i = 0; i < uqs.length; i++) {\r\n\t\t\tlet { ownerAlias, alias } = uqs[i];\r\n\t\t\tret[i].ownerAlias = ownerAlias;\r\n\t\t\tret[i].uqAlias = alias;\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nexport class UQsBuildingLoader extends UQsLoader {\r\n\tasync build() {\r\n\t\tthis.isBuildingUQ = true;\r\n\t\tlet retErrors = await this.loadUqs();\r\n\t\treturn retErrors;\r\n\t}\r\n}\r\n","export function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n","import { Uq } from \"tonwa-uq\";\r\n\r\nexport abstract class Model {\r\n    protected readonly uq: Uq;\r\n\r\n    constructor(uq: Uq) {\r\n        this.uq = uq;\r\n    }\r\n}\r\n","import { ID, IX, Uq } from \"tonwa-uq\";\r\nimport { Model } from \"./Model\";\r\n\r\nexport class MDraft extends Model {\r\n    protected readonly ID: ID;\r\n    protected readonly IX: IX;\r\n\r\n    constructor(uq: Uq, ID: ID, IX?: IX) {\r\n        super(uq);\r\n        this.ID = ID;\r\n        this.IX = IX;\r\n    }\r\n\r\n    async load<T>(id: number): Promise<T> {\r\n        let result = await Promise.all([\r\n            this.uq.ID({ IDX: this.ID, id }),\r\n            this.uq.IX({ IX: this.IX, IDX: [this.ID], ix: id })\r\n        ]);\r\n        let ret: any = {};\r\n        let main = result[0];\r\n        if (main.length > 0) {\r\n            let { content } = main[0];\r\n            ret.$ = JSON.parse(content);\r\n            //ret.$.$ID = ID;\r\n        }\r\n        for (let row of result[1]) {\r\n            let { entity, content } = row;\r\n            let IDRet = this.uq.IDEntity(entity);\r\n            if (IDRet === undefined) continue;\r\n            let IDname = IDRet.name;\r\n            let arr: any[] = ret[IDname];\r\n            if (arr === undefined) {\r\n                ret[IDname] = arr = [];\r\n            }\r\n            let obj = JSON.parse(content);\r\n            //obj.$ID = IDRet;\r\n            arr.push(obj);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    async saveMain(main: any, IdMain?: ID): Promise<number> {\r\n        let param: any = {};\r\n        let value = {\r\n            entity: IdMain !== undefined ? 0 : IdMain.typeId,\r\n            content: JSON.stringify(main),\r\n        }\r\n        let draftName = this.ID.name;\r\n        param[draftName] = [value];\r\n        let ret = await this.uq.Acts(param);\r\n        return ret[draftName][0];\r\n    }\r\n\r\n    async saveDetail(ix: number, details: object[], IdDetail?: ID): Promise<number[]> {\r\n        let entity = IdDetail !== undefined ? 0 : IdDetail.typeId;\r\n        let values = details.map(v => ({\r\n            ix,\r\n            xi: {\r\n                entity,\r\n                content: JSON.stringify(v),\r\n            }\r\n        }));\r\n        let ret = await this.uq.ActIX({\r\n            IX: this.IX,\r\n            ID: this.ID,\r\n            values,\r\n        });\r\n        return ret;\r\n    }\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n\ticon?: string;\r\n\troles?: {[uq:string]: string[]}\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","export enum UqError {\r\n    undefined_entity = 'UndefinedEntity',\r\n    undefined_uq = 'UndefinedUq'\r\n};\r\n","export abstract class LocalDb {\r\n    abstract getItem(key: string): string;\r\n    abstract setItem(key: string, value: string): void;\r\n    abstract removeItem(key: string): void;\r\n\r\n    createLocalMap(name: string): LocalMap {\r\n        return new LocalMap(this, name);\r\n    }\r\n}\r\n\r\nexport class LocalMapDb extends LocalDb {\r\n    private readonly map: Map<string, string>;\r\n    constructor() {\r\n        super();\r\n        this.map = new Map<string, string>();\r\n    }\r\n\r\n    getItem(key: string): string {\r\n        return this.map.get(key);\r\n    }\r\n    setItem(key: string, value: string) {\r\n        this.map.set(key, value);\r\n    }\r\n    removeItem(key: string) {\r\n        this.map.delete(key);\r\n    }\r\n}\r\n\r\n// const __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    readonly key: string | number;\r\n\r\n    constructor(local: Local, key: string | number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get(): any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value: any) {\r\n        let t = JSON.stringify(value, (key, value) => {\r\n            if (key !== '_tuid') return value;\r\n        });\r\n        this.local.setItem(this.key, t);\r\n    }\r\n    remove(local?: Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key: string | number): LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key: string | number): LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key: string | number): LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: { [key: string]: LocalCache };\r\n    private readonly locals: { [key: string]: Local };\r\n    protected readonly localDb: LocalDb;\r\n    protected readonly name: string;\r\n    constructor(localDb: LocalDb, name: string) {\r\n        this.localDb = localDb;\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key: string | number): string;\r\n    protected abstract keyForSet(key: string | number): string;\r\n    protected abstract keyForRemove(key: string | number): string;\r\n    abstract removeAll(): void;\r\n    getItem(key: string | number): string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return this.localDb.getItem(k);\r\n    }\r\n    setItem(key: string | number, value: string): void {\r\n        let k = this.keyForSet(key);\r\n        this.localDb.setItem(k, value);\r\n    }\r\n    removeItem(key: string | number): void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key: string | number): LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(this.localDb, k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key: string | number): LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(this.localDb, k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local: Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(this.localDb, k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key: string | number): LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] = ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(localDb: LocalDb, name: string) {\r\n        super(localDb, name);\r\n        let index = this.localDb.getItem(this.name);\r\n        this.index = index === null ? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        this.localDb.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key: number): string {\r\n        let i = this.index.indexOf(key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key: number): string {\r\n        let i = this.index.indexOf(key);\r\n        if (i < 0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key: number): string {\r\n        let i = this.index.indexOf(key);\r\n        if (i < 0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll(): void {\r\n        for (let i of this.index) {\r\n            this.localDb.removeItem(`${this.name}.${i}`);\r\n        }\r\n        this.localDb.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index: number): LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: { [key: string]: number };\r\n    private max: number;\r\n    constructor(localDb: LocalDb, name: string) {\r\n        super(localDb, name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = this.localDb.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p < 0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p + 1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i > this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls: string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        this.localDb.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key: number): string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key: number): string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key: string | number): string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll(): void {\r\n        for (let i in this.index) {\r\n            this.localDb.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        this.localDb.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key: string): LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","export function capitalCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\treturn parts.map(v => firstCharUppercase(v)).join('_');\r\n}\r\n\r\nexport function camelCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\tlet len = parts.length;\r\n\tparts[0] = firstCharLowercase(parts[0]);\r\n\tfor (let i=1; i<len; i++) {\r\n\t\tparts[1] = firstCharUppercase(parts[1]);\r\n\t}\r\n\treturn parts.join('_');\r\n}\r\n\r\nconst aCode = 'a'.charCodeAt(0);\r\nconst zCode = 'z'.charCodeAt(0);\r\nfunction firstCharUppercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= aCode && c <= zCode) {\r\n\t\treturn String.fromCharCode(c - 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\nconst ACode = 'A'.charCodeAt(0);\r\nconst ZCode = 'Z'.charCodeAt(0);\r\nfunction firstCharLowercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= ACode && c <= ZCode) {\r\n\t\treturn String.fromCharCode(c + 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\n","export function getObjPropIgnoreCase(obj:any, prop:string):any {\r\n\tif (!obj) return;\r\n\tif (!prop) return;\r\n\tlet keys = Object.keys(obj);\r\n\tprop = prop.toLowerCase();\r\n\tfor (let key of keys) {\r\n\t\tif (key.toLowerCase() === prop) return obj[key];\r\n\t}\r\n\treturn;\r\n}\r\n","import _ from 'lodash';\r\nimport { resLang, inputRes, InputRes } from 'tonwa-core';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy: string[], value: any): void;\r\n}\r\n\r\n//export type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value: any) => string[] | string;\r\n\r\nconst defaultInputRes: InputRes = resLang<InputRes>(inputRes);\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy: string[], value: any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }\r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: InputRes;\r\n    constructor(res?: InputRes) {\r\n        super();\r\n        this.res = res ?? defaultInputRes;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy: string[], value: any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: InputRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(this.res.min);\r\n        this.maxMsg = _.template(this.res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy: string[], value: any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy: string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({ min: this.min }));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({ max: this.max }));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy: string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem } from '../../schema';\r\nimport { ChangingHandler, ChangedHandler } from '../../../ui';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../../inputRules';\r\nimport { computed, makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps: FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n    protected defaultValue: any;\r\n    protected rules: Rule[];\r\n    protected readOnly: boolean;\r\n\r\n    disabled: boolean = false;\r\n    errors: string[] = [];\r\n    contextErrors: string[] = [];\r\n    get hasError(): boolean { return (this.errors.length + this.contextErrors.length) > 0 }\r\n    visible: boolean = null;\r\n    value: any = null;\r\n\r\n    constructor(context: Context, itemSchema: ItemSchema, fieldProps: FieldProps, children: React.ReactNode) {\r\n        makeObservable(this, {\r\n            errors: observable,\r\n            contextErrors: observable,\r\n            hasError: computed,\r\n            visible: observable,\r\n            value: observable,\r\n            disabled: observable,\r\n            isOk: computed,\r\n        });\r\n        this.context = context;\r\n        let { name } = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let { readOnly, disabled, visible } = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);\r\n        }\r\n        this.value = this.defaultValue = context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema { return this._itemSchema };\r\n    protected get ui(): UiItem { return this._ui };\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let { rules } = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy: string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    get isOk() {\r\n        return this.errors.length === 0;\r\n    }\r\n\r\n    setError(err: string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err: string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value: any): any { return value }\r\n\r\n    protected setElementValue(value: any) { }\r\n    protected setDataValue(value: any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value: any) {\r\n        if (this.isChanging === true) return;\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly(): boolean { return this.readOnly }\r\n    getDisabled(): boolean { return this.disabled }\r\n    getVisible(): boolean { return this.visible }\r\n    setReadOnly(value: boolean) { this.readOnly = value }\r\n    setDisabled(value: boolean) {\r\n        this.disabled = value;\r\n    }\r\n    setVisible(value: boolean) { this.visible = value }\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className(): string {\r\n        let fieldClass: string;\r\n        if (this.context.inNode === false && !(this._ui?.align)) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render(): JSX.Element;\r\n\r\n    protected renderBody(): JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let { discription, discriptionClassName } = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer((): JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let { form, inNode } = this.context;\r\n        if (inNode === true || this._ui?.align) return this.render();\r\n        let label: any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label(): string {\r\n        let label: any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet(): JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let { Templet } = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList: string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let { inNode } = this.context;\r\n        let tag = inNode === true ? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag,\r\n            {\r\n                key: err,\r\n                className: 'text-danger d-inline-block my-2 ms-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { UiTextItem, StringSchema, ItemSchema } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\nimport { Widget } from './widget';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    hasFocus: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\thasFocus: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {\r\n\t\tif (this.ui) {\r\n\t\t\tlet {placeholder} = this.ui;\r\n\t\t\tif (placeholder) return placeholder;\r\n\t\t\tlet {label} = this.ui;\r\n\t\t\tif (label) return label;\r\n\t\t}\r\n\t\treturn this.name\r\n\t}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.onInputChange(evt);\r\n\t\t\tthis.checkRules();\r\n\t\t\tthis.context.checkContextRules();\r\n\t\t\tthis.hasFocus = false;\r\n\t\t});\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.context.removeErrorWidget(this);\r\n\t\t\tthis.context.clearErrors();\r\n\t\t\tthis.hasFocus = true;\r\n\t\t});\r\n\t\tsetTimeout(() => {\r\n\t\t\tconsole.log('focus and select');\r\n\t\t\tthis.input.focus();\r\n\t\t\tthis.input.select();\r\n\t\t}, 10)\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n\t\tthis.onInputChange(evt);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={typeof this.placeholder === 'string'? this.placeholder : undefined}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { NumBaseSchema } from '../../schema';\r\nimport { RuleInt, RuleNum } from '../../inputRules';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n            new RuleInt(res, min, max) :\r\n            new RuleNum(res, min, max)\r\n        );\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n        switch (typeof value) {\r\n            default: return;\r\n            case 'undefined': return;\r\n            case 'number': return value;\r\n            case 'string':\r\n                if ((value as string).trim().length === 0) return;\r\n                return Number(value);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem { return this._ui as UiCheckItem };\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let { trueValue, falseValue } = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value: any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value: boolean) { this.input.readOnly = this.readOnly = value }\r\n    setDisabled(value: boolean) { this.input.disabled = this.disabled = value }\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true ? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let { align } = this._ui as UiCheckItem;\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input) => this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue}\r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true || align) {\r\n            let cnAlign: string;\r\n            if (!align) {\r\n                cnAlign = '';\r\n            }\r\n            else {\r\n                cnAlign = ` justify-content-${align} mb-3 `;\r\n            }\r\n            return <label className={cn + cnAlign}>\r\n                {input} {(this.ui && this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn + ' h-100'}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-start ms-2\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiSelect } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    readOnly: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\treadOnly: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { runInAction } from 'mobx';\r\n\r\nconst none = <small className=\"text-muted\">[无]</small>;\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem { return this._ui as UiIdItem };\r\n\r\n    setReadOnly(value: boolean) { this.readOnly = value }\r\n    setDisabled(value: boolean) { this.disabled = value }\r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n        let id = await pickId(this.context, this.name, this.value);\r\n        runInAction(() => {\r\n            this.setDataValue(id);\r\n            this.clearError();\r\n            this.clearContextError();\r\n            this.checkRules();\r\n        });\r\n    }\r\n\r\n    setValue(value: any) {\r\n        super.setValue(value);\r\n    }\r\n\r\n    render() {\r\n        let placeholder: string | JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn: any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || none;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = none; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\nimport { runInAction } from 'mobx';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t})\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n\t\t\tawait this.context.submit(name);\r\n\t\t\treturn;\r\n        }\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n\t\trunInAction(() => {\r\n\t\t\tthis.context.setError(name, ret);\r\n\t\t});\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string|JSX.Element;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = (type==='submit' && hasError) || this.disabled;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed, makeObservable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\n\r\nexport abstract class Context {\r\n    private subContexts:{[name:string]:{[rowKey:string]:Context}};\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\r\n    readonly widgets: {[name:string]: Widget} = {};\r\n    readonly rules: ContextRule[];\r\n\treadonly isRow: boolean;\r\n\t\r\n    errors: string[] = [];\r\n    errorWidgets:Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\terrorWidgets: observable,\r\n\t\t\thasError: computed,\r\n\t\t});\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let {rules} = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data():any;\r\n    abstract getItemSchema(itemName:string):ItemSchema;\r\n    abstract getUiItem(itemName:string):UiItem;\r\n    get arrName():string {return undefined}\r\n    getValue(itemName:string):any {return this.initData[itemName]}\r\n    setValue(itemName:string, value:any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let {onButtonClick} = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName:string, error:string) {\r\n\t\trunInAction(() => {\r\n\t\t\tlet widget = this.widgets[itemName];\r\n\t\t\tif (widget === undefined) return;\r\n\t\t\twidget.setContextError(error);\r\n\t\t\tthis.addErrorWidget(widget);\t\r\n\t\t})\r\n    }\r\n\r\n    clearContextErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearContextError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError():boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    get hasError():boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.errors.splice(0);\r\n\t\t\tthis.errorWidgets.splice(0);\r\n\t\t\tthis.clearContextErrors();\t\r\n\t\t});\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let {errors} = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ms-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed:number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n\treadonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\t\r\n    constructor(parentContext:Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr:UiArr;\r\n        let {uiSchema} = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let {items} = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let {items} = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName():string {return this.arrSchema.name}\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData():any {return this.parentContext.data;}\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form:Form, inNode:boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data():any {return this.form.data}\r\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        let {uiSchema} = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let {items} = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n\tlet ui = parentContext.getUiItem(name) as UiArr;\r\n\tlet {onDeleted, onRestored} = ui;\r\n    let arrLabel:string|JSX.Element = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n\t\t\t\t\t\tif ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n\t\t\t\t\t\tif (onRestored) onRestored(row);\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n\t\t\t\t\t\tif (p>=0) data.splice(p, 1);\r\n\t\t\t\t\t\tif (onDeleted) onDeleted(row);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { tonwa } from \"tonwa-core\";\r\n//import { nav } from '../nav';\r\n\r\nexport interface ImageProps {\r\n\tsrc: string;\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n\taltImage?: string;\r\n}\r\n\r\n// src = .src, 表示fontawesome Icon\r\nexport function Image(props: ImageProps) {\r\n\tlet { className, style, src, altImage } = props;\r\n\tlet icon: string;\r\n\tif (src) {\r\n\t\tif (src.indexOf('.') !== 0) {\r\n\t\t\tif (src.startsWith(':') === true) {\r\n\t\t\t\tsrc = tonwa.resUrl + src.substr(1);\r\n\t\t\t}\r\n\t\t\treturn <img src={src} className={className} alt=\"img\"\r\n\t\t\t\tstyle={style}\r\n\t\t\t\tonError={evt => {\r\n\t\t\t\t\tif (altImage) evt.currentTarget.src = altImage;\r\n\t\t\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t\t\t}} />;\r\n\t\t}\r\n\t\ticon = src.substr(1);\r\n\t}\r\n\telse {\r\n\t\ticon = 'file-o'\r\n\t}\r\n\treturn <span className={classNames(className, 'image-none')} style={style}>\r\n\t\t<i className={'fa fa-' + icon} />\r\n\t</span>;\r\n}\r\n","export function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n\tstyle?: React.CSSProperties,\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, style, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)}\r\n\t\t\tstyle={style}\r\n\t\t\tonClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string | JSX.Element;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\n//import { nav } from '../nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { LMR } from './simple';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n    fileName: string = null;\r\n\r\n    constructor(props: ResUploaderProps) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            fileName: observable,\r\n        });\r\n    }\r\n\r\n    buildFormData(): FormData {\r\n        let { maxSize } = this.props;\r\n        if (maxSize === undefined || maxSize <= 0)\r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files: FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i = 0; i < len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n        return data;\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData): Promise<string | { error: any }> => {\r\n        let resUrl = tonwa.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return { error: err };\r\n        }\r\n        finally {\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let { onFilesChange } = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names: string[] = [];\r\n        for (let i = 0; i < len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let { className, multiple, label } = this.props;\r\n        return <div>\r\n            <label className=\"btn btn-outline-success\">\r\n                {label || '选择文件'}\r\n                <input\r\n                    className={className}\r\n                    ref={t => this.fileInput = t}\r\n                    onChange={this.onFilesChange}\r\n                    type='file' name='file'\r\n                    multiple={multiple} style={{ display: 'none' }} />\r\n            </label>\r\n            &nbsp;\r\n            {this.fileName}\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size: number, pointLength: number = 2, units?: string[]) {\r\n    var unit;\r\n    units = units || ['B', 'K', 'M', 'G', 'TB'];\r\n    while ((unit = units.shift()) && size > 1024) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed(pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw';\r\n    onSaved?: (imageId: string) => Promise<void>;\r\n    imageTypes?: string[];\r\n}\r\n\r\nconst xlargeSize = 1600;\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n    private static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\r\n    private imgBaseSize: number;\r\n    private imageTypes: string[];\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n\r\n    file: File = null;\r\n    desImgWidth: number = null;\r\n    desImgHeight: number = null;\r\n    desImgSize: number = null;\r\n    srcImgWidth: number = null;\r\n    srcImgHeight: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    srcImage: string = null;\r\n    desImage: string = null;\r\n    fileError: string = null;\r\n    uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            file: observable,\r\n            desImgWidth: observable,\r\n            desImgHeight: observable,\r\n            desImgSize: observable,\r\n            srcImgWidth: observable,\r\n            srcImgHeight: observable,\r\n            isChanged: observable,\r\n            resId: observable,\r\n            enableUploadButton: observable,\r\n            srcImage: observable,\r\n            desImage: observable,\r\n            fileError: observable,\r\n            uploaded: observable,\r\n        });\r\n        this.resId = props.id;\r\n        this.imageTypes = props.imageTypes || ImageUploader.imageTypes;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos + 1).toLowerCase();\r\n            if (this.imageTypes.indexOf(this.suffix) < 0) {\r\n                this.fileError = `图片类型必须是 ${this.imageTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n                this.srcImage = reader.result as string;\r\n                switch (this.suffix) {\r\n                    default:\r\n                        await this.setSize(this.props.size);\r\n                        break;\r\n                    case 'svg':\r\n                        this.imgBaseSize = mediumSize;\r\n                        this.desImgSize = this.srcImage.length;\r\n                        this.desImage = this.srcImage;\r\n                        break;\r\n                }\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n                this.imgBaseSize = largeSize; break;\r\n            case 'xl':\r\n                this.imgBaseSize = xlargeSize; break;\r\n            case 'raw':\r\n                this.imgBaseSize = -1; break;\r\n        }\r\n        this.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = (): Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // 默认按比例压缩\r\n                let { width, height } = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n                let w: number, h: number;\r\n                if (this.imgBaseSize < 0) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 默认图片质量为0.7\r\n                //生成canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // 创建属性节点\r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix, quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 3 * 1024 * 1024) {\r\n                    this.fileError = \"图片大于3M，无法上传\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string): Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let { error } = ret;\r\n            let type = typeof error;\r\n            let err: string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let { onSaved } = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        tonwa.nav.push(<Page header=\"原图\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{ maxWidth: '100%' }} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{ caption: '小图', size: 'sm' }];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({ caption: '中图', size: 'md' });\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({ caption: '大图', size: 'lg' });\r\n        }\r\n        if (this.srcImgHeight > xlargeSize || this.srcImgWidth > xlargeSize) {\r\n            arr.push({ caption: '超大图', size: 'xl' });\r\n            arr.push({ caption: '原图', size: 'raw' });\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let { caption, size } = v;\r\n            return <label key={index} className=\"me-3\"><input type=\"radio\" name=\"size\"\r\n                onChange={() => this.setSize(size as any)}\r\n                defaultChecked={index === 0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let { label } = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改图片'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v => this.resUploader = v}\r\n                            multiple={false} maxSize={2048}\r\n                            label=\"选择图片文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {this.imageTypes.join(', ')} 格式图片。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                        {\r\n                            this.uploaded === true ?\r\n                                <div className=\"text-success p-2\">上传成功！</div>\r\n                                :\r\n                                this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                    <div className=\"me-5\">\r\n                                        {this.levelDiv()}\r\n                                        <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\r\n                                            &nbsp; &nbsp;\r\n                                            文件大小：{formatSize(this.desImgSize)}\r\n                                        </div>\r\n                                    </div>\r\n                                    <button className=\"btn btn-primary\"\r\n                                        disabled={!this.enableUploadButton}\r\n                                        onClick={this.upload}>上传</button>\r\n                                </div>\r\n                        }\r\n                        right={this.desImage &&\r\n                            <button className=\"btn btn-link btn-sm text-right mb-3\" onClick={this.showOrgImage}>\r\n                                原图大小: {formatSize(this.file.size)}<br />\r\n                                分辨率：{this.srcImgWidth} x {this.srcImgHeight}\r\n                            </button>\r\n                        }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\"\r\n                    style={{\r\n                        border: (this.uploaded === true ? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{ maxWidth: '100%' }} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId: string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n    private static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n\r\n    content: string = null;\r\n    file: File = null;\r\n    fileSize: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    fileError: string = null;\r\n    uploaded: boolean = false;\r\n    uploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            content: observable,\r\n            file: observable,\r\n            fileSize: observable,\r\n\r\n            isChanged: observable,\r\n            resId: observable,\r\n            enableUploadButton: observable,\r\n            fileError: observable,\r\n            uploaded: observable,\r\n            uploading: observable,\r\n        });\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos + 1).toLowerCase();\r\n            if (AudioUploader.audioTypes.indexOf(this.suffix) < 0) {\r\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n                this.content = reader.result as string;\r\n                this.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string): Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        this.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let { error } = ret;\r\n            let type = typeof error;\r\n            let err: string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let { onSaved } = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let { label } = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改文件'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v => this.resUploader = v}\r\n                            multiple={false} maxSize={2048}\r\n                            label=\"选择音频文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <LMR left=\r\n                {\r\n                    this.uploaded === true ?\r\n                        <div className=\"text-success p-2\">上传成功！</div>\r\n                        :\r\n                        this.uploading === true ?\r\n                            <div className=\"m-3\"><Loading /></div>\r\n                            :\r\n                            this.file && this.content && <div className=\"m-3\">\r\n                                <div className=\"mb-3\">\r\n                                    文件大小：{formatSize(this.fileSize)}\r\n                                </div>\r\n                                <button className=\"btn btn-primary\"\r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}>上传</button>\r\n                            </div>\r\n                }\r\n            />\r\n        </Page>;\r\n    }\r\n}\r\n","import { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Image } from '../image';\r\nimport { Edit } from './edit';\r\nimport { FieldRule } from '../inputRules';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nexport abstract class ItemEdit {\r\n    protected edit: Edit;\r\n    protected name: string;\r\n    protected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema { return this._itemSchema }\r\n    protected _uiItem: UiItem;\r\n    get uiItem(): UiItem { return this._uiItem }\r\n    value: any;\r\n    label: string | JSX.Element;\r\n    get editInRow(): boolean { return false; }\r\n    protected newValue: any;\r\n\r\n    error: string = null;\r\n    isChanged: boolean = false;\r\n\r\n    constructor(edit: Edit, itemSchema: ItemSchema, uiItem: UiItem, label: string | JSX.Element, value: any) {\r\n        makeObservable(this, {\r\n            error: observable,\r\n            isChanged: observable,\r\n        });\r\n        this.edit = edit;\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let { name } = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n    }\r\n\r\n    init() {\r\n    }\r\n\r\n    async start(): Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart(): Promise<any>;\r\n\r\n    async end(): Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n    renderContent() {\r\n        let { name, type } = this._itemSchema;\r\n        let divValue: any;\r\n        let uiItem = this._uiItem;\r\n        let label: string | JSX.Element, labelHide: boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n            label = uiItem.label;\r\n            labelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n                    if (this.value !== undefined) divValue = templet(this.value);\r\n                }\r\n                else {\r\n                    divValue = { templet };\r\n                }\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let { list } = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value ?\r\n                        <b>{this.value}</b>\r\n                        :\r\n                        <small className=\"text-muted\">[{labelHide === true ? label : '无'}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n        }\r\n        return divValue;\r\n    }\r\n\r\n    protected async internalEnd(): Promise<void> { tonwa.nav.pop(1) }\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let { rules } = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule: FieldRule, value: any): string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { ItemSchema, UiImageItem, UiItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\n//import { nav } from '../../nav';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { Edit } from './edit';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem { return this._uiItem as UiImageItem }\r\n    resId: string = null;\r\n\r\n    constructor(edit: Edit, itemSchema: ItemSchema, uiItem: UiItem, label: string | JSX.Element, value: any) {\r\n        super(edit, itemSchema, uiItem, label, value);\r\n        makeObservable(this, {\r\n            resId: observable\r\n        })\r\n    }\r\n\r\n    protected async internalStart(): Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            tonwa.nav.push(React.createElement(this.page, { resolve: resolve, reject: reject }), () => reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let size: any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}>保存</button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader\r\n            label={'更改' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId): Promise<void> => { resolve(resId); return; }} />;\r\n        /*\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div>上传图片：</div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c me-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\">图片预览</div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n\r\n\timageSrc: string = null;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\timageSrc: observable,\r\n\t\t})\r\n\t}\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(undefined, this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import { Widget } from './widget';\r\nimport { UiPick } from '../../schema';\r\nimport { runInAction } from 'mobx';\r\n\r\nexport class PickWidget extends Widget {\r\n    protected get ui(): UiPick { return this._ui as UiPick };\r\n\r\n    setReadOnly(value: boolean) { this.readOnly = value }\r\n    setDisabled(value: boolean) { this.disabled = value }\r\n\r\n    protected onClick = async () => {\r\n        let pick = this.ui?.pick;\r\n        if (pick === undefined) {\r\n            alert('no pick defined!');\r\n            return;\r\n        }\r\n        let id = await pick.pick();\r\n        runInAction(() => {\r\n            this.setDataValue(id);\r\n            this.clearError();\r\n            this.clearContextError();\r\n            this.checkRules();\r\n        });\r\n    }\r\n\r\n    setValue(value: any) {\r\n        super.setValue(value);\r\n    }\r\n\r\n    render() {\r\n        let pick = this.ui?.pick;\r\n        if (pick === undefined) {\r\n            return <span>no pick defined!</span>;\r\n        }\r\n        return <div className={this.className + ' cursor-pointer '} onClick={this.onClick}>{pick.ref()}</div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\nimport { PickWidget } from './pickWidget';\r\n\r\ninterface WidgetFactory {\r\n    widget?: TypeWidget;\r\n    dataTypes?: DataType[];\r\n};\r\n\r\nconst stringWidget: WidgetFactory = {\r\n    dataTypes: ['integer', 'number', 'string'],\r\n    widget: TextWidget\r\n};\r\n\r\nconst widgetFactories: { [type: string]: WidgetFactory } = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    pick: {\r\n        dataTypes: ['id'],\r\n        widget: PickWidget,\r\n    },\r\n    text: stringWidget,\r\n    string: stringWidget,\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n    },\r\n    tagSingle: {\r\n        dataTypes: ['integer'],\r\n        widget: TagSingleWidget\r\n    },\r\n    tagMulti: {\r\n        dataTypes: ['string'],\r\n        widget: TagMultiWidget\r\n    },\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children: React.ReactNode, fieldProps?: FieldProps): JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let { name, type } = itemSchema;\r\n    switch (type) {\r\n        case 'arr':\r\n            let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n            return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n        default:\r\n            break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\r\n    function getTypeWidget(t: DataType): TypeWidget {\r\n        switch (t) {\r\n            default: return TextWidget;\r\n            case 'id': return IdWidget;\r\n            case 'integer': return UpdownWidget;\r\n            case 'number': return NumberWidget;\r\n            case 'string': return TextWidget;\r\n            case 'date': return DateWidget;\r\n            case 'boolean': return CheckBoxWidget;\r\n            case 'button':\r\n            case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) {\r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let { widget: widgetType, hiden } = ui;\r\n        if (hiden === true) return null;\r\n        switch (widgetType) {\r\n            default:\r\n                if (widgetType !== undefined) {\r\n                    let widgetFactory = widgetFactories[widgetType];\r\n                    if (!widgetFactory) {\r\n                        debugger;\r\n                        throw new Error(`unknown widget ${widgetType}`);\r\n                    }\r\n                    typeWidget = widgetFactory.widget;\r\n                }\r\n                if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n                break;\r\n            case 'custom':\r\n                typeWidget = (ui as UiCustom).WidgetClass;\r\n                break;\r\n            case 'group':\r\n                return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n\r\n    let { widgets } = context;\r\n    let widget = widgets[name];\r\n    if (!widget) {\r\n        widget = new typeWidget(context, itemSchema, fieldProps, children);\r\n        widget.init();\r\n        widgets[name] = widget;\r\n    }\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { observable, IReactionDisposer, autorun } from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { InputRes, inputRes, resLang } from 'tonwa-core';\r\nimport { Schema, ItemSchema, ArrSchema, UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\n\r\nexport type FormButtonClick = (name: string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name: string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n    fieldLabelAlign?: 'left' | 'center' | 'right';\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext: FormContext) => void;\r\n    res?: InputRes;\r\n\r\n    Container?: (content: JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label: string | JSX.Element, content: JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: { [name: string]: ItemSchema };\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: InputRes;\r\n    formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data: any;\r\n\r\n    readonly Container: (content: JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label: any, content: JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n\r\n    constructor(props: FormProps) {\r\n        super(props);\r\n        let { schema, uiSchema,\r\n            Container, FieldContainer, FieldClass,\r\n            ButtonClass, res,\r\n        } = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass !== undefined && FieldClass !== '' && FieldClass !== null ? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent(): any {\r\n        this.initData(this.props.formData);\r\n        let { children } = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof (Templet) === 'function' ? Templet(this.data) : Templet;\r\n        }\r\n\r\n        if (!this.formContext) {\r\n            this.formContext = new FormContext(this, false);\r\n        }\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let { items } = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data: any, formData: any): any {\r\n        let { name, type } = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem: ArrSchema = itemSchema as ArrSchema;\r\n        let { arr: arrItems } = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict: any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val: any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr: any[] = [];\r\n        for (let row of val) {\r\n            let { $isSelected, $isDeleted } = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let { formData } = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let { name, type } = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let { arr: arrItems } = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let { $source } = row;\r\n            if ($source === undefined) continue;\r\n            let { $isSelected, $isDeleted } = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let { beforeShow } = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            {React.createElement(this.formContext.renderErrors)}\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName: string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let { onButtonClick } = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content: JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e => e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label: string | JSX.Element, content: JSX.Element): JSX.Element => {\r\n        let { fieldLabelSize, fieldLabelAlign } = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView: any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n                let cnAlign: string;\r\n                switch (fieldLabelAlign) {\r\n                    case 'right': cnAlign = 'text-sm-right'; break;\r\n                    case 'center': cnAlign = 'text-sm-center'; break;\r\n                }\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label', cnAlign)}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"mb-3 row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"mb-3\">\r\n            {label === null ? null : <label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass: string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes: InputRes = resLang<InputRes>(inputRes);\r\n\r\n    ArrContainer = (label: any, content: JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content: JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nexport interface InputOptions {\r\n    type: string;\r\n    min?: number;\r\n    max?: number;\r\n    step?: number;\r\n}\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem { return this._uiItem as UiTextItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve, reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    protected inputOptions(): InputOptions {\r\n        return {\r\n            type: 'text',\r\n        }\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let onSave = () => {\r\n            this.verifyValue();\r\n            if (!this.error) {\r\n                let val = this.newValue;\r\n                resolve(val);\r\n            }\r\n        }\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n            if (evt.keyCode === 13) onSave();\r\n        }\r\n        let { type, max, min, step } = this.inputOptions();\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <input type={type}\r\n                    onChange={this.onChange}\r\n                    onKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\"\r\n                    defaultValue={this.value} min={min} max={max} step={step} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio { return this._uiItem as UiRadio }\r\n\r\n    init() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem === undefined ? undefined : this._uiItem.defaultValue;\r\n        }\r\n    }\r\n\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve: resolve, reject: reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let { name } = this.itemSchema;\r\n        let { list } = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={() => {\r\n                this.verifyValue();\r\n                if (!this.error) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        let content = list ?\r\n            list.map((v, index: number) => {\r\n                let { title, value } = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value}\r\n                        onClick={() => this.onChange(value)}\r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect { return this._uiItem as UiSelect }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve: resolve, reject: reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let { list } = this.uiItem;\r\n        let content = list ?\r\n            list.map((v, index: number) => {\r\n                let { title, value } = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={() => { this.onChange(value); resolve(this.newValue) }}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem { return this._uiItem as UiIdItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let { pickId } = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd(): Promise<void> { }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'更改' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: { [index: number]: HTMLInputElement } = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n\tget uiItem(): UiTag { return this._uiItem as UiTag };\r\n\r\n\tinit() {\r\n\t\tif (this.value === undefined) {\r\n\t\t\tthis.value = this._uiItem === undefined ? undefined : this._uiItem.defaultValue;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected async internalStart(): Promise<any> {\r\n\t\treturn new Promise<any>((resolve, reject) => {\r\n\t\t\tlet element = React.createElement(this.page, { resolve: resolve, reject: reject });\r\n\t\t\ttonwa.nav.push(element, reject);\r\n\t\t});\r\n\t}\r\n\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs(): JSX.Element;\r\n\tprivate page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n\t\tlet { resolve } = props;\r\n\t\tlet right = <button\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center me-2\"\r\n\t\t\tdisabled={!this.isChanged}\r\n\t\t\tonClick={() => {\r\n\t\t\t\tthis.verifyValue();\r\n\t\t\t\tif (!this.error) resolve(this.newValue);\r\n\t\t\t}}>保存</button>;\r\n\t\t/*\r\n\t\tlet content = list?\r\n\t\t\tlist.map((v, index:number) => {\r\n\t\t\t\tlet {name:itemName, id} = v;\r\n\t\t\t\treturn <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n\t\t\t\t\t<input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n\t\t\t\t\t\tdefaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n\t\t\t\t</label></div>;\r\n\t\t\t})\r\n\t\t\t:\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n\t\treturn <Page header={'更改' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n\t\t</Page>;\r\n\t})\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType: 'radio' | 'checkbox' = 'radio';\r\n\tprotected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet { currentTarget } = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n\t\tthis.newValue = Number(currentTarget.value);\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\r\n\tprotected renderInputs(): JSX.Element {\r\n\t\tlet { valuesView } = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType: 'radio' | 'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values: string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n\t\tthis.newValue = values.join('|');\r\n\t\t//this.newValue = value;\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs(): JSX.Element {\r\n\t\tlet { valuesView } = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nexport class TextAreaItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem { return this._uiItem as UiTextItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve, reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let onSave = () => {\r\n            this.verifyValue();\r\n            if (!this.error) {\r\n                let val = this.newValue;\r\n                resolve(val);\r\n            }\r\n        }\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n            // if (evt.keyCode === 13) onSave();\r\n        }\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <textarea\r\n                    onChange={this.onChange}\r\n                    onKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\"\r\n                    defaultValue={this.value}\r\n                    rows={6} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import { UiCheckItem } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class CheckBoxItemEdit extends ItemEdit {\r\n\tprivate input: HTMLInputElement;\r\n    get uiItem(): UiCheckItem {return this._uiItem as UiCheckItem}\r\n\tget editInRow(): boolean {return true;}\r\n    protected async internalStart():Promise<any> {\r\n\t\tif (!this.input) return;\r\n\t\tlet uiItem = this.uiItem;\r\n\t\tif (uiItem === undefined) return this.input.checked;\r\n\t\tlet {checked} = this.input;\r\n\t\treturn this.getValue(checked);\r\n    }\r\n\tasync end():Promise<any> {}\r\n\trenderContent() {\r\n\t\tlet {readOnly} = this.uiItem;\r\n\t\tlet disabled = readOnly === true;\r\n\t\tlet onChange:any;\r\n\t\tif (readOnly !== true) onChange = this.onChange;\r\n\t\treturn <input ref={r => this.input=r} type=\"checkbox\" \r\n\t\t\tdefaultChecked={this.value} disabled={disabled}\r\n\t\t\tonChange={onChange} />\r\n\t}\r\n\r\n\tprivate getValue(checked: boolean) {\r\n\t\tlet {trueValue, falseValue} = this.uiItem;\r\n        return checked === true? (trueValue??true) : (falseValue??false);\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = this.getValue(evt.target.checked);\r\n        let preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t\tthis.edit.onItemChanged(this, this.newValue);\r\n    }\r\n}\r\n","import { UiRange } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class RangeItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiRange).min\r\n\t\t\tmax = (this._uiItem as UiRange).max\r\n\t\t\tstep = (this._uiItem as UiRange).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'range',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import { UiNumberItem } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class NumberItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiNumberItem).min\r\n\t\t\tmax = (this._uiItem as UiNumberItem).max\r\n\t\t\tstep = (this._uiItem as UiNumberItem).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'number',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\nimport { TextAreaItemEdit } from './textAreaItemEdit';\r\nimport { CheckBoxItemEdit } from './checkBoxItemEdit';\r\nimport { RangeItemEdit } from './rangeItemEdit';\r\nimport { NumberItemEdit } from './numberItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue:any, preValue:any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder:JSX.Element;\r\n    private bottomBorder:JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep:JSX.Element;\r\n\tprivate uiSchema: {[name:string]: UiItem};\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let {topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema} = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        //if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n\t\tthis.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let {schema} = this.props;\r\n\t\tlet sep:any;\r\n        return <div>\r\n\t\t\t{this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n\t\t\t\tlet {stopEdit} = this.props;\r\n\t\t\t\tlet {name} = itemSchema;\r\n\t\t\t\tlet uiItem = this.uiSchema===undefined? undefined : this.uiSchema[name];\r\n\t\t\t\tlet label:string|JSX.Element, labelHide:any;\r\n\t\t\t\tif (uiItem !== undefined) {\r\n\t\t\t\t\tlabel = uiItem.label || name;\r\n\t\t\t\t\tlabelHide = uiItem.labelHide;\r\n\t\t\t\t};\r\n\t\t\t\tlet value = this.props.data[name];\r\n\t\t\t\tlet itemEdit = createItemEdit(this, itemSchema, uiItem, label, value);\r\n\t\t\t\tlet rowContainerClassName = this.rowContainerClassName;\r\n\t\t\t\tlet {editInRow} = itemEdit;\r\n\t\t\t\tif (editInRow === false) {\r\n\t\t\t\t\tif (stopEdit !== true) editInRow = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (editInRow === false) rowContainerClassName += ' cursor-pointer';\r\n\r\n\t\t\t\tlet {required} = itemSchema;\r\n\t\t\t\tlet requireFlag = required===true && <span className=\"text-danger\">*</span>;\r\n\t\t\t\tlet divLabel:any, cn:string = 'flex-fill d-flex ';\r\n\t\t\t\tif (labelHide === true) {\r\n\t\t\t\t\tdivLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdivLabel = <div>{label} {requireFlag}</div>;\r\n\t\t\t\t\tcn += 'justify-content-end';\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = <React.Fragment key={index}>\r\n\t\t\t\t\t{sep}\r\n\t\t\t\t\t<div className={'d-flex align-items-center' + rowContainerClassName} \r\n\t\t\t\t\t\tonClick={async ()=>await this.rowClick(itemEdit)}>\r\n\t\t\t\t\t\t{divLabel}\r\n\t\t\t\t\t\t<div className={cn}>{\r\n\t\t\t\t\t\t\titemEdit===undefined? undefined: itemEdit.renderContent()\r\n\t\t\t\t\t\t}</div>\r\n\t\t\t\t\t\t{editInRow === false && <div className=\"w-2c text-right\"><i className=\"fa fa-angle-right\" /></div>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>;\r\n\t\t\t\tsep = this.sep;\r\n\t\t\t\treturn ret;\r\n\t\t\t})}\r\n\t\t\t{this.bottomBorder}\r\n\t\t</div>;\r\n    }\r\n\r\n\tasync onItemChanged(itemEdit:ItemEdit, newValue:any) {\r\n\t\tlet {itemSchema, uiItem, value} = itemEdit;\r\n\t\tthis.props.data[itemSchema.name] = newValue;\r\n        let {onItemChanged, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n\t\tif (onItemChanged === undefined) {\r\n\t\t\talert(`${itemSchema.name} value changed, new: ${newValue}, pre: ${value}`);\r\n\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n\t\t\t//this.props.data[itemSchema.name] = changeValue;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait onItemChanged(itemSchema, newValue, value);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rowClick = async (itemEdit:ItemEdit) => {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\talert('item has no edit');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {itemSchema, uiItem, value, editInRow} = itemEdit;\r\n\t\tif (editInRow === true) return;\r\n        let {onItemChanged, onItemClick, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n        let changeValue:any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以移到这里来\r\n\t\t\t\tthis.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n\t\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // 如果直接back，会触发reject，就到这里了\r\n\t\t\tconsole.log('no value changed');\r\n\t\t\tconsole.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any):ItemEdit {\r\n\tlet ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n\t\t\tcase 'text': itemEdit = StringItemEdit; break;\r\n\t\t\tcase 'textarea': itemEdit = TextAreaItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\tcase 'select': itemEdit = SelectItemEdit; break;\r\n\t\t\tcase 'range': itemEdit = RangeItemEdit; break;\r\n\t\t\tcase 'number':\r\n\t\t\tcase 'updown': itemEdit = NumberItemEdit; break;\r\n\t\t\tcase 'checkbox': itemEdit = CheckBoxItemEdit; break;\r\n            case 'radio': \r\n\t\t\t\tie = new RadioItemEdit(edit, itemSchema, uiItem as UiRadio, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagSingle':\r\n\t\t\t\tie = new TagSingleItemEdit(edit, itemSchema, uiItem as UiTagSingle, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagMulti':\r\n\t\t\t\tie = new TagMultiItemEdit(edit, itemSchema, uiItem as UiTagMulti, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t}\r\n\tif (ie === undefined) {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\tswitch (itemSchema.type) {\r\n\t\t\t\tcase 'string': itemEdit = StringItemEdit; break;\r\n\t\t\t\tcase 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\t\tcase 'boolean': itemEdit = CheckBoxItemEdit; break;\r\n\t\t\t\tcase 'number':\r\n\t\t\t\tcase 'integer': itemEdit = RangeItemEdit; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemEdit === undefined) return;\r\n\t\tie = new itemEdit(edit, itemSchema, uiItem, label, value);\r\n\t}\r\n\tie.init();\r\n\treturn ie;\r\n}\r\n","import { IObservableArray, computed, makeObservable } from 'mobx';\r\nimport { IPageItems } from '../../tool/IPageItems';\r\nimport { List } from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n\t\tmakeObservable(this, {\r\n\t\t\tloading: computed,\r\n\t\t});\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as IPageItems<any>).items;\r\n    }\r\n    get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as IPageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import classNames from 'classnames';\r\nimport { uid } from 'tonwa-uq';\r\nimport { ListBase } from './base';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item: any, index: number): JSX.Element => {\r\n        let { className, key } = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key === undefined ? index : key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable, IObservableArray, isObservableArray, observe, makeObservable } from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { uid } from 'tonwa-uq';\r\nimport { ListBase } from './base';\r\nimport { List } from './index';\r\nimport { IPageItems } from '../../tool';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    _items: SelectableItem[] = null;\r\n    private inputItems: { [uid: string]: HTMLInputElement } = {};\r\n\r\n    constructor(list: List) {\r\n        super(list);\r\n        makeObservable(this, {\r\n            _items: observable\r\n        })\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }\r\n\r\n    private listenArraySplice() {\r\n        let { items } = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray: any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as IPageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {\r\n                if (change.type === 'splice') {\r\n                    let { index, removedCount, added } = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false,\r\n                            item: v,\r\n                            labelId: uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let { items, isItemSelected, selectedItems, compare } = this.list.props;\r\n        let itemsArray: any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as IPageItems<any>).items;\r\n        }\r\n\r\n        if (isItemSelected) {\r\n            let retItems = itemsArray.map(v => {\r\n                return {\r\n                    selected: isItemSelected(v),\r\n                    item: v,\r\n                    labelId: uid()\r\n                };\r\n            });\r\n            this._items = retItems;\r\n        }\r\n        else {\r\n            let comp: ((item: any, selectItem: any) => boolean);\r\n            if (compare === undefined) {\r\n                comp = (item: any, selectItem: any) => item === selectItem;\r\n            }\r\n            else {\r\n                comp = compare;\r\n            }\r\n            let retItems = itemsArray.map(v => {\r\n                //let isObserved = isObservable(v);\r\n                //let obj = isObserved === true? toJS(v) : v;\r\n                //let obj = v;\r\n                let selected = selectedItems === undefined ?\r\n                    false\r\n                    : selectedItems.find(si => comp(v, si)) !== undefined;\r\n                return {\r\n                    selected: selected,\r\n                    item: v,\r\n                    labelId: uid()\r\n                };\r\n            });\r\n            this._items = retItems;\r\n        }\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n\r\n    private get anySelected(): boolean { return this._items.some(v => v.selected) }\r\n    private onSelect(item: SelectableItem, selected: boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n\r\n    get selectedItems(): any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n\r\n    render = (item: SelectableItem, index: number): JSX.Element => {\r\n        let { key } = this.list.props.item;\r\n        return React.createElement(this.row, { item, index, key: key === undefined ? index : key(item) });\r\n    }\r\n\r\n    private row = observer((props: { item: SelectableItem, index: number }): JSX.Element => {\r\n        let { item, index } = props;\r\n        let { className } = this.list.props.item;\r\n        let { labelId, selected, item: obItem } = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input => { if (input) this.inputItems[labelId] = input; }}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e) => {\r\n                        this.onSelect(item, e.target.checked)\r\n                    }\r\n                    } />\r\n                <label className=\"\" style={{ flex: 1, marginBottom: 0 }} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observer } from 'mobx-react';\r\nimport { resLang } from 'tonwa-core';\r\nimport { ListRes, listRes } from 'tonwa-core';\r\nimport _ from 'lodash';\r\nimport { ListBase } from './base';\r\nimport { Clickable } from './clickable';\r\nimport { Static } from './static';\r\nimport { Selectable } from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { IPageItems } from '../../tool';\r\n\r\ntype StaticRow = string | JSX.Element | (() => string | JSX.Element);\r\ninterface ItemProps {\r\n    className?: string | string[];\r\n    render?: (item: any, index: number) => JSX.Element;\r\n    onSelect?: (item: any, isSelected: boolean, anySelected: boolean) => void;\r\n    onClick?: (item: any) => void;\r\n    key?: (item: any) => string | number;\r\n}\r\n\r\nexport interface ListProps {\r\n    className?: string | string[];\r\n    items: any[] | IObservableArray<any> | IPageItems<any>;\r\n    item: ItemProps;\r\n    isItemSelected?: (item: any) => boolean;\r\n    compare?: (item: any, selectItem: any) => boolean;\r\n    selectedItems?: any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n    none?: StaticRow;\r\n    onFocus?: (evt: React.FocusEvent<HTMLUListElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n    private static res: ListRes = resLang<ListRes>(listRes);\r\n\r\n    private listBase: ListBase;\r\n    private selectable: Selectable;\r\n    constructor(props: ListProps) {\r\n        super(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top' | 'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let { item } = this.props;\r\n        let { onClick, onSelect } = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n    }\r\n    componentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\r\n        if (_.isEqual(this.props.item, prevProps.item) === false) {\r\n            this.buildBase();\r\n            this.forceUpdate();\r\n        }\r\n    }\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems(): any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let { className, header, footer, before, loading, none, onFocus } = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        let { items, loading: isLoading } = this.listBase;\r\n        function staticRow(row: StaticRow, type: string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\" + type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\" + type}>{(row as () => string | JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            }\r\n        }\r\n        let content: any, waitingMore: any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n        }\r\n        let tabIndex: number;\r\n        if (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from 'tonwa-core';\r\n\r\nexport interface EasyDateProps {\r\n\tdate: Date | number;\r\n\ttimeZone?: number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes: { [prop: string]: any } = {\r\n\tmd: (month: number, date: number) => `${month}-${date}`,\r\n\tymd: (year: number, month: number, date: number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month: number, date: number) => `${month}月${date}日`,\r\n\t\tymd: (year: number, month: number, date: number) => `${year}年${month}月${date}日`,\r\n\t\tyesterday: '昨天',\r\n\t\ttoday: '今天',\r\n\t\ttomorrow: '明天',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month: number, date: number) => `${month}-${date}`,\r\n\t\tymd: (year: number, month: number, date: number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str: string): any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate: Date | number, withTime: boolean, always: boolean = false) {\r\n\tif (!vDate) return null;\r\n\tlet date: Date;\r\n\tswitch (typeof vDate) {\r\n\t\tdefault: date = vDate as Date; break;\r\n\t\tcase 'string': date = new Date(vDate); break;\r\n\t\tcase 'number': date = new Date((vDate as number) * 1000); break;\r\n\t}\r\n\r\n\tlet now = new Date();\r\n\tlet tick: number, nDate: number, _date: number, month: number, year: number, nowYear: number;\r\n\tlet d = date;\r\n\ttick = now.getTime() - d.getTime();\r\n\tlet hour = d.getHours(), minute = d.getMinutes();\r\n\tnDate = now.getDate();\r\n\t_date = d.getDate();\r\n\tmonth = d.getMonth() + 1;\r\n\tyear = d.getFullYear();\r\n\tnowYear = now.getFullYear();\r\n\r\n\tlet appendTime: boolean = false;\r\n\tlet dPart: string = (function () {\r\n\t\tif (tick < -24 * 3600 * 1000) {\r\n\t\t\tif (year === nowYear) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('md')(month, _date);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('ymd')(year, month, _date);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tick < 24 * 3600 * 1000) {\r\n\t\t\tif (_date !== nDate) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt(tick < 0 ? 'tomorrow' : 'yesterday');\r\n\t\t\t}\r\n\t\t\tif (withTime === true) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn tt('today');\r\n\t\t}\r\n\t\tif (year === nowYear) {\r\n\t\t\treturn tt('md')(month, _date);\r\n\t\t}\r\n\t\treturn tt('ymd')(year, month, _date);\r\n\t})();\r\n\r\n\tlet hm = hour + ((minute < 10 ? ':0' : ':') + minute);\r\n\r\n\t/*\r\n\tif (tick < -24*3600*1000) {\r\n\t\tif (year === nowYear)\r\n\t\t\treturn tt('md')(month, _date) + ' ' + hm;\r\n\t\telse\r\n\t\t\treturn tt('ymd')(year, month, _date) + ' ' + hm;\r\n\t}\r\n\tif (always === true || tick < 24*3600*1000) {\r\n\t\treturn _date!==nDate? \r\n\t\t\ttt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n\t\t\t: withTime===true? hm : tt('today');\r\n\t}\r\n\tif (year === nowYear) {\r\n\t\treturn tt('md')(month, _date);\r\n\t}\r\n\treturn tt('ymd')(year, month, _date);\r\n\t*/\r\n\tif (appendTime === true || always === true) {\r\n\t\treturn dPart + ' ' + hm;\r\n\t}\r\n\treturn dPart;\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n\trender() {\r\n\t\treturn renderDate(this.props.date, false);\r\n\t}\r\n}\r\n\r\ninterface EasyTimeProps extends EasyDateProps {\r\n\talways?: boolean;\r\n}\r\nexport class EasyTime extends React.Component<EasyTimeProps> {\r\n\trender() {\r\n\t\tlet { date, always } = this.props;\r\n\t\treturn renderDate(date, true, always);\r\n\t}\r\n}\r\n\r\ninterface DateProps {\r\n\tdate: Date;\r\n\thideTime?: boolean;\r\n\thideSameYear?: boolean;\r\n}\r\nexport const VDate: React.FunctionComponent<DateProps> = (props) => {\r\n\tlet { date, hideTime, hideSameYear } = props;\r\n\tlet year = date.getFullYear();\r\n\tlet vTime: any;\r\n\tif (hideTime !== true) {\r\n\t\tvTime = <>{date.getHours()}:{String(100 + date.getMinutes()).substr(1, 2)}</>;\r\n\t}\r\n\tlet vDate = <>{date.getMonth() + 1}-{date.getDate()}</>;\r\n\tif (hideSameYear === true && year === new Date().getFullYear()) {\r\n\t}\r\n\telse {\r\n\t\tvDate = <>{year}-{vDate}</>;\r\n\t}\r\n\treturn <>\r\n\t\t{vDate} {vTime}\r\n\t</>;\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n\taction?: () => void;\r\n\ticonClass?: string;\r\n\tcaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n\tcontent?: string|JSX.Element;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n\tclassName?: string;\r\n\tcontainerClass?: string;\r\n\titemIconClass?: string;\r\n\titemCaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props:DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n\t/*\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\t*/\r\n\r\n    private handleDocumentClick = (evt:any) => {\r\n\t\tdocument.removeEventListener('click', this.handleDocumentClick);\r\n\t\tdocument.removeEventListener('touchstart', this.handleDocumentClick);\r\n\t\tif (this.state.dropdownOpen === false) return;\r\n        //if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n\t\tlet {dropdownOpen} = this.state;\r\n\t\tdropdownOpen = !dropdownOpen;\r\n        this.setState({dropdownOpen});\r\n\t\tif (dropdownOpen === true) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tdocument.addEventListener('click', this.handleDocumentClick);\r\n\t\t\t\tdocument.addEventListener('touchstart', this.handleDocumentClick);\t\r\n\t\t\t},10)\r\n\t\t}\r\n    }\r\n\r\n    render() {\r\n        let {icon, content, actions, isRight, className, containerClass, itemIconClass, itemCaptionClass} = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => {\r\n\t\t\tif (!v) return false;\r\n\t\t\treturn v.icon !== undefined\r\n\t\t});\r\n        let {dropdownOpen} = this.state;\r\n\t\t//isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n\t\tlet cn = className || 'cursor-pointer dropdown-toggle btn btn-sm';\r\n\t\t//if (className) cn += className;\r\n        return <div className={classNames('dropdown', containerClass)}>\r\n\t\t\t<button ref={v=>this.button=v} \r\n\t\t\t\tclassName={cn}\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                {icon!==null && <i className={classNames('fa fa-fw ', 'fa-'+(icon||'ellipsis-v'))} />}\r\n\t\t\t\t{content && <span className=\"ms-1\">{content}</span>}\r\n            </button>\r\n            <div ref={v => this.menu=v} className={classNames({\"dropdown-menu\":true, \"dropdown-menu-right\":isRight, \"show\":dropdownOpen})}>\r\n                {\r\n                    actions.map((v,index) => {\r\n\t\t\t\t\t\tif (!v) {\r\n                            return <div className=\"dropdown-divider\" key={index}/>;\r\n\t\t\t\t\t\t}\r\n                        let {icon, caption, action, iconClass, captionClass} = v;\r\n                        if (icon === undefined && caption === undefined) \r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i:any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n\t\t\t\t\t\t\tif (!iconClass) iconClass = 'text-info';\r\n\t\t\t\t\t\t\ti = <i className={classNames('me-2', 'fa', icon, 'fa-fw', iconClass || itemIconClass)}\r\n\t\t\t\t\t\t\t\taria-hidden={true}></i>;\r\n                        }\r\n                        if (action === undefined) \r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt:React.MouseEvent<HTMLAnchorElement>)=>{\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                            // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\" \r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                            >{i} <span className={captionClass || itemCaptionClass}>{caption}</span></a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n\tisInt: boolean;\t\t// 整数\r\n\ttime: boolean;\t\t// 字段log的time可以客户端输入\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string 表示名字，否则就是值\r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { env } from 'tonwa-core';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key: string) => Promise<void>;\r\n    onFocus?: () => void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n    private button: HTMLButtonElement;\r\n    private key: string = null;\r\n\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n        console.log('key = ' + this.key);\r\n        if (this.props.allowEmptySearch === true) {\r\n        }\r\n        else {\r\n            this.button.disabled = this.key === undefined || this.key.length === 0;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n            if (this.button) this.button.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n        if (this.button) this.button.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n        let { className, inputClassName, onFocus,\r\n            label, placeholder, buttonText, maxLength, size } = this.props;\r\n        let inputSize: string;\r\n        switch (size) {\r\n            default:\r\n            case 'sm': inputSize = 'input-group-sm'; break;\r\n            case 'md': inputSize = 'input-group-md'; break;\r\n            case 'lg': inputSize = 'input-group-lg'; break;\r\n        }\r\n        let autoComplete: string;\r\n        if (env.isMobile === true) autoComplete = 'off';\r\n        return <form className={className} onSubmit={this.onSubmit} autoComplete={autoComplete}>\r\n            <div className={classNames(\"input-group\", inputSize)}>\r\n                {label && <div className=\"input-group-addon align-self-center me-2\">{label}</div>}\r\n                <input ref={v => this.input = v} onChange={this.onChange}\r\n                    type=\"text\"\r\n                    name=\"key\"\r\n                    onFocus={onFocus}\r\n                    className={classNames('form-control', inputClassName || 'border-primary')}\r\n                    placeholder={placeholder}\r\n                    defaultValue={this.props.initKey}\r\n                    maxLength={maxLength} />\r\n                <div className=\"input-group-append\">\r\n                    <button ref={v => this.button = v} className=\"btn btn-primary\"\r\n                        type=\"submit\"\r\n                        disabled={this.props.allowEmptySearch !== true}>\r\n                        <i className='fa fa-search' />\r\n                        <i className=\"fa\" />\r\n                        {buttonText}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </form>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from './image';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string|JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let {icon, main, discription, px, py} = this.props;\r\n        let disp:any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media', \r\n            px===undefined? 'px-0':'px-'+px, \r\n            py===undefined? 'py-2':'py-'+py);\r\n        return <div className={cn}>\r\n            <Image className=\"me-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { tonwa } from \"tonwa-core\";\r\n// import { nav } from \"../../nav\";\r\n\r\nexport interface AxProps extends React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement> {\r\n\t//children: React.ReactNode;\r\n\t//href: string;\r\n\t//onClick?: (event:React.MouseEvent) => void;\r\n\t//className?: string;\r\n\taClassName?: string;\r\n\tnaClassName?: string;\r\n\t//target?: string;\r\n\t//props?: any;\r\n}\r\n\r\n// 如果是web方式，用webNav方式route网页\r\n// 如果是app方式，用click方式压栈页面\r\nexport const Ax = (axProps: AxProps) => {\r\n\tlet { href, children, className, onClick } = axProps;\r\n\tif (tonwa.nav.isWebNav === true) {\r\n\t\tlet { aClassName } = axProps;\r\n\t\tif (!href) return <span className=\"text-danger\">Error: href not defined in Ax</span>;\r\n\t\tlet onAxClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tlet ret: boolean;\r\n\t\t\tif (onClick) {\r\n\t\t\t\tret = onClick(evt) as unknown as boolean;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttonwa.navigate(href);\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\treturn <a {...axProps} className={classNames(className, aClassName)} onClick={onAxClick}>{children}</a>;\r\n\t}\r\n\telse {\r\n\t\tlet { naClassName } = axProps;\r\n\t\tif (!onClick) {\r\n\t\t\tonClick = () => {\r\n\t\t\t\tif (tonwa.openSysPage(href) === false) {\r\n\t\t\t\t\ttonwa.navigate(href);\r\n\t\t\t\t};\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <span className={classNames(className, 'cursor-pointer', naClassName)} onClick={onClick}>{children}</span>;\r\n\t}\r\n}\r\n\r\n// 同普通的a tag\r\n// 会自动处理href，处理生产版跟测试版之间的不同\r\nexport const A = (props: React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>) => {\r\n\tlet { children } = props;\r\n\tif (tonwa.nav.isWebNav === false) {\r\n\t\treturn <a {...props}>{children}</a>;\r\n\t}\r\n\tlet { href } = props;\r\n\t//if (nav.testing === true) href += '#test';\r\n\tlet onClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\tevt.preventDefault();\r\n\t\ttonwa.navigate(href);\r\n\t\treturn false;\r\n\t}\r\n\treturn <a {...props} href={href} onClick={onClick}>{children}</a>;\r\n}\r\n","import { action, makeObservable, observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport React, { Component } from \"react\";\r\nimport { Rule, RuleCustom, RuleRequired } from \"../inputRules\";\r\n\r\nexport interface InputProps {\r\n    className?: string;\r\n    defaultValue?: any;\r\n    disabled?: boolean;\r\n    onValueChange?: (newValue:any, preValue:any, ruleMessage:string) => void;\r\n    required?: boolean;\r\n    containerClassName?: string;\r\n    ruleClassName?: string;\r\n    requiredFlagElement?: JSX.Element;\r\n    rules?: ((value:any) => string[] | string)[];\r\n}\r\n\r\nexport abstract class Input<P extends InputProps, V> extends Component<P> {\r\n    static defaultRequiredFlagElement = <span className=\"mx-2 text-danger\">*</span>;\r\n    static defaultRuleClassName = ' mx-2 text-danger ';\r\n    protected readonly rules: Rule[] = [];\r\n    protected value: V = null;\r\n    protected input: HTMLInputElement;\r\n    protected abstract get type(): 'text' | 'number' | 'checkbox' | 'radio';\r\n    protected get placeholder(): string {return undefined;}\r\n    protected get max(): number {return undefined;}\r\n    protected get min(): number {return undefined;}\r\n    protected get maxLength(): number {return undefined;}\r\n    protected get className(): string {return this.props.className}\r\n    protected requiredFlagElement?: JSX.Element;\r\n    ruleMessage: string = null;\r\n    constructor(props: P) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            ruleMessage: observable,\r\n            onChange: action,\r\n            onFocus: action,\r\n            onBlur: action,\r\n        });\r\n        this.init();\r\n    }\r\n\r\n    private init() {\r\n        let {required, rules, requiredFlagElement, defaultValue} = this.props;\r\n        if (required === true) {\r\n            if (requiredFlagElement === undefined) requiredFlagElement = Input.defaultRequiredFlagElement;\r\n            this.requiredFlagElement = requiredFlagElement;\r\n            this.rules.push(new RuleRequired());\r\n        }\r\n        this.buildRules();\r\n        if (rules) {\r\n            for (let rule of rules) {this.rules.push(new RuleCustom(rule))};\r\n        }\r\n        this.value = defaultValue;\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    getValue(): V {return this.value;}\r\n    setValue(v: V) {\r\n        let p = this.value;\r\n        this.value = v;\r\n        this.checkRules();\r\n        let {onValueChange} = this.props;\r\n        if (!onValueChange) return;\r\n        if (v !== p) onValueChange(v, p, this.ruleMessage);\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        let {defaultValue, disabled, required} = this.props;\r\n        let content = <input ref={inp => this.input = inp}\r\n            className={this.className} type={this.type}\r\n            placeholder={this.placeholder}\r\n            defaultValue={defaultValue}\r\n            defaultChecked={defaultValue}\r\n            maxLength={this.maxLength}\r\n            max={this.max}\r\n            min={this.min}\r\n            disabled={disabled}\r\n            onChange={() => this.onChange()}\r\n            onBlur={() => this.onBlur()}\r\n            onFocus={() => this.onFocus()} />;\r\n        if (this.rules.length === 0) return content;\r\n        let {containerClassName, ruleClassName} = this.props;\r\n        return <span className={containerClassName}>\r\n            {required===true && this.requiredFlagElement}\r\n            {content}\r\n            {\r\n                React.createElement(observer(() => {\r\n                    return <span className={ruleClassName ?? Input.defaultRuleClassName}>{this.ruleMessage}</span>\r\n                }))\r\n            }\r\n        </span>;\r\n    }\r\n\r\n    onChange() {\r\n        let preValue = this.value;\r\n        let value = this.value = this.valueFromInput();\r\n        this.checkRules();\r\n        let {onValueChange} = this.props;\r\n        if (!onValueChange) return;\r\n        if (value !== preValue) onValueChange(value, preValue, this.ruleMessage);\r\n    }\r\n\r\n    protected valueFromInput():V {return;}\r\n\r\n    protected checkRules() {\r\n        let defy:string[] = [];\r\n        for (let rule of this.rules) {\r\n            rule.check(defy, this.value);\r\n        }\r\n        if (defy.length === 0) {\r\n            this.ruleMessage = null;\r\n        }\r\n        else {\r\n            this.ruleMessage = defy[0];\r\n        }\r\n    }\r\n\r\n    onBlur() {\r\n        this.checkRules();\r\n    }\r\n\r\n    onFocus() {\r\n        this.ruleMessage = null;\r\n    }\r\n}\r\n","import { RuleInt, RuleNum } from \"../../inputRules\";\r\nimport { Input, InputProps } from \"../input\";\r\n\r\ninterface InputNumberProps extends InputProps {\r\n    placeholder?: string;\r\n    max?: number;\r\n    min?: number;\r\n}\r\n\r\nexport class InputNumber<P extends InputNumberProps> extends Input<P, number> {\r\n    static defaultClassName = 'form-control w-8c d-inline text-right';\r\n\r\n    protected get type(): 'text' | 'number' | 'checkbox' | 'radio' { return 'number' }\r\n    protected get max(): number { return this.props.max; }\r\n    protected get min(): number { return this.props.min; }\r\n    protected get className(): string {\r\n        let { className } = this.props;\r\n        if (className === null) return null;\r\n        if (!className) return InputNumber.defaultClassName;\r\n        return className;\r\n    }\r\n\r\n    protected buildRules() {\r\n        let { max, min } = this.props;\r\n        this.rules.push(new RuleNum(undefined, min, max));\r\n    }\r\n\r\n    protected parseValue(): number {\r\n        return Number.parseFloat(this.input.value);\r\n    }\r\n\r\n    protected valueFromInput(): number {\r\n        let v = this.parseValue();\r\n        if (isNaN(v) === true) return undefined;\r\n        return v;\r\n    }\r\n}\r\n\r\nexport interface InputIntegerProps extends InputNumberProps {\r\n}\r\n\r\nexport class InputInteger<P extends InputIntegerProps> extends InputNumber<P> {\r\n    protected buildRules() {\r\n        let { max, min } = this.props;\r\n        this.rules.push(new RuleInt(undefined, min, max));\r\n    }\r\n\r\n    protected parseValue(): number {\r\n        return Number.parseInt(this.input.value);\r\n    }\r\n}\r\n","import { Input, InputProps } from \"../input\";\r\n\r\nexport interface InputCheckBoxProps extends InputProps {\r\n}\r\n\r\nexport class InputCheckBox extends Input<InputCheckBoxProps, boolean> {\r\n    static defaultClassName = 'form-check-input p-2';\r\n\r\n    protected get type(): 'text' | 'number' | 'checkbox' | 'radio' {return 'checkbox'}\r\n    protected get className(): string {\r\n        let {className} = this.props;\r\n        if (className === null) return null;\r\n        if (!className) return InputCheckBox.defaultClassName;\r\n        return className;\r\n    }\r\n\r\n    protected valueFromInput(): boolean {\r\n        return this.input.checked;\r\n    }\r\n    onBlur() {}\r\n    onFocus() {}\r\n    setValue(v: boolean) {\r\n        super.setValue(v);\r\n        this.input.checked = v;\r\n    }\r\n}\r\n","import fs from 'fs';\r\nimport { capitalCase } from \"../tool\";\r\nimport { UqMan } from \"../uqCore\";\r\nimport { UqBuildContext } from './UqBuildContext';\r\n\r\nexport const red = '\\x1b[41m%s\\x1b[0m';\r\nexport let lastBuildTime:number = 0;\r\n//export const uqTsSrcPath = 'src/UqApp';\r\n\r\nexport function saveSrcTsFileIfNotExists(context:UqBuildContext, fileName:string, suffix:string, content:string) {\r\n\tlet tsFilePath = `${context.uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tsaveTsFileIfNotExists(tsFilePath, content);\r\n\t//if (fs.existsSync(tsFile) === true) return;\r\n\t//saveTsFile(fileName, content, suffix);\r\n}\r\nexport function saveTsFile(context:UqBuildContext, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet {uqTsSrcPath} = context;\r\n\tlet srcFile = `${uqTsSrcPath}/${fileName}.${suffix}.txt`;\r\n\tlet tsFile = `${uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tif (!fs.existsSync(srcFile)) {\r\n\t\tif (fs.existsSync(tsFile)) {\r\n\t\t\tfs.renameSync(tsFile, srcFile);\r\n\t\t}\r\n\t}\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nexport function overrideTsFile(path:string, content:string) {\r\n\t//let tsFile = `${path}/${fileName}.${suffix}`;\r\n\tfs.writeFileSync(path, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${path} is built`);\r\n}\r\n//fileName:string, \r\n//, suffix:string = 'ts'\r\nexport function saveTsFileIfNotExists(tsFilePath:string, content:string) {\r\n\t//let tsFilePath = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFilePath) === true) return;\r\n\toverrideTsFile(tsFilePath, content);\r\n}\r\n\r\n/*\r\nfunction createTsFile(path:string, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet tsFile = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFile) === true) return;\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\n*/\r\nexport function entityName(s:string):string {\r\n\treturn capitalCase(s);\r\n}\r\n\r\nexport function getNameFromUq(uqMan:UqMan):{devName:string; uqName:string} {\r\n\tlet {config} = uqMan;\r\n\tlet devPart:string, uqPart:string;\r\n\tif (config) {\r\n\t\tlet {dev, name, alias} = config;\r\n\t\tlet {name:devName, alias:devAlias} = dev;\r\n\t\tdevPart = devAlias || devName;\r\n\t\tuqPart = alias || name;\r\n\t}\r\n\telse {\r\n\t\tlet {uqOwner, uqName} = uqMan;\r\n\t\tdevPart = uqOwner;\r\n\t\tuqPart = uqName;\r\n\t}\r\n\treturn {\r\n\t\tdevName: capitalCase(devPart),\r\n\t\tuqName: capitalCase(uqPart),\r\n\t};\r\n}\r\n","import { Net, User } from \"tonwa-uq\";\r\nimport { Tonwa } from \"tonwa-core\";\r\nimport { VPage } from \"./VPage\";\r\nimport { Controller, WebNav } from \"./Controller\";\r\n\r\nexport abstract class ControllerWithWeb extends Controller {\r\n    readonly net: Net;\r\n    constructor(tonwa: Tonwa) {\r\n        super(tonwa);\r\n        this.net = tonwa.net;\r\n    }\r\n\r\n    private receiveHandlerId: number;\r\n    //private disposer:()=>void;\r\n\r\n    protected dispose = () => {\r\n        // message listener的清理\r\n        //nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.net.messageHub.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n    }\r\n\r\n    protected async internalStart(param?: any, ...params: any[]): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    get user(): User { return this.tonwa.user }\r\n    get isLogined(): boolean {\r\n        let { user } = this.tonwa;\r\n        if (!user) return false;\r\n        return user.id > 0;\r\n    }\r\n\r\n    get webNav(): WebNav<any> { return undefined; }\r\n\r\n    getWebNav(): WebNav<any> { return this.webNav; }\r\n\r\n    get isWebNav(): boolean { return this.nav.isWebNav }\r\n    navigate(url: string) {\r\n        this.navigate(url);\r\n    }\r\n\r\n    isMe(id: any): boolean {\r\n        if (id === null) return false;\r\n        let { user } = this;\r\n        let userId = user.id;\r\n        switch (typeof id) {\r\n            default: return false;\r\n            case 'string': return Number(id) === userId;\r\n            case 'number': return id === userId;\r\n            case 'object': return id.id === userId;\r\n        }\r\n    }\r\n\r\n    protected onMessage(message: any): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message: any): Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart(): Promise<boolean> {\r\n        return true;\r\n    }\r\n    protected async afterStart(): Promise<void> {\r\n    }\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = this.net.messageHub.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    async start(param?: any, ...params: any[]): Promise<void> {\r\n        this.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n        await this.internalStart(param, ...params);\r\n        await this.afterStart();\r\n    }\r\n\r\n    get isCalling(): boolean { return this._resolve_$ !== undefined }\r\n\r\n    private _resolve_$: ((value: any) => void)[];\r\n    async call<T>(param?: any, ...params: any[]): Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T>(async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C) => VPage<C>, param?: any): Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value: any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { Page } from '../components';\r\nimport { env, Nav, Tonwa } from 'tonwa-core';\r\nimport { Controller } from './Controller';\r\nimport { VPage } from './VPage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected readonly tonwa: Tonwa;\r\n    protected readonly controller: C;\r\n    protected readonly nav: Nav;\r\n    protected readonly res: any;\r\n    protected readonly x: any;\r\n    protected readonly t: (str: string) => any;\r\n\r\n    constructor(controller: C) {\r\n        let tonwa = controller.getTonwa();\r\n        this.tonwa = tonwa;\r\n        this.controller = controller;\r\n        this.nav = tonwa.nav;\r\n        this.t = controller.t;\r\n    }\r\n\r\n    protected get isDev() { return env.isDevelopment }\r\n    get isWebNav(): boolean { return this.nav.isWebNav }\r\n    navigate(url: string) { this.tonwa.navigate(url) }\r\n    abstract render(param?: any): JSX.Element;\r\n\r\n    protected shallow<T extends object>(data: T) {\r\n        return this.controller.shallow(data);\r\n    }\r\n\r\n    protected deep<T extends object>(data: T) {\r\n        return this.controller.deep(data);\r\n    }\r\n\r\n    protected runInAction<T>(fn: () => T): T {\r\n        return this.controller.runInAction(fn);\r\n    }\r\n\r\n    protected react(func: () => JSX.Element): JSX.Element {\r\n        let V = observer(func.bind(this));\r\n        return <V />;\r\n    }\r\n\r\n    protected renderVm(vm: new (controller: C) => View<C>, param?: any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C) => VPage<C>, param?: any, afterBack?: () => Promise<void>): Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type: string, value?: any) {\r\n        await this.controller.event(type, value);\r\n    }\r\n\r\n    protected go(showPage: () => void, url: string, absolute?: boolean) {\r\n        this.controller.go(showPage, url, absolute);\r\n    }\r\n    /*\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n    protected renderUser(user:any, imageClassName?:string, textClassName?:string) {\r\n        let renderUser = (user:User) => {\r\n            let {name, nick, icon} = user;\r\n            return <>\r\n                <Image src={icon} className={imageClassName || 'w-1c h-1c me-2'} />\r\n                <span className={textClassName}>{nick || name}</span>\r\n            </>;\r\n        }\r\n        return <UserView user={user} render={renderUser} />\r\n    }\r\n\r\n    protected renderUserText(user:any) {\r\n        let renderUser = (user:User) => {\r\n            let {name, nick} = user;\r\n            return <>{nick || name}</>;\r\n        }\r\n        return <UserView user={user} render={renderUser} />\r\n    }\r\n\r\n    protected renderMe(imageClassName?:string, textClassName?:string) {\r\n        let {user} = this.controller;\r\n        if (!user) return;\r\n        return this.renderUser(user.id, imageClassName, textClassName);\r\n    }\r\n    */\r\n    protected openPage(view: React.StatelessComponent<any>, param?: any, onClosePage?: (ret: any) => void) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param), onClosePage);\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>, onClosePage);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?: any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: () => void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element, onClosePage?: () => void) {\r\n        this.controller.replacePage(page, onClosePage);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?: number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?: number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n    }\r\n\r\n    protected popToTopPage() {\r\n        this.controller.popToTopPage();\r\n    }\r\n}\r\n","import { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./View\";\r\nimport { Controller } from \"./Controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n    replaceOpen(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.replacePageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\tlet logout = this.logout();\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={logout}\r\n\t\t\twebNav={this.controller.pageWebNav}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","import React from 'react';\r\nimport { FA, Page } from '../../components';\r\nimport { Controller } from \"../Controller\";\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nexport interface CStringEditProps {\r\n\tlabel?: string;\r\n\tplaceholder?: string;\r\n\tmaxLength?: number;\r\n\tonValueChange?: (value: string) => Promise<void>;\r\n}\r\n\r\nexport class CStringEdit extends Controller {\r\n\tprivate props: CStringEditProps = {\r\n\t\tlabel: '编辑'\r\n\t}\r\n\tvalue: string = null;\r\n\tnewValue: string = null;\r\n\tisChanged: boolean = null;\r\n\terror: string = null;\r\n\r\n\tconstructor() {\r\n\t\tsuper(tonwa);\r\n\t\tmakeObservable(this, {\r\n\t\t\tvalue: observable,\r\n\t\t\tnewValue: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\terror: observable,\r\n\t\t});\r\n\t}\r\n\r\n\tprotected async internalStart() { }\r\n\trender(value: string, props?: CStringEditProps) {\r\n\t\tthis.value = value;\r\n\t\tif (props) Object.assign(this.props, props);\r\n\t\treturn React.createElement(observer(() => <>{this.renderValue()}{this.renderPencil()}</>))\r\n\t}\r\n\r\n\tprotected renderValue() { return <>{this.value}</> }\r\n\tprotected renderPencil() {\r\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\r\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\r\n\t\t</span>;\r\n\t}\r\n\r\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.newValue = evt.target.value;\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\r\n\tprivate onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.verifyValue();\r\n\t}\r\n\r\n\tprotected verifyValue() { }\r\n\r\n\tprivate onFocus = () => {\r\n\t\tthis.error = undefined;\r\n\t}\r\n\r\n\tprivate onEdit = () => {\r\n\t\tlet { label, maxLength, placeholder, onValueChange } = this.props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tthis.value = this.newValue;\r\n\t\t\t\tthis.closePage();\r\n\t\t\t\tif (onValueChange) onValueChange(this.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet right = React.createElement(observer(() => <button\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center me-2\"\r\n\t\t\tdisabled={!this.isChanged}\r\n\t\t\tonClick={onSave}>保存</button>));\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tthis.openPage(<Page header={label} right={right}>\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n\t\t\t\t\tonBlur={this.onBlur}\r\n\t\t\t\t\tonFocus={this.onFocus}\r\n\t\t\t\t\tclassName=\"form-control\"\r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t{\r\n\t\t\t\t\tReact.createElement(observer(() => placeholder && <div className=\"small muted m-2\">{placeholder}</div>))\r\n\t\t\t\t}\r\n\t\t\t\t{this.error && <div className=\"text-danger\">{this.error}</div>}\r\n\t\t\t</div>\r\n\t\t</Page>);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { renderPageHeader } from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView, WebNavScrollView } from './scrollView';\r\nimport { PageHeaderProps, PageWebNav, tonwa } from 'tonwa-core';\r\n//import { nav } from '../../nav';\r\n\r\nexport interface IVPage {\r\n\tcontent(): JSX.Element;\r\n\theader(): JSX.Element | string;\r\n\tfooter(): JSX.Element;\r\n}\r\n\r\nexport interface PageProps extends ScrollProps {\r\n\tback?: 'close' | 'back' | 'none';\r\n\theader?: boolean | string | JSX.Element;\r\n\tright?: JSX.Element;\r\n\tfooter?: JSX.Element;\r\n\tlogout?: boolean | (() => Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n\twebNav?: PageWebNav<JSX.Element>;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n\tconstructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet { tabsProps } = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader(webNav?: PageWebNav) {\r\n\t\tconst { back, header, right, headerClassName, afterBack, logout } = this.props;\r\n\t\tif (header === false) return;\r\n\t\t//const {webNav} = this.props;\r\n\t\tlet inWebNav = false;\r\n\t\tlet pageHeaderProps: PageHeaderProps<JSX.Element> = {\r\n\t\t\tback,\r\n\t\t\tcenter: header as any,\r\n\t\t\tright,\r\n\t\t\tlogout,\r\n\t\t\tclassName: headerClassName,\r\n\t\t\tafterBack,\r\n\t\t};\r\n\t\tif (webNav !== undefined) {\r\n\t\t\tinWebNav = true;\r\n\t\t\tlet { renderPageHeader: rph } = webNav;\r\n\t\t\tif (rph) return rph(pageHeaderProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinWebNav = false;\r\n\t\t}\r\n\t\treturn renderPageHeader(pageHeaderProps, inWebNav);\r\n\t}\r\n\r\n\tprivate renderFooter(webNav?: PageWebNav) {\r\n\t\tconst { footer } = this.props;\r\n\t\tif (!footer) return;\r\n\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\tif (webNav) return elFooter;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t{elFooter}\r\n\t\t</>;\r\n\t}\r\n\r\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n\t\t// You can also log the error to an error reporting service\r\n\t\t//logErrorToMyService(error, errorInfo);\r\n\t\tdebugger;\r\n\t}\r\n\r\n\trender() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst { onScroll, onScrollTop, onScrollBottom, children, className, webNav } = this.props;\r\n\t\tlet pageWebNav: PageWebNav;\r\n\t\tif (!webNav) {\r\n\t\t\tpageWebNav = tonwa.nav.pageWebNav;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpageWebNav = webNav;\r\n\t\t}\r\n\t\tlet content = <>\r\n\t\t\t{this.renderHeader(pageWebNav)}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter(pageWebNav)}\r\n\t\t</>;\r\n\t\tif (pageWebNav) {\r\n\t\t\treturn <WebNavScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twebNav={pageWebNav}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</WebNavScrollView>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn <ScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</ScrollView>;\r\n\t\t}\r\n\t}\r\n}\r\n","import { from62 } from './62';\r\nimport { LocalMap } from './localDb';\r\n\r\nexport const env = (function () {\r\n\tlet { unit, testing, params, lang, district, timeZone, isMobile } = initEnv();\r\n\treturn {\r\n\t\tunit,\r\n\t\ttesting,\r\n\t\tbuildingUq: false,\r\n\t\tparams,\r\n\t\tlang,\r\n\t\tdistrict,\r\n\t\ttimeZone,\r\n\t\tbrowser: detectBrowser(),\r\n\t\tisDevelopment: process.env.NODE_ENV === 'development',\r\n\t\tisMobile,\r\n\t\tlocalDb: new LocalMap(testing === true ? '$$' : '$'),\r\n\t\tsetTimeout: (tag: string, callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n\t\t\treturn global.setTimeout(callback, ms, ...args);\r\n\t\t},\r\n\t\tclearTimeout: (handle: NodeJS.Timer): void => {\r\n\t\t\tglobal.clearTimeout(handle);\r\n\t\t},\r\n\t\tsetInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n\t\t\treturn global.setInterval(callback, ms, ...args);\r\n\t\t},\r\n\t\tclearInterval: (handle: NodeJS.Timer): void => {\r\n\t\t\tglobal.clearInterval(handle);\r\n\t\t}\r\n\t}\r\n}());\r\n\r\nfunction initEnv(): {\r\n\tunit: number;\r\n\ttesting: boolean;\r\n\tparams: { [key: string]: string };\r\n\tlang: string;\r\n\tdistrict: string;\r\n\ttimeZone: number;\r\n\tisMobile: boolean;\r\n} {\r\n\tif (!(global as any).window) return {} as any;\r\n\tlet pl = /\\+/g,  // Regex for replacing addition symbol with a space\r\n\t\tsearch = /([^&=]+)=?([^&]*)/g,\r\n\t\tdecode = function (s: any) { return decodeURIComponent(s.replace(pl, \" \")); };\r\n\tlet query: string = undefined;\r\n\tif ((global as any).window) {\r\n\t\tlet win = (global as any).window;\r\n\t\tquery = win.location.search.substring(1);\r\n\t}\r\n\tlet params: { [key: string]: string } = {};\r\n\tfor (; ;) {\r\n\t\tif (!query) break;\r\n\t\tlet match = search.exec(query);\r\n\t\tif (!match) break;\r\n\t\tparams[decode(match[1])] = decode(match[2]);\r\n\t}\r\n\r\n\tlet testing: boolean; // = isTesting();\r\n\tlet unit: number;\r\n\r\n\tlet sUnit = params['u'] || params['unit'];\r\n\tif (sUnit) {\r\n\t\tlet p = sUnit.indexOf('-');\r\n\t\tif (p >= 0) {\r\n\t\t\tlet tc = sUnit.charCodeAt(p + 1);\r\n\t\t\tconst tt = 'tT';\r\n\t\t\ttesting = tc === tt.charCodeAt(0) || tc === tt.charCodeAt(1);\r\n\t\t\tsUnit = sUnit.substr(0, p);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttesting = false;\r\n\t\t}\r\n\t\tif (sUnit[0] === '0') {\r\n\t\t\tunit = Number(sUnit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tunit = from62(sUnit);\r\n\t\t}\r\n\t\tif (isNaN(unit) === true) unit = undefined;\r\n\t}\r\n\telse {\r\n\t\t// 下面都是为了兼容以前的操作。\r\n\t\t// 整个url上，只要有test作为独立的字符串出现，就是testing\r\n\t\ttesting = /(\\btest\\b)/i.test(document.location.href);\r\n\t\tlet unitName: string;\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\tunitName = el.innerText;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tel = document.getElementById('unit.json');\r\n\t\t\tif (el) {\r\n\t\t\t\tlet json = el.innerHTML;\r\n\t\t\t\tif (json) {\r\n\t\t\t\t\tlet res = JSON.parse(json);\r\n\t\t\t\t\tunitName = res?.unit;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unitName) {\r\n\t\t\tunitName = process.env.REACT_APP_UNIT;\r\n\t\t}\r\n\r\n\t\tif (unitName) {\r\n\t\t\tunit = Number.parseInt(unitName);\r\n\t\t\tif (Number.isInteger(unit) === false) {\r\n\t\t\t\tif (unitName === '百灵威') {\r\n\t\t\t\t\tunit = 24;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unit) unit = 0;\r\n\t}\r\n\tlet lang: string, district: string;\r\n\tlet language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n\t\t|| navigator.language; // ||   // All browsers\r\n\t//navigator.userLanguage; // IE <= 10\r\n\tif (!language) {\r\n\t\tlang = 'zh';\r\n\t\tdistrict = 'CN';\r\n\t}\r\n\telse {\r\n\t\tlet parts = language.split('-');\r\n\t\tlang = parts[0];\r\n\t\tif (parts.length > 1) district = parts[1].toUpperCase();\r\n\t}\r\n\tlet timeZone = -new Date().getTimezoneOffset() / 60;\r\n\tconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n\t\t'BlackBerry|Windows Phone|' +\r\n\t\t'Opera Mini|IEMobile|Mobile',\r\n\t\t'i');\r\n\tconst isMobile = regEx.test(navigator.userAgent);\r\n\treturn { unit, testing, params, lang, district, timeZone, isMobile };\r\n}\r\n\r\nfunction detectBrowser() {\r\n\tlet nav = (global as any).navigator;\r\n\tif (!nav) return;\r\n\tif ((nav.userAgent.indexOf(\"Opera\") || navigator.userAgent.indexOf('OPR')) >= 0)\r\n\t\treturn 'Opera';\r\n\tif (nav.userAgent.indexOf(\"Chrome\") >= 0)\r\n\t\treturn 'Chrome';\r\n\tif (nav.userAgent.indexOf(\"Safari\") >= 0)\r\n\t\treturn 'Safari';\r\n\tif (nav.userAgent.indexOf(\"Firefox\") >= 0)\r\n\t\treturn 'Firefox';\r\n\tif ((nav.userAgent.indexOf(\"MSIE\") >= 0) || (!!(document as any).documentMode === true))\r\n\t\treturn 'IE'; //crap\r\n\treturn 'Unknown';\r\n}\r\n","import { env, resOptions, PageHeaderProps, PageWebNav, Tonwa, Nav } from 'tonwa-core';\r\nimport { t } from '../ui';\r\nimport { Page } from '../components';\r\n//import { nav } from '../nav';\r\nimport { VPage } from './VPage';\r\nimport { View } from './View';\r\nimport { AnnotationsMap, makeObservable, observable, runInAction } from 'mobx';\r\n// import { messageHub } from 'tonwa-core';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport interface WebNav<C extends Controller> {\r\n    VNavHeader?: new (controller: C) => View<C>;\r\n    VNavRawHeader?: new (controller: C) => View<C>;\r\n    VNavFooter?: new (controller: C) => View<C>;\r\n    VNavRawFooter?: new (controller: C) => View<C>;\r\n    renderPageHeader?: (props: PageHeaderProps<JSX.Element>) => JSX.Element;\r\n}\r\n\r\nexport abstract class Controller {\r\n    protected readonly tonwa: Tonwa;\r\n    protected nav: Nav;\r\n    protected res: any = {};\r\n    t = (str: string): string | JSX.Element => this.internalT(str) || str;\r\n    icon: string | JSX.Element;\r\n    label: string | JSX.Element;\r\n    readonly isDev: boolean = env.isDevelopment;\r\n    pageWebNav: PageWebNav<JSX.Element>;\r\n\r\n    constructor(tonwa: Tonwa) {\r\n        this.tonwa = tonwa;\r\n        this.nav = tonwa.nav;\r\n    }\r\n\r\n    shallow<T extends object>(data: T) {\r\n        let ret = makeObservable(data, this.buildReactiveProps(data, observable.shallow));\r\n        return ret;\r\n    }\r\n\r\n    deep<T extends object>(data: T) {\r\n        let ret = makeObservable(data, this.buildReactiveProps(data, observable));\r\n        return ret;\r\n    }\r\n\r\n    private buildReactiveProps<T extends object>(data: T, ob: any): AnnotationsMap<T, never> {\r\n        let ret: AnnotationsMap<T, never> = {};\r\n        for (let i in data) {\r\n            let v = data[i];\r\n            switch (typeof v) {\r\n                default:\r\n                    ob = observable;\r\n                    break;\r\n                case 'object':\r\n                case 'function':\r\n                    break;\r\n            }\r\n            (ret as any)[i] = ob;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    runInAction<T>(fn: () => T): T {\r\n        return runInAction(fn);\r\n    }\r\n\r\n    getTonwa() { return this.tonwa; }\r\n\r\n    protected beforeInit() { }\r\n    protected afterInit() { }\r\n\r\n    internalInit(...param: any[]) {\r\n        this.beforeInit();\r\n        this.init(...param);\r\n        this.pageWebNav = this.getPageWebNav();\r\n        this.afterInit();\r\n    }\r\n\r\n    init(...param: any[]) {\r\n    }\r\n\r\n    internalT(str: string): any {\r\n        return this.res?.[str] ?? t(str);\r\n    }\r\n\r\n    getPageWebNav(): PageWebNav { return undefined; }\r\n\r\n    setRes(res: any) {\r\n        if (res === undefined) return;\r\n        let { $lang, $district } = resOptions;\r\n        Object.assign(this.res, res);\r\n        if ($lang !== undefined) {\r\n            let l = res[$lang];\r\n            if (l !== undefined) {\r\n                Object.assign(this.res, l);\r\n                let d = l[$district];\r\n                if (d !== undefined) {\r\n                    Object.assign(this.res, d);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    getRes(): any { return this.res; }\r\n\r\n    protected async openVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C) => P, param?: any, afterBack?: (ret: any) => void): Promise<P> {\r\n        let ret = new vp((this as any) as C);\r\n        await ret.open(param, afterBack);\r\n        return ret;\r\n    }\r\n\r\n    protected async replaceVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C) => P, param?: any, afterBack?: (ret: any) => void): Promise<P> {\r\n        let ret = new vp((this as any) as C);\r\n        await ret.replaceOpen(param, afterBack);\r\n        return ret;\r\n    }\r\n\r\n    protected renderView<C extends Controller, V extends View<C>>(view: new (controller: C) => V, param?: any): JSX.Element {\r\n        let v = new view((this as any) as C);\r\n        return v.render(param);\r\n    }\r\n\r\n    async event(type: string, value: any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type: string, value: any) {\r\n    }\r\n\r\n    protected msg(text: string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header: string, err: any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string' ? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    openPage(page: JSX.Element, onClosePage?: (ret: any) => void) {\r\n        let disposer: () => void;\r\n        if (onClosePage !== undefined) {\r\n            disposer = () => {\r\n                //if (this.disposer) this.disposer();\r\n                onClosePage(undefined);\r\n            }\r\n        }\r\n\r\n        this.nav.push(page, disposer);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page: JSX.Element, onClosePage?: () => void) {\r\n        this.nav.replace(page, onClosePage);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        this.nav.back(false);\r\n    }\r\n\r\n    closePage(level?: number) {\r\n        this.nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?: number) {\r\n        this.nav.ceaseTop(level);\r\n    }\r\n\r\n    go(showPage: () => void, url: string, absolute?: boolean) {\r\n        this.go(showPage, url, absolute);\r\n    }\r\n\r\n    removeCeased() {\r\n        this.nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        this.nav.regConfirmClose(confirmClose);\r\n    }\r\n\r\n    private topPageKey: any;\r\n    protected startAction() {\r\n        this.topPageKey = this.nav.topKey();\r\n    }\r\n    get TopKey() {\r\n        return this.topPageKey;\r\n    }\r\n    SetTopKey(key: any) {\r\n        this.topPageKey = key;\r\n    }\r\n    public popToTopPage() {\r\n        this.nav.popTo(this.topPageKey);\r\n    }\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok' | 'yes' | 'no' | undefined> {\r\n        return new Promise<'ok' | 'yes' | 'no' | undefined>(async (resolve, reject) => {\r\n            let { caption, message, ok, yes, no, classNames } = options;\r\n            let close = (res: 'ok' | 'yes' | 'no' | undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons: any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary me-3\" onClick={() => close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success me-3\" onClick={() => close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger me-3\" onClick={() => close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            this.nav.regConfirmClose(async (): Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { PageWebNav } from 'tonwa-core';\r\n//import { PageHeaderProps } from './pageHeader';\r\n\r\nconst scrollAfter = 20; // 20ms之后，scroll执行\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop(): void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom(): void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e: any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n    onScrollBottom?: (scroller: Scroller) => Promise<void>;\r\n    className?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nconst scrollEdgeGap = 30;\r\nabstract class ScrollViewBase<T extends ScrollViewProps> extends React.Component<T, null> {\r\n    private bottomTime: number = 0;\r\n    private topTime: number = 0;\r\n    private div: HTMLDivElement;\r\n\r\n    protected refDiv = (div: HTMLDivElement) => {\r\n        if (!div) {\r\n            if (this.div) {\r\n                this.div.removeEventListener('resize', this.onResize)\r\n            }\r\n            return;\r\n        }\r\n        this.div = div;\r\n        this.div.addEventListener('resize', this.onResize);\r\n    }\r\n\r\n    private onResize = (ev: UIEvent) => {\r\n        console.error('div resize');\r\n    };\r\n\r\n    protected onScroll = async (e: any) => {\r\n        let { onScroll, onScrollTop, onScrollBottom } = this.props;\r\n        if (onScroll) onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < scrollEdgeGap) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime - this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n                    onScrollTop(scroller).then(ret => {\r\n                        // has more\r\n                        if (ret === true) {\r\n                            let sh = el.scrollHeight;\r\n                            let top = 200;\r\n                            if (top > sh) top = sh;\r\n                            el.scrollTop = top;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - scrollEdgeGap) {\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c: any, direct: 'top' | 'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let { _$scroll } = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n    }\r\n}\r\n\r\nexport class ScrollView extends ScrollViewBase<ScrollViewProps> {\r\n    render() {\r\n        let { className, style } = this.props;\r\n        return <div ref={this.refDiv} className=\"tv-page\"\r\n            onScroll={this.onScroll} style={style}>\r\n            <article className={className}>\r\n                {this.props.children}\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\ninterface WebNavScrollViewProps extends ScrollViewProps {\r\n    webNav: PageWebNav<JSX.Element>;\r\n}\r\n\r\nexport class WebNavScrollView extends ScrollViewBase<WebNavScrollViewProps> {\r\n    render() {\r\n        let { className, style, webNav } = this.props;\r\n        let { navHeader, navRawHeader, navFooter, navRawFooter } = webNav;\r\n        let vHeader: any, vFooter: any;\r\n        if (navRawHeader) vHeader = navRawHeader;\r\n        else if (navHeader) vHeader = <header><main>{navHeader}</main></header>\r\n        if (navRawFooter) vFooter = navRawFooter;\r\n        else if (navFooter) vFooter = <footer><main>{navFooter}</main></footer>\r\n\r\n        return <div ref={this.refDiv} className=\"tv-page-webnav\"\r\n            onScroll={this.onScroll} style={style}>\r\n            {vHeader}\r\n            <article className={className}>\r\n                {this.props.children}\r\n            </article>\r\n            {vFooter}\r\n        </div>;\r\n    }\r\n}\r\n","class _LocalStorage {\r\n    private ls: any;\r\n    constructor() {\r\n        this.ls = (global as any).localStorage;\r\n    }\r\n\r\n    getItem(key: string): string {\r\n        if (!this.ls) return null;\r\n        return this.ls?.getItem(key)\r\n    }\r\n    setItem(key: string, value: string) {\r\n        this.ls?.setItem(key, value);\r\n    }\r\n    removeItem(key: string) {\r\n        this.ls?.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    readonly key: string | number;\r\n\r\n    constructor(local: Local, key: string | number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get(): any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value: any) {\r\n        let t = JSON.stringify(value, (key, value) => {\r\n            if (key !== '_tuid') return value;\r\n        });\r\n        this.local.setItem(this.key, t);\r\n    }\r\n    remove(local?: Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key: string | number): LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key: string | number): LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key: string | number): LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: { [key: string]: LocalCache };\r\n    private readonly locals: { [key: string]: Local };\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key: string | number): string;\r\n    protected abstract keyForSet(key: string | number): string;\r\n    protected abstract keyForRemove(key: string | number): string;\r\n    abstract removeAll(): void;\r\n    getItem(key: string | number): string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key: string | number, value: string): void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key: string | number): void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key: string | number): LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key: string | number): LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local: Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key: string | number): LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] = ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null ? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key: number): string {\r\n        let i = this.index.indexOf(key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key: number): string {\r\n        let i = this.index.indexOf(key);\r\n        if (i < 0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key: number): string {\r\n        let i = this.index.indexOf(key);\r\n        if (i < 0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll(): void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index: number): LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: { [key: string]: number };\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p < 0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p + 1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i > this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls: string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key: number): string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key: number): string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key: string | number): string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll(): void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key: string): LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { env, PageWebNav } from 'tonwa-core';\r\nimport { Loading } from '../components';\r\nimport { FA } from '../components';\r\n\r\nexport interface Props {\r\n    onLogined: (isUserLogin?: boolean) => Promise<void>;\r\n    notLogined?: () => Promise<void>;\r\n    userPassword?: () => Promise<{ user: string; password: string }>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: () => Promise<boolean>;\r\n    disposer?: () => void;\r\n}\r\nexport interface NavViewState {\r\n    notSupportedBrowser: boolean;\r\n    stack: StackItem[];\r\n    wait: 0 | 1 | 2;\r\n}\r\n\r\nconst notSupportedBrowsers = ['IE'];\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n    isWebNav: boolean = false;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.stack = [];\r\n        let { browser } = env;\r\n        let notSupportedBrowser = notSupportedBrowsers.findIndex(v => v === browser) >= 0;\r\n        this.state = {\r\n            notSupportedBrowser,\r\n            stack: this.stack,\r\n            wait: 0,\r\n        };\r\n        //nav.set(this);\r\n    }\r\n    async componentDidMount() {\r\n        if (this.state.notSupportedBrowser === true) return;\r\n        window.addEventListener('popstate', this.navBack);\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n    /*\r\n        startWait() {\r\n            if (this.waitCount === 0) {\r\n                this.setState({ wait: 1 });\r\n                this.waitTimeHandler = env.setTimeout(\r\n                    'NavView.startWait',\r\n                    () => {\r\n                        this.waitTimeHandler = undefined;\r\n                        this.setState({ wait: 2 });\r\n                    },\r\n                    1000) as NodeJS.Timer;\r\n            }\r\n            ++this.waitCount;\r\n        }\r\n    \r\n        endWait() {\r\n            env.setTimeout(\r\n                undefined, //'NavView.endWait',\r\n                () => {\r\n                    --this.waitCount;\r\n                    if (this.waitCount === 0) {\r\n                        if (this.waitTimeHandler !== undefined) {\r\n                            env.clearTimeout(this.waitTimeHandler);\r\n                            this.waitTimeHandler = undefined;\r\n                        }\r\n                        this.setState({ wait: 0 });\r\n                    }\r\n                }, 100);\r\n        }\r\n    */\r\n    show(view: JSX.Element, disposer?: () => void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: () => void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view,\r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: () => void): number {\r\n        let item: StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view,\r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level: number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i = 0; i < level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level: number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length > 0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len - 1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey(): number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len - 1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (; ;) {\r\n            let p = this.stack.length - 1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let { disposer } = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n        if (item === undefined) return;\r\n        //if (nav.isRouting) {\r\n        //\twindow.history.back();\r\n        //}\r\n        let { disposer } = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer: () => void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len - 1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack: boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now() - tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm: boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({ type: 'pop-app' }, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len - 1];\r\n        if (confirm === true && top.confirmClose) {\r\n            if (await top.confirmClose() === true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?: string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n\r\n    render() {\r\n        const { notSupportedBrowser, wait } = this.state;\r\n        if (notSupportedBrowser === true) {\r\n            return <div className=\"p-3 text-danger\">\r\n                {env.browser} not supported !\r\n            </div>;\r\n        }\r\n        let { stack } = this.state;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        let test = env.testing === true &&\r\n            <span className=\"cursor-pointer position-fixed\" style={{ top: 0, left: '0.2rem', zIndex: 90001 }}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n            </span>;\r\n        return <>\r\n            {stack.map((item, index) => {\r\n                let { key, view } = item;\r\n                return <div key={key} style={index < top ? { visibility: 'hidden', position: 'absolute' } : undefined}>\r\n                    {view}\r\n                </div>\r\n            })}\r\n            {elWait}\r\n            {elError}\r\n            {test}\r\n        </>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({ stack: this.stack });\r\n    }\r\n\r\n    backIcon = <i className=\"fa fa-angle-left\" />;\r\n    closeIcon = <i className=\"fa fa-close\" />;\r\n\r\n    setIsWebNav(): void {\r\n        this.isWebNav = true;\r\n        this.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n        this.closeIcon = <i className=\"fa fa-close\" />;\r\n    }\r\n\r\n    pageWebNav: PageWebNav<JSX.Element>;\r\n\r\n    renderNavView(onLogined: any, onNotLogined?: any): JSX.Element {\r\n        throw new Error('renderNavView');\r\n    }\r\n}\r\n","import { resGlobal } from 'tonwa-core';\r\n\r\nexport function t(str: string): string | JSX.Element {\r\n\treturn resGlobal[str] || str;\r\n}\r\nexport type TFunc = (str: string | JSX.Element) => string | JSX.Element;\r\n","import { Login, Tonwa } from 'tonwa-core';\r\n\r\nexport async function createLogin(tonwa: Tonwa): Promise<Login> {\r\n\tlet importCLogin = await import('../auth/CLogin');\r\n\treturn new importCLogin.CLogin(tonwa);\r\n}\r\n\r\nexport async function showRegister(tonwa: Tonwa): Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CRegister(tonwa);\r\n\tc.start();\r\n}\r\n\r\nexport async function showForget(tonwa: Tonwa): Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CForget(tonwa);\r\n\tc.start();\r\n}\r\n","const digits = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\r\nconst c0 = digits.charCodeAt(0);\r\nconst c9 = digits.charCodeAt(9);\r\nconst A = digits.charCodeAt(10);\r\nconst Z = digits.charCodeAt(35);\r\nconst a = digits.charCodeAt(36);\r\nconst z = digits.charCodeAt(61);\r\nexport function from62(v:string):number {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'string') return Number.NaN;\r\n\tlet len = v.length;\r\n\tif (len === 0) return Number.NaN;\r\n\tlet ret = 0;\r\n\tfor (let i=0; i<len; i++) {\r\n\t\tlet c = v.charCodeAt(i);\r\n\t\tlet n:number;\r\n\t\tif (c < c0) return Number.NaN;\r\n\t\tif (c <= c9) {\r\n\t\t\tn = c - c0;\r\n\t\t}\r\n\t\telse if (c < A) {\r\n\t\t\treturn Number.NaN;\r\n\t\t} \r\n\t\telse if (c <= Z) {\r\n\t\t\tn = c - A + 10;\r\n\t\t}\r\n\t\telse if (c < a) {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\telse if (c <= z) {\r\n\t\t\tn = c - a + 36;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\tret *= 62;\r\n\t\tret += n;\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nexport function to62(v:number):string {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'number') return '';\r\n\tif (v < 0) return '';\r\n\tlet ret = '';\r\n\tfor (;;) {\r\n\t\tret = digits[v % 62] + ret;\r\n\t\tv = Math.floor(v / 62);\r\n\t\tif (v === 0) break;\r\n\t}\r\n\treturn ret;\r\n}\r\n","import * as React from 'react';\r\nimport { PageHeaderProps, tonwa } from 'tonwa-core';\r\n//import {nav} from '../../nav';\r\n\r\nexport function renderPageHeader(props: PageHeaderProps<JSX.Element>, inWebNav?: boolean) {\r\n\tlet onBack = async () => {\r\n\t\tawait tonwa.nav.back(false); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet { afterBack } = props;\r\n\t\tif (afterBack) afterBack();\r\n\t}\r\n\tlet onLogoutClick = () => {\r\n\t\tlet logout = async () => {\r\n\t\t\tlet { logout } = props;\r\n\t\t\tif (typeof logout === 'function') {\r\n\t\t\t\tawait logout();\r\n\t\t\t}\r\n\t\t\tawait tonwa.logout(undefined);\r\n\t\t}\r\n\t\ttonwa.showLogout(logout);\r\n\t}\r\n\r\n\tlet b = tonwa.nav.level > 1 || window.self !== window.top;\r\n\tlet { back, right, center, logout, className, ex } = props;\r\n\tif (inWebNav === true && !back && !right && !center) return;\r\n\tlet vBack: any, debugLogout: any;\r\n\tif (logout !== undefined && window.self === window.top) {\r\n\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t|| typeof logout === 'function') {\r\n\t\t\tlet { user } = tonwa;\r\n\t\t\tif (user !== undefined) {\r\n\t\t\t\tlet { nick, name } = user;\r\n\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t<div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (b) {\r\n\t\tswitch (props.back) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tvBack = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tcase 'back':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{tonwa.nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'close':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{tonwa.nav.closeIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (window.self !== window.top) {\r\n\t\tconsole.log(document.location.href);\r\n\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t}\r\n\tif (vBack === undefined && typeof center === 'string') {\r\n\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t}\r\n\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\tlet header = <header className={className}>\r\n\t\t<nav>\r\n\t\t\t{vBack}\r\n\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t<div>{center}</div>\r\n\t\t\t{rightView}\r\n\t\t</nav>\r\n\t\t{ex}\r\n\t</header>;\r\n\tif (inWebNav === true) return header;\r\n\treturn <>\r\n\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t{header}\r\n\t</>;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps<JSX.Element>> {\r\n\trender() { return renderPageHeader(this.props) }\r\n\t/*\r\n\tprivate back = async () => {\r\n\t\tawait nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n\t}\r\n\topenWindow() {\r\n\t\twindow.open(document.location.href);\r\n\t}\r\n\tprivate logoutClick = () => {\r\n\t\tnav.showLogout(this.logout);\r\n\t}\r\n\tprivate logout = async () => {\r\n\t\tlet {logout} = this.props;\r\n\t\tif (typeof logout === 'function') {\r\n\t\t\tawait logout(); \r\n\t\t}\r\n\t\tawait nav.logout(undefined);\r\n\t}\r\n\trender() {\r\n\t\tlet b = nav.level > 1 || window.self !== window.top;\r\n\t\tlet {right, center, logout, className, ex} = this.props;\r\n\t\tlet back:any, debugLogout:any;\r\n\t\tif (logout !== undefined && window.self === window.top) {\r\n\t\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t\t|| typeof logout === 'function')\r\n\t\t\t{\r\n\t\t\t\tlet {user} = nav;\r\n\t\t\t\tif (user !== undefined) {\r\n\t\t\t\t\tlet {nick, name} = user;\r\n\t\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t\t<div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\t\tonClick={this.logoutClick}>\r\n\t\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (b) {\r\n\t\t\tswitch (this.props.back) {\r\n\t\t\t\tcase 'none':\r\n\t\t\t\t\tback = undefined;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcase 'back':\r\n\t\t\t\t\tback = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'close':\r\n\t\t\t\t\tback = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (window.self !== window.top) {\r\n\t\t\tconsole.log(document.location.href);\r\n\t\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t\t}\r\n\t\tif (back === undefined && typeof center === 'string') {\r\n\t\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t\t}\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number> | number;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\tloaded: boolean = false;\r\n\tselected: boolean = false;\r\n\t\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number> | number;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n\tprivate _content: JSX.Element;\r\n\t\r\n\tconstructor() {\r\n\t\tmakeObservable(this, {\r\n\t\t\tloaded: observable, \r\n\t\t\tselected: observable, \r\n\t\t});\r\n\t}\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\trunInAction(() => {\r\n\t\t\t\t\tthis.loaded = true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string|JSX.Element, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\n//export const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    private sep: string;\r\n    selectedTab: Tab;\r\n    tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n\t\tmakeObservable(this, {\r\n\t\t\tselectedTab: observable, \r\n\t\t\ttabArr: observable,\r\n\t\t});\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabClick(this.selectedTab);\r\n\t\t}, 100);\t\t\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trunInAction(() => {\r\n\t\t\tthis.selectedTab.selected = false;\r\n\t\t\ttab.selected = true;\r\n\t\t\tthis.selectedTab = tab;\r\n\t\t});\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n\t\t\t\tcursor: 'pointer',\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = typeof notify === 'number'? notify : notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} \r\n\t\t\t\t\tstyle={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = React.createElement(this.tabs);\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import { capitalCase } from \"../tool\";\r\n//import { FieldItem, FieldUIType } from \"../../tonwa-react/ui\";\r\n\r\nexport function buildFieldItem(field: any, isKey: boolean): any/*FieldItem*/ {\r\n\tlet $FieldItemType: string, fieldItemType: string, widget: any/*FieldUIType*/;\r\n\tlet { name, type } = field;\r\n\tswitch (type) {\r\n\t\tcase 'id':\r\n\t\t\t$FieldItemType = 'FieldItemId';\r\n\t\t\tfieldItemType = 'id';\r\n\t\t\tbreak;\r\n\t\tcase 'char':\r\n\t\t\t$FieldItemType = 'FieldItemString';\r\n\t\t\tfieldItemType = 'string';\r\n\t\t\twidget = 'string';\r\n\t\t\tbreak;\r\n\t\tcase 'smallint':\r\n\t\tcase 'int':\r\n\t\tcase 'bigint':\r\n\t\t\t$FieldItemType = 'FieldItemInt';\r\n\t\t\tfieldItemType = 'integer';\r\n\t\t\twidget = 'updown';\r\n\t\t\tbreak;\r\n\t\tcase 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\t\t$FieldItemType = 'FieldItemNumber';\r\n\t\t\tfieldItemType = 'number';\r\n\t\t\twidget = 'number';\r\n\t\t\tbreak;\r\n\t}\r\n\treturn {\r\n\t\tname,\r\n\t\ttype: fieldItemType,\r\n\t\tisKey,\r\n\t\twidget,\r\n\t\tlabel: capitalCase(name),\r\n\t\t$FieldItemType,\r\n\t} /*as FieldItem*/;\r\n}\r\n","import { VPage } from '../vm';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VLogout extends VPage<CLogin> {\r\n\tprivate onLogout: () => void;\r\n\r\n\tinit(param: any) {\r\n\t\tthis.onLogout = param;\r\n\t}\r\n\theader() { return this.isWebNav === true ? false : '安全退出'; }\r\n\tfooter() {\r\n\t\treturn <div className=\"mt-5 text-center justify-content-center\">\r\n\t\t\t<button className=\"btn btn-outline-warning\" onClick={this.tonwa.resetAll}>升级软件</button>\r\n\t\t</div>;\r\n\t}\r\n\tprotected get back(): 'close' | 'back' | 'none' { return 'close' }\r\n\tcontent() {\r\n\t\treturn <div className=\"m-5 border border-info bg-white rounded-3 p-5 text-center\">\r\n\t\t\t<div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<button className=\"btn btn-danger\" onClick={this.onLogout}>安全退出</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, StringSchema, Ax } from '../components';\r\nimport { defaultLoginTop, getSender } from './tools';\r\nimport { CLogin } from './CLogin';\r\nimport { VPage } from '../vm';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nconst schema: Schema = [\r\n\t{ name: 'username', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n\t{ name: 'password', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n\t{ name: 'login', type: 'submit' },\r\n];\r\n\r\nexport class VLogin extends VPage<CLogin> {\r\n\tprivate onLogin: (un: string, pwd: string) => Promise<boolean>;\r\n\tprivate withBack: boolean;\r\n\r\n\tinit({ onLogin, withBack }: { onLogin: (un: string, pwd: string) => Promise<boolean>; withBack: boolean; }) {\r\n\t\tthis.onLogin = onLogin;\r\n\t\tthis.withBack = withBack;\r\n\t}\r\n\r\n\tprivate uiSchema: UiSchema = {\r\n\t\titems: {\r\n\t\t\tusername: { placeholder: '手机/邮箱/用户名', label: '登录账号' } as UiTextItem,\r\n\t\t\tpassword: { widget: 'password', placeholder: '密码', label: '密码' } as UiPasswordItem,\r\n\t\t\tlogin: { widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录' } as UiButton,\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onSubmit = async (name: string, context: Context): Promise<string> => {\r\n\t\tlet values = context.form.data;\r\n\t\tlet un = values['username'];\r\n\t\tlet pwd = values['password'];\r\n\t\tif (pwd === undefined) {\r\n\t\t\treturn 'something wrong, pwd is undefined';\r\n\t\t}\r\n\t\tlet ret = await this.onLogin(un, pwd);\r\n\t\tif (ret === true) return;\r\n\r\n\t\tlet sender = getSender(un);\r\n\t\tlet type: string = sender !== undefined ? sender.caption : '用户名';\r\n\t\treturn type + '或密码错！';\r\n\t}\r\n\tprivate onEnter = async (name: string, context: Context): Promise<string> => {\r\n\t\tif (name === 'password') {\r\n\t\t\treturn await this.onSubmit('login', context);\r\n\t\t}\r\n\t}\r\n\r\n\theader() {\r\n\t\tif (this.withBack === true) {\r\n\t\t\treturn '登录';\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontent() {\r\n\t\treturn <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"w-20c\">\r\n\t\t\t\t{this.tonwa.loginTop(defaultLoginTop)}\r\n\t\t\t\t<div className=\"h-2c\" />\r\n\t\t\t\t<Form schema={schema} uiSchema={this.uiSchema}\r\n\t\t\t\t\tonButtonClick={this.onSubmit}\r\n\t\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\t\trequiredFlag={false} />\r\n\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t<Ax className=\"btn btn-link\" href=\"/forget\">\r\n\t\t\t\t\t\t忘记密码\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t\t<Ax href=\"/register\" className=\"btn btn-link\">\r\n\t\t\t\t\t\t注册账号\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t</div>\r\n\t\t\t\t{tonwa.privacyEntry()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { VPage } from '../vm';\r\nimport { Page, Form, ItemSchema, UiSchema, StringSchema, UiPasswordItem, Context, ButtonSchema, UiButton } from '../components';\r\n//import { CenterAppApi } from '../net';\r\nimport { CLogin } from './CLogin';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nexport class VChangePassword extends VPage<CLogin> {\r\n    private schema: ItemSchema[] = [\r\n        { name: 'orgPassword', type: 'string', maxLength: 60, required: true } as StringSchema,\r\n        { name: 'newPassword', type: 'string', maxLength: 60, required: true } as StringSchema,\r\n        { name: 'newPassword1', type: 'string', maxLength: 60, required: true } as StringSchema,\r\n        { name: 'submit', type: 'submit' } as ButtonSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            orgPassword: {\r\n                widget: 'password',\r\n                label: '原密码',\r\n                placeholder: '输入原来的密码'\r\n            } as UiPasswordItem,\r\n            newPassword: {\r\n                widget: 'password',\r\n                label: '新密码',\r\n                placeholder: '输入新设的密码'\r\n            } as UiPasswordItem,\r\n            newPassword1: {\r\n                widget: 'password',\r\n                label: '确认密码',\r\n                placeholder: '再次输入新设密码'\r\n            } as UiPasswordItem,\r\n            submit: {\r\n                widget: 'button',\r\n                label: '提交',\r\n                className: 'btn btn-primary'\r\n            } as UiButton,\r\n        }\r\n    };\r\n\r\n    private onChange: (orgPassword: string, newPassword: string) => Promise<boolean>\r\n    init(onChange: (orgPassword: string, newPassword: string) => Promise<boolean>) {\r\n        this.onChange = onChange;\r\n    }\r\n\r\n    private onSubmit = async (name: string, context: Context): Promise<any> => {\r\n        let { orgPassword, newPassword, newPassword1 } = context.data;\r\n        if (newPassword !== newPassword1) {\r\n            context.setError('newPassword1', '新密码错误，请重新输入');\r\n            return;\r\n        }\r\n        //let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        //let ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n        let ret = await this.onChange(orgPassword, newPassword);\r\n        if (ret === false) {\r\n            context.setError('orgPassword', '原密码错误');\r\n            return;\r\n        }\r\n        tonwa.nav.replace(<Page header=\"修改密码\" back=\"close\">\r\n            <div className=\"m-3  text-success\">\r\n                密码修改成功！\r\n            </div>\r\n        </Page>);\r\n        return;\r\n    }\r\n\r\n    header() { return '修改密码' }\r\n\r\n    content() {\r\n        return <Form\r\n            className=\"m-3\"\r\n            schema={this.schema}\r\n            uiSchema={this.uiSchema}\r\n            onButtonClick={this.onSubmit}\r\n            fieldLabelSize={2} />\r\n    }\r\n}\r\n","import { CLogin } from \"./CLogin\";\r\nimport { VPage } from \"../vm\";\r\nimport { CenterAppApi } from \"tonwa-uq\";\r\n\r\nconst waitingTime = '一小时';\r\n\r\nabstract class VUserQuitBase extends VPage<CLogin> {\r\n    protected abstract get note(): any;\r\n    protected get button1Caption(): string { return undefined; }\r\n    protected get button2Caption(): string { return undefined; }\r\n    protected renderButton1(): JSX.Element {\r\n        let caption = this.button1Caption;\r\n        if (caption === null) return null;\r\n        return <button className=\"btn btn-primary\" onClick={() => this.onClickButton1()}>\r\n            {caption ?? '不注销'}\r\n        </button>;\r\n    }\r\n    protected renderButton2(): JSX.Element {\r\n        let caption = this.button2Caption;\r\n        if (caption === null) return null;\r\n        return <button className=\"btn btn-outline-info ms-3\" onClick={() => this.onClickButton2()}>\r\n            {caption ?? '确认注销'}\r\n        </button>;\r\n    }\r\n    header() { return '注销账号' }\r\n    content() {\r\n        return <div className=\"border border-danger rounded mx-auto m-3 w-max-30c bg-white \">\r\n            <div className=\"p-4 border-bottom\">{this.note}</div>\r\n            <div className=\"p-3 text-center\">\r\n                {this.renderButton1()}\r\n                {this.renderButton2()}\r\n            </div>\r\n        </div>\r\n    }\r\n\r\n    protected onClickButton1() {\r\n        this.closePage();\r\n    }\r\n\r\n    protected onClickButton2() {\r\n    }\r\n}\r\n\r\nexport class VUserQuit extends VUserQuitBase {\r\n    protected get note(): any {\r\n        return <>\r\n            注意：账号注销后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。<br />\r\n            请确认！\r\n        </>;\r\n    }\r\n    protected get button2Caption(): string { return '我已了解，仍然注销'; }\r\n\r\n    protected onClickButton2() {\r\n        this.openVPage(VQuitConfirm);\r\n    }\r\n}\r\n\r\nclass VQuitConfirm extends VUserQuitBase {\r\n    protected get note(): any {\r\n        return <>\r\n            账号注销后，如果在{waitingTime}内容重新登录账号，账号自动恢复。\r\n            {waitingTime}之后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。<br />\r\n            请再次确认！\r\n        </>;\r\n    }\r\n    protected get button2Caption(): string { return '确认注销'; }\r\n\r\n    protected onClickButton1() {\r\n        this.closePage(2);\r\n    }\r\n\r\n    protected async onClickButton2() {\r\n        let centerAppApi = new CenterAppApi(this.controller.net, 'tv/');\r\n        await centerAppApi.userQuit();\r\n        this.openVPage(VQuitDone);\r\n    }\r\n}\r\n\r\nclass VQuitDone extends VUserQuitBase {\r\n    header() { return '注销已账号' }\r\n    protected get back(): 'close' | 'back' | 'none' { return 'none' }\r\n    protected get note(): any {\r\n        return <>\r\n            账号将在{waitingTime}后彻底注销。<br />\r\n            如果在{waitingTime}内容重新登录账号，注销操作自动取消。\r\n            {waitingTime}之后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。\r\n        </>;\r\n    }\r\n    protected get button1Caption(): string { return '退出'; }\r\n    protected get button2Caption(): string { return null; }\r\n    protected onClickButton1() {\r\n        this.tonwa.logout();\r\n    }\r\n}\r\n","import { User, CenterAppApi } from 'tonwa-uq';\r\nimport { Login } from 'tonwa-core';\r\nimport { ControllerWithWeb, VPage } from \"../vm\";\r\nimport { VLogout } from './VLogout';\r\nimport { VLogin } from './VLogin';\r\nimport { VChangePassword } from './VChangePassword';\r\nimport { VUserQuit } from './VUserQuit';\r\n\r\nexport class CLogin extends ControllerWithWeb implements Login {\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync showLogin(callback?: (user: User) => Promise<void>, withBack?: boolean): Promise<void> {\r\n\t\tlet onLogin = async (un: string, pwd: string): Promise<boolean> => {\r\n\t\t\tlet user = await this.net.userApi.login({\r\n\t\t\t\tuser: un,\r\n\t\t\t\tpwd: pwd,\r\n\t\t\t\tguest: this.tonwa.guest,\r\n\t\t\t});\r\n\r\n\t\t\tif (user === undefined) return false;\r\n\t\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n\t\t\tawait this.tonwa.userLogined(user, callback);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.openVPage(VLogin, { onLogin, withBack });\r\n\t}\r\n\r\n\tasync showLogout(callback?: () => Promise<void>) {\r\n\t\tthis.openVPage(VLogout, () => {\r\n\t\t\tthis.tonwa.logout(callback);\r\n\t\t});\r\n\t}\r\n\t/*\r\n\tasync showRegister() {\r\n\t\tlet cRegister = new (await import('./register')).CRegister(this.res);\r\n\t\tawait cRegister.start();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet cForget = new (await import('./register')).CForget(this.res);\r\n\t\tawait cForget.start();\r\n\t}\r\n\t*/\r\n\r\n\tprotected getVChangePassword(): new (cLogin: CLogin) => VPage<CLogin> {\r\n\t\treturn VChangePassword;\r\n\t}\r\n\tasync showChangePassword() {\r\n\t\tlet vPage = this.getVChangePassword();\r\n\t\tthis.openVPage(vPage, async (orgPassword: string, newPassword: string): Promise<boolean> => {\r\n\t\t\tlet centerAppApi = new CenterAppApi(this.net, 'tv/');\r\n\t\t\tlet ret = await centerAppApi.changePassword({ orgPassword, newPassword });\r\n\t\t\treturn ret;\r\n\t\t});\r\n\t}\r\n\r\n\tasync showUserQuit(): Promise<void> {\r\n\t\tthis.openVPage(VUserQuit);\r\n\t}\r\n}\r\n","export default __webpack_public_path__ + \"static/media/logo.2d27ead7.svg\";","import { mobileRegex, emailRegex } from 'tonwa-core';\r\nimport logo from '../img/logo.svg';\r\n\r\nexport const defaultLoginTop = <div className=\"d-flex align-items-center position-relative\">\r\n    <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\r\n    <div className=\"h3 flex-fill text-center\"><span className=\"text-primary me-3\">同</span>\r\n        <span className=\"text-danger\">花</span>\r\n    </div>\r\n</div>;\r\n\r\ninterface Sender {\r\n    type: string;\r\n    caption: string;\r\n    regex: RegExp;\r\n}\r\n\r\nconst senders: Sender[] = [\r\n    { type: 'mobile', caption: '手机号', regex: mobileRegex },\r\n    { type: 'email', caption: '邮箱', regex: emailRegex }\r\n];\r\n\r\nexport function getSender(un: string): Sender {\r\n    let sender = senders.find(v => v.regex.test(un) === true);\r\n    return sender;\r\n}","const rootCenterHost = 'https://tv.jkchemical.com';\r\nconst centerHost = process.env['REACT_APP_CENTER_HOST'] ?? rootCenterHost;\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = centerHost ?? rootCenterHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n    local: boolean;\r\n}\r\nconst hosts: { [name: string]: HostValue } = {\r\n    centerhost: {\r\n        value: /*process.env['REACT_APP_CENTER_DEBUG_HOST']*/ undefined || centerDebugHost,\r\n        local: false,\r\n    },\r\n    reshost: {\r\n        value: /*process.env['REACT_APP_RES_DEBUG_HOST']*/ undefined || resDebugHost,\r\n        local: false,\r\n    },\r\n    uqhost: {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_HOST']*/ undefined || uqDebugHost,\r\n        local: false,\r\n    },\r\n    unitxhost: {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_HOST']*/ undefined || uqDebugHost,\r\n        local: false,\r\n    },\r\n    \"uq-build\": {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST']*/ undefined || uqDebugBuilderHost,\r\n        local: false,\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url: string): boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host: string): string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host: string): string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host: string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length - 1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host: string) {\r\n    if (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nexport class Host {\r\n    static createHost(isDevelopment: boolean): Host {\r\n        if (isDevelopment === true) return new HostForDeveloping();\r\n        return new Host();\r\n    }\r\n\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n    hash: string;\r\n\r\n    async start(testing: boolean) {\r\n        if (!centerHost) debugger;\r\n        let doc = (global as any).document;\r\n        if (doc) {\r\n            this.hash = doc.location.hash;\r\n        }\r\n        else {\r\n            this.hash = '';\r\n        }\r\n        this.testing = testing;\r\n        await this.tryLocal();\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n        this.resHost = this.getResHost();\r\n    }\r\n\r\n    protected async tryLocal() { }\r\n\r\n    protected getCenterHost(): string {\r\n        let { value } = hosts.centerhost;\r\n        if (this.hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    protected getResHost(): string {\r\n        let { value } = hosts.reshost;\r\n        if (this.hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url: string, debugHost: string = 'uqhost'): string {\r\n        return url;\r\n    }\r\n\r\n    getUrlOrTest(db: string, url: string, urlTest: string): string {\r\n        if (!urlTest) {\r\n            urlTest = url;\r\n            if (!urlTest) {\r\n                console.error('no server set for ' + db);\r\n                debugger;\r\n            }\r\n        }\r\n        else if (!url) {\r\n            url = urlTest;\r\n        }\r\n        let testProd: string;\r\n        if (this.testing === true) {\r\n            if (urlTest !== '-') url = urlTest;\r\n            testProd = 'test';\r\n        }\r\n        else {\r\n            testProd = 'prod';\r\n        }\r\n        url = this.getUrlOrDebug(url);\r\n        if (url.endsWith('/') === false) {\r\n            url += '/';\r\n        }\r\n        return `${url}uq/${testProd}/${db}/`;\r\n    }\r\n\r\n    async localCheck(urlDebug: string): Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\nclass HostForDeveloping extends Host {\r\n    private debugHostUrl(host: string) { return `http://${host}/hello` }\r\n    protected async tryLocal() {\r\n        let promises: PromiseLike<any>[] = [];\r\n        let hostArr: string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let { value } = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i = 0; i < len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected getCenterHost(): string {\r\n        let { value, local } = hosts.centerhost;\r\n        if (this.hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (local === true) return value;\r\n        return centerHost;\r\n    }\r\n\r\n    protected getResHost(): string {\r\n        let { value, local } = hosts.reshost;\r\n        if (this.hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (local === true) return value;\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url: string, debugHost: string = 'uqhost'): string {\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let { value, local } = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n}\r\n\r\n//export const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 2000;\r\n\r\nfunction fetchLocalCheck(url: string): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        fetch(url, fetchOptions as any)\r\n            .then(v => {\r\n                v.text().then(resolve).catch(reject);\r\n            })\r\n            .catch(reject);\r\n        const e = new Error(\"Connection timed out\");\r\n        setTimeout(reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url: string): Promise<boolean> {\r\n    try {\r\n        await fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","export interface KeyValueRes {\r\n    [key: string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang: string]: T | { [district: string]: T };\r\n}\r\n\r\nexport const resOptions: {\r\n    lang: string;\r\n    $lang: string;\r\n    district: string;\r\n    $district: string;\r\n} = {\r\n    lang: undefined,\r\n    $lang: undefined,\r\n    district: undefined,\r\n    $district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang: string, district: string) {\r\n    resOptions.lang = lang;\r\n    resOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function () {\r\n    let nav = (global as any).navigator;\r\n    if (!nav) return;\r\n    let lang: string, district: string;\r\n    let language = (nav.languages && nav.languages[0])  // Chrome / Firefox\r\n        || nav.language; // ||   // All browsers\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res: Res<T>): T {\r\n    let { lang, district } = resOptions;\r\n    let ret: T = {} as T;\r\n    if (res === undefined) return ret;\r\n    Object.assign(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    Object.assign(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    Object.assign(ret, d);\r\n    let { entity } = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nexport const resGlobal: any = {};\r\nexport function setRes(target: any, res: any): (str: string) => any {\r\n    if (res === undefined) return;\r\n    let { $lang, $district } = resOptions;\r\n    Object.assign(target, res);\r\n    if ($lang !== undefined) {\r\n        let l = res[$lang];\r\n        if (l !== undefined) {\r\n            Object.assign(target, l);\r\n            let d = l[$district];\r\n            if (d !== undefined) {\r\n                Object.assign(target, d);\r\n            }\r\n        }\r\n    }\r\n    return function (str: string) {\r\n        return target[str] || str;\r\n    }\r\n}\r\nexport function setGlobalRes(res: any) {\r\n    setRes(resGlobal, res);\r\n}\r\n/*\r\nexport function t(str:string):string|JSX.Element {\r\n    return resGlobal[str] || str;\r\n}\r\nexport type TFunc = (str:string|JSX.Element) => string|JSX.Element;\r\n*/\r\n\r\n","import fs from \"fs\";\r\nimport { capitalCase } from \"../tool\";\r\nimport { Entity, ID, IDX, IX, UqMan } from \"../uqCore\";\r\nimport { TsUQ } from \"./TsUQ\";\r\nimport { buildFieldItem } from \"./buildFieldItem\";\r\nimport { overrideTsFile, saveTsFileIfNotExists } from \"./tools\";\r\nimport { UqBuildContext } from \"./UqBuildContext\";\r\n\r\ninterface FieldItem {\r\n\tname: string;\r\n};\r\n\r\ninterface ReplaceSection {\r\n\tbegin: string;\r\n\tend: string;\r\n\tcontent: string;\r\n};\r\n\r\nconst fieldItemReplaceProps = ['label', 'placeholder', 'widget', 'type'];\r\n\r\nexport class TsUqFolder {\r\n\tprivate buildContext: UqBuildContext;\r\n\tprivate readonly uq: UqMan;\r\n\tprivate readonly uqsFolder: string;\r\n\tprivate readonly uqAlias: string;\r\n\r\n\tconstructor(buildContext: UqBuildContext, uq: UqMan, uqsFolder: string, uqAlias: string) {\r\n\t\tthis.buildContext = buildContext;\r\n\t\tthis.uq = uq;\r\n\t\tthis.uqsFolder = uqsFolder;\r\n\t\tthis.uqAlias = uqAlias;\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tlet uqFolder = this.uqsFolder + '/' + this.uqAlias;\r\n\t\tif (fs.existsSync(uqFolder) === false) {\r\n\t\t\tfs.mkdirSync(uqFolder);\r\n\t\t}\r\n\t\tlet tsUq = this.buildContext.tsTemplate.tsHeader;\r\n\t\tlet tsUqBuilder = new TsUQ(this.buildContext, this.uq, this.uqAlias);\r\n\t\t//tsUq += buildUQ(this.uq, this.uqAlias);\r\n\t\ttsUq += tsUqBuilder.build();\r\n\t\toverrideTsFile(`${uqFolder}/${this.uqAlias}.ts`, tsUq);\r\n\t\tthis.saveTuidAndIDTsIndexAndRender(uqFolder);\r\n\t}\r\n\r\n\tprivate saveTuidAndIDTsIndexAndRender(uqFolder: string) {\r\n\t\tlet imports = '', sets = '';\r\n\t\tlet { idArr, idxArr, tuidArr } = this.uq;  // ixArr, \r\n\t\tlet coll: { [name: string]: Entity } = {};\r\n\r\n\t\tfor (let i of tuidArr) {\r\n\t\t\tlet { sName } = i;\r\n\t\t\tcoll[sName.toLowerCase()] = i;\r\n\t\t\tlet cName = capitalCase(sName);\r\n\t\t\tif (cName[0] === '$') continue;\r\n\t\t\timports += `\\nimport * as ${cName} from './${cName}.ui';`;\r\n\t\t\tsets += `\\n\tassign(uq, '${cName}', ${cName});`;\r\n\r\n\t\t\tlet tsUI = `/* eslint-disable */\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-${this.buildContext.uiPlatform}';\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { uqStringify } from \"tonwa-uq\";\r\nimport { Res, setRes } from \"tonwa-core\";\r\nimport { Tuid${cName} } from \"./${this.uqAlias}\";\r\n\r\nconst resRaw: Res<any> = {\r\n\t$zh: {\r\n\t},\r\n\t$en: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|${this.buildContext.element}): string|${this.buildContext.element} => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: Tuid${cName}):${this.buildContext.element} {\r\n\treturn <>{uqStringify(item)}</>;\r\n};\r\n`;\r\n\r\n\t\t\tlet path = `${uqFolder}/${cName}.ui.tsx`;\r\n\t\t\tsaveTsFileIfNotExists(path, tsUI);\r\n\t\t}\r\n\r\n\t\tfor (let i of [...idArr, ...idxArr]) { // , ...ixArr IX does not need UI\r\n\t\t\tlet { sName } = i;\r\n\t\t\t//coll[sName.toLowerCase()] = i;\r\n\t\t\tlet cName = capitalCase(sName);\r\n\t\t\tif (cName[0] === '$') continue;\r\n\t\t\tcoll[cName.toLocaleLowerCase()] = i;\r\n\t\t\timports += `\\nimport * as ${cName} from './${cName}.ui';`;\r\n\t\t\tsets += `\\n\tassign(uq, '${cName}', ${cName});`;\r\n\r\n\t\t\tlet tsUI = `// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-${this.buildContext.uiPlatform}';\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\r\nimport { ${cName} } from \"./${this.uqAlias}\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"${cName}\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\t$zh: {\r\n\t},\r\n\t$en: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|${this.buildContext.element}): string|${this.buildContext.element} => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: ${cName}):${this.buildContext.element} {\r\n\treturn <>{uqStringify(item)}</>;\r\n};\r\n`;\r\n\r\n\t\t\tlet path = `${uqFolder}/${cName}.ui.tsx`;\r\n\t\t\tsaveTsFileIfNotExists(path, tsUI);\r\n\r\n\t\t\tlet fields = this.buildFields(i);\r\n\t\t\tlet tsFieldArr: string = this.buildFieldArr(i);\r\n\r\n\t\t\tthis.replaceTsFileFields(path, fields);\r\n\t\t\tlet tsImportFieldItemsBegin = 'import { FieldItem, ';\r\n\t\t\tlet tsImportFieldItemsEnd = ` } from \"tonwa-${this.buildContext.uiPlatform}\";`;\r\n\t\t\tlet tsImportFieldItems = 'FieldItemInt, FieldItemNumber, FieldItemString, FieldItemId';\r\n\t\t\tthis.replaceTsFileString(path,\r\n\t\t\t\t{\r\n\t\t\t\t\tbegin: tsImportFieldItemsBegin,\r\n\t\t\t\t\tend: tsImportFieldItemsEnd,\r\n\t\t\t\t\tcontent: tsImportFieldItemsBegin + tsImportFieldItems + tsImportFieldItemsEnd,\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t\tthis.replaceTsFileString(path,\r\n\t\t\t\t{ begin: '\\nconst fieldArr: FieldItem[] = [\\n', end: '\\n];\\n', content: tsFieldArr }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlet tsIndex = `import { UqExt as Uq, assign } from './${this.uqAlias}';${imports}\r\n\t\r\nexport function setUI(uq: Uq) {${sets}\r\n}\r\nexport * from './${this.uqAlias}';\r\n`;\r\n\t\toverrideTsFile(`${uqFolder}/index.ts`, tsIndex);\r\n\r\n\t\tlet files = fs.readdirSync(uqFolder);\r\n\t\tconst suffix = '.ui.tsx';\r\n\t\tfor (let file of files) {\r\n\t\t\tif (file.endsWith(suffix) === false) continue;\r\n\t\t\tlet from = file.length - suffix.length;\r\n\t\t\tlet fileEntityName = file.substring(0, from);\r\n\t\t\tlet entity = coll[fileEntityName.toLocaleLowerCase()];\r\n\t\t\tif (entity === undefined || fileEntityName[0] === '$') {\r\n\t\t\t\tlet unFile = `${uqFolder}/${file}`;\r\n\t\t\t\tfs.unlinkSync(unFile);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildFields(i: ID | IDX | IX): { [name: string]: FieldItem } {\r\n\t\tswitch (i.typeName) {\r\n\t\t\tcase 'id': return this.buildIDFields(i as ID);\r\n\t\t\tcase 'idx': return this.buildIDXFields(i);\r\n\t\t\tcase 'ix': return this.buildIXFields(i);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate buildIDFields(ID: ID): { [name: string]: FieldItem } {\r\n\t\tlet ret: { [name: string]: FieldItem } = {};\r\n\t\tlet { schema } = ID;\r\n\t\tlet { keys, fields } = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate buildIDXFields(IDX: IDX): { [name: string]: FieldItem } {\r\n\t\tlet ret: { [name: string]: FieldItem } = {};\r\n\t\tlet { schema } = IDX;\r\n\t\tlet { keys, fields } = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tprivate buildIXFields(IX: IX): { [name: string]: FieldItem } {\r\n\t\tlet ret: { [name: string]: FieldItem } = {};\r\n\t\tlet { schema } = IX;\r\n\t\tlet { keys, fields } = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tprivate buildFieldArr(i: ID | IDX | IX): string {\r\n\t\tlet ts = '\\nconst fieldArr: FieldItem[] = [\\n\\t';\r\n\t\tswitch (i.typeName) {\r\n\t\t\tcase 'id': ts += this.buildIDFieldArr(i as ID); break;\r\n\t\t\tcase 'idx': ts += this.buildIDXFieldArr(i); break;\r\n\t\t\tcase 'ix': ts += this.buildIXFieldArr(i); break;\r\n\t\t}\r\n\t\treturn ts += '\\n];\\n';\r\n\t}\r\n\r\n\tprivate buildIDFieldArr(i: ID): string {\r\n\t\tlet { schema } = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDXFieldArr(i: IDX): string {\r\n\t\tlet { schema } = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIXFieldArr(i: IX): string {\r\n\t\tlet { schema } = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'ix') continue;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate replaceTsFileFields(path: string, fields: { [name: string]: FieldItem }) {\r\n\t\tlet text = fs.readFileSync(path).toString();\r\n\t\tlet startStr = '\\n/*--fields--*/';\r\n\t\tlet endStr = '\\n/*==fields==*/\\n';\r\n\t\tlet start = text.indexOf(startStr);\r\n\t\tif (start > 0) {\r\n\t\t\tlet end = text.indexOf(endStr, start + startStr.length);\r\n\t\t\tif (end > 0) {\r\n\t\t\t\tlet lBrace = text.indexOf('{', start + startStr.length);\r\n\t\t\t\tlet rBrace = text.lastIndexOf('}', end);\r\n\t\t\t\tlet oldText = text.substring(lBrace, rBrace + 1);\r\n\t\t\t\tlet fieldsText = this.buildFieldsFromOldText(fields, oldText);\r\n\t\t\t\ttext = text.substring(0, start)\r\n\t\t\t\t\t+ startStr + '\\nconst fields = {'\r\n\t\t\t\t\t+ fieldsText\r\n\t\t\t\t\t+ '\\n};'\r\n\t\t\t\t\t+ text.substring(end);\r\n\t\t\t\tfs.writeFileSync(path, text);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildFieldsFromOldText(fields: { [name: string]: FieldItem }, oldText: string): string {\r\n\t\tlet ret = '';\r\n\t\tfor (let i in fields) {\r\n\t\t\tlet field = fields[i];\r\n\t\t\tthis.setFieldOldProp(field, oldText);\r\n\t\t\tret += this.buildFieldText(field);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate setFieldOldProp(field: FieldItem, text: string) {\r\n\t\tlet fieldStart = field.name + ':';\r\n\t\tlet start = text.indexOf('\\t' + fieldStart);\r\n\t\tif (start < 0) start = text.indexOf('\\n' + fieldStart);\r\n\t\tif (start < 0) start = text.indexOf(' ' + fieldStart);\r\n\t\tif (start < 0) return;\r\n\t\t++start;\r\n\t\tlet end = text.indexOf('}', start + fieldStart.length);\r\n\t\tif (end < 0) return;\r\n\t\tlet fieldText = text.substring(start + fieldStart.length, end + 1);\r\n\t\t/* eslint no-eval: 0 */\r\n\t\tlet obj = eval('(' + fieldText + ')');\r\n\t\tfieldItemReplaceProps.forEach(v => {\r\n\t\t\tlet prop = obj[v];\r\n\t\t\tif (!prop) return;\r\n\t\t\tif (v === 'type') return; // 这个是由新的schema决定的\r\n\t\t\t(field as any)[v] = prop;\r\n\t\t});\r\n\t}\r\n\r\n\tprivate buildFieldText(field: FieldItem): string {\r\n\t\tlet { $FieldItemType } = field as any;\r\n\t\tdelete (field as any).$FieldItemType;\r\n\t\tlet ret = '\\n\\t' + field.name + ': ';\r\n\t\tlet json = JSON.stringify(field, null, '\\t\\t');\r\n\t\tjson = json.replace('}', '\\t}');\r\n\t\tret += json;\r\n\t\treturn ret + ' as ' + $FieldItemType + ',';\r\n\t}\r\n\r\n\tprivate replaceTsFileString(path: string, sec: ReplaceSection) {\r\n\t\tlet text = fs.readFileSync(path).toString();\r\n\t\tlet { begin, end, content } = sec;\r\n\t\tlet b = text.indexOf(begin);\r\n\t\tif (b < 0) return;\r\n\t\tlet e = text.indexOf(end, b + begin.length - 1);\r\n\t\tif (e < 0) return;\r\n\t\ttext = text.substring(0, b) + content + text.substr(e + end.length);\r\n\t\tfs.writeFileSync(path, text);\r\n\t}\r\n}\r\n","import { UqBuildContext } from \"./UqBuildContext\";\r\nimport { camelCase, capitalCase } from \"../tool\";\r\nimport {\r\n\tUqMan, Action, Book, Query, Sheet\r\n\t, Tuid, UqEnum, Map, History, Pending\r\n\t, Entity, ID, IX, IDX, ArrFields, Field\r\n} from '../uqCore';\r\nimport { entityName } from \"./tools\";\r\n\r\nconst fieldTypeMap: { [type: string]: string } = {\r\n\t\"char\": \"string\",\r\n\t\"text\": \"string\",\r\n\t\"id\": \"number\",\r\n\t\"textid\": \"string\",\r\n\t\"int\": \"number\",\r\n\t\"bigint\": \"number\",\r\n\t\"smallint\": \"number\",\r\n\t\"tinyint\": \"number\",\r\n\t\"dec\": \"number\",\r\n\t\"float\": \"number\",\r\n\t\"double\": \"number\",\r\n};\r\nconst sysFields = ['id', 'main', 'row', 'no', '$create', '$update', '$owner'];\r\n\r\nexport class TsUQ {\r\n\tprivate buildContext: UqBuildContext;\r\n\tprivate readonly uq: UqMan;\r\n\tprivate readonly uqAlias: string;\r\n\r\n\tconstructor(buildContext: UqBuildContext, uq: UqMan, uqAlias: string) {\r\n\t\tthis.buildContext = buildContext;\r\n\t\tthis.uq = uq;\r\n\t\tthis.uqAlias = uqAlias;\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tlet tsImport = `\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { IDXValue, Uq`;\r\n\t\tlet ts: string = `\\n\\n`;\r\n\t\tts += '\\n//===============================';\r\n\t\tts += `\\n//======= UQ ${this.uq.name} ========`;\r\n\t\tts += '\\n//===============================';\r\n\t\tts += '\\n';\r\n\r\n\t\tlet { enumArr, tuidArr, actionArr, sheetArr\r\n\t\t\t, queryArr, bookArr, mapArr, historyArr\r\n\t\t\t, pendingArr, idArr, idxArr, ixArr\r\n\t\t} = this.uq;\r\n\t\tenumArr.forEach(v => ts += this.uqEntityInterface<UqEnum>(v, this.buildEnumInterface));\r\n\t\ttuidArr.forEach(v => ts += this.uqEntityInterface<Tuid>(v, this.buildTuidInterface));\r\n\t\tactionArr.forEach(v => ts += this.uqEntityInterface<Action>(v, this.buildActionInterface));\r\n\t\tsheetArr.forEach(v => ts += this.uqEntityInterface<Sheet>(v, this.buildSheetInterface));\r\n\t\tqueryArr.forEach(v => ts += this.uqEntityInterface<Query>(v, this.buildQueryInterface));\r\n\t\tbookArr.forEach(v => ts += this.uqEntityInterface<Book>(v, this.buildBookInterface));\r\n\t\tmapArr.forEach(v => ts += this.uqEntityInterface<Map>(v, this.buildMapInterface));\r\n\t\thistoryArr.forEach(v => ts += this.uqEntityInterface<History>(v, this.buildHistoryInterface));\r\n\t\tpendingArr.forEach(v => ts += this.uqEntityInterface<Pending>(v, this.buildPendingInterface));\r\n\t\tidArr.forEach(v => ts += this.uqEntityInterface<ID>(v, this.buildIDInterface));\r\n\t\tidxArr.forEach(v => ts += this.uqEntityInterface<IDX>(v, this.buildIDXInterface));\r\n\t\tidxArr.forEach(v => ts += this.uqEntityInterface<IDX>(v, this.buildIDXActParamInterface));\r\n\t\tixArr.forEach(v => ts += this.uqEntityInterface<IX>(v, this.buildIXInterface));\r\n\r\n\t\tts += this.buildActsInterface(this.uq);\r\n\r\n\t\tts += `\r\n\r\nexport interface UqExt extends Uq {\r\n\tActs(param:ParamActs): Promise<any>;\r\n\tSQL: Uq;\r\n\tIDRender(id:number):${this.buildContext.element};\r\n\tIDLocalRender(id:number):${this.buildContext.element};\r\n`;\r\n\t\tfunction appendArr<T extends Entity>(arr: T[], type: string, tsBuild: (v: T) => string) {\r\n\t\t\tif (arr.length === 0) return;\r\n\t\t\tlet tsLen = ts.length;\r\n\t\t\tarr.forEach(v => ts += tsBuild(v));\r\n\t\t\tif (ts.length - tsLen > 0) {\r\n\t\t\t\ttsImport += ', Uq' + type;\r\n\t\t\t}\r\n\t\t}\r\n\t\tappendArr<Tuid>(tuidArr, 'Tuid', v => this.uqBlock<Tuid>(v, this.buildTuid));\r\n\t\tappendArr<Action>(actionArr, 'Action', v => this.uqBlock<Action>(v, this.buildAction));\r\n\t\tappendArr<Sheet>(sheetArr, 'Sheet', v => this.uqBlock<Sheet>(v, this.buildSheet));\r\n\t\tappendArr<Book>(bookArr, 'Book', v => this.uqBlock<Book>(v, this.buildBook));\r\n\t\tappendArr<Query>(queryArr, 'Query', v => this.uqBlock<Query>(v, this.buildQuery));\r\n\t\tappendArr<Map>(mapArr, 'Map', v => this.uqBlock<Map>(v, this.buildMap));\r\n\t\tappendArr<History>(historyArr, 'History', v => this.uqBlock<History>(v, this.buildHistory));\r\n\t\tappendArr<Pending>(pendingArr, 'Pending', v => this.uqBlock<Pending>(v, this.buildPending));\r\n\t\tappendArr<ID>(idArr, 'ID', v => this.uqBlock<ID>(v, this.buildID));\r\n\t\tappendArr<IDX>(idxArr, 'IDX', v => this.uqBlock<IDX>(v, this.buildIDX));\r\n\t\tappendArr<IX>(ixArr, 'IX', v => this.uqBlock<IX>(v, this.buildIX));\r\n\t\tts += '\\n}\\n';\r\n\t\tts += `\r\nexport function assign(uq: any, to:string, from:any): void {\r\n\tlet hasEntity = uq.hasEntity(to);\r\n\tif (hasEntity === false) {\r\n\t\treturn;\r\n\t}\r\n\tObject.assign((uq as any)[to], from);\r\n}\r\n`;\r\n\r\n\t\ttsImport += ` } from \"tonwa-core\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { Render, IDXEntity } from \"tonwa-${this.buildContext.uiPlatform}\";`;\r\n\r\n\t\treturn tsImport + ts;\r\n\t}\r\n\r\n\tprivate uqEntityInterface<T extends Entity>(entity: T, buildInterface: (entity: T) => string) {\r\n\t\tlet { name } = entity;\r\n\t\tif (name.indexOf('$') > 0) return '';\r\n\t\tlet entityCode = buildInterface(entity);\r\n\t\tif (!entityCode) return '';\r\n\t\treturn '\\n' + entityCode + '\\n';\r\n\t}\r\n\r\n\tprivate uqBlock<T extends Entity>(entity: T, build: (entity: T) => string) {\r\n\t\tlet { name } = entity;\r\n\t\tif (name.indexOf('$') > 0) return '';\r\n\t\tlet entityCode = build(entity);\r\n\t\tif (!entityCode) return '';\r\n\t\treturn '\\n' + entityCode;\r\n\t}\r\n\r\n\tprivate buildFields(fields: Field[], isInID: boolean = false, indent: number = 1) {\r\n\t\tif (!fields) return '';\r\n\t\tlet ts = '';\r\n\t\tfor (let f of fields) {\r\n\t\t\tts += this.buildField(f, isInID, indent);\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildField(field: Field, isInID: boolean, indent: number = 1) {\r\n\t\tlet { name, type } = field;\r\n\t\tlet s = fieldTypeMap[type];\r\n\t\tif (!s) s = 'any';\r\n\t\tlet q: string = (isInID === true && sysFields.indexOf(name) >= 0) ? '?' : '';\r\n\t\treturn `\\n${'\\t'.repeat(indent)}${name}${q}: ${s};`;\r\n\t}\r\n\r\n\tprivate buildArrs(arrFields: ArrFields[]): string {\r\n\t\tif (!arrFields) return '';\r\n\t\tlet ts = '\\n';\r\n\t\tfor (let af of arrFields) {\r\n\t\t\tts += `\\t${camelCase(af.name)}: {`;\r\n\t\t\tts += this.buildFields(af.fields, false, 2);\r\n\t\t\tts += '\\n\\t}[];\\n';\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildReturns(entity: Entity, returns: ArrFields[]): string {\r\n\t\tif (!returns) return;\r\n\t\t//let {typeName} = entity;\r\n\t\t//let type = typeMap[typeName] || typeName;\r\n\t\tlet { sName } = entity;\r\n\t\tsName = capitalCase(sName);\r\n\t\tlet ts = '';\r\n\t\tfor (let ret of returns) {\r\n\t\t\tlet retName = capitalCase(ret.name);\r\n\t\t\tts += `export interface Return${sName}${retName} {`;\r\n\t\t\tts += this.buildFields(ret.fields);\r\n\t\t\tts += '\\n}\\n';\r\n\t\t}\r\n\r\n\t\tts += `export interface Result${sName} {\\n`;\r\n\t\tfor (let ret of returns) {\r\n\t\t\tlet retName = capitalCase(ret.name);\r\n\t\t\tts += `\\t${ret.name}: Return${sName}${retName}[];\\n`;\r\n\t\t}\r\n\t\tts += '}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildTuid = (tuid: Tuid) => {\r\n\t\tlet ts = `\\t${entityName(tuid.sName)}: UqTuid<Tuid${capitalCase(tuid.sName)}>&{tv:(id:number, render?:Render<any>)=>${this.buildContext.element}};`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildTuidInterface = (tuid: Tuid) => {\r\n\t\tlet ts = `export interface Tuid${capitalCase(tuid.sName)} {`;\r\n\t\tts += `\\n\\tid?: number;`;\r\n\t\tts += this.buildFields(tuid.fields);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildAction = (action: Action) => {\r\n\t\tlet ts = `\\t${entityName(action.sName)}: UqAction<Param${capitalCase(action.sName)}, Result${capitalCase(action.sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildActionInterface = (action: Action) => {\r\n\t\tlet ts = `export interface Param${capitalCase(action.sName)} {`;\r\n\t\tts += this.buildFields(action.fields);\r\n\t\tts += this.buildArrs(action.arrFields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(action, action.returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildEnumInterface = (enm: UqEnum) => {\r\n\t\tlet { schema } = enm;\r\n\t\tif (!schema) return;\r\n\t\tlet { values } = schema;\r\n\t\tlet ts = `export enum ${capitalCase(enm.sName)} {`;\r\n\t\tlet first: boolean = true;\r\n\t\tfor (let i in values) {\r\n\t\t\tif (first === false) {\r\n\t\t\t\tts += ',';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfirst = false;\r\n\t\t\t}\r\n\t\t\tlet v = values[i];\r\n\t\t\tts += '\\n\\t' + i + ' = ';\r\n\t\t\tif (typeof v === 'string') {\r\n\t\t\t\tts += '\"' + v + '\"';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tts += v;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ts += '\\n}'\r\n\t}\r\n\r\n\tprivate buildQuery = (query: Query) => {\r\n\t\tlet { sName } = query;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqQuery<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildQueryInterface = (query: Query) => {\r\n\t\tlet ts = `export interface Param${capitalCase(query.sName)} {`;\r\n\t\tts += this.buildFields(query.fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(query, query.returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildSheet = (sheet: Sheet) => {\r\n\t\tlet { sName, verify } = sheet;\r\n\t\tlet cName = capitalCase(sName);\r\n\t\tlet v = verify ? `Verify${cName}` : 'any';\r\n\t\tlet ts = `\\t${entityName(sName)}: UqSheet<Sheet${cName}, ${v}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildSheetInterface = (sheet: Sheet) => {\r\n\t\tlet { sName, fields, arrFields, verify } = sheet;\r\n\t\tlet ts = `export interface Sheet${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += this.buildArrs(arrFields);\r\n\t\tts += '}';\r\n\r\n\t\tif (verify) {\r\n\t\t\tlet { returns } = verify;\r\n\t\t\tts += `\\nexport interface Verify${capitalCase(sName)} {`;\r\n\t\t\tfor (let item of returns) {\r\n\t\t\t\tlet { name: arrName, fields } = item;\r\n\t\t\t\tts += '\\n\\t' + arrName + ': {';\r\n\t\t\t\tts += this.buildFields(fields, false, 2);\r\n\t\t\t\tts += '\\n\\t}[];';\r\n\t\t\t}\r\n\t\t\tts += '\\n}';\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildBook = (book: Book): string => {\r\n\t\tlet { sName } = book;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqBook<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildBookInterface = (book: Book): string => {\r\n\t\tlet { sName, fields, returns } = book;\r\n\t\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(book, returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildMap = (map: Map): string => {\r\n\t\tlet { sName } = map;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqMap;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildMapInterface = (map: Map): string => {\r\n\t\t/*\r\n\t\tlet {sName, fields, returns} = map;\r\n\t\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += buildReturns(map, returns);\r\n\t\treturn ts;\r\n\t\t*/\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate buildHistory = (history: History): string => {\r\n\t\tlet { sName } = history;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqHistory<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildHistoryInterface = (history: History): string => {\r\n\t\tlet { sName, fields, returns } = history;\r\n\t\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(history, returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildPending = (pending: Pending): string => {\r\n\t\tlet { sName } = pending;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqPending<any, any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildPendingInterface = (pending: Pending): string => {\r\n\t\t/*\r\n\t\tlet {sName, fields, returns} = pending;\r\n\t\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += buildReturns(pending, returns);\r\n\t\treturn ts;\r\n\t\t*/\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate buildID = (id: ID): string => {\r\n\t\tlet { sName } = id;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqID<any> & IDXEntity<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDX = (idx: IDX): string => {\r\n\t\tlet { sName } = idx;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqIDX<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIX = (ix: IX): string => {\r\n\t\tlet { sName } = ix;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqIX<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDInterface = (idEntity: ID): string => {\r\n\t\tlet { sName, fields, schema } = idEntity;\r\n\t\tlet { keys: schemaKeys } = schema;\r\n\t\tlet keys: Field[] = [], others: Field[] = [];\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tif ((schemaKeys as any[]).find(v => v.name === name)) keys.push(f);\r\n\t\t\telse others.push(f);\r\n\t\t}\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tts += `\\n\\tid?: number;`;\r\n\t\tts += this.buildFields(keys, true);\r\n\t\tts += this.buildFields(others, true);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDXInterface = (idx: IDX): string => {\r\n\t\tlet { sName, fields/*, schema*/ } = idx;\r\n\t\t//let { exFields } = schema;\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tlet indent = 1;\r\n\t\tfor (let field of fields) {\r\n\t\t\tlet { name, type } = field;\r\n\t\t\tlet s = fieldTypeMap[type];\r\n\t\t\tif (!s) s = 'any';\r\n\t\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\t\tif (name !== 'id') ts += '?';\r\n\t\t\tts += `: ${s};`;\r\n\t\t}\r\n\r\n\t\tts += `\\n\\t$act?: number;`;\r\n\t\t/*\r\n\t\tlet hasTrack: boolean = false;\r\n\t\tlet hasMemo: boolean = false;\r\n\t\tif (exFields) {\r\n\t\t\tfor (let exField of exFields) {\r\n\t\t\t\tlet { track, memo } = exField;\r\n\t\t\t\tif (track === true) hasTrack = true;\r\n\t\t\t\tif (memo === true) hasMemo = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasTrack === true) {\r\n\t\t\tts += `\\n\\t$track?: number;`;\r\n\t\t}\r\n\t\tif (hasMemo === true) {\r\n\t\t\tts += `\\n\\t$memo?: string;`;\r\n\t\t}\r\n\t\t*/\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDXActParamInterface = (idx: IDX): string => {\r\n\t\tlet { sName, fields/*, schema*/ } = idx;\r\n\t\t//let { exFields } = schema;\r\n\t\tlet ts = `export interface ActParam${capitalCase(sName)} {`;\r\n\t\tlet indent = 1;\r\n\t\tfor (let field of fields) {\r\n\t\t\tlet { name, type } = field;\r\n\t\t\tlet s = fieldTypeMap[type];\r\n\t\t\tif (!s) s = 'any';\r\n\t\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\t\tif (name !== 'id') ts += '?';\r\n\t\t\tts += `: ${s}|IDXValue;`;\r\n\t\t}\r\n\r\n\t\tts += `\\n\\t$act?: number;`;\r\n\t\t/*\r\n\t\tlet hasTrack: boolean = false;\r\n\t\tlet hasMemo: boolean = false;\r\n\t\tif (exFields) {\r\n\t\t\tfor (let exField of exFields) {\r\n\t\t\t\tlet { track, memo } = exField;\r\n\t\t\t\tif (track === true) hasTrack = true;\r\n\t\t\t\tif (memo === true) hasMemo = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasTrack === true) {\r\n\t\t\tts += `\\n\\t$track?: number;`;\r\n\t\t}\r\n\t\tif (hasMemo === true) {\r\n\t\t\tts += `\\n\\t$memo?: string;`;\r\n\t\t}\r\n\t\t*/\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIXInterface = (ix: IX): string => {\r\n\t\tlet { sName, fields } = ix;\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildActsInterface(uq: UqMan) {\r\n\t\tlet ts = `\\nexport interface ParamActs {`;\r\n\t\tuq.idArr.forEach(v => {\r\n\t\t\tlet { sName } = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tuq.idxArr.forEach(v => {\r\n\t\t\tlet { sName } = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ActParam${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tuq.ixArr.forEach(v => {\r\n\t\t\tlet { sName } = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tts += '\\n}\\n';\r\n\t\treturn ts;\r\n\t}\r\n}","//=== UqApp builder created on Sat Feb 26 2022 19:22:11 GMT-0500 (北美东部标准时间) ===//\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { IDXValue, Uq, UqQuery, UqAction, UqID, UqIX } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Render, IDXEntity } from \"tonwa-react\";\n\n\n//===============================\n//======= UQ bizdev/workshop ========\n//===============================\n\nexport interface Param$poked {\n}\nexport interface Return$pokedRet {\n\tpoke: number;\n}\nexport interface Result$poked {\n\tret: Return$pokedRet[];\n}\n\nexport interface Param$setMyTimezone {\n\t_timezone: number;\n}\nexport interface Result$setMyTimezone {\n}\n\nexport interface Param$getUnitTime {\n}\nexport interface Return$getUnitTimeRet {\n\ttimezone: number;\n\tunitTimeZone: number;\n\tunitBizMonth: number;\n\tunitBizDate: number;\n}\nexport interface Result$getUnitTime {\n\tret: Return$getUnitTimeRet[];\n}\n\nexport interface Draft {\n\tid?: number;\n\tentity: number;\n\tcontent: string;\n}\n\nexport interface IxDraft {\n\tix: number;\n\txi: number;\n}\n\nexport enum EnumOpType {\n\ta = 1,\n\tb = 2\n}\n\nexport interface Biz {\n\tid?: number;\n\tvalue: number;\n\tstamp: any;\n}\n\nexport interface BizPack {\n\tid?: number;\n\tstamp: any;\n}\n\nexport interface IxBizPack {\n\tix: number;\n\txi: number;\n}\n\nexport interface Op {\n\tid?: number;\n\tbiz: number;\n\ttype: any;\n\tvalue: number;\n\tstamp: any;\n}\n\nexport interface Item {\n\tid?: number;\n}\n\nexport interface OpiBooking {\n\tid?: number;\n\topType: any;\n\tpost: number;\n\tpostItem: number;\n\titem: number;\n\tratio: number;\n\tstart: any;\n\tspan: number;\n\tratioInit: number;\n\tmemo: number;\n}\n\nexport interface Opi {\n\tid?: number;\n\tobject: number;\n\tpost: number;\n\titem: number;\n}\n\nexport interface ItemHistory {\n\tid?: number;\n\top: number;\n\titem: number;\n\tvalue: number;\n}\n\nexport interface OpiHistory {\n\tid?: number;\n\topi: number;\n\titemHistory: number;\n\tvalue: number;\n\tbooking: number;\n}\n\nexport interface IxOpiDate {\n\tvalue: number;\n\trows: number;\n\tp0: number;\n\tp1: number;\n\tix: number;\n\txi: any;\n}\n\nexport interface Note {\n\tid?: number;\n\tstaff: number;\n\tclient: number;\n\tnote: string;\n\tsensitive: number;\n}\n\nexport interface IxStaffClient {\n\ttick: number;\n\tix: number;\n\txi: number;\n}\n\nexport interface ParamSaveNote {\n\tid: number;\n\tstaff: number;\n\tclient: number;\n\tnote: string;\n\tsensitive: number;\n}\nexport interface ReturnSaveNoteRet {\n\tid: number;\n}\nexport interface ResultSaveNote {\n\tret: ReturnSaveNoteRet[];\n}\n\nexport interface ParamMyClients {\n}\nexport interface ReturnMyClientsRet {\n\tid: number;\n\tno: string;\n\tname: string;\n\tvice: string;\n\tfirstName: string;\n\tlastName: string;\n\tmiddleName: string;\n\tgender: any;\n\tyear: number;\n\tmonth: number;\n\tday: number;\n\temail: string;\n\tmobile: string;\n\tmobileCountry: string;\n}\nexport interface ResultMyClients {\n\tret: ReturnMyClientsRet[];\n}\n\nexport enum Gender {\n\tfemale = 0,\n\tmale = 1\n}\n\nexport interface Person {\n\tid?: number;\n\tno?: string;\n\tname: string;\n\tvice: string;\n\tfirstName: string;\n\tlastName: string;\n\tmiddleName: string;\n\tgender: any;\n\tyear: number;\n\tmonth: number;\n\tday: number;\n\temail: string;\n\tmobile: string;\n\tmobileCountry: string;\n}\n\nexport interface IxPersonLog {\n\tix: number;\n\txi: number;\n}\n\nexport interface ClientSurvey {\n\tid?: number;\n\tclient: number;\n}\n\nexport interface ParamGetPersonList {\n\trole: any;\n}\nexport interface ReturnGetPersonListRet {\n\tid: number;\n\tno: string;\n\tname: string;\n\tvice: string;\n\tfirstName: string;\n\tlastName: string;\n\tmiddleName: string;\n\tgender: any;\n\tyear: number;\n\tmonth: number;\n\tday: number;\n\temail: string;\n\tmobile: string;\n\tmobileCountry: string;\n\tuser: number;\n}\nexport interface ReturnGetPersonListRoles {\n\tperson: number;\n\trole: any;\n}\nexport interface ResultGetPersonList {\n\tret: ReturnGetPersonListRet[];\n\troles: ReturnGetPersonListRoles[];\n}\n\nexport interface ParamPersonSearch {\n\trole: any;\n\tkey: string;\n}\nexport interface ReturnPersonSearchRet {\n\tid: number;\n\tno: string;\n\tname: string;\n\tvice: string;\n\tfirstName: string;\n\tlastName: string;\n\tmiddleName: string;\n\tgender: any;\n\tyear: number;\n\tmonth: number;\n\tday: number;\n\temail: string;\n\tmobile: string;\n\tmobileCountry: string;\n}\nexport interface ResultPersonSearch {\n\tret: ReturnPersonSearchRet[];\n}\n\nexport interface ParamGetPersonLog {\n\tperson: number;\n}\nexport interface ReturnGetPersonLogRet {\n\tlog: number;\n\ttype: string;\n\tvalue: string;\n}\nexport interface ResultGetPersonLog {\n\tret: ReturnGetPersonLogRet[];\n}\n\nexport interface TagGroup {\n\tid?: number;\n\tname: string;\n}\n\nexport interface Tag {\n\tid?: number;\n\tname: string;\n\tvice: string;\n\tsingle: number;\n}\n\nexport interface TagItem {\n\tid?: number;\n\tname: string;\n}\n\nexport interface IxTag {\n\tix: number;\n\txi: number;\n}\n\nexport interface IxLocalIdTag {\n\tix: number;\n\txi: number;\n}\n\nexport interface IxGlobalIdTag {\n\tix: number;\n\txi: number;\n}\n\nexport interface IXAll {\n\tix: number;\n\txi: number;\n}\n\nexport enum Role {\n\tstaff = 10,\n\tcounselor = 11,\n\tvolunteer = 12,\n\tboard = 13,\n\tclient = 20,\n\tdonator = 30\n}\n\nexport interface IxUserPerson {\n\tix: number;\n\txi: number;\n}\n\nexport interface IxPersonRole {\n\tix: number;\n\txi: number;\n}\n\nexport interface Workshop {\n\tid?: number;\n\tno?: string;\n\tname: string;\n\tvice: string;\n\tstaff: number;\n}\n\nexport interface Session {\n\tid?: number;\n\tworkshop: number;\n\tdate: any;\n\tvice: string;\n\ttime: any;\n\tspan: number;\n}\n\nexport interface SessionPerson {\n\tid?: number;\n\tsession: number;\n\tperson: number;\n\tworkshop: number;\n\tdeleted: number;\n}\n\nexport interface IxWorkshopSession {\n\tix: number;\n\txi: number;\n}\n\nexport interface IxSessionStaff {\n\town: number;\n\tsubstitue: number;\n\tdone: number;\n\tix: number;\n\txi: number;\n}\n\nexport interface IxSessionClient {\n\tdeleted: number;\n\tix: number;\n\txi: number;\n}\n\nexport interface ParamSetSessionStaff {\n\tsession: number;\n\tstaff: number;\n\town: number;\n\tsubstitue: number;\n\tdone: number;\n}\nexport interface ResultSetSessionStaff {\n}\n\nexport interface ParamSaveWorkshopStaff {\n\tid: number;\n\tstaff: number;\n}\nexport interface ResultSaveWorkshopStaff {\n}\n\nexport interface ParamSaveSessionAttendee {\n\tsession: number;\n\tclient: number;\n\tdeleted: number;\n}\nexport interface ResultSaveSessionAttendee {\n}\n\nexport interface ParamMySessions {\n}\nexport interface ReturnMySessionsRet {\n\tid: number;\n\tworkshop: number;\n\tdate: any;\n\tvice: string;\n\ttime: any;\n\tspan: number;\n\town: number;\n\tsubstitue: number;\n\tdone: number;\n}\nexport interface ResultMySessions {\n\tret: ReturnMySessionsRet[];\n}\n\nexport interface ParamActs {\n\tdraft?: Draft[];\n\tixDraft?: IxDraft[];\n\tbiz?: Biz[];\n\tbizPack?: BizPack[];\n\tixBizPack?: IxBizPack[];\n\top?: Op[];\n\titem?: Item[];\n\topiBooking?: OpiBooking[];\n\topi?: Opi[];\n\titemHistory?: ItemHistory[];\n\topiHistory?: OpiHistory[];\n\tixOpiDate?: IxOpiDate[];\n\tnote?: Note[];\n\tixStaffClient?: IxStaffClient[];\n\tperson?: Person[];\n\tixPersonLog?: IxPersonLog[];\n\tclientSurvey?: ClientSurvey[];\n\ttagGroup?: TagGroup[];\n\ttag?: Tag[];\n\ttagItem?: TagItem[];\n\tixTag?: IxTag[];\n\tixLocalIdTag?: IxLocalIdTag[];\n\tixGlobalIdTag?: IxGlobalIdTag[];\n\tiXAll?: IXAll[];\n\tixUserPerson?: IxUserPerson[];\n\tixPersonRole?: IxPersonRole[];\n\tworkshop?: Workshop[];\n\tsession?: Session[];\n\tsessionPerson?: SessionPerson[];\n\tixWorkshopSession?: IxWorkshopSession[];\n\tixSessionStaff?: IxSessionStaff[];\n\tixSessionClient?: IxSessionClient[];\n}\n\n\nexport interface UqExt extends Uq {\n\tActs(param:ParamActs): Promise<any>;\n\tSQL: Uq;\n\tIDRender(id:number):JSX.Element;\n\tIDLocalRender(id:number):JSX.Element;\n\n\t$poked: UqQuery<Param$poked, Result$poked>;\n\t$setMyTimezone: UqAction<Param$setMyTimezone, Result$setMyTimezone>;\n\t$getUnitTime: UqQuery<Param$getUnitTime, Result$getUnitTime>;\n\tDraft: UqID<any> & IDXEntity<any>;\n\tIxDraft: UqIX<any>;\n\tBiz: UqID<any> & IDXEntity<any>;\n\tBizPack: UqID<any> & IDXEntity<any>;\n\tIxBizPack: UqIX<any>;\n\tOp: UqID<any> & IDXEntity<any>;\n\tItem: UqID<any> & IDXEntity<any>;\n\tOpiBooking: UqID<any> & IDXEntity<any>;\n\tOpi: UqID<any> & IDXEntity<any>;\n\tItemHistory: UqID<any> & IDXEntity<any>;\n\tOpiHistory: UqID<any> & IDXEntity<any>;\n\tIxOpiDate: UqIX<any>;\n\tNote: UqID<any> & IDXEntity<any>;\n\tIxStaffClient: UqIX<any>;\n\tSaveNote: UqAction<ParamSaveNote, ResultSaveNote>;\n\tMyClients: UqQuery<ParamMyClients, ResultMyClients>;\n\tPerson: UqID<any> & IDXEntity<any>;\n\tIxPersonLog: UqIX<any>;\n\tClientSurvey: UqID<any> & IDXEntity<any>;\n\tGetPersonList: UqQuery<ParamGetPersonList, ResultGetPersonList>;\n\tPersonSearch: UqQuery<ParamPersonSearch, ResultPersonSearch>;\n\tGetPersonLog: UqQuery<ParamGetPersonLog, ResultGetPersonLog>;\n\tTagGroup: UqID<any> & IDXEntity<any>;\n\tTag: UqID<any> & IDXEntity<any>;\n\tTagItem: UqID<any> & IDXEntity<any>;\n\tIxTag: UqIX<any>;\n\tIxLocalIdTag: UqIX<any>;\n\tIxGlobalIdTag: UqIX<any>;\n\tIXAll: UqIX<any>;\n\tIxUserPerson: UqIX<any>;\n\tIxPersonRole: UqIX<any>;\n\tWorkshop: UqID<any> & IDXEntity<any>;\n\tSession: UqID<any> & IDXEntity<any>;\n\tSessionPerson: UqID<any> & IDXEntity<any>;\n\tIxWorkshopSession: UqIX<any>;\n\tIxSessionStaff: UqIX<any>;\n\tIxSessionClient: UqIX<any>;\n\tSetSessionStaff: UqAction<ParamSetSessionStaff, ResultSetSessionStaff>;\n\tSaveWorkshopStaff: UqAction<ParamSaveWorkshopStaff, ResultSaveWorkshopStaff>;\n\tSaveSessionAttendee: UqAction<ParamSaveSessionAttendee, ResultSaveSessionAttendee>;\n\tMySessions: UqQuery<ParamMySessions, ResultMySessions>;\n}\n\nexport function assign(uq: any, to:string, from:any): void {\n\tlet hasEntity = uq.hasEntity(to);\n\tif (hasEntity === false) {\n\t\treturn;\n\t}\n\tObject.assign((uq as any)[to], from);\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Draft } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tentity: {\n\t\t\"name\": \"entity\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Entity\"\n\t} as FieldItemInt,\n\tcontent: {\n\t\t\"name\": \"content\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Content\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.entity, fields.content, \n];\n\nexport const ui: UI = {\nlabel: \"Draft\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Draft):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Biz } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tvalue: {\n\t\t\"name\": \"value\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Value\"\n\t} as FieldItemNumber,\n\tstamp: {\n\t\t\"name\": \"stamp\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Stamp\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.value, fields.stamp, \n];\n\nexport const ui: UI = {\nlabel: \"Biz\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Biz):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { BizPack } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tstamp: {\n\t\t\"name\": \"stamp\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Stamp\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.stamp, \n];\n\nexport const ui: UI = {\nlabel: \"BizPack\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: BizPack):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Op } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tbiz: {\n\t\t\"name\": \"biz\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Biz\"\n\t} as FieldItemId,\n\ttype: {\n\t\t\"name\": \"type\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Type\"\n\t} as undefined,\n\tvalue: {\n\t\t\"name\": \"value\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Value\"\n\t} as FieldItemNumber,\n\tstamp: {\n\t\t\"name\": \"stamp\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Stamp\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.biz, fields.type, fields.value, fields.stamp, \n];\n\nexport const ui: UI = {\nlabel: \"Op\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Op):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Item } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\t\n];\n\nexport const ui: UI = {\nlabel: \"Item\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Item):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { OpiBooking } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\topType: {\n\t\t\"name\": \"opType\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"OpType\"\n\t} as undefined,\n\tpost: {\n\t\t\"name\": \"post\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Post\"\n\t} as FieldItemId,\n\tpostItem: {\n\t\t\"name\": \"postItem\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"PostItem\"\n\t} as FieldItemId,\n\titem: {\n\t\t\"name\": \"item\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Item\"\n\t} as FieldItemId,\n\tratio: {\n\t\t\"name\": \"ratio\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Ratio\"\n\t} as FieldItemNumber,\n\tstart: {\n\t\t\"name\": \"start\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Start\"\n\t} as undefined,\n\tspan: {\n\t\t\"name\": \"span\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Span\"\n\t} as FieldItemInt,\n\tratioInit: {\n\t\t\"name\": \"ratioInit\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"RatioInit\"\n\t} as FieldItemNumber,\n\tmemo: {\n\t\t\"name\": \"memo\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Memo\"\n\t} as FieldItemInt,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.opType, fields.post, fields.postItem, fields.item, fields.ratio, fields.start, fields.span, fields.ratioInit, fields.memo, \n];\n\nexport const ui: UI = {\nlabel: \"OpiBooking\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: OpiBooking):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Opi } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tobject: {\n\t\t\"name\": \"object\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Object\"\n\t} as FieldItemId,\n\tpost: {\n\t\t\"name\": \"post\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Post\"\n\t} as FieldItemId,\n\titem: {\n\t\t\"name\": \"item\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Item\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.object, fields.post, fields.item, \n];\n\nexport const ui: UI = {\nlabel: \"Opi\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Opi):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { ItemHistory } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\top: {\n\t\t\"name\": \"op\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Op\"\n\t} as FieldItemId,\n\titem: {\n\t\t\"name\": \"item\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Item\"\n\t} as FieldItemId,\n\tvalue: {\n\t\t\"name\": \"value\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Value\"\n\t} as FieldItemNumber,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.op, fields.item, fields.value, \n];\n\nexport const ui: UI = {\nlabel: \"ItemHistory\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: ItemHistory):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { OpiHistory } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\topi: {\n\t\t\"name\": \"opi\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Opi\"\n\t} as FieldItemId,\n\titemHistory: {\n\t\t\"name\": \"itemHistory\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"ItemHistory\"\n\t} as FieldItemId,\n\tvalue: {\n\t\t\"name\": \"value\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Value\"\n\t} as FieldItemNumber,\n\tbooking: {\n\t\t\"name\": \"booking\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Booking\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.opi, fields.itemHistory, fields.value, fields.booking, \n];\n\nexport const ui: UI = {\nlabel: \"OpiHistory\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: OpiHistory):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Note } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tstaff: {\n\t\t\"name\": \"staff\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Staff\"\n\t} as FieldItemId,\n\tclient: {\n\t\t\"name\": \"client\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Client\"\n\t} as FieldItemId,\n\tnote: {\n\t\t\"name\": \"note\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Note\"\n\t} as undefined,\n\tsensitive: {\n\t\t\"name\": \"sensitive\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Sensitive\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.staff, fields.client, fields.note, fields.sensitive, \n];\n\nexport const ui: UI = {\nlabel: \"Note\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Note):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Person } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n\tfirstName: {\n\t\t\"name\": \"firstName\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"FirstName\"\n\t} as FieldItemString,\n\tlastName: {\n\t\t\"name\": \"lastName\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"LastName\"\n\t} as FieldItemString,\n\tmiddleName: {\n\t\t\"name\": \"middleName\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"MiddleName\"\n\t} as FieldItemString,\n\tgender: {\n\t\t\"name\": \"gender\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Gender\"\n\t} as undefined,\n\tyear: {\n\t\t\"name\": \"year\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Year\"\n\t} as FieldItemInt,\n\tmonth: {\n\t\t\"name\": \"month\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Month\"\n\t} as undefined,\n\tday: {\n\t\t\"name\": \"day\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Day\"\n\t} as undefined,\n\temail: {\n\t\t\"name\": \"email\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Email\"\n\t} as FieldItemString,\n\tmobile: {\n\t\t\"name\": \"mobile\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Mobile\"\n\t} as FieldItemString,\n\tmobileCountry: {\n\t\t\"name\": \"mobileCountry\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"MobileCountry\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, fields.name, fields.vice, fields.firstName, fields.lastName, fields.middleName, fields.gender, fields.year, fields.month, fields.day, fields.email, fields.mobile, fields.mobileCountry, \n];\n\nexport const ui: UI = {\nlabel: \"Person\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Person):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { ClientSurvey } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tclient: {\n\t\t\"name\": \"client\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Client\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.client, \n];\n\nexport const ui: UI = {\nlabel: \"ClientSurvey\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: ClientSurvey):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { TagGroup } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, \n];\n\nexport const ui: UI = {\nlabel: \"TagGroup\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: TagGroup):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Tag } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n\tsingle: {\n\t\t\"name\": \"single\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Single\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, fields.vice, fields.single, \n];\n\nexport const ui: UI = {\nlabel: \"Tag\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Tag):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { TagItem } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, \n];\n\nexport const ui: UI = {\nlabel: \"TagItem\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: TagItem):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Workshop } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Vice\"\n\t} as undefined,\n\tstaff: {\n\t\t\"name\": \"staff\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Staff\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, fields.name, fields.vice, fields.staff, \n];\n\nexport const ui: UI = {\nlabel: \"Workshop\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Workshop):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Session } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tworkshop: {\n\t\t\"name\": \"workshop\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Workshop\"\n\t} as FieldItemId,\n\tdate: {\n\t\t\"name\": \"date\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Date\"\n\t} as undefined,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n\ttime: {\n\t\t\"name\": \"time\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Time\"\n\t} as undefined,\n\tspan: {\n\t\t\"name\": \"span\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Span\"\n\t} as FieldItemInt,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.workshop, fields.date, fields.vice, fields.time, fields.span, \n];\n\nexport const ui: UI = {\nlabel: \"Session\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Session):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { SessionPerson } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tsession: {\n\t\t\"name\": \"session\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Session\"\n\t} as FieldItemId,\n\tperson: {\n\t\t\"name\": \"person\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Person\"\n\t} as FieldItemId,\n\tworkshop: {\n\t\t\"name\": \"workshop\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Workshop\"\n\t} as FieldItemId,\n\tdeleted: {\n\t\t\"name\": \"deleted\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Deleted\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.session, fields.person, fields.workshop, fields.deleted, \n];\n\nexport const ui: UI = {\nlabel: \"SessionPerson\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: SessionPerson):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","//=== UqApp builder created on Sat Feb 26 2022 19:22:11 GMT-0500 (北美东部标准时间) ===//\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { IDXValue, Uq, UqQuery, UqAction, UqID } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Render, IDXEntity } from \"tonwa-react\";\n\n\n//===============================\n//======= UQ bizdev/workshop-bus-test ========\n//===============================\n\nexport interface Param$poked {\n}\nexport interface Return$pokedRet {\n\tpoke: number;\n}\nexport interface Result$poked {\n\tret: Return$pokedRet[];\n}\n\nexport interface Param$setMyTimezone {\n\t_timezone: number;\n}\nexport interface Result$setMyTimezone {\n}\n\nexport interface Param$getUnitTime {\n}\nexport interface Return$getUnitTimeRet {\n\ttimezone: number;\n\tunitTimeZone: number;\n\tunitBizMonth: number;\n\tunitBizDate: number;\n}\nexport interface Result$getUnitTime {\n\tret: Return$getUnitTimeRet[];\n}\n\nexport interface Id1 {\n\tid?: number;\n\tname: string;\n}\n\nexport interface Id2 {\n\tid?: number;\n\tname: string;\n}\n\nexport interface Id3 {\n\tid?: number;\n\tname: string;\n}\n\nexport interface Id4 {\n\tid?: number;\n\tname: string;\n}\n\nexport interface ParamActs {\n\tid1?: Id1[];\n\tid2?: Id2[];\n\tid3?: Id3[];\n\tid4?: Id4[];\n}\n\n\nexport interface UqExt extends Uq {\n\tActs(param:ParamActs): Promise<any>;\n\tSQL: Uq;\n\tIDRender(id:number):JSX.Element;\n\tIDLocalRender(id:number):JSX.Element;\n\n\t$poked: UqQuery<Param$poked, Result$poked>;\n\t$setMyTimezone: UqAction<Param$setMyTimezone, Result$setMyTimezone>;\n\t$getUnitTime: UqQuery<Param$getUnitTime, Result$getUnitTime>;\n\tId1: UqID<any> & IDXEntity<any>;\n\tId2: UqID<any> & IDXEntity<any>;\n\tId3: UqID<any> & IDXEntity<any>;\n\tId4: UqID<any> & IDXEntity<any>;\n}\n\nexport function assign(uq: any, to:string, from:any): void {\n\tlet hasEntity = uq.hasEntity(to);\n\tif (hasEntity === false) {\n\t\treturn;\n\t}\n\tObject.assign((uq as any)[to], from);\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Id1 } from \"./BzWorkshopBusTest\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, \n];\n\nexport const ui: UI = {\nlabel: \"Id1\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Id1):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Id2 } from \"./BzWorkshopBusTest\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, \n];\n\nexport const ui: UI = {\nlabel: \"Id2\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Id2):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Id3 } from \"./BzWorkshopBusTest\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, \n];\n\nexport const ui: UI = {\nlabel: \"Id3\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Id3):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { uqStringify } from \"tonwa-uq\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, setRes } from \"tonwa-core\";\nimport { Id4 } from \"./BzWorkshopBusTest\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, \n];\n\nexport const ui: UI = {\nlabel: \"Id4\",\nfieldArr,\nfields,\n};\n\nconst resRaw: Res<any> = {\n$zh: {\n},\n$en: {\n}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\nreturn res[str as string] ?? str;\n}\n\nexport function render(item: Id4):JSX.Element {\nreturn <>{uqStringify(item)}</>;\n};\n","//=== UqApp builder created on Sat Feb 26 2022 19:22:11 GMT-0500 (北美东部标准时间) ===//\nimport * as BzWorkshop from './BzWorkshop';\nimport * as BzWorkshopBusTest from './BzWorkshopBusTest';\n\nexport interface UQs {\n\tBzWorkshop: BzWorkshop.UqExt;\n\tBzWorkshopBusTest: BzWorkshopBusTest.UqExt;\n}\n\nexport * as BzWorkshop from './BzWorkshop';\nexport * as BzWorkshopBusTest from './BzWorkshopBusTest';\n\nexport function setUI(uqs:UQs) {\n\tBzWorkshop.setUI(uqs.BzWorkshop);\n\tBzWorkshopBusTest.setUI(uqs.BzWorkshopBusTest);\n}\n","import { UqExt as Uq, assign } from './BzWorkshop';\nimport * as Draft from './Draft.ui';\nimport * as Biz from './Biz.ui';\nimport * as BizPack from './BizPack.ui';\nimport * as Op from './Op.ui';\nimport * as Item from './Item.ui';\nimport * as OpiBooking from './OpiBooking.ui';\nimport * as Opi from './Opi.ui';\nimport * as ItemHistory from './ItemHistory.ui';\nimport * as OpiHistory from './OpiHistory.ui';\nimport * as Note from './Note.ui';\nimport * as Person from './Person.ui';\nimport * as ClientSurvey from './ClientSurvey.ui';\nimport * as TagGroup from './TagGroup.ui';\nimport * as Tag from './Tag.ui';\nimport * as TagItem from './TagItem.ui';\nimport * as Workshop from './Workshop.ui';\nimport * as Session from './Session.ui';\nimport * as SessionPerson from './SessionPerson.ui';\n\t\nexport function setUI(uq: Uq) {\n\tassign(uq, 'Draft', Draft);\n\tassign(uq, 'Biz', Biz);\n\tassign(uq, 'BizPack', BizPack);\n\tassign(uq, 'Op', Op);\n\tassign(uq, 'Item', Item);\n\tassign(uq, 'OpiBooking', OpiBooking);\n\tassign(uq, 'Opi', Opi);\n\tassign(uq, 'ItemHistory', ItemHistory);\n\tassign(uq, 'OpiHistory', OpiHistory);\n\tassign(uq, 'Note', Note);\n\tassign(uq, 'Person', Person);\n\tassign(uq, 'ClientSurvey', ClientSurvey);\n\tassign(uq, 'TagGroup', TagGroup);\n\tassign(uq, 'Tag', Tag);\n\tassign(uq, 'TagItem', TagItem);\n\tassign(uq, 'Workshop', Workshop);\n\tassign(uq, 'Session', Session);\n\tassign(uq, 'SessionPerson', SessionPerson);\n}\nexport * from './BzWorkshop';\n","import { UqExt as Uq, assign } from './BzWorkshopBusTest';\nimport * as Id1 from './id1.ui';\nimport * as Id2 from './id2.ui';\nimport * as Id3 from './id3.ui';\nimport * as Id4 from './id4.ui';\n\t\nexport function setUI(uq: Uq) {\n\tassign(uq, 'Id1', Id1);\n\tassign(uq, 'Id2', Id2);\n\tassign(uq, 'Id3', Id3);\n\tassign(uq, 'Id4', Id4);\n}\nexport * from './BzWorkshopBusTest';\n","//=== UqApp builder created on Tue Jan 12 2021 23:14:51 GMT-0500 (GMT-05:00) ===//\r\nimport { AppConfig } from \"tonwa\";\r\nimport { UqConfig } from 'tonwa-uq';\r\nimport uqConfigs from '../uqconfig.json';\r\n\r\n/*\r\nconst bz: DevConfig = {\r\n\tname: 'bizdev',\r\n\talias: 'bz',\r\n}\r\n*/\r\n\r\nexport const appConfig: AppConfig = {\r\n\tversion: '0.1.0',\r\n\tuqs: uqsFromConfigs(),\r\n\tnoUnit: true,\r\n\toem: undefined,\r\n\thtmlTitle: 'Timeschange Workshop',\r\n};\r\n\r\nfunction uqsFromConfigs(): UqConfig[] {\r\n\tlet { devs, uqs } = uqConfigs;\r\n\treturn uqs.map(v => {\r\n\t\tlet { dev, name, alias } = v;\r\n\t\treturn {\r\n\t\t\tdev: (devs as any)[dev],\r\n\t\t\tname,\r\n\t\t\talias,\r\n\t\t};\r\n\t});\r\n}\r\n","//=== UqApp builder created on Wed Mar 10 2021 16:02:48 GMT-0500 (GMT-05:00) ===//\r\n//import { nav } from \"tonwa-view\";\r\nimport { tonwa } from \"tonwa-core\";\r\nimport { appConfig } from './appConfig';\r\n\r\nexport const App: React.FC = () => {\r\n\ttonwa.setSettings(appConfig);\r\n\tconst onLogined = async (isUserLogin?: boolean) => {\r\n\t\t// await start(CApp, appConfig, isUserLogin);\r\n\t}\r\n\ttonwa.appStart();\r\n\treturn tonwa.nav.renderNavView(onLogined);\r\n\t//return <NavView onLogined={onLogined} />;\r\n}\r\n","import * as React from 'react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, UiImageItem } from '../components';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    data: any;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            data: observable,\r\n        })\r\n        let { nick, icon } = tonwa.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        //let {name} = itemSchema;        \r\n        //await userApi.userSetProp(name, newValue);\r\n        throw new Error('await userApi.userSetProp(name, newValue);');\r\n        /*\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n        */\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { Page, LMR } from \"../components\";\r\nimport { VPage } from '../vm';\r\n//import { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\n//import { UQsMan } from '../uq';\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase<any>> {\r\n    private params: { predefinedUnit: number, uqsLoadErrors: string[] };\r\n    async open(params: { predefinedUnit: number, uqsLoadErrors: string[] }) {\r\n        this.params = params;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = () => {\r\n        let { predefinedUnit, uqsLoadErrors } = this.params;\r\n        let { user } = this.tonwa;\r\n        let userName: string = user ? user.name : '[未登录]';\r\n        //let {appOwner, appName} = UQsMan.value;\r\n        return <Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\r\n                </div>\r\n                {\r\n                    uqsLoadErrors && uqsLoadErrors.map(v => {\r\n                        return <div className=\"mb-3 row\">\r\n                            <div className=\"col-sm-3 font-weight-bold\">App</div>\r\n                            <div className=\"col-sm text-body\">{v}</div>\r\n                        </div>\r\n                    })\r\n                }\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                        预设小号定义在 public/unit.json 文件中。\r\n                        定义了这个文件的程序，只能由url直接启动。\r\n                        用户第一次访问app之后，会缓存在localStorage里。<br />\r\n                        如果要删去缓存的预定义Unit，logout然后再login。\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n    /*\r\n    <div className=\"mb-3 row\">\r\n        <div className=\"col-sm-3 font-weight-bold\">\r\n            可能原因<FA name=\"exclamation-triangle\" />\r\n        </div>\r\n        <div className=\"col-sm text-body\">\r\n            <ul className=\"p-0\">\r\n                <li>没有小号运行 {appName}</li>\r\n                <li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\r\n                {\r\n                    predefinedUnit && \r\n                    <li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\r\n                }\r\n            </ul>\r\n        </div>\r\n    </div>\r\n    */\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase<any>> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number): JSX.Element => {\r\n        let { id, nick, name } = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (appUnit: any) => {\r\n        //appInFrame.unit = appUnit.id; // 25;\r\n        //this.controller.setAppUnit(appUnit);\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n            <div>this.controller.appUnits appUnits removed</div>\r\n        </Page>\r\n        // <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n    }\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase<any>> {\r\n    async open(errors: string[]) {\r\n        this.openPage(this.page, { errors: errors });\r\n    }\r\n\r\n    private page = (errors: { errors: string[] }) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n                <div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n                    <button className=\"btn btn-danger\" onClick={this.tonwa.resetAll}>重启网页</button>\r\n                </div>\r\n\r\n                <div>Load Uqs 发生错误：</div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase<any>> {\r\n    async open(error: any) {\r\n        this.openPage(this.page, { error });\r\n    }\r\n\r\n    private page = ({ error }: { error: any }) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string' ? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport {\r\n\tUqMan, Uq as UqCore, UqError\r\n} from \"tonwa-uq\";\r\n\r\nexport class Uq {\r\n\tprivate $_uqMan: UqMan;\r\n\tprivate $_uqSql: UqCore;\r\n\tconstructor(uqMan: UqMan) {\r\n\t\tthis.$_uqMan = uqMan;\r\n\t\tthis.$_uqSql = this.$_createUqSqlProxy();\r\n\t}\r\n\r\n\t$_createProxy() {\r\n\t\tlet ret = new Proxy(this.$_uqMan.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tif (key === '$') {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tif (key === 'SQL') {\r\n\t\t\t\t\treturn this.$_uqSql;\r\n\t\t\t\t}\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet func = (this.$_uqMan as any)[key];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tfunc = (this as any)[key];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tthis.errUndefinedEntity(String(key));\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate $_createUqSqlProxy(): UqCore {\r\n\t\tlet ret = new Proxy(this.$_uqMan, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet ret = (target as any)['$' + (key as string)];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tthis.errUndefinedEntity(String(key));\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret as unknown as UqCore;\r\n\t}\r\n\r\n\tprivate errUndefinedEntity(entity: string) {\r\n\t\tlet message = `entity ${this.$_uqMan.name}.${entity} not defined`;\r\n\t\tlet err = new Error(message);\r\n\t\terr.name = UqError.undefined_entity;\r\n\t\tthrow err;\r\n\t}\r\n\r\n\tprotected IDRender = (id: number, render?: (value: any) => JSX.Element): JSX.Element => {\r\n\t\tif (id === undefined || id === null) return null;\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet ret = this.$_uqMan.idCache.getValue(id);\r\n\t\t\tif (ret === undefined) {\r\n\t\t\t\treturn React.createElement('span', { props: { className: 'text-muted' }, children: ['id=' + id] });\r\n\t\t\t}\r\n\t\t\tlet { $type } = ret as any;\r\n\t\t\tif (!$type) return this.renderIDUnknownType(id);\r\n\t\t\tlet IDType = this.$_uqMan.ids[$type];\r\n\t\t\tif (!IDType) return this.renderIDUnknownType(id);\r\n\t\t\treturn (render ?? (IDType as any).render)(ret);\r\n\t\t}));\r\n\t}\r\n\r\n\tprotected IDV = <T extends object>(id: number): T => {\r\n\t\tlet ret = this.$_uqMan.idCache.getValue(id);\r\n\t\treturn ret as T;\r\n\t}\r\n\r\n\tprivate renderIDUnknownType(id: number) {\r\n\t\treturn React.createElement('span', { props: { className: 'text-muted' }, children: [`id=${id} type undefined`] });\r\n\t}\r\n\r\n\tprotected IDLocalV = <T extends object>(id: number): T => {\r\n\t\treturn this.IDV(-id);\r\n\t}\r\n\r\n\tprotected IDLocalRender = (id: number, render?: (value: any) => JSX.Element): JSX.Element => {\r\n\t\tif (id === undefined || id === null) return null;\r\n\t\treturn this.IDRender(-id, render);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { UQsMan, TuidInner, uqStringify, TuidImport } from \"tonwa-uq\";\r\nimport { Render } from \"../ui\";\r\nimport { Uq } from \"./Uq\";\r\n\r\nexport function uqsProxy(uqsMan: UQsMan) {\r\n    buildTuidTv();\r\n    const uqReacts: { [key: string]: any } = {};\r\n    function setUq(uqKey: string, proxy: any): void {\r\n        if (!uqKey) return;\r\n        let lower = uqKey.toLowerCase();\r\n        uqReacts[uqKey] = proxy;\r\n        if (lower !== uqKey) uqReacts[lower] = proxy;\r\n    }\r\n    for (let uqMan of uqsMan.uqMans) {\r\n        let uqReact = new Uq(uqMan);\r\n        let proxy = uqReact.$_createProxy();\r\n        setUq(uqMan.getUqKey(), proxy);\r\n        setUq(uqMan.getUqKeyWithConfig(), proxy);\r\n    }\r\n    function onUqProxyError(key: string) {\r\n        for (let i in uqReacts) {\r\n            let uqReact = uqReacts[i];\r\n            uqReact.localMap.removeAll();\r\n        }\r\n        console.error(`uq proxy ${key} error`);\r\n    }\r\n    return new Proxy(uqReacts, {\r\n        get: (target, key, receiver) => {\r\n            let lk = (key as string).toLowerCase();\r\n            let ret = target[lk];\r\n            if (ret !== undefined) return ret;\r\n            debugger;\r\n            console.error(`controller.uqs.${String(key)} undefined`);\r\n            onUqProxyError(String(key));\r\n            return undefined;\r\n        },\r\n    });\r\n}\r\n\r\nfunction buildTuidTv() {\r\n    (TuidInner.prototype as any).tv = function (this: any, id: number, render?: Render<any>): JSX.Element {\r\n        const TuidView = observer(() => {\r\n            let obj = this.valueFromId(id);\r\n            if (obj === undefined) {\r\n                this.useId(id);\r\n                return <>{this.sName}:{id}</>;\r\n            }\r\n            let r: Render<any>;\r\n            if (render) {\r\n                r = render;\r\n            }\r\n            else if (this.render) {\r\n                r = this.render;\r\n            }\r\n            else {\r\n                console.log('render', render, 'this.render', this.render);\r\n                r = (item: any) => {\r\n                    return <>{this.sName}:{uqStringify(item)}</>;\r\n                };\r\n            }\r\n            return r(obj);\r\n        });\r\n        return <><TuidView /></>;\r\n    };\r\n\r\n    (TuidImport.prototype as any).tv = function (this: any, id: number, render?: Render<any>): JSX.Element {\r\n        return this.tuidLocal?.tv(id, render);\r\n    };\r\n}\r\n","import { User, UQsLoader, UQsMan, UqQuery, Net, UqsConfig } from \"tonwa-uq\";\r\nimport {\r\n\t//UqsConfig as UqsConfigCore, AppConfig as AppConfigCore\r\n\tTonwa, setGlobalRes, RouteFunc, Hooks, Navigo, NamedRoute\r\n} from \"tonwa-core\";\r\nimport { ControllerWithWeb } from '../vm';\r\nimport { VErrorsPage, VStartError } from \"./vMain\";\r\nimport { uqsProxy } from \"../uq\";\r\nimport { t } from \"../ui\";\r\n\r\nexport interface IConstructor<T> {\r\n\tnew(...args: any[]): T;\r\n}\r\n\r\n/*\r\nexport interface DevConfig {\r\n\tname: string;\r\n\talias?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqConfig {\r\n\tdev: DevConfig;\r\n\tname: string;\r\n\talias?: string;\t\r\n\tversion?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqsConfig {\r\n\tapp?: {\r\n\t\tdev: DevConfig;\r\n\t\tname: string;\r\n\t\tversion?: string;\r\n\t};\r\n\tuqs?: UqConfig[];\r\n}\r\n*/\r\n\r\n//export type UqsConfig = UqsConfigCore;\r\nexport interface AppConfig extends UqsConfig {\r\n\t/*\r\n\tapp?: {\r\n\t\tname: string;\r\n\t\tversion: string;\r\n\t\townerMap?: {[key:string]: string};\r\n\t};\r\n\t*/\r\n\t//appName: string;        // 格式: owner/appName\r\n\tversion: string;        // 版本变化，缓存的uqs才会重载\r\n\t//tvs?: TVs;\r\n\t//uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n\tloginTop?: JSX.Element;\r\n\toem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// app的运行，不跟unit绑定\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id: string]: (element: HTMLElement) => void,\r\n}\r\n\r\nexport abstract class CAppBase<U> extends ControllerWithWeb {\r\n\tprivate appConfig: AppConfig;\r\n\tprivate uqsMan: UQsMan;\r\n\tprotected _uqs: U;\r\n\treadonly net: Net;\r\n\ttimezone: number;\r\n\tunitTimezone: number;\r\n\tunitBizMonth: number;\r\n\tunitBizDate: number;\r\n\r\n\tconstructor(tonwa: Tonwa, config?: AppConfig) {\r\n\t\tsuper(tonwa);\r\n\t\tthis.net = tonwa.net;\r\n\t\t//this.nav = new Nav(tonwa); // nav;\r\n\t\tthis.appConfig = config || (tonwa.navSettings as AppConfig);\r\n\t\tif (this.appConfig) {\r\n\t\t\tlet { uqs } = this.appConfig;\r\n\t\t\tif (uqs === undefined) {\r\n\t\t\t\tthrow new Error('uqs must be defined in AppConfig');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget uqs(): U { return this._uqs; }\r\n\r\n\tinternalT(str: string): any {\r\n\t\treturn t(str);\r\n\t}\r\n\r\n\tsetRes(res: any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\tprotected afterBuiltUQs(uqs: any) { }\r\n\r\n\tprotected async loadUnitTime($getTimezone: UqQuery<any, any>) {\r\n\t\tlet ret = await $getTimezone.query({});\r\n\t\tlet tz = ret.ret[0];\r\n\t\tthis.timezone = tz.timezone ?? 8;\r\n\t\tthis.unitTimezone = tz.unitTimeZone ?? 8;\r\n\t\tthis.unitBizMonth = (tz.unitBizMonth ?? 1) - 1;\r\n\t\tthis.unitBizDate = tz.unitBizDate ?? 1;\r\n\t}\r\n\r\n\tbizDate(date: Date): Date {\r\n\t\tlet year: number, month: number, d: number;\r\n\t\tyear = date.getFullYear();\r\n\t\tmonth = date.getMonth();\r\n\t\td = date.getDate();\r\n\t\tlet bm = this.unitBizMonth;\r\n\t\tlet bd = this.unitBizDate;\r\n\t\tif (bd < 0) {\r\n\t\t\tif (d < -bd) --month;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (d >= bd) ++month;\r\n\t\t}\r\n\t\tif (bm < 0) {\r\n\t\t\tif (month < -bm) --year;\r\n\t\t\tmonth = (month - bm) % 12;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (month >= bm) ++year;\r\n\t\t\tmonth = (month + bm) % 12;\r\n\t\t}\r\n\t\treturn new Date(year, month, 1);\r\n\t}\r\n\r\n\tprivate uqsUser: any = '';\r\n\tprotected async initUQs(): Promise<any> {\r\n\t\tif (!this.appConfig) return;\r\n\t\tlet { user } = this.tonwa;\r\n\t\tif (user === this.uqsUser) return;\r\n\t\tthis.uqsUser = user;\r\n\t\tthis.net.logoutApis();\r\n\t\tlet { version, uqs } = this.appConfig;\r\n\t\tlet uqsLoader = new UQsLoader(this.tonwa.net, version, uqs);\r\n\t\tlet retErrors = await uqsLoader.build();\r\n\t\tthis.uqsMan = uqsLoader.uqsMan;\r\n\t\tthis._uqs = uqsProxy(uqsLoader.uqsMan) as any; //  this.uqsMan.proxy;\r\n\t\tthis.afterBuiltUQs(this._uqs);\r\n\t\treturn retErrors;\r\n\t}\r\n\r\n\tprotected async beforeStart(): Promise<boolean> {\r\n\t\ttry {\r\n\t\t\tthis.onNavRoutes();\r\n\t\t\tlet retErrors = await this.initUQs();\r\n\t\t\tif (retErrors !== undefined) {\r\n\t\t\t\tthis.openVPage(VErrorsPage, retErrors);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tthis.openVPage(VStartError, err);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\tprotected async afterStart(): Promise<void> {\r\n\t\tthis.tonwa.resolveRoute();\r\n\t\tthis.tonwa.onChangeLogin = (user: User) => this.onChangeLogin(user);\r\n\t\tthis.onChangeLogin(this.user);\r\n\t}\r\n\r\n\tasync userFromId(userId: number): Promise<any> {\r\n\t\treturn await this.net.centerApi.userFromId(userId);\r\n\t}\r\n\r\n\tasync userFromName(userName: string): Promise<any> {\r\n\t\treturn await this.net.centerApi.userFromKey(userName);\r\n\t}\r\n\r\n\tprotected on(routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\tprotected on(url: string, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\tprotected on(regex: RegExp, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\tprotected on(options: { [url: string]: RouteFunc | NamedRoute }): Navigo;\r\n\tprotected on(...args: any[]): Navigo {\r\n\t\treturn this.tonwa.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprotected onNavRoutes() { return; }\r\n\r\n\tasync getUqRoles(uqName: string): Promise<string[]> {\r\n\t\tlet { user } = this.tonwa;\r\n\t\tif (!user) return null;\r\n\t\tlet { roles: userRoles } = user;\r\n\t\tlet uq = uqName.toLowerCase();\r\n\t\tlet roles: string[];\r\n\t\tif (userRoles) {\r\n\t\t\troles = userRoles[uq];\r\n\t\t}\r\n\t\tif (roles) return roles;\r\n\r\n\t\troles = await this.uqsMan.getUqUserRoles(uq);\r\n\t\tif (!roles) roles = null;\r\n\t\tthis.tonwa.setUqRoles(uq, roles);\r\n\t\treturn roles;\r\n\t}\r\n\t/*\r\n\tisAdmin(roles: string[]): boolean {\r\n\t\treturn this.isRole(roles, '$');\r\n\t}\r\n\r\n\tisRole(roles: string[], role: string): boolean {\r\n\t\tif (!roles) return false;\r\n\t\trole = role.toLowerCase();\r\n\t\treturn roles.indexOf(role) >= 0;\r\n\t}\r\n\t*/\r\n\r\n\tprotected onChangeLogin(user: User): Promise<void> {\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { Tonwa } from \"tonwa-core\";\r\nimport { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (tonwa: Tonwa, config: AppConfig) => CAppBase<any>, tonwa: Tonwa, appConfig: AppConfig, isUserLogin?: boolean) {\r\n\tif (appConfig) {\r\n\t\tlet { htmlTitle } = appConfig;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tlet cApp = new CApp(tonwa, appConfig);\r\n\tawait cApp.start(isUserLogin);\r\n}\r\n","import { User } from 'tonwa-uq';\r\nimport { Net } from 'tonwa-uq';\r\nimport { ControllerWithWeb, WebNav } from \"../vm\";\r\nimport { CAppBase, IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase<A extends CAppBase<U>, U> extends ControllerWithWeb {\r\n\tconstructor(cApp: A) {\r\n\t\tsuper(cApp.getTonwa());\r\n\t\tthis.cApp = cApp;\r\n\t\tif (cApp) {\r\n\t\t\tlet { uqs, net } = cApp;\r\n\t\t\tthis.uqs = uqs;\r\n\t\t\tthis.net = net;\r\n\t\t\t//this.nav = nav;\r\n\t\t}\r\n\t}\r\n\r\n\treadonly cApp: A;\r\n\treadonly uqs: U;\r\n\treadonly net: Net;\r\n\tget timezone(): number { return this.cApp.timezone; }\r\n\tget unitTimezone(): number { return this.cApp.unitTimezone; }\r\n\tbizDate(date: Date): Date { return this.cApp.bizDate(date); }\r\n\r\n\tasync getUqRoles(uqName: string): Promise<string[]> {\r\n\t\treturn this.cApp?.getUqRoles(uqName);\r\n\t}\r\n\r\n\tprotected async internalStart(param?: any, ...params: any[]): Promise<void> { }\r\n\r\n\tinternalT(str: string): any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r !== undefined) return r;\r\n\t\treturn this.cApp.internalT(str);\r\n\t}\r\n\r\n\tprotected newC<T extends CBase<A, U>>(type: IConstructor<T>, ...param: any[]): T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.internalInit(...param);\r\n\t\treturn c;\r\n\t}\r\n\r\n\tnewSub<O extends CBase<A, U>, T extends CSub<A, U, O>>(type: IConstructor<T>, ...param: any[]): T {\r\n\t\tlet s = new type(this);\r\n\t\ts.internalInit(...param);\r\n\t\treturn s;\r\n\t}\r\n\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this.cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ret = Object.assign({}, wn);\r\n\t\tObject.assign(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync userFromId(userId: number): Promise<User> {\r\n\t\treturn await this.net.centerApi.userFromId(userId);\r\n\t}\r\n\tasync userFromKey(userName: string): Promise<User> {\r\n\t\treturn await this.net.centerApi.userFromKey(userName);\r\n\t}\r\n}\r\n\r\nexport abstract class CSub<A extends CAppBase<U>, U, T extends CBase<A, U>> extends CBase<A, U> {\r\n\tprotected _owner: T;\r\n\r\n\tconstructor(owner: T) {\r\n\t\tsuper(owner.cApp);\r\n\t\tthis._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str: string): any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r !== undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n\tprotected get owner(): T { return this._owner }\r\n\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this.cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ownerWNs: WebNav<any>[] = [];\r\n\t\tfor (let p = this.owner; p !== undefined; p = (p as any)?.owner) {\r\n\t\t\townerWNs.push(p.webNav);\r\n\t\t}\r\n\t\tlet ret = Object.assign({}, wn);\r\n\t\tfor (; ;) {\r\n\t\t\tlet own = ownerWNs.pop();\r\n\t\t\tif (own === undefined) break;\r\n\t\t\tObject.assign(ret, own);\r\n\t\t}\r\n\t\tObject.assign(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { UqBuildContext } from \"tonwa-uq\";\r\n\r\nexport class UqBuildContextUI extends UqBuildContext {\r\n\tget uiPlatform(): string { return 'react' };\r\n\tget uiPlatformUpper(): string { return 'REACT' };\r\n\tget uiPlatformCamel(): string { return 'React' }\r\n\tget element(): string { return 'JSX.Element' }\r\n}\r\n","import React from 'react';\r\nimport { FA, Page } from './components';\r\nimport { Controller } from \"./vm/Controller\";\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { tonwa } from \"tonwa-core\";\r\n\r\nexport interface CStringEditProps {\r\n\tlabel?: string;\r\n\tplaceholder?: string;\r\n\tmaxLength?: number;\r\n\tonValueChange?: (value: string) => Promise<void>;\r\n}\r\n\r\nexport class CStringEdit extends Controller {\r\n\tprivate props: CStringEditProps = {\r\n\t\tlabel: '编辑'\r\n\t}\r\n\tvalue: string = null;\r\n\tnewValue: string = null;\r\n\tisChanged: boolean = null;\r\n\terror: string = null;\r\n\r\n\tconstructor() {\r\n\t\tsuper(tonwa);\r\n\t\tmakeObservable(this, {\r\n\t\t\tvalue: observable,\r\n\t\t\tnewValue: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\terror: observable,\r\n\t\t});\r\n\t}\r\n\r\n\tprotected async internalStart() { }\r\n\trender(value: string, props?: CStringEditProps) {\r\n\t\tthis.value = value;\r\n\t\tif (props) Object.assign(this.props, props);\r\n\t\treturn React.createElement(observer(() => <>{this.renderValue()}{this.renderPencil()}</>))\r\n\t}\r\n\r\n\tprotected renderValue() { return <>{this.value}</> }\r\n\tprotected renderPencil() {\r\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\r\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\r\n\t\t</span>;\r\n\t}\r\n\r\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.newValue = evt.target.value;\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\r\n\tprivate onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.verifyValue();\r\n\t}\r\n\r\n\tprotected verifyValue() { }\r\n\r\n\tprivate onFocus = () => {\r\n\t\tthis.error = undefined;\r\n\t}\r\n\r\n\tprivate onEdit = () => {\r\n\t\tlet { label, maxLength, placeholder, onValueChange } = this.props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tthis.value = this.newValue;\r\n\t\t\t\tthis.closePage();\r\n\t\t\t\tif (onValueChange) onValueChange(this.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet right = React.createElement(observer(() => <button\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center me-2\"\r\n\t\t\tdisabled={!this.isChanged}\r\n\t\t\tonClick={onSave}>保存</button>));\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tthis.openPage(<Page header={label} right={right}>\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n\t\t\t\t\tonBlur={this.onBlur}\r\n\t\t\t\t\tonFocus={this.onFocus}\r\n\t\t\t\t\tclassName=\"form-control\"\r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t{\r\n\t\t\t\t\tReact.createElement(observer(() => placeholder && <div className=\"small muted m-2\">{placeholder}</div>))\r\n\t\t\t\t}\r\n\t\t\t\t{this.error && <div className=\"text-danger\">{this.error}</div>}\r\n\t\t\t</div>\r\n\t\t</Page>);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { nav } from '../nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { tonwa } from 'tonwa-core';\r\nimport { Net, User } from 'tonwa-uq';\r\n\r\nexport type UserLoader = (userId: number) => Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate readonly net: Net;\r\n\tprivate readonly loader: UserLoader;\r\n\tprivate onLoaded: (user: User) => void;\r\n\tprivate map = observable(new Map<number, T | number>());\r\n\r\n\tconstructor(net: Net, loader: UserLoader) {\r\n\t\tthis.net = net;\r\n\t\tif (loader === undefined) loader = (userId: number) => this.net.userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id: number | any, onLoaded?: (user: User) => void) {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tthis.onLoaded = onLoaded;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id: number | any): any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof (id)) {\r\n\t\t\tcase 'object':\r\n\t\t\t\tid = id.id;\r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof (ret)) {\r\n\t\t\tdefault:\r\n\t\t\t\treturn ret;\r\n\t\t\tcase 'number':\r\n\t\t\t\tif (ret < 0) return id;\r\n\t\t\t\tthis.map.set(id, -id);\r\n\t\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\t\tif (!v) v = null;\r\n\t\t\t\t\tthis.map.set(id, v);\r\n\t\t\t\t\tif (this.onLoaded) this.onLoaded(v);\r\n\t\t\t\t}).catch(reason => {\r\n\t\t\t\t\tconsole.error(reason);\r\n\t\t\t\t});\r\n\t\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet staticUserCache: UserCache<any>;\r\nfunction getUserCache(net: Net) {\r\n\tif (staticUserCache === undefined) {\r\n\t\tstaticUserCache = new UserCache(net, undefined);\r\n\t}\r\n\treturn staticUserCache;\r\n}\r\n\r\nexport interface UserIconProps {\r\n\tnet: Net;\r\n\tid: number;\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n\taltImage?: string;\r\n\tnoneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps): JSX.Element => {\r\n\tlet { className, style, id, altImage, noneImage } = props;\r\n\tlet userCache = getUserCache(props.net);\r\n\tlet user = userCache.getValue(id);\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n\t\t\treturn <div className={classNames(className, 'image-none')} style={style}>\r\n\t\t\t\t{noneImage || <i className=\"fa fa-file-o\" />}\r\n\t\t\t</div>;\r\n\t}\r\n\tlet { icon } = user;\r\n\tif (!icon) {\r\n\t\treturn <div className={classNames(className, 'image-none')} style={style}>\r\n\t\t\t<i className=\"fa fa-file-o\" />\r\n\t\t</div>;\r\n\t}\r\n\tif (icon.startsWith(':') === true) {\r\n\t\ticon = tonwa.resUrl + icon.substr(1);\r\n\t}\r\n\treturn <img src={icon} className={className} alt=\"img\"\r\n\t\tstyle={style}\r\n\t\tonError={evt => {\r\n\t\t\tif (altImage) evt.currentTarget.src = altImage;\r\n\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t}} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tnet: Net;\r\n\tid?: number;\r\n\tuser?: number | User;\r\n\trender: (user: User) => JSX.Element;\r\n\tonLoaded?: (user: User) => void\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps): JSX.Element => {\r\n\tlet { net, id: idProp, user, render, onLoaded } = props;\r\n\tif (user === null) return <>null</>;\r\n\tlet userCache = getUserCache(net);\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object':\r\n\t\t\tlet {/*obj, */id } = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\tuseUser(net, id, onLoaded);\r\n\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(net, user as number, onLoaded);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(net, Number(user), onLoaded);\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n\t\t\treturn <>{user}</>;\r\n\t}\r\n\treturn render(user);\r\n});\r\n\r\nexport function useUser(net: Net, id: number | object, onLoaded?: (user: User) => void) {\r\n\tif (!id) return;\r\n\tif (typeof (id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tlet userCache = getUserCache(net);\r\n\tuserCache.use(id, onLoaded);\r\n}\r\n","import {makeObservable, observable} from 'mobx';\r\n\r\nexport interface Id {\r\n    id: number;\r\n}\r\n\r\nexport abstract class CacheIds<T extends Id> {\r\n    constructor(maxCount:number = 100) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tdict: observable,\r\n\t\t})\r\n        this.maxCount = maxCount;\r\n    }\r\n    private maxCount:number;\r\n    private arr:T[] = [];\r\n    dict = new Map<number, T>();\r\n\r\n    loadIds(ids:number[]) {\r\n        let arr:number[] = [];\r\n        for (let id of ids) {\r\n            if (id === null) continue;\r\n            let item = this.dict.get(id);\r\n            if (item === undefined) {\r\n                arr.push(id);\r\n                item = {id:id} as T;\r\n                this.dict.set(id, item);\r\n            }\r\n        }                \r\n        this.loadId(arr);\r\n    }\r\n\r\n    get(id:number):T {\r\n        if (id === undefined || id === null) return null;\r\n        let item = this.dict.get(id);\r\n        if (item === undefined) {\r\n            this.dict.set(id, {id:id} as T);\r\n            this.loadId([id]);\r\n            item = this.dict.get(id);\r\n        }\r\n        return item;\r\n    }\r\n    private setItem(id:number, item:T) {\r\n        if (item === undefined) {\r\n            this.dict.set(id, null);\r\n            this.arr.push({id: id} as T);\r\n        }\r\n        else {\r\n            this.dict.set(id, item);\r\n            this.arr.push(item);\r\n        }\r\n        if (this.arr.length > this.maxCount) {\r\n            item = this.arr.shift();\r\n            this.dict.delete(item.id);\r\n        }\r\n    }\r\n    private async loadId(ids:number[]) {\r\n        let items = await this._loadIds(ids);\r\n        if (items === undefined) {\r\n            for (let id of ids) {\r\n                if (id === null) continue;\r\n                let item = await this._loadId(id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n        else {\r\n            for (let id of ids) {\r\n                let item = items.find(v => v.id === id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract _loadIds(ids:number[]):Promise<T[]>;\r\n    protected abstract _loadId(id:number):Promise<T>;\r\n}\r\n","import * as React from 'react';\r\nimport { tonwa } from \"tonwa-core\";\r\n// import { nav } from '../nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler: any;\r\n    constructor(props: Props) {\r\n        super(props);\r\n        let { seconds } = props;\r\n        if (seconds === undefined) return;\r\n        this.state = { seconds };\r\n        if (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n            let { seconds } = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({ seconds: seconds });\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        tonwa.reload();\r\n    }\r\n    render() {\r\n        let { seconds } = this.state;\r\n        let title: string, msg: string;\r\n        if (seconds > 0) {\r\n            title = '程序升级中...';\r\n            msg = this.state.seconds + '秒钟之后自动重启动';\r\n        }\r\n        else {\r\n            title = '程序需要升级';\r\n            msg = '请点击下面按钮重启';\r\n        }\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n                    <span className=\"text-danger\">{title}</span>\r\n                    <br />\r\n                    {msg}\r\n                    <br />\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean) => Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps): JSX.Element => {\r\n    return <Page header=\"升级软件\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger me-3\" onClick={() => props.confirm(true)}>确认升级</button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\r\n}\r\n","import { makeObservable, observable, ObservableMap } from \"mobx\";\r\nimport { LocalDb, Net, NetProps } from \"tonwa-uq\";\r\nimport { env, Nav, Tonwa } from \"tonwa-core\";\r\nimport { Page } from './components';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport './css/va-form.css';\r\nimport './css/va.css';\r\nimport './css/animation.css';\r\nimport { ReloadPage, ConfirmReloadPage } from './components/reloadPage';\r\nimport { createLogin, showForget, showRegister } from './components/login';\r\nimport { NavView } from './nav';\r\n\r\nexport class TonwaReact extends Tonwa {\r\n    navView: NavView;\r\n\r\n    constructor() {\r\n        super();\r\n        makeObservable(this, {\r\n            user: observable,\r\n        });\r\n        this.setCreateLogin(createLogin);\r\n    }\r\n\r\n    createWeb(): Net {\r\n        let props: NetProps = {\r\n            unit: env.unit,\r\n            testing: env.testing,\r\n        }\r\n        return new WebInReact(props);\r\n    }\r\n\r\n    createObservableMap<K, V>(): Map<K, V> {\r\n        return observable.map({}, { deep: false });\r\n    }\r\n\r\n    set(navView: NavView) {\r\n        //this.logo = logo;\r\n        this.navView = navView;\r\n    }\r\n\r\n    get nav(): Nav<JSX.Element> { return this.navView };\r\n\r\n    renderNavView(onLogined: (isUserLogin?: boolean) => Promise<void>,\r\n        notLogined?: () => Promise<void>,\r\n        userPassword?: () => Promise<{ user: string; password: string }>,\r\n    ) {\r\n        return <NavView ref={nv => this.navView = nv}\r\n            onLogined={onLogined}\r\n            notLogined={notLogined}\r\n            userPassword={userPassword} />;\r\n    }\r\n\r\n    protected beforeStart(): void {\r\n        window.onerror = this.windowOnError;\r\n        window.onunhandledrejection = this.windowOnUnhandledRejection;\r\n        window.onfocus = this.reloadUser;\r\n    }\r\n\r\n    private windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n        debugger;\r\n        console.error('windowOnError');\r\n        console.error(error);\r\n    }\r\n    private windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n        debugger;\r\n        console.error('windowOnUnhandledRejection');\r\n        console.error(ev.reason);\r\n    }\r\n\r\n    /*\r\n    setIsWebNav() {\r\n        this.isWebNav = true;\r\n        this.navView.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n        this.navView.closeIcon = <i className=\"fa fa-close\" />;\r\n    }\r\n    */\r\n\r\n    // pageWebNav: PageWebNav;\r\n\r\n    async showAppView(isUserLogin?: boolean): Promise<void> {\r\n        let { onLogined } = this.navView.props;\r\n        if (onLogined === undefined) {\r\n            this.navView.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        this.nav.clear();\r\n        await onLogined(isUserLogin);\r\n    }\r\n\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent(): string {\r\n        if (!this.navSettings) return;\r\n        let { privacy } = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            this.navView.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (htmlString: string) => {\r\n        let content = { __html: htmlString };\r\n        this.navView.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n    async showRegister() {\r\n        showRegister(this);\r\n    }\r\n\r\n    async showForget() {\r\n        showForget(this);\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.navView.push(<ConfirmReloadPage confirm={(ok: boolean): Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n                localStorage.clear();\r\n            }\r\n            else {\r\n                this.navView.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n        this.navView.push(<ReloadPage message={msg} seconds={seconds} />);\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        this.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq: string, version: number): Promise<void> {\r\n        this.navView.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n}\r\n\r\nclass LocalStorageDb extends LocalDb {\r\n    getItem(key: string): string {\r\n        return localStorage.getItem(key);\r\n    }\r\n    setItem(key: string, value: string): void {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key: string): void {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nclass WebInReact extends Net {\r\n    createLocalDb(): LocalDb {\r\n        return new LocalStorageDb();\r\n    }\r\n    createObservableMap(): Map<number, any> {\r\n        return new ObservableMap();\r\n    }\r\n}","import { observer } from \"mobx-react-lite\";\r\nimport { SyntheticEvent } from \"react\";\r\nimport { Controller } from \"./Controller\";\r\n\r\nexport class View<C extends Controller = any, P = any> {\r\n    protected readonly controller: C;\r\n    protected readonly props: P;\r\n\r\n    constructor(controller: C, props: P = undefined) {\r\n        this.controller = controller;\r\n        this.props = props;\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        return null\r\n    }\r\n\r\n    protected react(func: () => JSX.Element): JSX.Element {\r\n        let V = observer(func);\r\n        return <V />;\r\n    }\r\n\r\n    protected res(t: string): string | JSX.Element {\r\n        return t;\r\n    }\r\n\r\n    async confirm(msg: string): Promise<boolean> {\r\n        return window.confirm(msg);\r\n    }\r\n\r\n    renderAdmin(el: JSX.Element | (() => JSX.Element)): JSX.Element {\r\n        if (typeof (el) === 'function') el = el();\r\n        return this.controller.app.renderAdmin(el);\r\n    }\r\n    renderRole(el: JSX.Element | (() => JSX.Element), ...roles: number[]): JSX.Element {\r\n        if (typeof (el) === 'function') el = el();\r\n        return this.controller.app.renderRole(el, ...roles);\r\n    }\r\n    renderAdminOrRole(el: JSX.Element | (() => JSX.Element), ...roles: number[]): JSX.Element {\r\n        if (typeof (el) === 'function') el = el();\r\n        return this.controller.app.renderAdminOrRole(el, ...roles);\r\n    }\r\n\r\n    waitingEvent<P, E extends SyntheticEvent<any>>(evt: E, handler: (params?: P) => Promise<void>, params?: P) {\r\n        let waiting = this.beforeWaiting(evt.currentTarget);\r\n        try {\r\n            handler(params).then(() => {\r\n                this.afterWaiting(waiting);\r\n            }).catch(reason => {\r\n                this.afterWaiting(waiting);\r\n                this.controller.app.setError(reason);\r\n            });\r\n        }\r\n        catch (err) {\r\n            this.controller.app.setError(err as any);\r\n        }\r\n    }\r\n\r\n    private beforeWaiting(element: HTMLElement): { target: HTMLElement; el: HTMLDivElement; disabled: boolean; } {\r\n        let width = element.offsetWidth;\r\n        let height = element.offsetHeight;\r\n        //let v = <div style={{ position: 'relative', left: 0, top: 0, width, height }}></div>;\r\n        let disabled = (element as any).disabled;\r\n        let style = element.getAttribute('style');\r\n        (element as any).disabled = true;\r\n        element.setAttribute('style', (style ?? '') + ' position: relative;');\r\n        let elWaiting = document.createElement('div');\r\n        elWaiting.setAttribute('style', `display:flex; position: absolute; opacity:0.5; left: 0; top: 0; width:${width}px; height:${height}px;align-items:center;justify-content:center;`);\r\n        elWaiting.innerHTML = '<i class=\"fa fa-spinner fa-spin\" />';\r\n        element.appendChild(elWaiting);\r\n        return { target: element, el: elWaiting, disabled };\r\n    }\r\n\r\n    private afterWaiting(waiting: { target: HTMLElement; el: HTMLDivElement; disabled: boolean; }) {\r\n        let { target, el, disabled } = waiting;\r\n        (target as any).disabled = disabled;\r\n        target.removeChild(el);\r\n    }\r\n}\r\n","import { FA, LMR, Page as TonwaReactPage, Scroller, TabsProps } from \"tonwa-react\";\r\nimport { Controller } from \"./Controller\";\r\nimport { View } from \"./View\";\r\n\r\nexport abstract class Page<C extends Controller = Controller, P = any> extends View<C, P> {\r\n    header(): string | boolean | JSX.Element { return null; }\r\n    right(): JSX.Element { return null; }\r\n    content(): JSX.Element { return <div className=\"p-3\">{this.header}</div>; }\r\n    footer(): JSX.Element { return null; }\r\n    logout(): boolean | (() => Promise<void>) { return false; }\r\n    render(): JSX.Element {\r\n        let header = this.header();\r\n        if (!header) header = false;\r\n        let logout = this.logout();\r\n        return <TonwaReactPage\r\n            header={header} right={this.right()} footer={this.footer()}\r\n            onScroll={(e: any) => this.onPageScroll(e)}\r\n            onScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n            onScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n            back={this.back}\r\n            headerClassName={this.headerClassName}\r\n            className={this.className}\r\n            tabsProps={this.tabsProps}\r\n            logout={logout}\r\n        >\r\n            {this.renderError()}\r\n            {this.content()}\r\n        </TonwaReactPage>;\r\n        //afterBack={() => this.internalAfterBack()}\r\n    }\r\n\r\n    private renderError() {\r\n        return this.react(() => {\r\n            let { app } = this.controller;\r\n            let { error } = app.shallow;\r\n            if (!error) return null;\r\n            let { name, message } = error;\r\n            return <LMR className=\"border-bottom bg-light align-items-center text-muted mb-3\"\r\n                left={\r\n                    <div className=\"cursor-pointer px-3 py-2\" onClick={() => app.setError(null)}>\r\n                        <FA name=\"times-circle\" className=\"text-danger\" size=\"lg\" />\r\n                    </div>\r\n                }\r\n                right={<div className=\"cursor-pointer px-3 py-2\" onClick={this.controller.openError}><FA name=\"angle-right\" /></div>}\r\n            >\r\n                {name} {message}\r\n            </LMR>;\r\n        });\r\n    }\r\n    /*\r\n    protected internalAfterBack() {\r\n        if (!this.afterBack) return;\r\n        this.afterBack();\r\n    }\r\n    */\r\n\r\n    callValue: any;\r\n    //afterBack: () => void | Promise<void>;\r\n\r\n    protected onPageScroll(e: any) { }\r\n    protected async onPageScrollTop(scroller: Scroller): Promise<boolean> { return false; }\r\n    protected async onPageScrollBottom(scroller: Scroller): Promise<void> { return; }\r\n    // protected afterBack(): void { }\r\n    protected get back(): 'close' | 'back' | 'none' { return 'back' }\r\n    protected get headerClassName(): string { return null; }\r\n    protected get className(): string { return null; }\r\n    protected get tabsProps(): TabsProps { return null; }\r\n}\r\n","import { Controller } from \"./Controller\";\r\nimport { Page } from \"./Page\";\r\n\r\nexport class PError extends Page<Controller, Error> {\r\n    header(): string | boolean | JSX.Element {\r\n        let { name } = this.props;\r\n        return name;\r\n        /*\r\n        return <span>\r\n            <FA name=\"times\" className=\"mx-3 text-danger\" />\r\n            {name}\r\n        </span>;\r\n        */\r\n    }\r\n\r\n    protected get headerClassName(): string {\r\n        return 'text-danger bg-warning bg-gradient'\r\n    }\r\n\r\n    protected get back(): \"close\" | \"back\" | \"none\" {\r\n        return 'close';\r\n    }\r\n\r\n    content() {\r\n        let { message, stack } = this.props;\r\n        return <div className=\"p-3\">\r\n            <div>{message}</div>\r\n            <div>{stack}</div>\r\n        </div>\r\n    }\r\n}","import { FA } from \"tonwa-react\";\r\nimport { Page } from \"./Page\";\r\n\r\nexport class PWaiting extends Page {\r\n    header(): string | boolean | JSX.Element {\r\n        return '...';\r\n    }\r\n\r\n    protected get headerClassName(): string {\r\n        return 'bg-secondary';\r\n    }\r\n\r\n    protected get back(): \"close\" | \"back\" | \"none\" {\r\n        return 'none';\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"p-5 text-center\">\r\n            <FA name=\"spinner\" size=\"lg\" className=\"text-info\" spin={true} />\r\n        </div>;\r\n    }\r\n}\r\n","import { AnnotationsMap, makeObservable, observable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react-lite';\r\nimport React from 'react';\r\n\r\nfunction buildReactiveProps<T extends object>(data: T, ob: any): AnnotationsMap<T, never> {\r\n    let ret: AnnotationsMap<T, never> = {};\r\n    for (let i in data) {\r\n        let v = data[i];\r\n        switch (typeof v) {\r\n            default:\r\n                ob = observable;\r\n                break;\r\n            case 'object':\r\n            case 'function':\r\n                break;\r\n        }\r\n        (ret as any)[i] = ob;\r\n    }\r\n    return ret;\r\n}\r\n\r\nexport function deepReact<T extends object>(data: T): T {\r\n    let ret = makeObservable(data, buildReactiveProps(data, observable));\r\n    return ret;\r\n}\r\n\r\nexport function shallowReact<T extends object>(data: T): T {\r\n    let ret = makeObservable(data, buildReactiveProps(data, observable.shallow));\r\n    return ret;\r\n}\r\n\r\nexport function setReact<T>(fn: () => T): T {\r\n    return runInAction(fn);\r\n}\r\n\r\nexport function react(func: () => JSX.Element): JSX.Element {\r\n    let V = observer(func);\r\n    return React.createElement(V);\r\n}\r\n","import { AppBase } from './AppBase';\r\nimport { Page } from './Page';\r\nimport { PError } from './PError';\r\nimport { PWaiting } from './PWaiting';\r\nimport { setReact } from './Reactive';\r\nimport { View } from './View';\r\n\r\nexport abstract class Controller<A extends AppBase = AppBase> {\r\n    readonly app: A;\r\n    constructor(app: A) {\r\n        this.app = app;\r\n    }\r\n\r\n    get waiting(): new (c: Controller) => Page { return undefined; }\r\n\r\n    res(t: string): string | JSX.Element {\r\n        return t;\r\n    }\r\n\r\n    open<C extends Controller, P = any>(Pg: new (c: C, props: P) => Page<C>, props?: P, afterClose?: (page: Page<C>) => void): void;\r\n    open<C extends Controller, P = any>(promise: Promise<void>, Pg: new (c: C, props: P) => Page<C>, props?: P, afterClose?: (page: Page<C>) => void): void;\r\n    open<C extends Controller>(...params: any[]): void {\r\n        let p0 = params[0];\r\n        if (typeof p0 === 'object') {\r\n            if (typeof (p0.then) === 'function') {\r\n                let isWaiting = false;\r\n                setTimeout(() => {\r\n                    if (isWaiting === undefined) return;\r\n                    this.open(this.waiting ?? this.app.waiting ?? PWaiting);\r\n                    isWaiting = true;\r\n                }, 100);\r\n                (p0 as Promise<void>).then(() => {\r\n                    if (isWaiting === true) {\r\n                        this.close();\r\n                    }\r\n                    isWaiting = undefined;\r\n                    let Pg = params[1];\r\n                    let props = params[2];\r\n                    let afterClose = params[3];\r\n                    let p: Page<C> = new Pg(this as unknown as C, props) as any;\r\n                    this.app.open(p.render(), () => afterClose?.(p));\r\n                    return;\r\n                });\r\n                return;\r\n            }\r\n        }\r\n\r\n        let Pg = p0;\r\n        let props = params[1];\r\n        let afterClose = params[2];\r\n        let p: Page<C> = new Pg(this as unknown as C, props) as any;\r\n        this.app.open(p.render(), () => afterClose?.(p));\r\n    }\r\n\r\n    close(level: number = 1) {\r\n        this.app.close(level);\r\n    }\r\n\r\n    render<C extends Controller, P = any>(V: new (c: this, props: P) => View<C>, props?: P): JSX.Element {\r\n        let v = new V(this as any, props);\r\n        return v.render();\r\n    }\r\n\r\n    // private callPromises: (any | PromiseLike<any>)[] = [];\r\n    call<R, C extends Controller = this, P = any>(Pg: new (c: C, props: P) => Page<C>, props?: P): Promise<R> {\r\n        return new Promise<R>(async (resolve, reject) => {\r\n            //this.callPromises.push(resolve);\r\n            this.open(Pg, props, (page: Page<C>) => {\r\n                resolve(page.callValue);\r\n            });\r\n        });\r\n    }\r\n\r\n    callReturn(page: Page<any>, ret: any) {\r\n        page.callValue = ret;\r\n    }\r\n\r\n    async waitFor(ms: number): Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            setTimeout(() => {\r\n                resolve();\r\n            }, ms);\r\n        });\r\n    }\r\n\r\n    openError = () => {\r\n        let { error } = this.app.shallow;\r\n        if (!error) return;\r\n        setReact(() => {\r\n            this.app.shallow.error = null;\r\n            this.open(PError, error);\r\n        });\r\n    }\r\n\r\n    fetch<T>(promise: Promise<T>): Promise<T> {\r\n        return new Promise<T>((resolve, reject) => {\r\n            promise\r\n                .then(resolve)\r\n                .catch((reason: any) => {\r\n                    this.app.setError(reason);\r\n                    reject(reason);\r\n                });\r\n        })\r\n    }\r\n}\r\n","import { Schema, UiSchema } from \"tonwa-react\";\r\nimport { Uq, ID } from \"tonwa-uq\";\r\nimport { Controller } from \"../Controller\";\r\nimport { deepReact, react, setReact } from \"../Reactive\";\r\nimport { VAdd } from \"./VAdd\";\r\nimport { VStart } from \"./VStart\";\r\nimport { VEditId } from \"./VEditId\";\r\nimport { IdCache } from \"./IdCache\";\r\nimport { AppBase, Page } from \"tonwa-contoller\";\r\nimport { mutedSmall } from \"../tool\";\r\n\r\nexport enum EnumSelectType {\r\n    listAll,            // 一次列出所有的项目，供选择\r\n    search,             // 输入文字，再选择\r\n    listAndSearch,      // 列出部分，还可以搜索\r\n};\r\n\r\nexport interface SelectOptions {\r\n    listAll?: boolean;              // default: true\r\n    search?: boolean;               // default: true\r\n    valueRender?: IdValueRender;\r\n    allowNew?: boolean;             // default: allow new\r\n};\r\n\r\nexport interface IdValue {\r\n    id: number;\r\n};\r\n\r\nexport type Render = () => JSX.Element;\r\nexport type IdValueRender = (value: IdValue) => JSX.Element;\r\nexport type ValuesRender = (values: JSX.Element[]) => JSX.Element;\r\nexport type RefRender = (onClick: () => void, content: JSX.Element) => JSX.Element;\r\n\r\ninterface IDDeep {\r\n    list: IdValue[];\r\n    currentItem: any;\r\n}\r\n\r\nconst caches: { [id: string]: IdCache } = {}\r\n\r\nexport abstract class CIdBase<A extends AppBase = AppBase> extends Controller<A> {\r\n    private cache: IdCache;\r\n    protected ID: ID;\r\n\r\n    initNO: string;\r\n    readonly deepData = deepReact<IDDeep>({\r\n        list: null,\r\n        currentItem: null,\r\n    });\r\n\r\n    protected initID() {\r\n        this.ID = this.getID();\r\n        let { name } = this.ID;\r\n        this.cache = caches[name];\r\n        if (this.cache === undefined) {\r\n            this.cache = new IdCache(this);\r\n            caches[name] = this.cache;\r\n        }\r\n    }\r\n\r\n    abstract get uq(): Uq;\r\n    abstract getID(): ID;\r\n    abstract get caption(): string;\r\n    abstract get schema(): Schema;\r\n    abstract get uiSchema(): UiSchema;\r\n    abstract renderTagInput(): JSX.Element;\r\n    get icon(): string { return null; }\r\n    get iconClass(): string { return undefined; }\r\n    get isGlobal(): boolean { return this.ID.isGlobal; }\r\n\r\n    getIdValue(id: number): any {\r\n        return this.cache.getValue(id);\r\n    }\r\n\r\n    protected setIDDeepList(list: any[]) {\r\n        this.deepData.list = list;\r\n    }\r\n\r\n    protected async initAdd() {\r\n        let ID = this.ID;\r\n        if (ID) {\r\n            this.initNO = await this.uq.IDNO({ ID });\r\n            setReact(() => {\r\n                this.deepData.currentItem = null;\r\n            });\r\n        }\r\n    }\r\n\r\n    private addedIds: number[];\r\n    private afterAddCallback: (ids: number[]) => Promise<void>;\r\n    setAfterAdd(func: (ids: number[]) => Promise<void>) {\r\n        this.afterAddCallback = func;\r\n    }\r\n\r\n    get VAdd(): new (c: CIdBase) => Page<CIdBase> {\r\n        return VAdd;\r\n    }\r\n    onAdd = async (): Promise<void> => {\r\n        this.addedIds = [];\r\n        await this.initAdd();\r\n        this.open(this.VAdd, this.afterAdded);\r\n    }\r\n\r\n    get ids(): number[] { return this.addedIds; }\r\n\r\n    afterAdded = async () => {\r\n        if (this.afterAddCallback) {\r\n            await this.afterAddCallback(this.addedIds);\r\n            this.afterAddCallback = undefined;\r\n        }\r\n        else {\r\n            await this.loadToList();\r\n        }\r\n    }\r\n\r\n    async loadValue(id: number): Promise<IdValue> {\r\n        let ret = await this.uq.ID({ IDX: this.ID, id: id });\r\n        if (ret.length === 0) return null;\r\n        return ret[0] as IdValue;\r\n    }\r\n\r\n    protected abstract loadList(): Promise<any[]>;\r\n    abstract loadItemsFromIds(ids: number[]): Promise<any[]>;\r\n\r\n    async loadToList() {\r\n        let list = await this.loadList();\r\n        setReact(() => {\r\n            this.setIDDeepList(list);\r\n        });\r\n    }\r\n\r\n    async onSaveId(data: any) {\r\n        let id = await this.saveId(data);\r\n        this.addedIds.push(id);\r\n    }\r\n\r\n    savePropValue(id: number, name: string, value: any): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    protected abstract saveId(data: any): Promise<number>;\r\n\r\n    async search(key: string): Promise<any[]> {\r\n        return null;\r\n    }\r\n\r\n    get VStart(): new (c: CIdBase) => Page<CIdBase> {\r\n        return VStart;\r\n    }\r\n\r\n    async openMain() {\r\n        this.open(this.VStart);\r\n        await this.loadToList();\r\n    }\r\n\r\n    get VEdit(): new (c: CIdBase) => Page<CIdBase> {\r\n        return VEditId;\r\n    }\r\n\r\n    protected async beforeEdit() {\r\n        // await this.waitFor(10);\r\n    }\r\n\r\n    onEditItem = async (item: any) => {\r\n        setReact(async () => {\r\n            this.deepData.currentItem = item;\r\n            this.open(this.beforeEdit(), this.VEdit);\r\n        });\r\n    }\r\n\r\n    renderItemInList(item: any): JSX.Element {\r\n        return this.renderIdValue(item);\r\n    }\r\n\r\n    renderItemOnSelect(item: any): JSX.Element {\r\n        return this.renderItemInList(item);\r\n    }\r\n\r\n    abstract renderIdValue(idValue: IdValue): JSX.Element;\r\n\r\n    renderId(id: number): JSX.Element {\r\n        return react(() => {\r\n            let val = this.getIdValue(id);\r\n            if (val === null || val === undefined) {\r\n                return mutedSmall(id);\r\n            }\r\n            return this.renderIdValue(val);\r\n        });\r\n    }\r\n}\r\n","import { UserApi } from \"./UserApi\";\r\nimport { Nav } from \"./Nav\";\r\nimport { CUser } from \"./CUser\";\r\nimport { Page } from \"./Page\";\r\nimport { setReact, shallowReact } from \"./Reactive\";\r\n\r\nexport abstract class AppBase {\r\n    shallow: {\r\n        error: {\r\n            name: string;\r\n            message: string;\r\n            stack: string;\r\n        };\r\n    } = shallowReact({\r\n        error: null,\r\n    });\r\n\r\n    abstract get cUser(): CUser;\r\n    abstract get userApi(): UserApi;\r\n    abstract get nav(): Nav;\r\n\r\n    open(page: JSX.Element, afterClose?: () => void): void {\r\n        this.nav.open(page, afterClose);\r\n    }\r\n\r\n    close(level: number): void {\r\n        this.nav.close(level);\r\n    }\r\n\r\n    get waiting(): new () => Page { return null; }\r\n\r\n    renderAdmin(el: JSX.Element): JSX.Element { return null; }\r\n    renderRole(el: JSX.Element, ...roles: number[]): JSX.Element { return null; }\r\n    renderAdminOrRole(el: JSX.Element, ...roles: number[]): JSX.Element { return null; }\r\n    setError(error: Error) {\r\n        setReact(() => {\r\n            if (!error) {\r\n                this.shallow.error = null;\r\n            }\r\n            else {\r\n                this.shallow.error = {\r\n                    name: error.name,\r\n                    message: error.message,\r\n                    stack: error.stack,\r\n                };\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { Page } from \"../Page\";\r\nimport { CSelect, CSelectMulti, CSelectOne } from \"./CSelect\";\r\nimport { FA, List, SearchBox } from \"tonwa-react\";\r\nimport { IdValue, SelectOptions } from \".\";\r\n\r\nabstract class VSelect<C extends CSelect<any>> extends Page<C, SelectOptions> {\r\n    header(): string | boolean | JSX.Element {\r\n        return this.controller.cId.caption;\r\n    }\r\n\r\n    protected get back(): \"close\" | \"back\" | \"none\" {\r\n        return \"close\";\r\n    }\r\n\r\n    right(): JSX.Element {\r\n        if (this.props?.search === false) return null;\r\n        return <SearchBox className=\"me-2\" onSearch={this.controller.search} />;\r\n    }\r\n}\r\n\r\nexport class VSelectOne extends VSelect<CSelectOne> {\r\n    content(): JSX.Element {\r\n        let vNew: any;\r\n        if (this.props?.allowNew !== false) {\r\n            vNew = <div className=\"px-3 py-2 align-items-center cursor-pointer mb-3 bg-white\"\r\n                onClick={this.controller.onNew}>\r\n                <FA name=\"plus\" className=\"me-3 text-warning\" fixWidth={true} />\r\n                New {this.controller.cId.caption}\r\n            </div>;\r\n        }\r\n        return this.react(() => <div className=\"\">\r\n            {vNew}\r\n            <List items={this.controller.shallowData.items} item={{ render: this.renderItem, onClick: this.onItemClick }} />\r\n        </div>);\r\n    }\r\n\r\n    private renderItem = (item: any, index: number) => {\r\n        let { cId } = this.controller;\r\n        let vItem: any;\r\n        let valueRender = this.props?.valueRender;\r\n        if (valueRender !== undefined) vItem = valueRender(item);\r\n        else vItem = cId.renderItemOnSelect(item);\r\n        let { icon } = cId;\r\n        let vIcon: any;\r\n        if (icon) {\r\n            vIcon = <FA name=\"user-o\" className=\"me-3 text-primary \" fixWidth={true} />;\r\n        }\r\n        return <div className=\"px-3 py-2 align-items-center\">\r\n            {vIcon}\r\n            {vItem}\r\n        </div>;\r\n    }\r\n\r\n    private onItemClick = (item: any) => {\r\n        this.controller.callReturn(this, item);\r\n        this.controller.close();\r\n    }\r\n}\r\n\r\nexport class VSelectMulti extends VSelect<CSelectMulti> {\r\n    content(): JSX.Element {\r\n        return <div className=\"p-3\">\r\n            <div>select multi</div>\r\n            <button onClick={this.onSelected}>select 1,2,3</button>\r\n        </div>;\r\n    }\r\n\r\n    private onItemClick = (item: any) => {\r\n\r\n    }\r\n\r\n    private onSelected = () => {\r\n        this.controller.callReturn(this, [\r\n            { id: 78905344 } as IdValue,\r\n            { id: 78905346 } as IdValue,\r\n            { id: 78905347 } as IdValue,\r\n        ]);\r\n        this.controller.close();\r\n    }\r\n}\r\n","import { setReact, shallowReact } from \"tonwa-contoller\";\r\nimport { IdValue } from \".\";\r\nimport { Controller } from \"../Controller\";\r\nimport { Page } from \"../Page\";\r\nimport { CIdBase, SelectOptions } from \"./CIdBase\";\r\nimport { VSelectMulti, VSelectOne } from \"./VSelect\";\r\n\r\nexport abstract class CSelect<R extends IdValue | IdValue[]> extends Controller {\r\n    cId: CIdBase;\r\n    //resolve: (value: R | PromiseLike<R>) => void;\r\n    shallowData: {\r\n        items: any[];\r\n    } = shallowReact({\r\n        items: null,\r\n    });\r\n\r\n    constructor(cId: CIdBase) {\r\n        super(cId.app);\r\n        this.cId = cId;\r\n    }\r\n\r\n    protected abstract get VSelect(): new (c: any) => Page<any>;\r\n\r\n    async select(options?: SelectOptions): Promise<R> {\r\n        if (options?.listAll !== false) {\r\n            await this.search(undefined);\r\n        }\r\n        return await this.call<R>(this.VSelect, options);\r\n    }\r\n\r\n    search = async (key: string): Promise<void> => {\r\n        let ret = await this.cId.search(key ?? '');\r\n        setReact(() => {\r\n            this.shallowData.items = ret;\r\n        });\r\n    }\r\n\r\n    onNew = async () => {\r\n        this.cId.setAfterAdd(async (ids: number[]) => {\r\n            let ret = await this.cId.loadItemsFromIds(ids);\r\n            setReact(() => {\r\n                this.shallowData.items.unshift(...ret);\r\n            });\r\n        });\r\n        await this.cId.onAdd();\r\n        //this.close();\r\n        //this.resolve(item.id);\r\n    }\r\n}\r\n\r\nexport class CSelectOne extends CSelect<IdValue> {\r\n    protected get VSelect(): new (c: CSelectOne) => Page<CSelectOne> {\r\n        return VSelectOne as any;\r\n    }\r\n}\r\n\r\nexport class CSelectMulti extends CSelect<IdValue[]> {\r\n    protected get VSelect(): new (c: this) => Page<this> {\r\n        return VSelectMulti as any;\r\n    }\r\n}\r\n","import { Context, Form } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CIdBase } from \"./CIdBase\";\r\n\r\nexport class VAdd<C extends CIdBase = any> extends Page<C> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'New ' + this.controller.caption;\r\n    }\r\n\r\n    protected renderForm() {\r\n        let { schema, uiSchema } = this.controller;\r\n        schema = [...schema, { name: 'submit', type: 'submit' }];\r\n        return <Form schema={schema} uiSchema={uiSchema} fieldLabelSize={2}\r\n            onButtonClick={this.onSave}\r\n        />;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return <div className=\"p-3\">{this.renderForm()}</div>;\r\n    }\r\n\r\n    private onSave = async (name: string, context: Context) => {\r\n        let data = context.data;\r\n        await this.controller.onSaveId(data);\r\n        this.controller.close();\r\n        this.controller.open(VSucceed as any);\r\n    }\r\n}\r\n\r\nclass VSucceed extends Page<CIdBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Saved'\r\n    }\r\n    protected get back(): \"close\" | \"back\" | \"none\" {\r\n        return 'close';\r\n    }\r\n    content(): JSX.Element {\r\n        return <div>\r\n            <div className=\"m-5 border border-warning rounded-3 bg-white w-30c p-5 mx-auto\">\r\n                <div className=\"text-center\">Saved OK! </div>\r\n                <div className=\"mt-5 text-center\">\r\n                    <button className=\"btn btn-primary me-3\" onClick={this.onNext}>Continue Input</button>\r\n                    <button className=\"btn btn-outline-primary\" onClick={this.onExit}>Exit</button>\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n    onNext = async () => {\r\n        this.controller.close();\r\n        await this.controller.onAdd();\r\n    }\r\n\r\n    onExit = async () => {\r\n        this.controller.close();\r\n    }\r\n}\r\n","import { FA, List, LMR } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CIdBase } from \"./CIdBase\";\r\n\r\nexport class VStart extends Page<CIdBase> {\r\n    header() { return this.controller.caption; }\r\n    right() {\r\n        return <button className=\"btn btn-sm btn-success me-2\" onClick={this.controller.onAdd}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n    content() {\r\n        return this.react(() => <List items={this.controller.deepData.list}\r\n            item={{ render: this.renderItem, onClick: this.controller.onEditItem }} />\r\n        );\r\n    }\r\n\r\n    private renderItem = (item: any, index: number) => {\r\n        let { icon, iconClass } = this.controller;\r\n        let vIcon: any;\r\n        if (icon) {\r\n            vIcon = <FA name={icon} className={'me-4 ' + (iconClass ?? 'text-primary')} fixWidth={true} size=\"lg\" />;\r\n        }\r\n        let right = <FA name=\"angle-right\" />\r\n        return <LMR className=\"px-3 py-2 align-items-center\" left={vIcon} right={right}>\r\n            <div>\r\n                {this.controller.renderItemInList(item)}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n}\r\n","import { createEdit, setReact } from \"tonwa-contoller\";\r\nimport { LMR, Pick } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CIdBase } from \"./CIdBase\";\r\n\r\n//const cnRow = 'px-3 py-2 bg-white border-bottom cursor-pointer';\r\n\r\nexport class VEditId<C extends CIdBase = any> extends Page<C> {\r\n    header(): string | boolean | JSX.Element {\r\n        return this.controller.caption + ' ' + this.controller.deepData.currentItem.no;\r\n    }\r\n\r\n    protected renderProps() {\r\n        return this.react(() => {\r\n            let { schema, uiSchema, deepData } = this.controller;\r\n            let { currentItem } = deepData;\r\n            if (!uiSchema) {\r\n                uiSchema = { items: {} };\r\n            }\r\n            let vProps = schema.map((v, index) => {\r\n                let { name } = v;\r\n                let uiItem = uiSchema.items[name];\r\n                let label: string | JSX.Element;\r\n                let readOnly: boolean;\r\n                let pick: Pick;\r\n                if (uiItem) {\r\n                    label = uiItem.label ?? name;\r\n                    readOnly = uiItem.readOnly;\r\n                    pick = (uiItem as any).pick;\r\n                }\r\n                else {\r\n                    label = name;\r\n                    readOnly = false;\r\n                }\r\n                let value = currentItem[name];\r\n                let cEdit = createEdit(this.controller.app, {\r\n                    pick,\r\n                    itemSchema: v,\r\n                    uiItem,\r\n                    value,\r\n                    onChanged: this.propValueSave\r\n                });\r\n                let right = cEdit.renderEditIcon();\r\n                let onEdit: any;\r\n                let cn = 'mb-3 row bg-white align-items-center ';\r\n                if (readOnly === true) {\r\n                    onEdit = undefined;\r\n                }\r\n                else {\r\n                    onEdit = cEdit.onEdit;\r\n                    cn += 'cursor-pointer ';\r\n                }\r\n                return <div key={index} onClick={onEdit}\r\n                    className={cn}>\r\n                    <label className=\"col-sm-2 col-form-label\">{label}</label>\r\n                    <div className=\"col-sm-10\">\r\n                        <LMR right={readOnly !== true && right}>\r\n                            {cEdit.renderRef()}\r\n                        </LMR>\r\n                    </div>\r\n                </div>\r\n            });\r\n            return <div className=\"container\">{vProps}</div>;\r\n        });\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"py-3\">\r\n            {this.renderProps()}\r\n            {this.renderTagInput()}\r\n        </div>\r\n    }\r\n\r\n    private propValueSave = async (name: string, value: any) => {\r\n        let { deepData } = this.controller;\r\n        await this.controller.savePropValue(deepData.currentItem.id, name, value);\r\n        setReact(() => {\r\n            deepData.currentItem[name] = value;\r\n        });\r\n    }\r\n\r\n    protected renderTagInput() {\r\n        let vTagInput = this.controller.renderTagInput();\r\n        if (!vTagInput) return null;\r\n        return <div className=\"my-3 border rounded-3 pt-2\">\r\n            <div className=\"px-3 pb-2 small text-muted\">Tags</div>\r\n            {vTagInput}\r\n        </div>;\r\n    }\r\n}\r\n","import { setReact, shallowReact } from \"../Reactive\";\r\nimport { CIdBase, IdValue } from \"./CIdBase\";\r\n\r\ninterface ShallowData {\r\n    cache: Map<number, IdValue>;\r\n}\r\n\r\nexport class IdCache {\r\n    private readonly shallowData: ShallowData = shallowReact<ShallowData>({\r\n        cache: new Map<number, IdValue>(),\r\n    });\r\n\r\n    private readonly cId: CIdBase;\r\n    constructor(cId: CIdBase) {\r\n        this.cId = cId;\r\n    }\r\n\r\n    getValue(id: number): IdValue {\r\n        let ret = this.shallowData.cache.get(id);\r\n        if (ret === null) return null;\r\n        if (ret === undefined) {\r\n            this.loadValue(id);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    async loadValue(id: number) {\r\n        try {\r\n            let ret = await this.cId.loadValue(id);\r\n            this.setCache(id, ret);\r\n        }\r\n        catch {\r\n            this.setCache(id, null);\r\n        }\r\n    }\r\n\r\n    setCache(id: number, value: IdValue) {\r\n        setReact(() => this.shallowData.cache.set(id, value));\r\n    }\r\n}\r\n","export function mutedSmall(text: number | string | JSX.Element) {\r\n    return <small className=\"text-muted\">{text}</small>;\r\n}\r\n","import { View } from \"tonwa-contoller\";\r\nimport { FA } from \"tonwa-react\";\r\nimport { CEdit } from \"./CEdit\";\r\n\r\nexport class VRef extends View<CEdit> {\r\n    render() {\r\n        let { shallowValue, props } = this.controller;\r\n        let { pick } = props;\r\n        if (pick) return pick.ref();\r\n        return this.react(() => {\r\n            let { value } = shallowValue;\r\n            return <div>{value ?? <small className=\"text-muted\"> - </small>}</div>;\r\n        });\r\n    }\r\n}\r\n\r\nexport class VEditIcon extends View<CEdit> {\r\n    render() {\r\n        return <FA name=\"pencil-square-o\" className=\"text-primary\" />;\r\n    }\r\n}","import { AppBase, Page, shallowReact } from \"tonwa-contoller\";\r\nimport { FieldRule, ItemSchema, Pick, UiItem } from \"tonwa-react\";\r\nimport { Controller } from \"../Controller\";\r\nimport { VEditIcon, VRef } from \"./VRef\";\r\n\r\nexport interface EditProps {\r\n    readonly itemSchema: ItemSchema;\r\n    readonly uiItem: UiItem;\r\n    readonly onChanged: (name: string, value: any) => Promise<void>;\r\n    readonly value: any;\r\n    readonly pick?: Pick;\r\n    readonly exView?: JSX.Element;      // can add extra action or message on the bottom of page\r\n}\r\n\r\nexport abstract class CEdit extends Controller {\r\n    readonly props: EditProps;\r\n    readonly shallowValue: {\r\n        value: any;\r\n    };\r\n    constructor(nav: AppBase, props: EditProps) {\r\n        super(nav);\r\n        this.props = props;\r\n        this.shallowValue = shallowReact({ value: props.value })\r\n    }\r\n\r\n    renderRef(): JSX.Element { return this.render(VRef); }\r\n\r\n    get label(): string | JSX.Element {\r\n        let { itemSchema, uiItem } = this.props;\r\n        return uiItem?.label ?? itemSchema.name;\r\n    }\r\n\r\n    renderEditIcon() { return this.render(VEditIcon); }\r\n\r\n    verifyValue(value: any): string {\r\n        let { uiItem } = this.props;\r\n        if (uiItem === undefined) return;\r\n        let { rules } = uiItem;\r\n        if (rules === undefined) return;\r\n        function verifyRule(rule: FieldRule, v: any): string {\r\n            let error = rule(v);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, value);\r\n                if (error !== undefined) {\r\n                    return error;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            return verifyRule(rules as FieldRule, value);\r\n        }\r\n    }\r\n\r\n    get Page(): new (c: CEdit) => Page<CEdit> { return undefined; }\r\n\r\n    onEdit = () => {\r\n        this.open(this.Page);\r\n    }\r\n}\r\n","import { ChangeEvent } from 'react';\r\nimport { CEdit } from './CEdit';\r\nimport { setReact } from '../Reactive';\r\nimport { AppBase } from 'tonwa-contoller';\r\nimport { EditProps } from '.';\r\n\r\nexport class CCheckEdit extends CEdit {\r\n    constructor(nav: AppBase, props: EditProps) {\r\n        super(nav, props);\r\n        this.onEdit = undefined;\r\n    }\r\n\r\n    renderRef(): JSX.Element {\r\n        return <label className=\"form-check-inline w-100 h-100\">\r\n            <input type=\"checkbox\" className=\"ms-1\"\r\n                defaultChecked={this.shallowValue.value}\r\n                onChange={this.onChange} />\r\n        </label>;\r\n    }\r\n\r\n    renderEditIcon(): JSX.Element { return null; }\r\n\r\n    private onChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n        let value = e.target.checked;\r\n        let { onChanged, itemSchema } = this.props;\r\n        onChanged(itemSchema.name, value);\r\n        setReact(() => {\r\n            this.shallowValue.value = value;\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CEdit } from './CEdit';\r\nimport { setReact, shallowReact } from '../Reactive';\r\nimport { Page } from '../Page';\r\nimport { UiInputItem } from 'tonwa-react';\r\n\r\nexport interface InputOptions {\r\n    type: string;\r\n    min?: number;\r\n    max?: number;\r\n    step?: number;\r\n}\r\n\r\nabstract class CEditWithPage extends CEdit {\r\n    abstract get Page(): new (c: CEdit) => Page<CEdit>;\r\n}\r\n\r\nabstract class VEditPage<C extends CEditWithPage> extends Page<C> {\r\n    shallowData: {\r\n        isChanged: boolean;\r\n        error: string;\r\n    } = shallowReact({\r\n        isChanged: false,\r\n        error: null,\r\n    });\r\n    value: any;\r\n\r\n    header(): string | boolean | JSX.Element {\r\n        return this.controller.label;\r\n    }\r\n\r\n    right() {\r\n        return this.react(() => <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.shallowData.isChanged}\r\n            onClick={this.onSave}>{this.res('Save')}</button>\r\n        );\r\n    }\r\n\r\n    private onSave = async () => {\r\n        let { onChanged, itemSchema } = this.controller.props;\r\n        onChanged(itemSchema.name, this.value);\r\n        this.controller.close();\r\n    }\r\n\r\n    abstract get InputType(): string;\r\n\r\n    content() {\r\n        let { error } = this.shallowData;\r\n        let { uiItem, exView } = this.controller.props;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n            if (this.shallowData.isChanged === false) return;\r\n            if (evt.key === 'Enter') this.onSave();\r\n        }\r\n        return <div className=\"m-3\">\r\n            <input type={this.InputType}\r\n                onChange={this.onChange}\r\n                onKeyDown={onKeyDown}\r\n                onBlur={this.onBlur}\r\n                onFocus={this.onFocus}\r\n                className=\"form-control\"\r\n                defaultValue={this.controller.shallowValue.value} />\r\n            {\r\n                <div className=\"small muted m-2\">{(uiItem as UiInputItem)?.placeholder}</div>\r\n            }\r\n            {error && <div className=\"text-danger\">{error}</div>}\r\n            {exView}\r\n        </div>;\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        setReact(() => {\r\n            this.value = evt.target.value;\r\n            this.shallowData.isChanged = (this.value !== this.controller.shallowValue.value);\r\n        });\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        setReact(() => {\r\n            this.shallowData.error = this.controller.verifyValue(this.value);\r\n        })\r\n    }\r\n\r\n    private onFocus = () => {\r\n        setReact(() => {\r\n            this.shallowData.error = undefined;\r\n        })\r\n    }\r\n}\r\n\r\nexport class CStringEdit extends CEditWithPage {\r\n    get Page(): new (c: CEdit) => Page<CEdit> {\r\n        return VStringPage;\r\n    }\r\n}\r\n\r\nclass VStringPage extends VEditPage<CStringEdit> {\r\n    get InputType(): string { return 'text' }\r\n}\r\n\r\nexport class CDateEdit extends CEditWithPage {\r\n    get Page(): new (c: CEdit) => Page<CEdit> {\r\n        return VDatePage;\r\n    }\r\n}\r\n\r\nclass VDatePage extends VEditPage<CDateEdit> {\r\n    get InputType(): string { return 'date' }\r\n}\r\n\r\nexport class CDateTimeEdit extends CEditWithPage {\r\n    get Page(): new (c: CEdit) => Page<CEdit> {\r\n        return VDateTimePage;\r\n    }\r\n}\r\n\r\nclass VDateTimePage extends VEditPage<CDateTimeEdit> {\r\n    get InputType(): string { return 'datetime' }\r\n}\r\n\r\nexport class CTimeEdit extends CEditWithPage {\r\n    get Page(): new (c: CEdit) => Page<CEdit> {\r\n        return VTimePage;\r\n    }\r\n}\r\n\r\nclass VTimePage extends VEditPage<CTimeEdit> {\r\n    get InputType(): string { return 'time' }\r\n}\r\n\r\n","import { Page } from \"tonwa-contoller\";\r\nimport { CEdit } from \".\";\r\n\r\nexport class CIdEdit extends CEdit {\r\n    get Page(): new (c: CEdit) => Page<CEdit> {\r\n        return VIdEditPage;\r\n    }\r\n}\r\n\r\nclass VIdEditPage extends Page<CIdEdit> {\r\n    header(): string | boolean | JSX.Element {\r\n        return this.controller.label;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return <div>\r\n            select id\r\n        </div>\r\n    }\r\n}","import { CEdit } from \".\";\r\n\r\nexport class CPickEdit extends CEdit {\r\n    renderRef(): JSX.Element {\r\n        let { pick } = this.props;\r\n        if (!pick) {\r\n            return <span>pick is not defined</span>;\r\n        }\r\n        return pick.ref();\r\n    }\r\n\r\n    onEdit: () => Promise<void> = async () => {\r\n        let { pick } = this.props;\r\n        if (!pick) {\r\n            alert('pick not defined in CPickEdit');\r\n            return;\r\n        }\r\n        let ret = await pick.pick();\r\n        let { onChanged } = this.props;\r\n        if (onChanged) {\r\n            let { value } = this.shallowValue;\r\n            if (ret !== value) {\r\n                let { itemSchema } = this.props;\r\n                await onChanged(itemSchema.name, ret);\r\n                this.shallowValue.value = ret;\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { CDateEdit, CDateTimeEdit, CStringEdit, CTimeEdit } from \"./CInputEdit\";\r\nimport { CEdit, EditProps } from \"./CEdit\";\r\nimport { AppBase } from \"../AppBase\";\r\nimport { CIdEdit } from \"./CIdEdit\";\r\nimport { CPickEdit } from \"./CPickEdit\";\r\nimport { CCheckEdit } from \".\";\r\n\r\nexport function createEdit(nav: AppBase, props: EditProps): CEdit {\r\n    let { itemSchema, uiItem } = props;\r\n    if (uiItem === undefined) {\r\n        switch (itemSchema.type) {\r\n            default: return new CStringEdit(nav, props);\r\n        }\r\n    }\r\n    switch (uiItem.widget) {\r\n        case 'date': return new CDateEdit(nav, props);\r\n        case 'datetime': return new CDateTimeEdit(nav, props);\r\n        case 'time': return new CTimeEdit(nav, props);\r\n        case 'id': return new CIdEdit(nav, props);\r\n        case 'pick': return new CPickEdit(nav, props);\r\n        case 'checkbox': return new CCheckEdit(nav, props);\r\n        default: return new CStringEdit(nav, props);\r\n    }\r\n}\r\n","import { AppBase, CStringEdit, deepReact, setReact } from \"tonwa-contoller\";\r\nimport { UiTextItem } from \"tonwa-react\";\r\nimport { Controller } from \"../Controller\";\r\n// import { VAddUser } from \"./VAddUser\";\r\nimport { VMeSysAdmin } from \"./VMeSysAdmin\";\r\nimport { VStart } from \"./VStart\";\r\nimport { VUser } from \"./VUser\";\r\n\r\nexport enum EnumAdminRoleInEdit { sys = 1, admin = 2, nSys = -1, nAdmin = -2, }\r\n\r\nexport interface Admin {\r\n    id: number;\r\n    role: EnumAdminRoleInEdit;\r\n    operator: number;\r\n    create: number;\r\n    update: number;\r\n    user: number;\r\n    assigned: string;\r\n}\r\n\r\nexport abstract class CAdminBase<A extends AppBase = AppBase> extends Controller<A> {\r\n    private adminsChanged = true;\r\n    onAdmin: () => Promise<void>;\r\n    deep: {\r\n        meAdmin: Admin;\r\n        sysAdmins: Admin[];\r\n        admins: Admin[];\r\n    } = deepReact({\r\n        meAdmin: null,\r\n        admins: [],\r\n        sysAdmins: [],\r\n    });\r\n\r\n    /*\r\n    constructor(app: AppBase) {\r\n        super(app);\r\n        this.cUser = cUser;\r\n    }\r\n    */\r\n\r\n    abstract get me(): number;\r\n    //abstract userFromName(userName: string): Promise<any>;\r\n    //abstract userFromId(id: number): Promise<any>;\r\n    protected abstract loadAdmins(): Promise<any[]>;\r\n    protected abstract setMeAdmin(): Promise<void>;\r\n    protected abstract setAdmin(user: number, role: number, assigned: string): Promise<void>;\r\n\r\n    async load(): Promise<void> {\r\n        if (this.adminsChanged === false) return;\r\n        this.adminsChanged = false;\r\n        let retAdmins = await this.loadAdmins();\r\n        if (!retAdmins) return;\r\n        //await this.loadUserNames(retAdmins);\r\n        let sysAdmins: Admin[] = [];\r\n        let admins: Admin[] = [];\r\n        let meAdmin: Admin;\r\n        let me = this.me;\r\n        for (let admin of retAdmins) {\r\n            let { id } = admin;\r\n            if (id === me) {\r\n                meAdmin = admin;\r\n                continue;\r\n            }\r\n            let { role } = admin;\r\n            switch (role) {\r\n                case -1:\r\n                    break;\r\n                case 1:\r\n                    sysAdmins.push(admin);\r\n                    break;\r\n                case 2:\r\n                    admins.push(admin);\r\n                    break;\r\n            }\r\n        }\r\n        setReact(() => {\r\n            this.deep.meAdmin = meAdmin;\r\n            this.deep.sysAdmins = sysAdmins;\r\n            this.deep.admins = admins;\r\n        });\r\n        if (meAdmin) {\r\n            this.onAdmin = async () => {\r\n                await this.openMain();\r\n            }\r\n        }\r\n    }\r\n    /*\r\n    private async loadUserNames(admins: Admin[]) {\r\n        let ids: number[] = [];\r\n        for (let admin of admins) {\r\n            let { id, user } = admin;\r\n            if (!user) ids.push(id);\r\n        }\r\n        if (ids.length === 0) return;\r\n        let promises: Promise<any>[] = ids.map(id => this.userFromId(id));\r\n        let users = await Promise.all(promises);\r\n        for (let user of users) {\r\n            let { id } = user;\r\n            let admin = admins.find(v => v.id === id);\r\n            if (admin) Object.assign(admin, user);\r\n        }\r\n    }\r\n    */\r\n    async openMain() {\r\n        await this.load();\r\n        this.open(VStart);\r\n    }\r\n\r\n    showMeSysAdmin = () => {\r\n        this.open(VMeSysAdmin);\r\n    }\r\n\r\n    onMeSystemAdmin = async () => {\r\n        await this.setMeAdmin();\r\n        setReact(() => {\r\n            let { meAdmin } = this.deep;\r\n            let { role } = meAdmin;\r\n            meAdmin.role = -role;\r\n            meAdmin.update = Date.now() / 1000;\r\n            this.adminsChanged = true;\r\n        })\r\n        this.close();\r\n    }\r\n    /*\r\n    async searchUser(key: string): Promise<any> {\r\n        let user = await this.userFromName(key);\r\n        return user;\r\n    }\r\n    */\r\n    async onAddAdmin(role: EnumAdminRoleInEdit) {\r\n        let captionSelectUser = 'Add ' + (role === EnumAdminRoleInEdit.sys ? 'system admin' : 'admin');\r\n        //let cSelectUser = new CUser(this.nav, captionSelectUser, this)\r\n        //let ret = await this.app.cUser.select<Admin>(captionSelectUser);\r\n        let ret = await this.fetch(this.app.cUser.select<Admin>(captionSelectUser));\r\n        // let ret = await this.call<any, CAdminBase>(VAddUser, role);\r\n        if (!ret) return;\r\n        let { id: user, assigned } = ret;\r\n        await this.fetch(this.setAdmin(user, role, assigned));\r\n        setReact(() => {\r\n            let tick = Date.now() / 1000;\r\n            let admin: Admin = {\r\n                id: user,\r\n                user,\r\n                role,\r\n                operator: undefined,\r\n                assigned,\r\n                create: tick,\r\n                update: tick,\r\n            }\r\n            let { sysAdmins, admins } = this.deep;\r\n            let listAdd: Admin[], listDel: Admin[];\r\n            if (role === 1) {\r\n                listAdd = sysAdmins;\r\n                listDel = admins;\r\n            }\r\n            else {\r\n                listAdd = admins;\r\n                listDel = sysAdmins;\r\n            }\r\n            listAdd.unshift(admin);\r\n            this.removeAdmin(listDel, admin);\r\n            this.adminsChanged = true;\r\n        });\r\n    }\r\n\r\n    onDelAdmin = async (admin: Admin) => {\r\n        let { role } = admin;\r\n        await this.setAdmin(admin.id, -role, null);\r\n        setReact(() => {\r\n            let list = role === 1 ? this.deep.sysAdmins : this.deep.admins;\r\n            this.removeAdmin(list, admin);\r\n            this.adminsChanged = true;\r\n        });\r\n    }\r\n\r\n    private removeAdmin(list: Admin[], admin: Admin) {\r\n        let p = list.findIndex(v => v.id === admin.id);\r\n        if (p >= 0) list.splice(p, 1);\r\n    }\r\n\r\n    onUser = async (admin: Admin) => {\r\n        this.open(VUser, admin);\r\n    }\r\n\r\n    onEditRemark = async (admin: Admin) => {\r\n        let cStringEdit = new CStringEdit(this.app, {\r\n            itemSchema: { name: 'remark', type: 'string', required: true },\r\n            uiItem: { widget: 'text', maxLength: 100, label: 'Remark' } as UiTextItem,\r\n            value: admin.assigned,\r\n            onChanged: async (fieldName: string, value: any) => {\r\n                admin.assigned = value;\r\n                let { id, role, assigned } = admin;\r\n                await this.setAdmin(id, role, assigned);\r\n                this.adminsChanged = true;\r\n            }\r\n        });\r\n        cStringEdit.onEdit();\r\n    }\r\n}\r\n","import { Context, FA, Form, NumSchema, Schema, StringSchema, UiButton, UiCheckItem, UiTextItem } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CTagBase } from \"./CTagBase\";\r\n\r\nexport class VAddTag extends Page<CTagBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Add tag';\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        let schema: Schema = [\r\n            { name: 'name', type: 'string', maxLength: 50, required: true } as StringSchema,\r\n            { name: 'vice', type: 'string', maxLength: 100 } as StringSchema,\r\n            { name: 'single', type: 'number' } as NumSchema,\r\n            { name: 'submit', type: 'submit' }\r\n        ];\r\n        let uiSchema = {\r\n            items: {\r\n                name: {\r\n                    widget: 'text',\r\n                    label: 'Name',\r\n                } as UiTextItem,\r\n                vice: {\r\n                    widget: 'text',\r\n                    label: 'Discription',\r\n                } as UiTextItem,\r\n                single: {\r\n                    widget: 'checkbox',\r\n                    label: 'Singular',\r\n                    defaultValue: 0,\r\n                    trueValue: 1,\r\n                    falseValue: 0,\r\n                } as UiCheckItem,\r\n                submit: {\r\n                    widget: 'button',\r\n                    label: <><FA name=\"floppy-o\" /> Submit</>,\r\n                    className: 'btn btn-primary',\r\n                } as UiButton,\r\n            }\r\n        }\r\n        return <div className=\"p-3\">\r\n            <Form schema={schema} uiSchema={uiSchema} fieldLabelSize={2}\r\n                onButtonClick={this.onSave}\r\n            />\r\n        </div>;\r\n    }\r\n\r\n    private onSave = async (name: string, context: Context) => {\r\n        await this.controller.onSaveTag(context.data);\r\n    }\r\n}","import { Context, FA, Form, Schema, StringSchema, UiButton, UiTextItem } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CTagBase } from \"./CTagBase\";\r\n\r\nexport class VAddTagItem extends Page<CTagBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Add tag';\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        let schema: Schema = [\r\n            { name: 'name', type: 'string', maxLength: 50, required: true } as StringSchema,\r\n            { name: 'submit', type: 'submit' }\r\n        ];\r\n        let uiSchema = {\r\n            items: {\r\n                name: {\r\n                    widget: 'text',\r\n                    label: 'Name',\r\n                } as UiTextItem,\r\n                submit: {\r\n                    widget: 'button',\r\n                    label: <><FA name=\"floppy-o\" /> Submit</>,\r\n                    className: 'btn btn-primary',\r\n                } as UiButton,\r\n            }\r\n        }\r\n        return <div className=\"p-3\">\r\n            <Form schema={schema} uiSchema={uiSchema} fieldLabelSize={2}\r\n                onButtonClick={this.onSave}\r\n            />\r\n        </div>;\r\n    }\r\n\r\n    private onSave = async (name: string, context: Context) => {\r\n        await this.controller.onSaveTagItem(context.data);\r\n    }\r\n}","import { MouseEvent } from 'react';\r\nimport { View } from \"tonwa-contoller\";\r\nimport { FA } from \"tonwa-react\";\r\nimport { CTagBase } from \"./CTagBase\";\r\n\r\nexport class VDeleteTagItem extends View<CTagBase, () => Promise<void>> {\r\n    render() {\r\n        return <div className=\"mt-4 d-flex justify-content-end\">\r\n            <div onClick={this.onClick} className=\"px-3 py-2 cursor-pointer text-primary\">\r\n                <FA name=\"trash\" /> Delete the item\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    onClick = async (evt: MouseEvent<HTMLDivElement>) => {\r\n        evt.stopPropagation();\r\n        if (window.confirm('Do you really want to delete?') === true) {\r\n            await this.props();\r\n        }\r\n    }\r\n}","import { createEdit, Page } from \"tonwa-contoller\";\r\nimport { FA, ItemSchema, List, LMR, NumSchema, StringSchema, UiCheckItem, UiSchema } from \"tonwa-react\";\r\nimport { CTagBase, Tag } from \".\";\r\n\r\nexport class VEditTag extends Page<CTagBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Edit ' + this.controller.deep.currentTag.name;\r\n    }\r\n\r\n    right() {\r\n        return <button className=\"btn btn-sm btn-light me-2\" onClick={this.onRemoveTag}>\r\n            <FA name=\"trash\" />\r\n        </button>;\r\n    }\r\n\r\n    private onRemoveTag = async () => {\r\n        let { currentTag } = this.controller.deep;\r\n        let { name } = currentTag;\r\n        let ret = await this.confirm(`Do you really want to remove tag '${name}'?`);\r\n        if (ret === true) {\r\n            await this.controller.removeTag(currentTag);\r\n        }\r\n    }\r\n\r\n    content() {\r\n        let right = <button className=\"btn btn-sm btn-success\"\r\n            onClick={this.controller.onAddTagItem}>\r\n            <FA name=\"plus\" /> Item\r\n        </button>;\r\n        return this.react(() => {\r\n            return <div>\r\n                {this.renderProps()}\r\n                <LMR className=\"mt-4 mb-1 px-3\" right={right}>\r\n                    Items\r\n                </LMR>\r\n                <List items={this.controller.deep.items} item={{ render: this.renderItem, onClick: this.onItemClick }} />\r\n            </div>;\r\n        });\r\n    }\r\n\r\n    private renderItem = (tagItem: Tag, index: number) => {\r\n        let { name } = tagItem;\r\n        let left = <FA className=\"text-info me-3\" name=\"square-o\" />;\r\n        return <LMR className=\"px-3 py-2 align-items-center\" left={left}>\r\n            {name}\r\n        </LMR>;\r\n    }\r\n\r\n    private onItemClick = (tagItem: Tag) => {\r\n        this.controller.onEditTagItem(tagItem);\r\n    }\r\n\r\n    protected renderProps() {\r\n        return this.react(() => {\r\n            let { deep } = this.controller;\r\n            let schema: ItemSchema[] = [\r\n                { name: 'name', type: 'string', required: true } as StringSchema,\r\n                { name: 'vice', type: 'string' } as StringSchema,\r\n                { name: 'single', type: 'number' } as NumSchema,\r\n            ];\r\n            let uiSchema: UiSchema = {\r\n                items: {\r\n                    name: {\r\n                        label: 'Name',\r\n                    },\r\n                    vice: {\r\n                        label: 'Discription'\r\n                    },\r\n                    single: {\r\n                        widget: 'checkbox',\r\n                        label: 'Singular',\r\n                        defaultValue: 0,\r\n                        trueValue: 1,\r\n                        falseValue: 0,\r\n                    } as UiCheckItem,\r\n                }\r\n            }\r\n            let { currentTag } = deep;\r\n            if (!uiSchema) {\r\n                uiSchema = { items: {} };\r\n            }\r\n            let vProps = schema.map((v, index) => {\r\n                let { name } = v;\r\n                let uiItem = uiSchema.items[name];\r\n                let label: string | JSX.Element;\r\n                let readOnly: boolean;\r\n                if (uiItem) {\r\n                    label = uiItem.label ?? name;\r\n                    readOnly = uiItem.readOnly;\r\n                }\r\n                else {\r\n                    label = name;\r\n                    readOnly = false;\r\n                }\r\n                let value = (currentTag as any)[name];\r\n                let cEdit = createEdit(this.controller.app, {\r\n                    itemSchema: v,\r\n                    uiItem,\r\n                    value,\r\n                    onChanged: this.controller.tagPropSave\r\n                });\r\n                let right = cEdit.renderEditIcon();\r\n                let onEdit: any;\r\n                let cn = 'mb-1 row bg-white align-items-center ';\r\n                if (readOnly === true) {\r\n                    onEdit = undefined;\r\n                }\r\n                else {\r\n                    onEdit = cEdit.onEdit;\r\n                    cn += 'cursor-pointer ';\r\n                }\r\n                return <div key={index} onClick={onEdit}\r\n                    className={cn}>\r\n                    <label className=\"col-sm-2 col-form-label\">{label}</label>\r\n                    <div className=\"col-sm-10\">\r\n                        <LMR right={readOnly !== true && right}>\r\n                            {cEdit.renderRef()}\r\n                        </LMR>\r\n                    </div>\r\n                </div>\r\n            });\r\n            return <div className=\"container\">{vProps}</div>;\r\n        });\r\n    }\r\n}","import { FA, LMR } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CTagBase } from \"./CTagBase\";\r\n\r\nexport class VStart extends Page<CTagBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Tags admin';\r\n    }\r\n\r\n    content() {\r\n        let { icon, iconClass } = this.controller;\r\n        return <div className=\"\">\r\n            {this.controller.groups.map((v, index) => {\r\n                let { name, vice } = v;\r\n                let left = <FA name={icon} className={iconClass + ' me-3'} size=\"lg\" />;\r\n                let right = <FA name=\"angle-right\" />;\r\n                return <LMR key={index}\r\n                    onClick={() => this.controller.openTagGroup(v)}\r\n                    className=\"px-3 py-2 cursor-pointer mb-1 bg-white align-items-center\"\r\n                    left={left} right={right}>\r\n                    {vice ?? name}\r\n                </LMR>;\r\n            })}\r\n        </div>;\r\n    }\r\n}\r\n","import { FA, List, LMR } from \"tonwa-react\";\r\nimport { Tag } from \".\";\r\nimport { Page } from \"../Page\";\r\nimport { CTagBase } from \"./CTagBase\";\r\n\r\nexport class VTagGroup extends Page<CTagBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        let { name, vice } = this.controller.currentGroup;\r\n        return vice ?? name;\r\n    }\r\n\r\n    right(): JSX.Element {\r\n        return <button className=\"btn btn-sm btn-success me-2\"\r\n            onClick={this.controller.onAddTag}>\r\n            <FA name=\"plus\" /> Tag\r\n        </button>;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return this.react(() => {\r\n            return <div className=\"\">\r\n                <List items={this.controller.deep.tags} item={{ render: this.renderTag, onClick: this.onTagClick }} />\r\n            </div>;\r\n        });\r\n    }\r\n\r\n    private renderTag = (tag: Tag, index: number): JSX.Element => {\r\n        let { name, vice } = tag;\r\n        let left = <FA name={this.controller.icon} className=\"text-info me-3\" />;\r\n        let right = <FA name=\"angle-right\" />;\r\n        return <LMR className=\"px-3 py-2 align-items-center\" left={left} right={right}>\r\n            <div>{name}</div>\r\n            <div className=\"small text-muted\">{vice}</div>\r\n        </LMR>\r\n    }\r\n\r\n    private onTagClick = (tag: Tag) => {\r\n        this.controller.onEditTag(tag);\r\n    }\r\n}","import { AppBase, CStringEdit, deepReact, Page, setReact } from \"tonwa-contoller\";\r\nimport { Uq, ID, IX } from \"tonwa-uq\";\r\nimport { StringSchema, UiTextItem } from \"tonwa-react\";\r\nimport { Controller } from \"../Controller\";\r\nimport { VAddTag } from \"./VAddTag\";\r\nimport { VAddTagItem } from \"./VAddTagItem\";\r\nimport { VDeleteTagItem } from \"./VDeleteTagItem\";\r\nimport { VEditTag } from \"./VEditTag\";\r\nimport { VStart } from \"./VStart\";\r\nimport { VTagGroup } from \"./VTagGroup\";\r\n\r\nexport interface Tag {\r\n    id?: number;\r\n    name: string;\r\n    vice?: string;\r\n    single?: number;\r\n}\r\n\r\nexport interface TagWithItems extends Tag {\r\n    items: Tag[];\r\n}\r\n\r\nexport interface TagGroup extends Tag {\r\n    tick?: number;\r\n    tags: TagWithItems[];\r\n}\r\n\r\nexport abstract class CTagBase<A extends AppBase = AppBase> extends Controller<A> {\r\n    currentGroup: Tag;\r\n    tagGroups: { [group: string]: TagGroup } = {};\r\n    deep: {\r\n        tags: Tag[];\r\n        items: Tag[];\r\n        currentTag: Tag;\r\n    }\r\n        = deepReact({\r\n            tags: null,\r\n            items: null,\r\n            currentTag: null,\r\n        });\r\n\r\n    abstract get uq(): Uq;\r\n    abstract get TagGroup(): ID;\r\n    abstract get Tag(): ID;\r\n    abstract get TagItem(): ID;\r\n    abstract get IxTag(): IX;\r\n\r\n    abstract get groups(): Tag[];\r\n    abstract get caption(): string;\r\n    abstract get icon(): string;\r\n    abstract get iconClass(): string;\r\n\r\n    get VStart(): new (c: CTagBase) => Page<CTagBase> {\r\n        return VStart;\r\n    }\r\n\r\n    private groupsLoaded = false;\r\n    protected resetGroups() {\r\n        for (let i in this.tagGroups) {\r\n            let tagGroup = this.tagGroups[i];\r\n            tagGroup.tick = 0;\r\n        }\r\n        this.groupsLoaded = false;\r\n    }\r\n    protected async loadGroups(): Promise<void> {\r\n        if (this.groupsLoaded === true) return;\r\n        let ret = await this.uq.ID<Tag>({\r\n            IDX: this.TagGroup,\r\n            id: undefined,\r\n        });\r\n        for (let group of this.groups) {\r\n            let g = ret.find(v => v.name === group.name);\r\n            if (!g) {\r\n                throw Error(`${group.name} is not defined in UQ`);\r\n            }\r\n            group.id = g.id;\r\n        }\r\n        this.groupsLoaded = true;\r\n    }\r\n\r\n    async openMain() {\r\n        await this.loadGroups();\r\n        this.open(this.VStart);\r\n    }\r\n\r\n    get VTagGroup(): new (c: CTagBase) => Page<CTagBase> {\r\n        return VTagGroup;\r\n    }\r\n\r\n    async openTagGroup(group: Tag) {\r\n        this.currentGroup = group;\r\n        let ret = await this.uq.IX<Tag>({\r\n            IX: this.IxTag,\r\n            ix: group.id,\r\n            IDX: [this.Tag],\r\n        });\r\n        this.open(this.VTagGroup);\r\n        setReact(() => {\r\n            this.deep.tags = ret;\r\n        });\r\n    }\r\n\r\n    get VAddTag(): new (c: CTagBase) => Page<CTagBase> {\r\n        return VAddTag;\r\n    }\r\n    onAddTag = async () => {\r\n        this.open(this.VAddTag);\r\n    }\r\n\r\n    onSaveTag = async (tag: Tag) => {\r\n        let ret = await this.uq.ActIX<Tag>({\r\n            IX: this.IxTag,\r\n            ID: this.Tag,\r\n            values: [{ ix: this.currentGroup.id, xi: tag }]\r\n        });\r\n        tag.id = ret[0];\r\n        this.close();\r\n        setReact(() => {\r\n            this.deep.tags.push(tag);\r\n            this.resetGroups();\r\n        });\r\n    }\r\n\r\n    get VEditTag(): new (c: CTagBase) => Page<CTagBase> {\r\n        return VEditTag;\r\n    }\r\n    onEditTag = async (tag: Tag) => {\r\n        setReact(() => {\r\n            this.deep.currentTag = tag;\r\n            this.open(this.VEditTag);\r\n        });\r\n        let ret = await this.uq.IX<Tag>({\r\n            IX: this.IxTag,\r\n            ix: tag.id,\r\n            IDX: [this.TagItem],\r\n        });\r\n        setReact(() => {\r\n            this.deep.items = ret;\r\n        });\r\n    }\r\n\r\n    async removeTag(tag: Tag) {\r\n        await this.uq.ActIX({\r\n            IX: this.IxTag,\r\n            values: [{\r\n                ix: this.currentGroup.id,\r\n                xi: -tag.id,\r\n            }],\r\n        })\r\n        this.close();\r\n        setReact(() => {\r\n            this.resetGroups();\r\n            let { tags } = this.deep;\r\n            let p = tags.findIndex(v => v === tag);\r\n            if (p >= 0) tags.splice(p, 1);\r\n        });\r\n    }\r\n\r\n    get VAddTagItem(): new (c: CTagBase) => Page<CTagBase> {\r\n        return VAddTagItem;\r\n    }\r\n    onAddTagItem = async () => {\r\n        this.open(this.VAddTagItem);\r\n    }\r\n\r\n    onSaveTagItem = async (tag: Tag) => {\r\n        let ret = await this.uq.ActIX<Tag>({\r\n            IX: this.IxTag,\r\n            ID: this.TagItem,\r\n            values: [{ ix: this.deep.currentTag.id, xi: tag }]\r\n        });\r\n        tag.id = ret[0];\r\n        this.close();\r\n        setReact(() => {\r\n            this.resetGroups();\r\n            this.deep.items.push(tag);\r\n        });\r\n    }\r\n\r\n    onEditTagItem = async (tagItem: Tag) => {\r\n        let onTagItemChanged = async (name: string, value: any): Promise<void> => {\r\n            tagItem.name = value;\r\n            await this.uq.ActIDProp(this.TagItem, tagItem.id, 'name', value);\r\n        }\r\n        let onTagItemDeleted = async (): Promise<void> => {\r\n            let { currentTag, items } = this.deep;\r\n            await this.uq.ActIX({\r\n                IX: this.IxTag,\r\n                values: [{ ix: currentTag.id, xi: -tagItem.id }]\r\n            });\r\n            this.close();\r\n            setReact(() => {\r\n                let p = items.findIndex(v => v === tagItem);\r\n                if (p >= 0) items.splice(p, 1);\r\n            });\r\n        }\r\n        let cStringEdit = new CStringEdit(this.app, {\r\n            itemSchema: { name: 'name', type: 'string', maxLength: 50, required: true } as StringSchema,\r\n            uiItem: { widget: 'text', label: 'Edit tag item' } as UiTextItem,\r\n            onChanged: onTagItemChanged,\r\n            value: tagItem.name,\r\n            exView: this.render(VDeleteTagItem, onTagItemDeleted),\r\n        });\r\n        cStringEdit.onEdit();\r\n    }\r\n\r\n    tagPropSave = async (name: string, value: any) => {\r\n        let { deep } = this;\r\n        await this.uq.ActIDProp(this.Tag, deep.currentTag.id, name, value);\r\n        setReact(() => {\r\n            (deep.currentTag as any)[name] = value;\r\n            this.resetGroups();\r\n        });\r\n    }\r\n\r\n    async loadGroup(groupName: string): Promise<TagGroup> {\r\n        let tagGroup = this.tagGroups[groupName];\r\n        if (tagGroup !== undefined) {\r\n            let { tick } = tagGroup;\r\n            if (Date.now() - tick < 3600 * 1000) {\r\n                return tagGroup;\r\n            }\r\n            tagGroup = undefined;\r\n            this.tagGroups[groupName] = undefined;\r\n        }\r\n        await this.loadGroups();\r\n        let group = this.groups.find(v => v.name === groupName);\r\n        if (group === undefined) return;\r\n        let ret = await this.uq.IX<Tag>({\r\n            IX: this.IxTag,\r\n            ix: group.id,\r\n            IDX: [this.Tag],\r\n        });\r\n        let retItems = await this.uq.IX<Tag>({\r\n            IX: this.IxTag,\r\n            IX1: this.IxTag,\r\n            ix: group.id,\r\n            IDX: [this.TagItem],\r\n        });\r\n        let tagColl: { [tag: number]: TagWithItems } = {};\r\n        let tags: TagWithItems[] = [];\r\n        for (let row of ret) {\r\n            let tag: TagWithItems = {\r\n                items: [],\r\n                ...row\r\n            };\r\n            tagColl[row.id] = tag;\r\n            tags.push(tag);\r\n        }\r\n        for (let row of retItems) {\r\n            let { ix } = row as any;\r\n            let tag = tagColl[ix];\r\n            if (!tag) continue;\r\n            tag.items.push(row);\r\n        }\r\n        tagGroup = {\r\n            name: group.name,\r\n            tick: Date.now(),\r\n            tags,\r\n        };\r\n        return this.tagGroups[groupName] = tagGroup;\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport { TagWithItems } from \".\";\r\nimport { View } from \"../View\";\r\nimport { Tag } from \"./CTagBase\";\r\nimport { CTagInput } from \"./CTagInput\";\r\n\r\nexport class VTagInput extends View<CTagInput> {\r\n    render(): JSX.Element {\r\n        let { tagGroup } = this.controller;\r\n        if (!tagGroup) return null;\r\n        let { tags } = tagGroup;\r\n        if (tags.length === 0) return null;\r\n        return <div className=\"container\">\r\n            {tagGroup.tags.map((v, index) => {\r\n                let { name, items } = v;\r\n                return <div key={index} className=\"row mb-1 py-2 bg-white\">\r\n                    <div className=\"col-2 ps-3 pt-1\">{name}</div>\r\n                    <div className=\"col-10\">\r\n                        {items.map((item: Tag, index: number) => this.renderTagItem(v, item, index))}\r\n                    </div>\r\n                </div>\r\n            })}\r\n        </div>;\r\n    }\r\n\r\n    private renderTagItem = (tag: TagWithItems, item: Tag, index: number): JSX.Element => {\r\n        let { shallow } = this.controller;\r\n        let { single, name } = tag;\r\n        let type: string;\r\n        let radioName: string;\r\n        if (single === 1) {\r\n            type = 'radio';\r\n            radioName = 'tag-radio-' + name;\r\n        }\r\n        else {\r\n            type = 'checkbox';\r\n        }\r\n        return <React.Fragment key={index}>{this.react(() => {\r\n            let { id, name } = item;\r\n            let { tagMap } = shallow;\r\n            let checked = tagMap.get(id);\r\n            return <label className=\"w-min-8c me-3 my-2\">\r\n                <input className=\"form-check-input\"\r\n                    type={type}\r\n                    name={radioName}\r\n                    defaultChecked={checked}\r\n                    value={id}\r\n                    onChange={evt => this.controller.onCheckChange(tag, item, evt.currentTarget.checked)} /> {name}\r\n            </label>;\r\n        })}</React.Fragment>;\r\n    }\r\n}\r\n","import { CIdBase, Controller, setReact, shallowReact, View } from \"tonwa-contoller\";\r\nimport { IX } from \"tonwa-uq\";\r\nimport { Tag, TagGroup, TagWithItems } from \".\";\r\nimport { CTagBase } from \"./CTagBase\";\r\nimport { VTagInput } from \"./VTagInput\";\r\n\r\nexport class CTagInput extends Controller {\r\n    readonly cTag: CTagBase;\r\n    readonly cId: CIdBase;\r\n    readonly IxID: IX;\r\n    tagGroup: TagGroup;\r\n    id: number;\r\n    shallow: {\r\n        tagMap: Map<number, boolean>;\r\n    } = shallowReact({\r\n        tagMap: new Map<number, boolean>(),\r\n    });\r\n\r\n    constructor(cTag: CTagBase, cId: CIdBase, IxID: IX) {\r\n        super(cTag.app);\r\n        this.cTag = cTag;\r\n        this.cId = cId;\r\n        this.IxID = IxID;\r\n    }\r\n\r\n    async beforeEdit(tagGroupName: string, id: number): Promise<void> {\r\n        this.tagGroup = await this.cTag.loadGroup(tagGroupName);\r\n        this.id = id;\r\n        let ret = await this.cId.uq.IX<{ ix: number, xi: number }>({\r\n            IX: this.IxID,\r\n            ix: id,\r\n        });\r\n        setReact(() => {\r\n            let { tagMap } = this.shallow;\r\n            tagMap.clear();\r\n            for (let row of ret) {\r\n                let { xi } = row;\r\n                tagMap.set(xi, true);\r\n            }\r\n            // assure radio box only show single value\r\n            for (let tag of this.tagGroup.tags) {\r\n                let { single, items } = tag;\r\n                if (single !== 1) continue;\r\n                let checked = false;\r\n                for (let item of items) {\r\n                    let { id } = item;\r\n                    if (checked === true) {\r\n                        if (tagMap.get(id) === true) {\r\n                            tagMap.set(id, false);\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (tagMap.get(id) === true) {\r\n                            checked = true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    get InputView(): new (c: CTagInput) => View<CTagInput> {\r\n        return VTagInput;\r\n    }\r\n\r\n    renderInput(): JSX.Element {\r\n        return this.render(this.InputView);\r\n    }\r\n\r\n    onCheckChange = async (tag: TagWithItems, item: Tag, checked: boolean) => {\r\n        let { tagMap } = this.shallow;\r\n        let itemId = item.id;\r\n        let values: { ix: number; xi: number; }[] = [];\r\n        if (tag.single === 1) {\r\n            for (let p of tag.items) {\r\n                if (p === item) continue;\r\n                let pid = p.id;\r\n                if (tagMap.get(pid) === true) {\r\n                    values.push({ ix: this.id, xi: -pid });\r\n                }\r\n            }\r\n            if (checked === false) throw Error('radio should not be false');\r\n            values.push({ ix: this.id, xi: itemId });\r\n        }\r\n        else {\r\n            values.push({ ix: this.id, xi: checked === true ? itemId : -itemId });\r\n        }\r\n        await this.cTag.uq.ActIX({\r\n            IX: this.IxID,\r\n            values,\r\n        });\r\n        setReact(() => {\r\n            for (let v of values) {\r\n                let { xi } = v;\r\n                let idOfItem: number;\r\n                let checkValue: boolean;\r\n                if (xi < 0) {\r\n                    idOfItem = -xi;\r\n                    checkValue = false;\r\n                }\r\n                else {\r\n                    idOfItem = xi;\r\n                    checkValue = true;\r\n                }\r\n                tagMap.set(idOfItem, checkValue);\r\n            }\r\n        });\r\n    }\r\n}","import { CAdminBase } from \"./CAdminBase\";\r\nimport { Page } from \"../Page\";\r\nimport { FA, LMR } from \"tonwa-react\";\r\n\r\nconst cnRow = ' px-3 py-2 ';\r\nconst cnBg = ' bg-white ';\r\nconst cnMYLg = ' my-2 ';\r\n//const cnMYSm = ' my-1 ';\r\nconst cnSmallMuted = ' small text-muted ';\r\nconst info = <FA className=\"text-primary me-3 mt-1\" name=\"info-circle\" size=\"lg\" />;\r\n\r\nexport class VMeSysAdmin extends Page<CAdminBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'System admin';\r\n    }\r\n\r\n    content() {\r\n        let { meAdmin } = this.controller.deep;\r\n        switch (meAdmin.role) {\r\n            default: return null;\r\n            case -1: return this.renderQuiting();\r\n            case 1: return this.renderAm();\r\n        }\r\n    }\r\n\r\n    private renderQuiting() {\r\n        let { update } = this.controller.deep.meAdmin;\r\n        let dateUpdate = new Date(update * 1000);\r\n        let dateUpdateNextDay = new Date((update + 24 * 3600) * 1000);\r\n        return <div>\r\n            <LMR className={cnRow + cnBg + cnMYLg + ' text-danger cursor-pointer'}\r\n                onClick={this.controller.showMeSysAdmin}>\r\n                <div className=\"d-flex justify-content-center p-3\">\r\n                    {info}<b>I am quiting system admim</b>\r\n                </div>\r\n                <div className={cnSmallMuted + ' my-3 d-flex justify-content-center '}>\r\n                    You quit at {dateUpdate.toLocaleDateString()} {dateUpdate.toLocaleTimeString()},\r\n                    can restore before {dateUpdateNextDay.toLocaleDateString()} {dateUpdateNextDay.toLocaleTimeString()}\r\n                </div>\r\n            </LMR>\r\n            <div className=\"pt-3\">\r\n                <div className=\"d-flex justify-content-center my-3\">\r\n                    <button className=\"btn btn-outline-primary\"\r\n                        onClick={this.controller.onMeSystemAdmin}>\r\n                        Restore system admin\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private renderAm() {\r\n        return <div>\r\n            <LMR className={cnRow + cnBg + cnMYLg + ' text-danger cursor-pointer'}\r\n                onClick={this.controller.showMeSysAdmin}>\r\n                <div className=\"d-flex justify-content-center p-3\">\r\n                    {info}<b>I am a system admim</b>\r\n                </div>\r\n            </LMR>\r\n            <div className=\"pt-3\">\r\n                <div className=\"d-flex justify-content-center my-3\">\r\n                    <button className=\"btn btn-outline-primary\"\r\n                        disabled={this.controller.deep.sysAdmins.length === 0}\r\n                        onClick={this.controller.onMeSystemAdmin}>\r\n                        Quit system admin\r\n                    </button>\r\n                </div>\r\n                <div className=\"d-flex justify-content-center my-3\">\r\n                    <div className={cnSmallMuted}>You can restore in 24 hours after quiting</div>\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n","import { User } from \"tonwa-contoller\";\r\nimport { FA, Image, List, LMR } from \"tonwa-react\";\r\nimport { Admin, EnumAdminRoleInEdit } from \".\";\r\nimport { Page } from \"../Page\";\r\nimport { CAdminBase } from \"./CAdminBase\";\r\n\r\nconst cnRow = ' px-3 py-2 ';\r\nconst cnBg = ' bg-white ';\r\nconst cnMYLg = ' my-2 ';\r\nconst cnMYSm = ' my-1 ';\r\n//const cnSmallMuted = ' small text-muted ';\r\nconst info = <FA className=\"text-primary me-3\" name=\"info-circle\" size=\"lg\" />;\r\n\r\nexport class VStart extends Page<CAdminBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Admin';\r\n    }\r\n\r\n    content() {\r\n        return this.react(() => {\r\n            return <div>\r\n                {this.renderMe()}\r\n                {this.renderSysAdmins()}\r\n                {this.renderAdmins()}\r\n            </div>\r\n        });\r\n    }\r\n\r\n    private renderMe(): JSX.Element {\r\n        let { deep } = this.controller;\r\n        let { meAdmin } = deep;\r\n        switch (meAdmin.role) {\r\n            default: return null;\r\n            case EnumAdminRoleInEdit.nSys: return this.renderMeSystemAdmin(true);\r\n            case EnumAdminRoleInEdit.sys: return this.renderMeSystemAdmin(false);\r\n            case EnumAdminRoleInEdit.admin:\r\n                return <div className={cnRow + cnBg + cnMYLg}>\r\n                    {info} I am an admin\r\n                </div>;\r\n        }\r\n    }\r\n\r\n    private renderMeSystemAdmin(quiting: boolean) {\r\n        let rightAngle = <FA name=\"angle-right\" />;\r\n        let msg = quiting === true ?\r\n            'I am quiting system admin'\r\n            :\r\n            'I am a system admin';\r\n        return <LMR className={cnRow + cnBg + cnMYLg + ' text-danger cursor-pointer'}\r\n            onClick={this.controller.showMeSysAdmin}\r\n            right={rightAngle}>\r\n            {info}\r\n            <b>{msg}</b>\r\n        </LMR>;\r\n    }\r\n\r\n    private renderSysAdmins(): JSX.Element {\r\n        let { deep } = this.controller;\r\n        let { meAdmin } = deep;\r\n        switch (meAdmin.role) {\r\n            case EnumAdminRoleInEdit.nSys: return null;\r\n            case EnumAdminRoleInEdit.admin: return null;\r\n        }\r\n\r\n        let { sysAdmins } = deep;\r\n        return <div className=\"mt-3\">\r\n            <div className={cnRow + ' small '}>\r\n                <LMR right={this.renderAdd(EnumAdminRoleInEdit.sys)} className=\"align-items-end\">\r\n                    <div>System admins</div>\r\n                    <div className=\"small text-muted\">System admin is an admin, and can add or delete admin</div>\r\n                </LMR>\r\n            </div>\r\n            <List items={sysAdmins} item={{ render: this.renderAdminItem, onClick: this.controller.onUser }} />\r\n        </div>;\r\n    }\r\n\r\n    private renderAdmins(): JSX.Element {\r\n        let { deep } = this.controller;\r\n        let { meAdmin } = deep;\r\n        switch (meAdmin.role) {\r\n            case EnumAdminRoleInEdit.nSys: return null;\r\n            case EnumAdminRoleInEdit.admin: return null;\r\n        }\r\n        let { admins } = deep;\r\n        return <div className=\"mt-3\">\r\n            <div className={cnRow + ' small'}>\r\n                <LMR right={this.renderAdd(EnumAdminRoleInEdit.admin)} className=\"align-items-end\">\r\n                    <div>Admins</div>\r\n                    <div className=\"small text-muted\">Admin can define user roles</div>\r\n                </LMR>\r\n            </div>\r\n            <List items={admins} item={{ render: this.renderAdminItem, onClick: this.controller.onUser }} />\r\n        </div>;\r\n    }\r\n\r\n    private renderAdminItem = (admin: Admin, index: number) => {\r\n        let { id, assigned } = admin;\r\n        return this.controller.app.cUser.renderUser(id, (user: User) => {\r\n            let { name, nick, icon } = user;\r\n            let right = <FA name=\"angle-right\" className=\"cursor-pointer\" />;\r\n            return <LMR key={id}\r\n                className={cnRow + cnMYSm + cnBg}\r\n                left={<Image src={icon} className=\"me-4 align-self-start w-2-5c h-2-5c\" />}\r\n                right={right}>\r\n                {\r\n                    assigned && <div>\r\n                        <small className=\"text-muted me-3\">Remark:</small>\r\n                        {assigned}\r\n                    </div>\r\n                }\r\n                <div><small className=\"text-muted me-3\">Name:</small>{name}</div>\r\n                <div><small className=\"text-muted me-3\">Nick:</small>{nick}</div>\r\n            </LMR>;\r\n        });\r\n    }\r\n\r\n    renderAdd(role: EnumAdminRoleInEdit): JSX.Element {\r\n        return <button className=\"btn btn-sm btn-outline-success\" onClick={() => this.controller.onAddAdmin(role)}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n}\r\n","import { Page } from \"tonwa-contoller\";\r\nimport { User } from \"../CUser\";\r\nimport { FA, Image } from \"tonwa-react\";\r\nimport { Admin, CAdminBase, EnumAdminRoleInEdit } from \".\";\r\n\r\nexport class VUser extends Page<CAdminBase, Admin> {\r\n    header() {\r\n        return ' ';\r\n    }\r\n    content() {\r\n        let vDel: any;\r\n        let { id, role, operator, update } = this.props;\r\n        return this.controller.app.cUser.renderUser(id, (user: User) => {\r\n            let { name, nick, icon } = user;\r\n            if ((role === EnumAdminRoleInEdit.sys && Date.now() / 1000 - update < 24 * 3600)\r\n                || operator === this.controller.me\r\n                || role === EnumAdminRoleInEdit.admin) {\r\n                vDel = <button className=\"btn btn-sm btn-outline-secondary\" onClick={this.onDelAdmin}>\r\n                    Remove {role === EnumAdminRoleInEdit.sys ? 'system admin' : 'admin'}\r\n                </button>;\r\n            }\r\n\r\n            return <div>\r\n                <div className=\"d-flex border m-3 rounded-3 bg-white px-5 py-4\">\r\n                    <Image src={icon} className=\"me-4 w-2-5c h-2-5c\" />\r\n                    <div>\r\n                        <div className=\"cursor-pointer\"\r\n                            onClick={() => this.controller.onEditRemark(this.props)}>\r\n                            <small className=\"text-muted me-3\">Remark:</small>\r\n                            {this.react(() => {\r\n                                let { assigned } = this.props;\r\n                                return <>{assigned ?? '-'}</>;\r\n                            })}\r\n                            <span className=\"ms-3\">\r\n                                <FA name=\"pencil-square-o\" className=\"text-primary\" />\r\n                            </span>\r\n                        </div>\r\n                        <div><small className=\"me-3 text-muted\">Name:</small> {name}</div>\r\n                        <div><small className=\"me-3 text-muted\">Nick:</small> {nick}</div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"d-flex m-3 mt-4 justify-content-end\">\r\n                    {vDel}\r\n                </div>\r\n            </div>\r\n        });\r\n    }\r\n\r\n    private onDelAdmin = async () => {\r\n        let ret = await this.confirm('do you really want to delete the admin?');\r\n        if (ret === true) {\r\n            this.controller.onDelAdmin(this.props);\r\n            this.controller.close();\r\n        }\r\n    }\r\n}\r\n","export function mutedSmall(text: number | string | JSX.Element) {\r\n    return <small className=\"text-muted\">{text}</small>;\r\n}\r\n","export function renderDate(date: string): JSX.Element {\r\n    let parts = date.split('-');\r\n    let d = new Date(Number(parts[0]), Number(parts[1]) - 1, Number(parts[2]));\r\n    return <>{d.toDateString()}</>;\r\n}\r\n\r\nexport function renderHourMinute(time: string): JSX.Element {\r\n    let parts = time.split(':');\r\n    return <>{parts[0]}:{parts[1]}</>;\r\n}","import { runInAction } from \"mobx\";\r\n\r\nconst gaps = [10, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5, 10, 10, 10, 10, 15, 15, 15, 30, 30, 60];\r\n\r\nexport class AutoRun {\r\n    private readonly poke: Promise<{ ret: { poke: number }[]; }>;\r\n    private readonly refreshAction: Promise<void>;\r\n    private timer: any;\r\n\r\n    constructor(poke: Promise<{ ret: { poke: number }[] }>, refreshAction: Promise<void>) {\r\n        this.poke = poke;\r\n        this.refreshAction = refreshAction;\r\n    }\r\n\r\n    start() {\r\n        if (this.refreshAction === undefined) return;\r\n        this.stop();\r\n        this.timer = setInterval(this.callTick, 1000);\r\n    }\r\n\r\n    stop() {\r\n        if (this.timer === undefined) return;\r\n        clearInterval(this.timer);\r\n        this.timer = undefined;\r\n    }\r\n\r\n    // 数据服务器提醒客户端刷新，下面代码重新调入的数据\r\n    refresh = async () => {\r\n        let d = Date.now() / 1000;\r\n        if (d - this.refreshTime < 30) return;\r\n        await this.refreshAction;\r\n        runInAction(() => {\r\n            this.refreshTime = d;\r\n        });\r\n    }\r\n\r\n    refreshTime: number = Date.now() / 1000;\r\n\r\n    private tick = 0;\r\n    private gapIndex = 0;\r\n    private callTick = async () => {\r\n        try {\r\n            // if (!this.user) return;\r\n            ++this.tick;\r\n            if (this.tick < gaps[this.gapIndex]) return;\r\n            this.tick = 0;\r\n            if (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n            let ret = await this.poke; // this.uqs.JkMe.$poked.query(undefined, undefined, false);\r\n            let v = ret.ret[0];\r\n            if (v === undefined) return;\r\n            if (!v.poke) return;\r\n            this.gapIndex = 1;\r\n            await this.refresh();\r\n        }\r\n        catch {\r\n        }\r\n    }\r\n}\r\n","import { Page, setReact, shallowReact } from \"tonwa-contoller\";\r\nimport { FA, Image, SearchBox } from \"tonwa-react\";\r\nimport { mutedSmall } from \"App/tool\";\r\nimport { CUser, User } from \"./CUser\";\r\n\r\nexport class VSelectUser extends Page<CUser> {\r\n    shallow: {\r\n        user: any;\r\n    } = shallowReact({\r\n        user: null,\r\n    });\r\n    header(): string | boolean | JSX.Element {\r\n        return this.controller.caption;\r\n    }\r\n\r\n    protected get back(): \"close\" | \"back\" | \"none\" {\r\n        return 'close';\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"p-3 d-flex align-items-center flex-column\">\r\n            <div className=\"mx-auto mb-3\">\r\n                <SearchBox className=\"w-min-20c\"\r\n                    onFocus={() => setReact(() => this.shallow.user = null)}\r\n                    onSearch={this.onSearch}\r\n                    placeholder=\"user account\" />\r\n            </div>\r\n            {this.react(() => {\r\n                let { user } = this.shallow;\r\n                if (user === null) return null;\r\n                let vContent: any;\r\n                if (user === undefined) {\r\n                    vContent = <div><FA name=\"info-o\" className=\"me-3 text-info\" /> No user</div>;\r\n                }\r\n                else {\r\n                    let { name, nick, icon } = user;\r\n                    vContent = <>\r\n                        <div className=\"d-flex\">\r\n                            <Image src={icon} className=\"me-4 w-2-5c h-2-5c\" />\r\n                            <div>\r\n                                <div>{mutedSmall('Name:')} &nbsp; {name}</div>\r\n                                <div>{mutedSmall('Nick:')} &nbsp; {nick}</div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"text-center mt-5\">\r\n                            <button className=\"btn btn-primary\" onClick={() => this.onSelected(user)}>\r\n                                {this.header()}\r\n                            </button>\r\n                        </div>\r\n                    </>;\r\n                }\r\n                return <div className=\"border rounded-3 bg-white p-5 mx-auto w-min-20c\">\r\n                    {vContent}\r\n                </div>;\r\n            })}\r\n        </div>;\r\n    }\r\n\r\n    private onSelected = (user: User) => {\r\n        this.controller.callReturn(this, user);\r\n        this.controller.close();\r\n    }\r\n\r\n    private onSearch = async (key: string) => {\r\n        let ret = await this.controller.searchUser(key);\r\n        setReact(() => {\r\n            this.shallow.user = ret;\r\n        });\r\n    }\r\n}\r\n","import { Controller, react, setReact, shallowReact } from \"tonwa-contoller\";\r\nimport { mutedSmall } from \"../tool\";\r\nimport { VSelectUser } from \"./VSelectUser\";\r\n\r\ninterface ShallowData {\r\n    cache: Map<number, User>;\r\n}\r\n\r\nexport interface User {\r\n    id: number;\r\n    name: string;\r\n    nick: string;\r\n    icon: string;\r\n}\r\n\r\nexport class CUser extends Controller {\r\n    private readonly shallow: ShallowData = shallowReact<ShallowData>({\r\n        cache: new Map<number, User>(),\r\n    });\r\n    //private readonly userApi: UserApi;\r\n    caption: string;\r\n    /*\r\n    constructor(app: AppBase, userApi: UserApi) {\r\n        super(app);\r\n        this.userApi = userApi;\r\n    }\r\n    */\r\n\r\n    async select<T>(caption: string): Promise<T> {\r\n        this.caption = caption;\r\n        let ret = await this.call<any, CUser>(VSelectUser);\r\n        return ret;\r\n    }\r\n\r\n    async searchUser(key: string): Promise<any> {\r\n        let user = await this.app.userApi.userFromName(key);\r\n        this.setCache(user.id, user);\r\n        return user;\r\n    }\r\n\r\n    renderUser(id: number, render: (user: User) => JSX.Element): JSX.Element {\r\n        return react(() => {\r\n            if (!id) return null;\r\n            let user = this.userFromCache(id);\r\n            if (!user) return mutedSmall(id);\r\n            return render(user);\r\n        });\r\n    }\r\n\r\n    private userFromCache(id: number): User {\r\n        let ret = this.shallow.cache.get(id);\r\n        if (ret === null) return null;\r\n        if (ret === undefined) {\r\n            this.loadUser(id);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private async loadUser(id: number) {\r\n        try {\r\n            let ret = await this.app.userApi.userFromId(id);\r\n            this.setCache(id, ret);\r\n        }\r\n        catch {\r\n            this.setCache(id, null);\r\n        }\r\n    }\r\n\r\n    private setCache(id: number, user: User) {\r\n        setReact(() => this.shallow.cache.set(id, user));\r\n    }\r\n}\r\n","import { Controller } from \"tonwa-contoller\";\r\nimport { UQs } from \"uq-app\";\r\nimport { App } from \"./App\";\r\n\r\nexport abstract class CControl extends Controller<App> {\r\n    readonly uqs: UQs;\r\n    constructor(app: App) {\r\n        super(app);\r\n        this.uqs = app.uqs;\r\n    }\r\n\r\n    openMain() {\r\n        alert('openMain not defined');\r\n    }\r\n}\r\n","import { CControl } from \"../CControl\";\r\nimport { CActs } from \"./CActs\";\r\n\r\nexport abstract class CAct extends CControl {\r\n    readonly cActs: CActs;\r\n    constructor(cActs: CActs) {\r\n        super(cActs.app);\r\n        this.cActs = cActs;\r\n    }\r\n    abstract openMain(): Promise<void>;\r\n}","import { Page } from \"tonwa-contoller\";\r\nimport { BoolSchema, ButtonSchema, Context, Form, Schema, StringSchema, UiButton, UiCheckItem, UiSchema, UiTextAreaItem } from \"tonwa-react\";\r\nimport { CClientNotes } from \".\";\r\n\r\nexport class VAddNote extends Page<CClientNotes> {\r\n    header(): string | boolean | JSX.Element {\r\n        let { firstName, lastName, no } = this.props;\r\n        return <>{firstName} {lastName} &nbsp; <small className=\"text-muted\">{no}</small></>;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        let schema: Schema = [\r\n            { name: 'note', type: 'string' } as StringSchema,\r\n            { name: 'sensitive', type: 'boolean' } as BoolSchema,\r\n            { name: 'submit', type: 'submit' } as ButtonSchema,\r\n        ];\r\n        let uiSchema: UiSchema = {\r\n            items: {\r\n                note: { widget: 'textarea', placeholder: 'input note here', label: 'Note', rows: 10 } as UiTextAreaItem,\r\n                sensitive: { widget: 'checkbox', label: 'Sensitive', align: 'start' } as UiCheckItem,\r\n                submit: { widget: 'button', className: 'btn btn-primary', label: 'Submit' } as UiButton,\r\n            }\r\n        };\r\n        return <div className=\"p-3\">\r\n            <Form schema={schema} uiSchema={uiSchema} onButtonClick={this.onSubmit} />\r\n        </div>\r\n    }\r\n\r\n    private onSubmit = async (name: string, context: Context): Promise<void> => {\r\n        await this.controller.saveNote(this.props, context.data);\r\n        this.controller.close();\r\n    }\r\n}","import { Page } from \"tonwa-contoller\";\r\nimport { EasyTime, FA, List } from \"tonwa-react\";\r\nimport { dateFromMinuteId } from \"tonwa-core\";\r\nimport { Note, SessionPerson } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CClientNotes } from \".\";\r\n\r\nexport class VClient extends Page<CClientNotes> {\r\n    header(): string | boolean | JSX.Element {\r\n        let { firstName, lastName, no } = this.props;\r\n        return <>{firstName} {lastName} &nbsp; <small className=\"text-muted\">{no}</small></>;\r\n    }\r\n\r\n    right(): JSX.Element {\r\n        return <button className=\"btn btn-sm btn-success me-2\" onClick={() => this.controller.showAddNote(this.props)}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return <div className=\"\">\r\n            <List items={this.controller.deepData.notes}\r\n                item={{ render: this.renderLog, className: \"mt-1 mb-3\", key: (item) => item.id }} />\r\n        </div>;\r\n    }\r\n\r\n    private renderLog = (log: any, index: number) => {\r\n        let { id } = log;\r\n        return <div className=\"d-block\">\r\n            <div className=\"px-3 py-1 border-bottom small text-muted\"><EasyTime date={dateFromMinuteId(id)} /></div>\r\n            <div className=\"px-3 py-2\">{\r\n                this.renderLogContent(log)\r\n            }</div>\r\n        </div>;\r\n    }\r\n\r\n    private renderLogContent(log: any) {\r\n        let { $type } = log;\r\n        switch ($type) {\r\n            default: return <>unknown type {$type}</>;\r\n            case 'note': return this.renderNote(log);\r\n            case 'sessionperson': return this.renderSessionPerson(log);\r\n        }\r\n    }\r\n\r\n    private renderNote(note: Note) {\r\n        let { note: noteContent, staff, sensitive } = note;\r\n        let vLock: any;\r\n        if (sensitive === 1) {\r\n            vLock = <FA name=\"lock\" className=\"text-danger me-3\" />\r\n            if (this.controller.app.isPersonMe(staff) === true) {\r\n                return <div className=\"text-muted small\">{vLock} #sensitive</div>;\r\n            }\r\n        }\r\n        return <>{noteContent.split('\\n').map((v, index) =>\r\n            <div key={index} className=\"my-1\">{vLock} {v}</div>\r\n        )}</>;\r\n    }\r\n\r\n    private renderSessionPerson(sessionPerson: SessionPerson) {\r\n        let { cWorkshop, cStaff } = this.controller.app.cIds;\r\n        let { cSession } = cWorkshop;\r\n        let { session, person, workshop } = sessionPerson;\r\n        return <>\r\n            <div>{cWorkshop.renderId(workshop)}</div>\r\n            <div>{cSession.renderId(session)}</div>\r\n            <div>{cStaff.renderId(person)}</div>\r\n        </>;\r\n    }\r\n}\r\n","import { CSelectOne, Page } from \"tonwa-contoller\";\r\nimport { FA, List, LMR } from \"tonwa-react\";\r\nimport { CClientNotes } from \"./CClientNotes\";\r\n\r\nexport class VStart extends Page<CClientNotes> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Client notes';\r\n    }\r\n\r\n    right(): JSX.Element {\r\n        return <button className=\"btn btn-sm btn-primary me-2\" onClick={this.onSearch}>\r\n            <FA name=\"search\" />\r\n        </button>;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        let { clients } = this.controller.deepData;\r\n        return <div className=\"\">\r\n            <List items={clients}\r\n                item={{ render: this.renderItem, onClick: this.controller.showClient }} />\r\n        </div>;\r\n    }\r\n\r\n    private renderItem = (item: any, index: number) => {\r\n        let { icon } = this.controller.cClient;\r\n        let vIcon: any;\r\n        if (icon) {\r\n            vIcon = <FA name=\"user-o\" className=\"me-3 text-primary \" fixWidth={true} />;\r\n        }\r\n        let right = <FA name=\"angle-right\" />\r\n        return <LMR className=\"px-3 py-2 align-items-center\" left={vIcon} right={right}>\r\n            <div>\r\n                {this.controller.cClient.renderItemInList(item)}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private onSearch = async () => {\r\n        let cSelectOne = new CSelectOne(this.controller.cClient);\r\n        let ret = await cSelectOne.select();\r\n        if (!ret) return;\r\n        this.controller.showClient(ret as any);\r\n    }\r\n}\r\n","import { CClient } from \"../../CIds\";\r\nimport { deepReact, setReact } from \"tonwa-contoller\";\r\nimport { Note, Person, SessionPerson } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CAct } from \"../CAct\";\r\nimport { VAddNote } from \"./VAddNote\";\r\nimport { VClient } from \"./VClient\";\r\nimport { VStart } from \"./VStart\";\r\n\r\nexport class CClientNotes extends CAct {\r\n    readonly deepData: {\r\n        notes: (Note | SessionPerson)[];\r\n        clients: Person[];\r\n    } = deepReact({\r\n        notes: null,\r\n        clients: null,\r\n    });\r\n    cClient: CClient;\r\n\r\n    async openMain(): Promise<void> {\r\n        let { cClient } = this.app.cIds;\r\n        this.cClient = cClient;\r\n        await this.loadClients();\r\n        this.open(VStart);\r\n    }\r\n\r\n    private async loadClients() {\r\n        let { BzWorkshop } = this.uqs;\r\n        //let { UserObject, IxStaffClient, Person } = BzWorkshop;\r\n        let ret = await BzWorkshop.MyClients.query({});\r\n        /*\r\n        let ret = await BzWorkshop.QueryID<Person>({\r\n            IX: [UserObject, IxStaffClient],\r\n            IDX: [Person],\r\n        });*/\r\n        setReact(() => {\r\n            this.deepData.clients = ret.ret;\r\n        });\r\n    }\r\n\r\n    showClient = async (client: Person) => {\r\n        let { BzWorkshop } = this.uqs;\r\n        /*\r\n        let ret = await BzWorkshop.QueryID<Note>({\r\n            IX: [BzWorkshop.IxPersonLog],\r\n            ix: client.id,\r\n            IDX: [BzWorkshop.Note],\r\n            order: 'desc'\r\n        });\r\n        */\r\n        //let ret = await BzWorkshop.GetPersonLog.query({ person: client.id });\r\n        let ret = await BzWorkshop.IXValues({\r\n            IX: BzWorkshop.IxPersonLog,\r\n            ix: client.id,\r\n            order: 'desc',\r\n        })\r\n        let notes: any[] = [];\r\n        for (let row of ret) {\r\n            let { type, value } = row;\r\n            let obj: any = BzWorkshop.IDValue(type, value);\r\n            if (obj !== undefined) {\r\n                obj['$type'] = type;\r\n                notes.push(obj);\r\n            }\r\n        }\r\n        setReact(() => {\r\n            this.deepData.notes = notes;\r\n        });\r\n        this.open(VClient, client);\r\n    }\r\n\r\n    showAddNote = (client: Person) => {\r\n        this.open(VAddNote, client);\r\n    }\r\n\r\n    saveNote = async (client: Person, data: any) => {\r\n        let note: Note = {\r\n            id: undefined,\r\n            staff: 10,\r\n            client: client.id,\r\n            note: data.note,\r\n            sensitive: data.sensitive === true ? 1 : 0,\r\n        };\r\n        let { BzWorkshop } = this.uqs;\r\n        let ret = await BzWorkshop.SaveNote.submitReturns(note as any);\r\n        note.id = ret.ret[0].id;\r\n        (note as any)['$type'] = 'note';\r\n        setReact(() => {\r\n            let { notes, clients } = this.deepData;\r\n            notes.unshift(note);\r\n            let index = clients.findIndex(v => v.id === client.id);\r\n            if (index >= 0) {\r\n                clients.splice(index, 1);\r\n            }\r\n            clients.unshift(client);\r\n        });\r\n    }\r\n}\r\n","import { Page } from \"tonwa-contoller\";\r\nimport { CTest } from \"./CTest\";\r\n\r\nexport class PMain extends Page<CTest> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Test';\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"p-3\">\r\n            Test\r\n            <div>\r\n                <button className=\"btn btn-primary me-3\"\r\n                    onClick={evt => this.waitingEvent(evt, this.controller.onTestSave)}>\r\n                    save\r\n                </button>\r\n                <button className=\"btn btn-primary me-3\"\r\n                    onClick={evt => this.waitingEvent(evt, this.controller.onTestLoad)}>\r\n                    load\r\n                </button>\r\n            </div>\r\n        </div>\r\n    }\r\n}","import { MDraft } from \"tonwa-uq\";\r\nimport { CControl } from \"../../CControl\";\r\nimport { App } from \"../../App\";\r\nimport { PMain } from \"./PMain\";\r\n\r\nexport class CTest extends CControl {\r\n    readonly mDraft: MDraft;\r\n\r\n    constructor(app: App) {\r\n        super(app);\r\n        let { BzWorkshop } = this.uqs;\r\n        let { Draft, IxDraft } = BzWorkshop;\r\n        this.mDraft = new MDraft(BzWorkshop, Draft, IxDraft);\r\n    }\r\n\r\n    openMain(): void {\r\n        this.open(PMain);\r\n    }\r\n\r\n    onTestSave = async () => {\r\n        let { BzWorkshop } = this.uqs;\r\n        let { Person } = BzWorkshop;\r\n        let ret = await this.mDraft.saveMain('aaa');\r\n        let d = await this.mDraft.saveDetail(ret, [{ b: 2 }, { b: 3 }], Person);\r\n        alert(JSON.stringify([ret, d]));\r\n    }\r\n\r\n    onTestLoad = async () => {\r\n        let ret = await this.mDraft.load(1176521146368);\r\n        alert(JSON.stringify(ret));\r\n    }\r\n}","import { Page } from \"tonwa-contoller\";\r\nimport { FA } from \"tonwa-react\";\r\nimport { CSessionAct } from \"./CSessionAct\";\r\n\r\nexport class VAttendee extends Page<CSessionAct> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Attendee';\r\n    }\r\n\r\n    right(): JSX.Element {\r\n        let { deleted } = this.props;\r\n        let onClick = () => this.controller.changeSessionClient(this.props);\r\n        let cn = 'btn btn-sm me-2 ';\r\n        let content: any;\r\n        if (deleted === 0) {\r\n            cn += ' btn-light';\r\n            content = <FA name=\"trash\" />;\r\n        }\r\n        else {\r\n            cn += ' btn-info';\r\n            content = <><FA name=\"repeat\" /> Restore</>;\r\n        }\r\n        return <button className={cn} onClick={onClick}>\r\n            {content}\r\n        </button>;\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"p-3\">\r\n            {this.controller.cClient.renderId(this.props.xi)}\r\n        </div>;\r\n    }\r\n}","import { Page } from \"tonwa-contoller\";\r\nimport { EasyTime, FA, List, LMR } from \"tonwa-react\";\r\nimport { renderDate, renderHourMinute } from \"../../tool\";\r\nimport { CSessionAct } from \"./CSessionAct\";\r\n\r\nexport class VSession extends Page<CSessionAct> {\r\n    header() {\r\n        return 'Session';\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        let { cWorkshop, session, deep: shallow } = this.controller;\r\n        let { icon, iconClass } = cWorkshop;\r\n        let { date, time, span, substitue, done, workshop } = session;\r\n        let right = <button className=\"btn btn-sm btn-outline-primary\" onClick={this.onAddAttendee}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n        return <div>\r\n            <div className=\"fs-5 px-3 py-2 d-flex align-items-center\">\r\n                <FA name={icon} className={iconClass + ' me-3'} size=\"lg\" />\r\n                {cWorkshop.renderId(workshop)}\r\n            </div>\r\n            <div className=\"px-3 py-2 d-block\">\r\n                <div>{renderDate(date)} {renderHourMinute(time)} {span}</div>\r\n                <div>\r\n                    {done > 0 && <FA className=\"text-danger\" name=\"check-circle-o\" />}\r\n                    {substitue > 0 && <FA className=\"text-primary\" name=\"star-o\" />}\r\n                </div>\r\n            </div>\r\n            <div className=\"mt-3\">\r\n                <LMR className=\"px-3 mb-2 align-items-end\"\r\n                    right={right}>\r\n                    Attendees\r\n                </LMR>\r\n                <List items={shallow.list} item={{ render: this.renderAttendee, onClick: this.controller.showAttendee }} />\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private renderAttendee = (attendee: any, index: number) => {\r\n        let { $create, $update, deleted } = attendee;\r\n        let cn = 'px-3 py-2 align-items-center';\r\n        if (deleted > 0) cn += ' text-decoration-line-through text-muted';\r\n        let vChanged: any;\r\n        if ($create !== $update) {\r\n            vChanged = <span className=\"ms-3\">\r\n                change at: <EasyTime date={new Date($update * 1000)} />\r\n            </span>;\r\n        }\r\n        let right = <div>\r\n            <EasyTime date={new Date($create * 1000)} />\r\n            {vChanged}\r\n        </div>;\r\n        return <LMR className={cn} right={right}>\r\n            <div className=\"d-flex align-items-center\">\r\n                {this.controller.cClient.renderId(attendee.xi)}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private onAddAttendee = () => {\r\n        this.controller.addAttendee();\r\n    }\r\n}\r\n","import { CClient, CWorkshop } from \"../../CIds\";\r\nimport { CActs } from \"../CActs\";\r\nimport { CSelectOne, deepReact, setReact } from \"tonwa-contoller\";\r\nimport { CWorkshops, MSession } from \".\";\r\nimport { CAct } from \"../CAct\";\r\nimport { VAttendee } from \"./VAttendee\";\r\nimport { VSession } from \"./VSession\";\r\n\r\nexport class CSessionAct extends CAct {\r\n    readonly cWorkshops: CWorkshops;\r\n    readonly cWorkshop: CWorkshop;\r\n    readonly cClient: CClient;\r\n    readonly session: MSession;\r\n    readonly deep: {\r\n        list: any[];\r\n    } = deepReact({ list: null });\r\n\r\n    constructor(cActs: CActs, cWorkshops: CWorkshops, session: MSession) {\r\n        super(cActs);\r\n        this.cWorkshops = cWorkshops;\r\n        this.cWorkshop = cWorkshops.cWorkshop;\r\n        this.cClient = cWorkshops.app.cIds.cClient;\r\n        this.session = session;\r\n    }\r\n\r\n    async openMain(): Promise<void> {\r\n        let { BzWorkshop } = this.uqs;\r\n        let ret = await BzWorkshop.IX({\r\n            IX: BzWorkshop.IxSessionClient,\r\n            ix: this.session.id,\r\n        });\r\n        setReact(() => {\r\n            this.deep.list = ret;\r\n        });\r\n        this.open(VSession);\r\n    }\r\n\r\n    addAttendee = async () => {\r\n        let { BzWorkshop } = this.uqs;\r\n        let cSelectOne = new CSelectOne(this.cClient);\r\n        let ret = await cSelectOne.select();\r\n        let sessionId = this.session.id;\r\n        let clientId = ret.id;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        let ixValue = {\r\n            ix: sessionId,\r\n            xi: clientId,\r\n            deleted: 0,\r\n            $create: now,\r\n            $update: now,\r\n        };\r\n        await BzWorkshop.SaveSessionAttendee.submit({\r\n            session: sessionId,\r\n            client: clientId,\r\n            deleted: 0,\r\n        });\r\n        /*\r\n        await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxSessionClient,\r\n            values: [ixValue],\r\n        });\r\n        */\r\n        setReact(() => {\r\n            let { list } = this.deep;\r\n            let index = list.findIndex(v => v.xi === clientId);\r\n            if (index >= 0) {\r\n                list.splice(index, 1);\r\n            }\r\n            list.unshift(ixValue);\r\n        });\r\n    }\r\n\r\n    showAttendee = async (row: any) => {\r\n        this.open(VAttendee, row);\r\n    }\r\n\r\n    changeSessionClient = async (row: any) => {\r\n        let { BzWorkshop } = this.uqs;\r\n        let { ix, xi, deleted } = row;\r\n        deleted = 1 - deleted;\r\n        /*\r\n        await BzWorkshop.Acts({\r\n            ixSessionClient: [{\r\n                ix, xi, deleted,\r\n            }],\r\n        });\r\n        */\r\n        await BzWorkshop.SaveSessionAttendee.submit({\r\n            session: ix,\r\n            client: xi,\r\n            deleted,\r\n        });\r\n        let ixVal = this.deep.list.find(v => v.xi === xi);\r\n        ixVal.deleted = deleted;\r\n        this.close();\r\n    }\r\n}\r\n","import { Page } from \"tonwa-contoller\";\r\nimport { FA, List } from \"tonwa-react\";\r\nimport { renderDate, renderHourMinute } from \"../../tool\";\r\nimport { CWorkshops, MSession, WorkshopItem } from \".\";\r\n\r\nexport class VStart extends Page<CWorkshops> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Workshops';\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return this.react(() => {\r\n            let { workshopItems } = this.controller.shallow;\r\n            return <div>\r\n                <List items={workshopItems} item={{ render: this.renderWorkshopItem }} />\r\n            </div>;\r\n        });\r\n    }\r\n\r\n    private renderWorkshopItem = (item: WorkshopItem, index: number) => {\r\n        let { workshop, sessions } = item;\r\n        let { cWorkshop } = this.controller;\r\n        let { icon, iconClass } = cWorkshop;\r\n        return <div className=\"px-3 py-2 d-block mb-3\">\r\n            <div onClick={() => this.onWorkshopClick(workshop)}\r\n                className=\"fs-5 my-2 d-flex align-items-center cursor-pointer\">\r\n                <FA name={icon} className={iconClass + ' me-3'} size=\"lg\" />\r\n                {cWorkshop.renderId(workshop)}\r\n            </div>\r\n            <List className=\"ms-4\" items={sessions}\r\n                item={{ render: this.renderSessionItem, onClick: this.onSessionClick }} />\r\n        </div>\r\n    }\r\n\r\n    private renderSessionItem = (item: MSession, index: number) => {\r\n        let { date, time, span, substitue, done } = item;\r\n        return <div className=\"px-3 py-2 d-block\">\r\n            <div>{renderDate(date)} {renderHourMinute(time)} {span}</div>\r\n            <div>\r\n                {done > 0 && <FA className=\"text-danger\" name=\"check-circle-o\" />}\r\n                {substitue > 0 && <FA className=\"text-primary\" name=\"star-o\" />}\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private onWorkshopClick = (workshop: number) => {\r\n        alert(workshop);\r\n    }\r\n\r\n    private onSessionClick = (session: MSession) => {\r\n        this.controller.openSession(session);\r\n    }\r\n}","import { CActs } from \"../../CActs\";\r\nimport { CWorkshop } from \"../../CIds\";\r\nimport { setReact, shallowReact } from \"tonwa-contoller\";\r\nimport { Session } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CAct } from \"../CAct\";\r\nimport { CSessionAct } from \"./CSessionAct\";\r\nimport { VStart } from \"./VStart\";\r\n\r\nexport interface WorkshopItem {\r\n    workshop: number;\r\n    sessions: MSession[];\r\n}\r\n\r\nexport interface MSession extends Session {\r\n    workshop: number;\r\n    own: number;\r\n    substitue: number;\r\n    done: number;\r\n}\r\n\r\nexport class CWorkshops extends CAct {\r\n    readonly cWorkshop: CWorkshop;\r\n    shallow: {\r\n        workshopItems: WorkshopItem[];\r\n    } = shallowReact({ workshopItems: null });\r\n\r\n    constructor(cActs: CActs) {\r\n        super(cActs);\r\n        this.cWorkshop = cActs.app.cIds.cWorkshop;\r\n    }\r\n\r\n    async openMain(): Promise<void> {\r\n        await this.loadList();\r\n        this.open(VStart);\r\n    }\r\n\r\n    private async loadList() {\r\n        let ret = await this.uqs.BzWorkshop.MySessions.query({});\r\n        let coll: { [id: number]: WorkshopItem } = {};\r\n        let workshopItems: WorkshopItem[] = [];\r\n        for (let row of ret.ret) {\r\n            let { workshop } = row;\r\n            let workshopItem = coll[workshop];\r\n            if (!workshopItem) {\r\n                workshopItem = { workshop, sessions: [] };\r\n                coll[workshop] = workshopItem;\r\n                workshopItems.push(workshopItem);\r\n            }\r\n            workshopItem.sessions.push(row);\r\n        }\r\n        workshopItems.sort((a, b) => {\r\n            let { workshop: wa } = a;\r\n            let { workshop: wb } = b;\r\n            if (wa > wb) return -1;\r\n            if (wa === wb) return 0;\r\n            return 1;\r\n        })\r\n        setReact(() => {\r\n            this.shallow.workshopItems = workshopItems;\r\n        });\r\n    }\r\n\r\n    async openSession(session: MSession) {\r\n        let cSessionAct = new CSessionAct(this.cActs, this, session);\r\n        cSessionAct.openMain();\r\n    }\r\n}","import { Page } from \"tonwa-contoller\";\r\nimport { FA, LMR } from \"tonwa-react\";\r\nimport { CActs } from \"./CActs\";\r\n\r\ninterface DirItem {\r\n    icon: string;\r\n    caption: string;\r\n    onClick: () => void;\r\n}\r\n\r\nexport class VStart extends Page<CActs> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Home';\r\n    }\r\n\r\n    content() {\r\n        let { showClientNotes, showRegisterWorkshop, showTest } = this.controller;\r\n        let arr: DirItem[] = [\r\n            { icon: 'user-o', caption: 'Client notes', onClick: showClientNotes },\r\n            { icon: 'user-o', caption: 'Workshops', onClick: showRegisterWorkshop },\r\n            { icon: 'caret-right', caption: 'Test', onClick: showTest },\r\n        ];\r\n        return <div className=\"\">\r\n            {\r\n                arr.map((v, index) => this.renderAdminOrRole(() => {\r\n                    let { onClick, caption, icon } = v;\r\n                    let right = <FA name=\"angle-right\" />;\r\n                    let vIcon = <FA name={icon} className=\"text-primary me-3\" fixWidth={true} />;\r\n                    return <LMR key={index}\r\n                        className=\"cursor-pointer bg-white border-bottom py-2 px-3 align-items-center\"\r\n                        left={vIcon}\r\n                        right={right}\r\n                        onClick={onClick}>{caption}</LMR>\r\n                }))\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n","import { CControl } from \"../CControl\";\r\nimport { CClientNotes } from \"./CClientNotes\";\r\nimport { CTest } from \"./CTest\";\r\nimport { CWorkshops } from \"./CWorkshops\";\r\nimport { VStart } from \"./VStart\";\r\n\r\nexport class CActs extends CControl {\r\n    load = async () => {\r\n    }\r\n\r\n    main() {\r\n        return this.render(VStart);\r\n    }\r\n\r\n    showRegisterWorkshop = async () => {\r\n        let cRegisterWorkshop = new CWorkshops(this);\r\n        cRegisterWorkshop.openMain();\r\n    }\r\n\r\n    showClientNotes = async () => {\r\n        let cClientNotes = new CClientNotes(this);\r\n        cClientNotes.openMain();\r\n    }\r\n\r\n    showTest = async () => {\r\n        let cTest = new CTest(this.app);\r\n        cTest.openMain();\r\n    }\r\n}\r\n","import { App } from \"App\";\r\nimport { CIdBase, CTagInput } from \"tonwa-contoller\";\r\nimport { UQs } from \"uq-app\";\r\nimport { CIds } from \"./CIds\";\r\n\r\nexport abstract class CId extends CIdBase<App> {\r\n    readonly cIds: CIds;\r\n    readonly uqs: UQs;\r\n    protected readonly cTagInput: CTagInput;\r\n    constructor(cIds: CIds) {\r\n        super(cIds.app);\r\n        this.cIds = cIds;\r\n        this.uqs = cIds.uqs;\r\n        this.cTagInput = new CTagInput(this.cIds.app.cTag, this, this.uqs.BzWorkshop.IxGlobalIdTag);\r\n        this.initID();\r\n    }\r\n\r\n    get tagGroupName(): string { return undefined; }\r\n\r\n    isVisible(): boolean {\r\n        return this.app.meAdmin;\r\n    }\r\n\r\n    async loadItemsFromIds(ids: number[]): Promise<any[]> {\r\n        let list = await this.uqs.BzWorkshop.ID({\r\n            IDX: this.ID,\r\n            id: ids,\r\n        });\r\n        return list;\r\n    }\r\n\r\n    async savePropValue(id: number, name: string, value: any): Promise<void> {\r\n        await this.uqs.BzWorkshop.ActIDProp(this.ID, id, name, value);\r\n    }\r\n\r\n    protected async beforeEdit() {\r\n        await super.beforeEdit();\r\n        let tagGroupName = this.tagGroupName;\r\n        if (tagGroupName !== undefined) {\r\n            await this.cTagInput.beforeEdit(tagGroupName, this.deepData.currentItem.id);\r\n        }\r\n    }\r\n\r\n    renderTagInput() {\r\n        return this.cTagInput.renderInput();\r\n    }\r\n}\r\n","import { CUser, User } from \"tonwa-contoller\";\r\nimport { LMR } from \"tonwa-react\";\r\n\r\nexport function renderPerson(item: any, cUser?: CUser) {\r\n    let { no, name, firstName, lastName, middleName, user } = item;\r\n    let vUser: any;\r\n    if (cUser && user) {\r\n        vUser = cUser.renderUser(user, (user: User) => {\r\n            let { name } = user;\r\n            return <span className=\"ms-4\">\r\n                user:  {name}\r\n            </span>;\r\n        });\r\n    }\r\n    return <>\r\n        <div className=\"small text-muted me-3\">{no} {vUser}</div>\r\n        <div>\r\n            {name ?? <>{lastName} {middleName} {firstName}</>}\r\n        </div>\r\n    </>;\r\n}\r\n\r\nexport function renderSelectPerson(item: any) {\r\n    let { no, name, firstName, lastName, middleName } = item;\r\n    let right = <span className=\"small text-muted\">{no}</span>;\r\n    return <LMR className=\"w-100\" right={right}>\r\n        {name ?? <>{lastName} {middleName} {firstName}</>}\r\n    </LMR>;\r\n}\r\n","import { Page, VEditId } from \"tonwa-contoller\";\r\nimport { FA, LMR } from \"tonwa-react\";\r\nimport { CPerson } from \"./CPerson\";\r\n\r\nexport class VEditPerson<C extends CPerson = CPerson> extends VEditId<C> {\r\n    content() {\r\n        return <div className=\"py-3\">\r\n            {this.renderProps()}\r\n            {this.renderTagInput()}\r\n        </div>;\r\n        //{this.renderBindUser()}\r\n    }\r\n\r\n    protected renderBindUser(): JSX.Element {\r\n        return this.renderAdmin(() => {\r\n            let rightIcon = this.controller.deepData.currentItem.user ? 'angle-right' : 'pencil-square-o';\r\n            return <div className=\"container\">\r\n                <div onClick={this.controller.onBindUser}\r\n                    className=\"mb-3 row bg-white align-items-center cursor-pointer\">\r\n                    <label className=\"col-sm-2 col-form-label\">Bind user</label>\r\n                    <div className=\"col-sm-10\">\r\n                        <LMR right={<FA name={rightIcon} className=\"text-primary\" />}>\r\n                            {this.controller.renderCurrentUser((user => {\r\n                                let { name } = user;\r\n                                return <>{name}</>;\r\n                            }))}\r\n                        </LMR>\r\n                    </div>\r\n                </div>\r\n            </div>;\r\n        });\r\n    }\r\n}\r\n\r\nexport class VBound extends Page<CPerson> {\r\n    header() { return 'User bound'; }\r\n    content() {\r\n        let btnRemove = <button className=\"btn btn-outline-secondary\"\r\n            onClick={this.onRemoveBound}>\r\n            Remove bound\r\n        </button>;\r\n        return <div className=\"m-5 rouned-3 border bg-white w-max-30c p-5 mx-auto\">\r\n            <div className=\"mb-5 text-center\">\r\n                The person has bound to website user account:\r\n                <br /><br />\r\n                {this.controller.renderCurrentUser((user => {\r\n                    let { name } = user;\r\n                    return <b className=\"text-primary ms-3\">{name}</b>;\r\n                }))}\r\n            </div>\r\n            <LMR className=\"\" right={btnRemove}>\r\n                <button className=\"btn btn-primary\" onClick={this.onChange}>Change user</button>\r\n            </LMR>\r\n        </div>\r\n    }\r\n\r\n    private onChange = async () => {\r\n        if (await this.confirm('Change user account bound is not recommented. Still want to do so?') === true) {\r\n            await this.controller.onChangeUser();\r\n        }\r\n    }\r\n\r\n    private onRemoveBound = async () => {\r\n        await this.controller.onRemoveBound();\r\n    }\r\n}\r\n","import { Schema, UiSchema, UiTextItem } from \"tonwa-react\";\r\nimport { Uq } from \"tonwa-uq\";\r\nimport { CId } from \"../CId\";\r\nimport { renderPerson, renderSelectPerson } from \"./renderPerson\";\r\nimport { CIdBase, IdValue, Page, react, setReact, User } from \"tonwa-contoller\";\r\nimport { Role, Person } from \"uq-app/uqs/BzWorkshop\";\r\nimport { VBound, VEditPerson } from \"./VEditPerson\";\r\n\r\nexport interface MPerson extends Person {\r\n    user: number;\r\n    role: Role;\r\n}\r\n\r\nexport abstract class CPerson extends CId {\r\n    abstract get personRole(): Role;\r\n    get uq(): Uq { return this.uqs.BzWorkshop; };\r\n    getID() { return this.uqs.BzWorkshop.Person; }\r\n    get caption() { return 'Staff' }\r\n    get schema(): Schema {\r\n        return this.uqs.BzWorkshop.Person.ui.fieldArr;\r\n    }\r\n    get uiSchema(): UiSchema {\r\n        return {\r\n            items: {\r\n                no: {\r\n                    \"name\": \"no\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": true,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"No\",\r\n                    \"defaultValue\": this.initNO,\r\n                } as UiTextItem,\r\n                name: {\r\n                    \"name\": \"name\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Name\",\r\n                } as UiTextItem,\r\n                firstName: {\r\n                    \"name\": \"firstName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"First Name\",\r\n                } as UiTextItem,\r\n                lastName: {\r\n                    \"name\": \"lastName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Last Name\",\r\n                } as UiTextItem,\r\n                middleName: {\r\n                    \"name\": \"middleName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Middle Name\",\r\n                } as UiTextItem,\r\n                submit: {\r\n                    \"label\": \"Save \" + this.caption,\r\n                    \"widget\": \"button\",\r\n                    \"className\": \"btn btn-primary\",\r\n                }\r\n            }\r\n        }\r\n    }\r\n    abstract isInRole(role: Role): boolean;\r\n    protected async loadList(): Promise<any[]> {\r\n        let { BzWorkshop } = this.uqs;\r\n        /*\r\n        let list = await BzWorkshop.QueryID({\r\n            IX: [BzWorkshop.IxPersonRole],\r\n            ix: this.personRole,\r\n            IDX: [this.ID],\r\n            page: { start: 0, size: 10000 },\r\n            order: 'desc',\r\n        });\r\n        */\r\n        /*\r\n        let list = await BzWorkshop.IXr({\r\n            IX: BzWorkshop.IxPersonRole,\r\n            IDX: [BzWorkshop.Person],\r\n            ix: this.personRole,\r\n            page: { start: 0, size: 10000 },\r\n            order: 'desc',\r\n        });\r\n        */\r\n        let result = await BzWorkshop.GetPersonList.query({ role: this.personRole });\r\n        let { ret, roles: retRoles } = result;\r\n        let mPerson: MPerson;\r\n        for (let row of ret) {\r\n            let { id } = row;\r\n            mPerson = row as any;\r\n            for (let r of retRoles) {\r\n                let { person, role } = r;\r\n                if (person !== id) continue;\r\n                if (this.isInRole(role as Role) === true) {\r\n                    mPerson.role = role as Role;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    async saveId(data: any) {\r\n        let { BzWorkshop } = this.uqs;\r\n        let ret = await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxPersonRole,\r\n            ID: BzWorkshop.Person,\r\n            values: [{\r\n                ix: this.personRole,\r\n                xi: data,\r\n            }],\r\n        });\r\n        return ret[0];\r\n    }\r\n\r\n    async search(key: string): Promise<any[]> {\r\n        let ret = await this.uqs.BzWorkshop.PersonSearch.query({\r\n            role: this.personRole,\r\n            key,\r\n        });\r\n        return ret.ret;\r\n    }\r\n\r\n    renderItemInList(item: any): JSX.Element {\r\n        return renderPerson(item, this.app.cUser);\r\n    }\r\n\r\n    renderItemOnSelect(item: any): JSX.Element {\r\n        return renderSelectPerson(item);\r\n    }\r\n\r\n    renderIdValue(item: IdValue): JSX.Element {\r\n        return renderPerson(item);\r\n    }\r\n\r\n    get VEdit(): new (c: CIdBase) => Page<CPerson> {\r\n        return VEditPerson as any;\r\n    }\r\n\r\n    renderCurrentUser(render: (user: User) => JSX.Element) {\r\n        return react(() => {\r\n            let { currentItem } = this.deepData;\r\n            if (!currentItem) return null;\r\n            let { user } = currentItem;\r\n            return this.app.cUser.renderUser(user, render);\r\n        });\r\n    }\r\n\r\n    onBindUser = async () => {\r\n        if (this.deepData.currentItem.user) {\r\n            this.open(VBound);\r\n            return;\r\n        }\r\n        await this.onChangeUser();\r\n    }\r\n\r\n    onChangeUser = async () => {\r\n        let ret = await this.app.cUser.select<User>('Bind user');\r\n        if (!ret) return;\r\n        let { currentItem } = this.deepData;\r\n        let userId = ret.id;\r\n        let { BzWorkshop } = this.uqs;\r\n        await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxUserPerson,\r\n            values: [\r\n                { ix: userId, xi: currentItem.id }\r\n            ]\r\n        })\r\n        setReact(() => {\r\n            currentItem.user = userId;\r\n        });\r\n    }\r\n\r\n    onRemoveBound = async () => {\r\n        let { currentItem } = this.deepData;\r\n        let { BzWorkshop } = this.uqs;\r\n        await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxUserPerson,\r\n            values: [\r\n                { ix: currentItem.user, xi: -currentItem.id }\r\n            ]\r\n        })\r\n        this.close();\r\n        setReact(() => {\r\n            currentItem.user = undefined;\r\n        });\r\n    }\r\n}\r\n","import { Role } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CPerson } from \"../CPerson\";\r\n\r\nexport class CClient extends CPerson {\r\n    get tagGroupName() { return 'client-tags'; }\r\n    get personRole(): Role { return Role.client; }\r\n    get caption() { return 'Client' }\r\n    get icon() { return 'user-o' }\r\n    get iconClass(): string { return 'text-info'; }\r\n    isInRole(role: Role): boolean { return undefined; }\r\n    isVisible(): boolean {\r\n        return this.app.isAdminOrRole(Role.counselor);\r\n    }\r\n}\r\n","import { Controller, AppBase, View } from \"tonwa-contoller\";\r\nimport { Uq, IX } from \"tonwa-uq\";\r\nimport { VEnumMulti, VEnumSingle } from \".\";\r\n\r\nexport abstract class CEnumBase<E extends number> extends Controller {\r\n    abstract get enums(): E[];\r\n    abstract get enumCaptions(): { [e in E]?: string }\r\n\r\n    abstract get caption(): string;\r\n    abstract get uq(): Uq;\r\n    abstract get IX(): IX;\r\n    abstract get VInput(): new (c: this) => View<this>;\r\n    abstract get OnEnumChanged(): (vale: E) => Promise<void>;\r\n\r\n    isInEnum(e: E): boolean { return this.enumCaptions[e] !== undefined; }\r\n    renderInput(): JSX.Element {\r\n        return this.render(this.VInput as any);\r\n    }\r\n}\r\n\r\nexport abstract class CEnumSingle<E extends number> extends CEnumBase<E> {\r\n    readonly id: number;\r\n    value: E;\r\n    constructor(nav: AppBase, id: number, value: E) {\r\n        super(nav);\r\n        this.id = id;\r\n        this.value = value;\r\n    }\r\n\r\n    get VInput(): new (c: this) => View<this> {\r\n        return VEnumSingle as any;\r\n    }\r\n\r\n    saveIxEnum = async (e: E) => {\r\n        let values = this.enums.map(v => (\r\n            { ix: this.id, xi: v as number }\r\n        ));\r\n        // delete all other roles\r\n        for (let v of values) {\r\n            if (v.xi !== e) {\r\n                v.xi = -v.xi;\r\n            }\r\n        }\r\n        await this.uq.ActIX({\r\n            IX: this.IX,\r\n            values\r\n        });\r\n        if (this.OnEnumChanged) this.OnEnumChanged(e);\r\n    }\r\n}\r\n\r\nexport abstract class CEnumMulti<E extends number> extends CEnumBase<E> {\r\n    readonly id: number;\r\n    values: E[];\r\n    constructor(nav: AppBase, id: number, values: E[]) {\r\n        super(nav);\r\n        this.id = id;\r\n        this.values = values;\r\n    }\r\n\r\n    get VInput(): new (c: this) => View<this> {\r\n        return VEnumMulti as any;\r\n    }\r\n\r\n    saveIxEnum = async (e: E) => {\r\n        let values = this.enums.map(v => (\r\n            { ix: this.id, xi: v as number }\r\n        ));\r\n        // delete all other roles\r\n        for (let v of values) {\r\n            if (v.xi !== e) {\r\n                v.xi = -v.xi;\r\n            }\r\n        }\r\n        await this.uq.ActIX({\r\n            IX: this.IX,\r\n            values\r\n        });\r\n    }\r\n}\r\n","import { View } from \"tonwa-contoller\";\r\nimport { CEnumSingle } from \"./CEnumBase\";\r\n\r\nexport class VEnumSingle<E extends number, C extends CEnumSingle<E>> extends View<C> {\r\n    render() {\r\n        let { caption, enums, enumCaptions, value } = this.controller;\r\n        return <div className=\"container\">\r\n            <div\r\n                className=\"mb-3 row bg-white align-items-center cursor-pointer\">\r\n                <label className=\"col-sm-2 col-form-label\">{caption}</label>\r\n                <div className=\"col-sm-10\">\r\n                    {enums.map(v => {\r\n                        return <label key={v} className=\"me-4 form-check-inline\">\r\n                            <input type=\"radio\" name=\"staff-role\"\r\n                                onChange={this.onChange}\r\n                                defaultChecked={v === value}\r\n                                defaultValue={v} /> {enumCaptions[v]}\r\n                        </label>;\r\n                    })}\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    onChange = async (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let { currentTarget } = evt;\r\n        await this.controller.saveIxEnum(Number(currentTarget.value) as E);\r\n    }\r\n}\r\n","import { CUser, User } from \"tonwa-contoller\";\r\nimport { FA } from \"tonwa-react\";\r\nimport { Role } from \"uq-app/uqs/BzWorkshop\";\r\nimport { MPerson } from \"../CPerson\";\r\n\r\nconst roleCaption: { [role in Role]?: string } = {\r\n    [Role.counselor]: 'Counselor',\r\n    [Role.volunteer]: 'Volunteer',\r\n};\r\n\r\nexport function renderStaff(item: MPerson, cUser?: CUser) {\r\n    let { no, name, firstName, lastName, middleName, user, role } = item;\r\n    let vUser: any;\r\n    if (cUser && user) {\r\n        vUser = cUser.renderUser(user, (user: User) => {\r\n            let { name } = user;\r\n            return <span className=\"ms-4\">\r\n                user:  {name}\r\n            </span>;\r\n        });\r\n    }\r\n    let vRole: any;\r\n    if (role) {\r\n        vRole = <span className=\"ms-3\"><FA name='dot' /> {roleCaption[role]}</span>;\r\n    }\r\n    return <>\r\n        <div className=\"small text-muted me-3\">{no} {vUser}</div>\r\n        <div>\r\n            {name ?? <>{lastName} {middleName} {firstName}</>}\r\n            {vRole}\r\n        </div>\r\n    </>;\r\n}\r\n","//import React from \"react\";\r\n//import { Role } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CStaff/*, staffRoles*/ } from \"./CStaff\";\r\nimport { VEditPerson } from \"../VEditPerson\";\r\n//import { MPerson } from \"../CPerson\";\r\n//import { staffRoleCaptions } from \".\";\r\n\r\nexport class VEditStaff extends VEditPerson<CStaff> {\r\n    content() {\r\n        return <div className=\"py-3\">\r\n            {this.renderBindUser()}\r\n            {this.renderRoles()}\r\n            {this.renderProps()}\r\n            {this.renderTagInput()}\r\n        </div>;\r\n    }\r\n\r\n    protected renderRoles() {\r\n        return this.controller.cRoleSingle.renderInput();\r\n    }\r\n}\r\n","import { CIdBase, Page, setReact } from \"tonwa-contoller\";\r\nimport { CEnumSingle } from \"tonwa-contoller/CEnumBase\";\r\nimport { IX } from \"tonwa-uq\";\r\nimport { Role } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CPerson, MPerson } from \"../CPerson\";\r\nimport { renderStaff } from \"./renderStaff\";\r\nimport { VEditStaff } from \"./VEditStaff\";\r\n\r\nexport const staffRoles = [Role.counselor, Role.volunteer];\r\nexport const staffRoleCaptions: { [role in Role]?: string } = {\r\n    [Role.counselor]: 'Counselor',\r\n    [Role.volunteer]: 'Volunteer',\r\n};\r\n\r\nexport class CStaff extends CPerson {\r\n    cRoleSingle: CRoleSingle;\r\n    get tagGroupName() { return 'staff-tags'; }\r\n    get personRole(): Role { return Role.staff; }\r\n    get caption() { return 'Staff' }\r\n    get icon() { return 'user' }\r\n    isInRole(role: Role): boolean { return staffRoleCaptions[role] !== undefined; }\r\n\r\n    protected async beforeEdit() {\r\n        this.cRoleSingle = new CRoleSingle(this);\r\n        await super.beforeEdit();\r\n    }\r\n\r\n    get VEdit(): new (c: CIdBase) => Page<CPerson> {\r\n        return VEditStaff as any;\r\n    }\r\n    /*\r\n    saveStaffRole = async (role: Role) => {\r\n        let { BzWorkshop } = this.uqs;\r\n        let { currentItem } = this.deepData;\r\n        let personId = currentItem.id;\r\n        let values = staffRoles.map(v => (\r\n            { ix: personId, xi: v }\r\n        ));\r\n        // delete all other roles\r\n        for (let v of values) {\r\n            if (v.xi !== role) {\r\n                v.xi = -v.xi;\r\n            }\r\n        }\r\n        await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxPersonRole,\r\n            values\r\n        });\r\n        setReact(() => {\r\n            currentItem.role = role;\r\n        });\r\n    }\r\n    */\r\n    onRoleChanged = async (value: Role): Promise<void> => {\r\n        setReact(() => {\r\n            let { currentItem } = this.deepData;\r\n            currentItem.role = value;\r\n        });\r\n    }\r\n\r\n    renderItemInList(item: any): JSX.Element {\r\n        return renderStaff(item, this.cIds.app.cUser);\r\n    }\r\n}\r\n\r\nclass CRoleSingle extends CEnumSingle<Role> {\r\n    private readonly cStaff: CStaff;\r\n    constructor(cStaff: CStaff) {\r\n        let { currentItem } = cStaff.deepData;\r\n        super(cStaff.app, currentItem?.id, (currentItem as MPerson).role);\r\n        this.cStaff = cStaff;\r\n    }\r\n    get enums() { return staffRoles; }\r\n    get enumCaptions() { return staffRoleCaptions; }\r\n\r\n    get caption() { return 'Role' }\r\n    get uq() { return this.cStaff.uqs.BzWorkshop; }\r\n    get IX(): IX { return this.uq.IxPersonRole; }\r\n    get OnEnumChanged(): (value: Role) => Promise<void> {\r\n        return this.cStaff.onRoleChanged;\r\n    }\r\n}\r\n","import { Workshop } from \"uq-app/uqs/BzWorkshop\";\r\n\r\nexport function renderWorkshopItem(item: Workshop) {\r\n    let { no, name } = item;\r\n    return <>\r\n        <div className=\"small text-muted me-3\">{no}</div>\r\n        <div>{name}</div>\r\n    </>;\r\n}\r\n","import { VEditId } from \"tonwa-contoller\";\r\nimport { CWorkshop } from \"./CWorkshop\";\r\n\r\nexport class VEditWorkshop extends VEditId<CWorkshop> {\r\n    content() {\r\n        return <div className=\"\">\r\n            <div className=\"my-3 border rounded-3 pt-1\">\r\n                {this.renderProps()}\r\n            </div>\r\n            {this.renderStaffPick()}\r\n\r\n            {this.renderTagInput()}\r\n\r\n            <div className=\"my-3 border rounded-3\">\r\n                {this.controller.cSession.renderList()}\r\n            </div>\r\n        </div>\r\n    }\r\n\r\n    renderStaffPick(): JSX.Element {\r\n        return null;\r\n    }\r\n}\r\n","import { FA, List, LMR } from \"tonwa-react\";\r\nimport { View } from \"tonwa-contoller\";\r\nimport { Session } from \"uq-app/uqs/BzWorkshop\";\r\nimport { renderDate } from \"../../tool\";\r\nimport { CSession } from \"./CSession\";\r\n\r\nexport class VSessionList extends View<CSession> {\r\n    render() {\r\n        return this.react(() => {\r\n            let right = <span className=\"text-success cursor-pointer\" onClick={this.controller.onAdd}>\r\n                <FA name=\"plus\" fixWidth={true} />\r\n            </span>;\r\n            return <>\r\n                <LMR right={right} className=\"px-3 py-1 small text-muted\">\r\n                    Sessions\r\n                </LMR>\r\n                <List items={this.controller.deepData.list} className=\"my-1\"\r\n                    item={{ render: this.renderItem, onClick: this.controller.onEditItem }}\r\n                    none={<small className=\" px-3 py-2 text-muted\">Click {right} to add session</small>} />\r\n            </>\r\n        });\r\n    }\r\n\r\n    private renderItem = (item: any, index: number) => {\r\n        return <div className=\"px-3 py-2\">\r\n            {this.controller.renderItemInList(item)}\r\n        </div>\r\n    }\r\n}\r\n\r\nexport function renderSessionItem(item: Session) {\r\n    let { date, vice, time, span } = item;\r\n    return <div>\r\n        <div>\r\n            {renderDate(date)} &nbsp; &nbsp;\r\n            start at {time} &nbsp; &nbsp;\r\n            for {span} minutes &nbsp; &nbsp;\r\n        </div>\r\n        <div>{vice}</div>\r\n    </div>;\r\n}\r\n","import { IdValue, setReact } from \"tonwa-contoller\";\r\nimport { Uq, ID } from \"tonwa-uq\";\r\nimport { Schema, UiDate, UiNumberItem, UiSchema, UiTextItem, UiTime } from \"tonwa-react\";\r\nimport { Session } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CWorkshop } from \"../../CIds\";\r\nimport { CId } from \"../CId\";\r\nimport { renderSessionItem, VSessionList } from \"./VSessionList\";\r\n\r\nexport class CSession extends CId {\r\n    readonly cWorkshop: CWorkshop;\r\n    readonly tick: number;\r\n    constructor(cWorkshop: CWorkshop) {\r\n        super(cWorkshop.cIds);\r\n        this.cWorkshop = cWorkshop;\r\n        this.tick = Date.now();\r\n        let { fields } = this.uqs.BzWorkshop.Session.ui;\r\n        fields['date'].required = true;\r\n        fields['time'].required = true;\r\n        fields['span'].required = true;\r\n    }\r\n\r\n    get uq(): Uq {\r\n        return this.uqs.BzWorkshop;\r\n    }\r\n    getID(): ID {\r\n        return this.uqs.BzWorkshop.Session;\r\n    }\r\n    get caption(): string {\r\n        return 'Session';\r\n    }\r\n    get schema(): Schema {\r\n        return this.uqs.BzWorkshop.Session.ui.fieldArr;\r\n    }\r\n    get uiSchema(): UiSchema {\r\n        return {\r\n            items: {\r\n                date: {\r\n                    widget: 'date',\r\n                    label: 'Date',\r\n                } as UiDate,\r\n                vice: {\r\n                    widget: 'text',\r\n                    label: 'Discription',\r\n                } as UiTextItem,\r\n                time: {\r\n                    widget: 'time',\r\n                    label: 'Time',\r\n                } as UiTime,\r\n                span: {\r\n                    widget: 'number',\r\n                    label: 'Duration',\r\n                } as UiNumberItem,\r\n                submit: {\r\n                    \"label\": \"Save Session\",\r\n                    \"widget\": \"button\",\r\n                    \"className\": \"btn btn-primary\",\r\n                }\r\n            }\r\n        };\r\n    }\r\n    protected async loadList(): Promise<any[]> {\r\n        let { deepData } = this.cWorkshop;\r\n        let { currentItem } = deepData;\r\n        if (!currentItem) {\r\n            debugger;\r\n            return undefined;\r\n        }\r\n        let { BzWorkshop } = this.uqs;\r\n        let { id } = currentItem;\r\n        let ret = await BzWorkshop.QueryID<Session>({\r\n            IX: [BzWorkshop.IxWorkshopSession],\r\n            IDX: [BzWorkshop.Session],\r\n            ix: id,\r\n        });\r\n        return ret;\r\n    }\r\n    protected async saveId(data: any): Promise<number> {\r\n        let { BzWorkshop } = this.uqs;\r\n        let { deepData } = this.cWorkshop;\r\n        let { currentItem } = deepData;\r\n        let ret = await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxWorkshopSession,\r\n            ID: BzWorkshop.Session,\r\n            values: [\r\n                {\r\n                    ix: currentItem.id,\r\n                    xi: data,\r\n                }\r\n            ]\r\n        });\r\n        let id = ret[0];\r\n        await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxSessionStaff,\r\n            values: [\r\n                { ix: id, xi: currentItem.staff }\r\n            ]\r\n        })\r\n        setReact(() => {\r\n            data.id = id;\r\n            let { list } = this.deepData;\r\n            list.push(data);\r\n        });\r\n        return id;\r\n    }\r\n\r\n    renderItemInList(item: Session): JSX.Element {\r\n        return renderSessionItem(item);\r\n    }\r\n\r\n    renderList(): JSX.Element {\r\n        return this.render(VSessionList);\r\n    }\r\n\r\n    renderIdValue(idValue: IdValue): JSX.Element {\r\n        return renderSessionItem(idValue as Session);\r\n    }\r\n}\r\n","import { Controller, CSelectOne, deepReact, react, setReact } from \"tonwa-contoller\";\r\nimport { Pick } from \"tonwa-react\";\r\nimport { mutedSmall } from \"../tool\";\r\nimport { CId } from \"./CId\";\r\n\r\nexport class CIdPick<C extends CId> extends Controller implements Pick<number> {\r\n    protected readonly cId: C;\r\n    // protected id: number;\r\n    deepValue: {\r\n        id: number;\r\n    } = deepReact({ id: null, });\r\n    constructor(c: C, id: number) {\r\n        super(c.app);\r\n        this.cId = c;\r\n        this.deepValue.id = id;\r\n    }\r\n\r\n    pick = async (): Promise<number> => {\r\n        let cSelectOne = new CSelectOne(this.cId);\r\n        let ret = await cSelectOne.select();\r\n        let id = ret.id;\r\n        setReact(() => {\r\n            this.deepValue.id = id;\r\n        })\r\n        return id;\r\n    }\r\n\r\n    ref() {\r\n        return react(() => {\r\n            let { id } = this.deepValue;\r\n            if (id === null) {\r\n                return this.renderInit();\r\n            }\r\n            if (id === undefined) {\r\n                return this.renderNA();\r\n            }\r\n            return this.cId.renderId(id);\r\n        });\r\n    }\r\n\r\n    protected renderInit() {\r\n        return mutedSmall(`Pick ${this.cId.caption}`);\r\n    }\r\n\r\n    protected renderNA() {\r\n        return mutedSmall(' - ');\r\n    }\r\n}\r\n","import { VAdd } from \"tonwa-contoller\";\r\nimport { CWorkshop } from \"./CWorkshop\";\r\n\r\nexport class VAddWorkshop extends VAdd<CWorkshop> {\r\n    content(): JSX.Element {\r\n        return <div className=\"p-3\">\r\n            {this.renderForm()}\r\n        </div>;\r\n    }\r\n}\r\n","import { Schema, UiSchema, UiTextAreaItem, UiTextItem, UiPick } from \"tonwa-react\";\r\nimport { Uq } from \"tonwa-uq\";\r\nimport { IdValue } from \"tonwa-contoller\";\r\nimport { Workshop } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CId } from \"../CId\";\r\nimport { renderWorkshopItem } from \"./renderItem\";\r\nimport { CIds } from \"../CIds\";\r\nimport { VEditWorkshop } from \"./VEditWorkshop\";\r\nimport { CSession } from \"./CSession\";\r\nimport { CIdPick } from \"../CIdPick\";\r\nimport { VAddWorkshop } from \"./VAddWorkshop\";\r\n\r\nexport class CWorkshop extends CId {\r\n    readonly cSession: CSession;\r\n\r\n    constructor(cIds: CIds) {\r\n        super(cIds);\r\n        this.cSession = new CSession(this);\r\n    }\r\n    get tagGroupName() { return 'workshop-tags'; }\r\n    get uq(): Uq { return this.uqs.BzWorkshop; };\r\n    getID() { return this.uqs.BzWorkshop.Workshop; }\r\n    get caption() { return 'Workshop' }\r\n    get icon() { return 'book'; }\r\n    get iconClass(): string { return 'text-warning'; }\r\n    get schema(): Schema {\r\n        return this.uqs.BzWorkshop.Workshop.ui.fieldArr;\r\n    }\r\n    get uiSchema(): UiSchema {\r\n        return {\r\n            items: {\r\n                no: {\r\n                    \"name\": \"no\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": true,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"No\",\r\n                    \"defaultValue\": this.initNO,\r\n                    readOnly: true,\r\n                } as UiTextItem,\r\n                name: {\r\n                    \"name\": \"name\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Name\",\r\n                } as UiTextItem,\r\n                vice: {\r\n                    \"name\": \"vice\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"textarea\",\r\n                    \"label\": \"Discription\",\r\n                    \"placeholder\": \"Workshop discription\",\r\n                    \"rows\": 6,\r\n                } as UiTextAreaItem,\r\n                staff: {\r\n                    name: 'staff',\r\n                    widget: 'pick',\r\n                    label: 'Staff',\r\n                    pick: new CIdPick(this.cIds.cStaff, this.deepData.currentItem?.staff),\r\n                } as UiPick,\r\n                submit: {\r\n                    \"label\": \"Save Workshop\",\r\n                    \"widget\": \"button\",\r\n                    \"className\": \"btn btn-primary\",\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    protected async beforeEdit() {\r\n        await super.beforeEdit();\r\n        await this.cTagInput.beforeEdit(this.tagGroupName, this.deepData.currentItem.id);\r\n        await this.cSession.loadToList()\r\n    }\r\n\r\n    protected async loadList(): Promise<any[]> {\r\n        let list = await this.uqs.BzWorkshop.QueryID({\r\n            ID: this.ID,\r\n            page: { start: 0, size: 10 },\r\n            order: 'desc',\r\n        });\r\n        return list;\r\n    }\r\n\r\n    async saveId(data: any) {\r\n        let ret = await this.uqs.BzWorkshop.Acts({\r\n            workshop: [data],\r\n        });\r\n        return ret.workshop[0];\r\n    }\r\n\r\n    renderItemInList(item: any): JSX.Element {\r\n        return renderWorkshopItem(item);\r\n    }\r\n\r\n    get VAdd() { return VAddWorkshop as any; }\r\n    get VEdit() { return VEditWorkshop as any; }\r\n\r\n    renderIdValue(idValue: IdValue): JSX.Element {\r\n        return renderWorkshopItem(idValue as Workshop);\r\n    }\r\n\r\n    async savePropValue(id: number, name: string, value: any): Promise<void> {\r\n        let { BzWorkshop } = this.uqs;\r\n        switch (name) {\r\n            default:\r\n                await BzWorkshop.ActIDProp(this.ID, id, name, value);\r\n                break;\r\n            case 'staff':\r\n                await BzWorkshop.SaveWorkshopStaff.submit({ id, staff: value });\r\n                break;\r\n        }\r\n    }\r\n}\r\n","import { Page } from \"tonwa-contoller\";\r\nimport { FA, LMR } from \"tonwa-react\";\r\nimport { CIds } from \"./CIds\";\r\n\r\nexport class VStart extends Page<CIds> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Items';\r\n    }\r\n\r\n    content() {\r\n        let { cWorkshop, cStaff, cClient, app } = this.controller;\r\n        return <div>{\r\n            [cWorkshop, cStaff, cClient, app.cTag].map((v, index) => {\r\n                if (v.isVisible() === false) return null;\r\n                let { caption, icon, iconClass } = v;\r\n                let right = <FA name=\"angle-right\" />;\r\n                let vIcon = <FA name={icon} className={(iconClass ?? 'text-primary') + ' me-4'} fixWidth={true} size=\"lg\" />;\r\n                return <LMR key={index}\r\n                    className=\"cursor-pointer bg-white border-bottom py-2 px-3 align-items-center\"\r\n                    left={vIcon}\r\n                    right={right}\r\n                    onClick={() => v.openMain()}>{caption}</LMR>\r\n            })\r\n        }</div>;\r\n    }\r\n}\r\n","import { App } from \"../App\";\r\nimport { CControl } from \"../CControl\";\r\nimport { CClient } from \"./CPerson/CClient\";\r\nimport { CStaff } from \"./CPerson/CStaff\";\r\nimport { CWorkshop } from \"./CWorkshop\";\r\nimport { VStart } from \"./VStart\";\r\n\r\nexport class CIds extends CControl {\r\n    readonly cWorkshop: CWorkshop;\r\n    readonly cClient: CClient;\r\n    readonly cStaff: CStaff;\r\n    //readonly cTag: CTag;\r\n\r\n    // personCategories: PersonCategory[];\r\n    //personCatClient: PersonCategory;\r\n    //personCatStaff: PersonCategory;\r\n\r\n    constructor(app: App) {\r\n        super(app);\r\n        this.cWorkshop = new CWorkshop(this);\r\n        this.cClient = new CClient(this);\r\n        this.cStaff = new CStaff(this);\r\n        //this.cTag = app.cTag;\r\n    }\r\n\r\n    load = async () => {\r\n        /*\r\n        if (this.personCategories) return;\r\n        let { BzWorkshop } = this.uqs;\r\n        this.personCategories = await BzWorkshop.QueryID({ ID: BzWorkshop.PersonCategory });\r\n        this.personCatStaff = this.personCategories.find(v => v.name === 'staff');\r\n        this.personCatClient = this.personCategories.find(v => v.name === 'client');\r\n        */\r\n    }\r\n\r\n    onWorkshop = (): void => {\r\n        this.cWorkshop.openMain();\r\n    }\r\n\r\n    onClient = (): void => {\r\n        this.cClient.openMain();\r\n    }\r\n\r\n    onStaff = (): void => {\r\n        this.cStaff.openMain();\r\n    }\r\n\r\n    main() {\r\n        return this.render(VStart);\r\n    }\r\n}\r\n","import { Page } from \"tonwa-contoller\";\r\nimport { appConfig } from \"../../uq-app/appConfig\";\r\nimport { CMe } from \"./CMe\";\r\n\r\nexport class VAbout extends Page<CMe> {\r\n\theader() { return 'about APP'; }\r\n\tcontent() {\r\n\t\treturn <div className=\"py-5 px-3 my-3 w-max-30c mx-auto bg-white\">\r\n\t\t\t<div className=\"text-center mb-5 position-relative\">\r\n\t\t\t\t<small className=\"text-muted position-absolute\"\r\n\t\t\t\t\tstyle={{ right: '0', top: '-2.8rem' }}>\r\n\t\t\t\t\tversion: {appConfig.version}\r\n\t\t\t\t</small>\r\n\t\t\t\t<b className=\"text-danger h5 mb-0\">About</b>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { observer } from 'mobx-react';\r\nimport { Image, PropGrid, LMR, FA, Prop } from \"tonwa\";\r\nimport { CMe } from './CMe';\r\nimport { appConfig } from '../../uq-app/appConfig';\r\nimport { VAbout } from './VAbout';\r\nimport { tonwa } from \"tonwa-core\";\r\nimport { View } from 'tonwa-contoller';\r\n\r\nexport class VMe extends View<CMe> {\r\n    render(): JSX.Element {\r\n        const { user } = tonwa;\r\n        let aboutRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <LMR className=\"w-100 py-2\" onClick={this.about}\r\n                    right={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n                    <FA className=\"text-info me-3\" name=\"smile-o\" fixWidth={true} size=\"lg\" />\r\n                    <b className=\"\">{this.res('aboutTheApp')} <small>{this.res('version')} {appConfig.version}</small></b>\r\n                </LMR>,\r\n            },\r\n        ];\r\n\r\n        let rows: Prop[];\r\n        if (user === undefined) {\r\n            rows = aboutRows;\r\n            rows.push(\r\n                {\r\n                    type: 'component',\r\n                    component: <button className=\"btn btn-success w-100 my-2\" onClick={() => tonwa.logout()}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.res('pleaseLogin')}\r\n                    </button>\r\n                },\r\n            );\r\n        }\r\n        else {\r\n            let logOutRows: Prop[] = [\r\n            ];\r\n\r\n            rows = [\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: <this.meInfo />\r\n                },\r\n            ]\r\n\r\n            let { onAdmin } = this.controller.cAdmin;\r\n            if (onAdmin) {\r\n                rows.push('');\r\n                rows.push({\r\n                    type: 'component',\r\n                    component: <LMR className=\"w-100 py-3\" onClick={onAdmin}\r\n                        right={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n                        <FA className=\"text-primary me-3\" name=\"cogs\" fixWidth={true} size=\"lg\" />\r\n                        <b className=\"text-danger\">{this.res('admin')}</b>\r\n                    </LMR>,\r\n                })\r\n            }\r\n\r\n            rows.push(...aboutRows, ...logOutRows);\r\n        }\r\n        return <PropGrid rows={[...rows]} values={{}} />;\r\n    }\r\n\r\n    private meInfo = observer(() => {\r\n        let { user } = tonwa;\r\n        if (!user) return null;\r\n        let { id, name, nick, icon } = user;\r\n        return <LMR className=\"py-2 cursor-pointer w-100\"\r\n            left={<Image className=\"w-3c h-3c me-3\" src={icon || '.user-o'} />}\r\n            right={<FA className=\"align-self-end\" name=\"angle-right\" />}\r\n            onClick={this.controller.showEditMe}>\r\n            <div>\r\n                <div>{userSpan(name, nick)}</div>\r\n                <div className=\"small\"><span className=\"text-muted\">ID:</span> {id > 10000 ? id : String(id + 10000).substr(1)}</div>\r\n            </div>\r\n        </LMR>;\r\n    });\r\n\r\n    private about = () => {\r\n        this.controller.open(VAbout);\r\n    }\r\n}\r\n\r\nfunction userSpan(name: string, nick: string): JSX.Element {\r\n    return nick ?\r\n        <><b>{nick} &nbsp; <small className=\"muted\">{name}</small></b></>\r\n        : <b>{name}</b>\r\n}\r\n","import { makeObservable, observable } from 'mobx';\r\nimport {\r\n    ItemSchema, StringSchema, ImageSchema, UiTextItem, UiImageItem,\r\n    Edit, UiSchema, Prop, FA, IconText, PropGrid\r\n} from \"tonwa\";\r\nimport { tonwa } from \"tonwa-core\";\r\nimport { Page } from 'tonwa-contoller';\r\nimport { CMe } from './CMe';\r\n\r\nexport class VEditMe extends Page<CMe>{\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema,\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    data: any = undefined;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            data: observable\r\n        })\r\n        let { nick, icon } = tonwa.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        };\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        await tonwa.net.userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        tonwa.user.name = newValue;\r\n        tonwa.saveLocalUser();\r\n    }\r\n\r\n    private onExit = () => {\r\n        tonwa.showLogout();\r\n    }\r\n\r\n    private changePassword = async () => {\r\n        await tonwa.changePassword();\r\n    }\r\n\r\n    private userQuit = async () => {\r\n        await tonwa.userQuit();\r\n    }\r\n\r\n    header(): string | boolean | JSX.Element {\r\n        return '个人信息';\r\n    }\r\n\r\n    content() {\r\n        let { schema, uiSchema, data, onItemChanged } = this;\r\n        let gridRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <IconText iconClass=\"text-info me-2\" icon=\"key\" text={this.res('changePassword')} />,\r\n                onClick: this.changePassword\r\n            },\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <IconText iconClass=\"text-info me-2\" icon=\"key\" text={this.res('quitUser')} />,\r\n                onClick: this.userQuit\r\n            },\r\n            '',\r\n            '',\r\n            {\r\n                type: 'component',\r\n                bk: '',\r\n                component: <div className=\"w-100 text-center\">\r\n                    <button className=\"btn btn-danger w-100 w-max-20c\" onClick={this.onExit}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.res('logout')}\r\n                    </button>\r\n                </div>\r\n            },\r\n        ];\r\n\r\n\r\n        /*\r\n        let vAdmin: any;\r\n    \t\r\n        let { role } = this.controller;\r\n        if ((role & 2) === 2) {\r\n            vAdmin = <div className=\"px-3 py-2 cursor-pointer bg-white border-bottom\" onClick={this.controller.showAdmin}>管理员</div>;\r\n        }\r\n        {vAdmin}\r\n        */\r\n        return <div>\r\n            <Edit schema={schema} uiSchema={uiSchema}\r\n                data={data}\r\n                onItemChanged={onItemChanged} />\r\n            <PropGrid rows={gridRows} values={{}} />\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const webUserSchema: ItemSchema[] = [\r\n    { name: 'firstName', type: 'string', required: true } as StringSchema,\r\n    { name: 'gender', type: 'string' } as StringSchema,\r\n    { name: 'salutation', type: 'string' } as StringSchema,\r\n    { name: 'organizationName', type: 'string', required: true } as StringSchema,\r\n    { name: 'departmentName', type: 'string' } as StringSchema,\r\n];\r\n\r\n","import { View } from \"tonwa-contoller\";\r\nimport { CAdmin } from \"./CAdmin\";\r\n\r\nconst cnRow = ' px-3 py-2 ';\r\nconst cnBg = ' bg-white ';\r\n//const cnMYLg = ' my-2 ';\r\nconst cnMYSm = ' my-1 ';\r\nconst cnSmallMuted = ' small text-muted ';\r\n\r\nexport class VRoleSettings extends View<CAdmin> {\r\n    render(): JSX.Element {\r\n        return <div className=\"mt-3\">\r\n            <div className={cnRow + cnSmallMuted}>counselor</div>\r\n            <div className={cnRow + cnBg + cnMYSm}></div>\r\n        </div>\r\n    }\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { App } from \"../App\";\r\nimport { CAdminBase } from \"tonwa-contoller\";\r\nimport { VRoleSettings } from \"./VRoleSettings\";\r\n\r\nexport class CAdmin extends CAdminBase<App> {\r\n    readonly uqs: UQs;\r\n\r\n    constructor(app: App) {\r\n        super(app);\r\n        //this.cApp = cApp;\r\n        this.uqs = app.uqs;\r\n    }\r\n\r\n    protected async loadAdmins(): Promise<any[]> {\r\n        return await this.uqs.BzWorkshop.AdminGetList();\r\n    }\r\n\r\n    protected async setMeAdmin(): Promise<void> {\r\n        await this.uqs.BzWorkshop.AdminSetMe();\r\n    }\r\n\r\n    protected async setAdmin(user: number, role: number, assigned: string): Promise<void> {\r\n        await this.uqs.BzWorkshop.AdminSet(user, role, assigned);\r\n    }\r\n\r\n    get me(): number {\r\n        return this.app.user?.id;\r\n    }\r\n\r\n    renderRoleSettings(): JSX.Element {\r\n        return this.render(VRoleSettings);\r\n    }\r\n}\r\n","import { User } from 'tonwa-uq';\r\nimport { QueryPager } from \"tonwa\";\r\nimport { VMe } from \"./VMe\";\r\nimport { VEditMe } from \"./VEditMe\";\r\nimport { CAdmin } from \"../CAdmin\";\r\nimport { CControl } from \"../CControl\";\r\nimport { App } from \"../App\";\r\n\r\nexport interface RootUnitItem {\r\n\tid: number;\t\t\t\t\t// root unit id\r\n\towner: any;\r\n\tname: string;\t\t\t\t// 唯一\r\n\tcontent: string;\r\n\ttonwaUnit: number;\t\t\t// 跟tonwa机构对应的值\r\n\tx: number;\r\n}\r\n\r\nexport class CMe extends CControl {\r\n\trole: number;\r\n\tunitOwner: User;\r\n\trootUnits: QueryPager<any>;\r\n\tcAdmin: CAdmin;\r\n\r\n\tconstructor(app: App) {\r\n\t\tsuper(app);\r\n\t\tthis.cAdmin = new CAdmin(this.app);\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => {\r\n\t\treturn this.render(VMe);\r\n\t}\r\n\r\n\tshowEditMe = async () => {\r\n\t\t//let result = await this.uqs.Notes.GetSystemRole.query({});\r\n\t\t//this.role = result.ret[0]?.role;\r\n\t\tthis.open(VEditMe);\r\n\t}\r\n\r\n\tload = async () => {\r\n\t\tawait this.cAdmin.load();\r\n\t\t//this.roles = await this.getUqRoles(this.uq.name);\r\n\t}\r\n\r\n\tbackend = async () => {\r\n\t\t//let cRoles = new CRoles(this.uq, this.res);\r\n\t\t//await cRoles.start();\r\n\t}\r\n\r\n\tprivate myRolesChanged = (roles: string[]) => {\r\n\t\t//this.roles = roles;\r\n\t\t//this.user.roles[this.uq.name] = roles;\r\n\t\t//nav.saveLocalUser();\r\n\t}\r\n}\r\n","import { App } from \"../App\";\r\nimport { CTagBase, Tag } from \"tonwa-contoller\";\r\nimport { ID, IX } from \"tonwa-uq\";\r\nimport { UQs } from \"uq-app\";\r\nimport * as BzWorkshop from 'uq-app/uqs/BzWorkshop';\r\n\r\nexport class CTag extends CTagBase<App> {\r\n    readonly uqs: UQs;\r\n    readonly uq: BzWorkshop.UqExt;\r\n    readonly TagGroup: ID;\r\n    readonly Tag: ID;\r\n    readonly TagItem: ID;\r\n    readonly IxTag: IX;\r\n    readonly IxLocalIdTag: IX;\r\n    readonly IxGlobalIdTag: IX;\r\n    readonly groups: Tag[] = [\r\n        { name: 'workshop-tags', vice: 'Workshop tags' },\r\n        { name: 'client-tags', vice: 'Client tags' },\r\n        { name: 'staff-tags', vice: 'Staff tags' },\r\n    ];\r\n\r\n    constructor(app: App) {\r\n        super(app);\r\n        this.uqs = app.uqs;\r\n        this.uq = this.uqs.BzWorkshop;\r\n        this.TagGroup = this.uq.TagGroup;\r\n        this.Tag = this.uq.Tag;\r\n        this.TagItem = this.uq.TagItem;\r\n        this.IxTag = this.uq.IxTag;\r\n        this.IxLocalIdTag = this.uq.IxLocalIdTag;\r\n        this.IxGlobalIdTag = this.uq.IxGlobalIdTag;\r\n    }\r\n\r\n    get caption(): string { return 'Tags admin'; }\r\n    get icon(): string { return 'tag'; }\r\n    get iconClass(): string { return 'text-danger'; }\r\n\r\n    isVisible(): boolean {\r\n        return this.app.meAdmin;\r\n    }\r\n}\r\n","import { TabProp, TabCaptionComponent, TabsProps, t } from \"tonwa\";\r\nimport { Page } from 'tonwa-contoller';\r\nimport { CMain } from './CMain';\r\n\r\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\r\nfunction caption(label: string | JSX.Element, icon: string) {\r\n\treturn (selected: boolean) => TabCaptionComponent(label, icon, color(selected));\r\n}\r\n\r\nexport class VMain extends Page<CMain> {\r\n\tprotected get tabsProps(): TabsProps {\r\n\t\tlet { cHome, cActs, cIds, cMe } = this.controller.app;\r\n\t\tlet tabs: TabProp[] = [\r\n\t\t\t{ name: 'home', caption: caption(t('dev'), 'wrench'), content: cHome.tab },\r\n\t\t\t{ name: 'acts', caption: caption(t('home'), 'home'), content: () => cActs.main(), load: cActs.load },\r\n\t\t\t{ name: 'ids', caption: caption(t('ids'), 'file-text-o'), content: () => cIds.main(), load: cIds.load },\r\n\t\t]\r\n\t\ttabs.push(\r\n\t\t\t{ name: 'me', caption: caption(t('me'), 'user-o'), content: cMe.tab, load: cMe.load },\r\n\t\t);\r\n\t\treturn { tabs };\r\n\t}\r\n}\r\n","import { CControl } from \"./CControl\";\r\nimport { VMain } from \"./VMain\";\r\n\r\nexport class CMain extends CControl {\r\n    async openMain() {\r\n        this.open(VMain);\r\n    }\r\n}","import { CControl } from \"../CControl\";\r\n\r\nexport class CRouter extends CControl {\r\n    pathParam: string;\r\n}\r\n","import { Page } from \"tonwa-contoller\";\r\nimport { Form, UiSchema, UiTextItem } from \"tonwa-react\";\r\nimport { Person } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CClientSurvey } from \"./CClientSurvey\";\r\n\r\nexport class PClientForm extends Page<CClientSurvey, Person> {\r\n    header(): string | boolean | JSX.Element {\r\n        return null;\r\n    }\r\n\r\n    content() {\r\n        const schema = [\r\n            ...this.controller.uqs.BzWorkshop.Person.ui.fieldArr as any[],\r\n            { name: 'submit', type: 'submit' }\r\n        ];\r\n        const uiSchema: UiSchema = {\r\n            items: {\r\n                no: {\r\n                    \"name\": \"no\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": true,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"No\",\r\n                    \"defaultValue\": this.props.no,\r\n                } as UiTextItem,\r\n                name: {\r\n                    \"name\": \"name\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Name\",\r\n                    \"defaultValue\": this.props.name,\r\n                } as UiTextItem,\r\n                firstName: {\r\n                    \"name\": \"firstName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"First Name\",\r\n                    \"defaultValue\": this.props.firstName,\r\n                } as UiTextItem,\r\n                lastName: {\r\n                    \"name\": \"lastName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Last Name\",\r\n                    \"defaultValue\": this.props.lastName,\r\n                } as UiTextItem,\r\n                middleName: {\r\n                    \"name\": \"middleName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Middle Name\",\r\n                    \"defaultValue\": this.props.middleName,\r\n                } as UiTextItem,\r\n                submit: {\r\n                    \"label\": \"Submit\",\r\n                    \"widget\": \"button\",\r\n                    \"className\": \"btn btn-primary\",\r\n                }\r\n            }\r\n        }\r\n        return <div className=\"p-3\">\r\n            <Form schema={schema} uiSchema={uiSchema} fieldLabelSize={2} />\r\n        </div>;\r\n    }\r\n}\r\n","import { Page } from \"tonwa-contoller\";\r\nimport { CClientSurvey } from \"./CClientSurvey\";\r\n\r\nexport class PInvalid extends Page<CClientSurvey> {\r\n    header(): string | boolean | JSX.Element {\r\n        return null;\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"p-3\">\r\n            invalid\r\n        </div>;\r\n    }\r\n}\r\n","import { Page } from \"tonwa-contoller\";\r\nimport { CClientSurvey } from \"./CClientSurvey\";\r\n\r\nexport class PMain extends Page<CClientSurvey> {\r\n    header(): string | boolean | JSX.Element {\r\n        return null;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return <div className=\"p-3\">\r\n            <div className=\"my-5 text-center text-success\">\r\n                Welcome to the servey!\r\n            </div>\r\n            <div className=\"my-5 text-center\">\r\n                {this.controller.pathParam}\r\n            </div>\r\n            <div className=\"my-5 text-center\">\r\n                <button className=\"btn btn-primary\" onClick={evt => this.waitingEvent(evt, this.controller.onStart)}>Next &gt;</button>\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n","import { Person } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CRouter } from \"../CRouter\";\r\nimport { PClientForm } from \"./PClientForm\";\r\nimport { PInvalid } from \"./PInvalid\";\r\nimport { PMain } from \"./PMain\";\r\n\r\nexport class CClientSurvey extends CRouter {\r\n    async openMain() {\r\n        this.open(PMain);\r\n    }\r\n\r\n    onStart = async () => {\r\n        let { BzWorkshop } = this.uqs;\r\n        let id = Number.parseInt(this.pathParam);\r\n        if (isNaN(id) === true) {\r\n            this.open(PInvalid);\r\n            return\r\n        }\r\n        let ret = await BzWorkshop.ID<Person>({\r\n            IDX: BzWorkshop.Person,\r\n            id,\r\n        });\r\n        if (ret.length === 0) {\r\n            this.open(PInvalid);\r\n            return;\r\n        }\r\n\r\n        this.open(PClientForm, ret[0]);\r\n    }\r\n}\r\n","import { App } from \"../App\";\r\nimport { CClientSurvey } from \"./CClientSurvey\";\r\nimport { CRouter } from \"./CRouter\";\r\n\r\nconst coll: {\r\n    [name: string]: new (a: App) => CRouter\r\n} = {\r\n    '/client/survey/': CClientSurvey,\r\n};\r\n\r\nexport function routers(app: App): boolean {\r\n    let { href } = document.location;\r\n    let path = href.toLowerCase();\r\n    for (let i in coll) {\r\n        let p = path.indexOf(i.toLowerCase());\r\n        if (p >= 0) {\r\n            let Control = coll[i];\r\n            let param = path.substring(p + i.length);\r\n            let c = new Control(app);\r\n            c.pathParam = param;\r\n            c.openMain();\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n","export default __webpack_public_path__ + \"static/media/logo.6ce24c58.svg\";","import { FA } from \"tonwa\";\r\nimport { Page } from \"tonwa-contoller\";\r\nimport { CHome } from \"./CHome\";\r\nimport logo from '../../logo.svg';\r\nimport '../../App.css';\r\n\r\nexport class VHome extends Page<CHome> {\r\n\tprivate items: string[] = [\r\n\t\t'在服务器端创建 app',\r\n\t\t'创建 uq 编程单元',\r\n\t\t'uq 关联 app',\r\n\t\t'uq 绑定数据库服务',\r\n\t\t'编写 uq 代码',\r\n\t\t'提交 uq 编译生成数据库',\r\n\t\t'在 src/appConfig.ts 设置 uqs',\r\n\t\t'在 vs code 调试环境运行Build UqApp，生成uq typescript interface',\r\n\t\t'调用 uq 接口，读写数据',\r\n\t];\r\n\theader() { return '首页' }\r\n\tcontent() {\r\n\t\treturn <div className=\"App\">\r\n\t\t\t<header className=\"App-header\">\r\n\t\t\t\t<img src={logo} className=\"App-logo\" alt=\"logo\" />\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<span className=\"text-success\">tonwa</span> + <span className=\"text-primary\">uq</span> = UI + DB\r\n\t\t\t\t</p>\r\n\t\t\t\t<div className=\"mb-3 h6 text-warning\">\r\n\t\t\t\t\t编程\r\n\t\t\t\t\t<FA name=\"handshake-o\" size=\"lg\" className=\"text-danger mx-2\" />\r\n\t\t\t\t\t开心\r\n\t\t\t\t</div>\r\n\t\t\t</header>\r\n\t\t\t<ul className=\"text-left my-3 me-3\">\r\n\t\t\t\t{this.items.map((v, index) => <li key={index} className=\"my-2\">{v}</li>)}\r\n\t\t\t</ul>\r\n\t\t</div>;\r\n\t}\r\n}","import { CControl } from \"../CControl\";\r\nimport { VHome } from \"./VHome\";\r\n\r\nexport class CHome extends CControl {\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => this.render(VHome);\r\n\r\n\tload = async () => {\r\n\r\n\t}\r\n}\r\n\r\n","import { User } from 'tonwa-uq';\r\nimport { AppBase, CUser, Nav, UserApi } from \"tonwa-contoller\";\r\nimport { UQs } from \"uq-app\";\r\nimport { Role } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CActs } from \"./CActs\";\r\nimport { CIds } from \"./CIds\";\r\nimport { CMe } from \"./CMe\";\r\nimport { CTag } from \"./CTag\";\r\nimport { AutoRun } from \"./tool\";\r\nimport { CMain } from \"./CMain\";\r\nimport { routers } from \"./CRouter\";\r\nimport { CHome } from './CHome';\r\n\r\ntype Roles = { [role in Role]: number };\r\n\r\nexport class App extends AppBase {\r\n    private readonly autoRun: AutoRun;\r\n    appNav: Nav;\r\n    user: User;\r\n    meAdmin: boolean;\r\n    meRoles: Roles;\r\n    readonly uqs: UQs;\r\n    readonly cHome: CHome;\r\n    readonly cTag: CTag;\r\n    readonly cActs: CActs;\r\n    readonly cIds: CIds;\r\n    readonly cMe: CMe;\r\n    readonly cUser: CUser;\r\n\r\n    userApi: UserApi;\r\n    get nav(): Nav {\r\n        return this.appNav;\r\n    }\r\n\r\n    constructor(uqs: UQs) {\r\n        super();\r\n        let poked = uqs.BzWorkshop.$poked.query(undefined, undefined, false);\r\n        let autoLoader: Promise<any> = undefined; // new Promise<any>((resolve, reject) => { });\r\n        this.autoRun = new AutoRun(poked, autoLoader);\r\n        this.uqs = uqs;\r\n        this.cHome = new CHome(this);\r\n        this.cTag = new CTag(this);\r\n        this.cActs = new CActs(this);\r\n        this.cIds = new CIds(this);\r\n        this.cMe = new CMe(this);\r\n        this.cUser = new CUser(this);\r\n    }\r\n\r\n    openMain() {\r\n        this.autoRun.start();\r\n        let ret = routers(this);\r\n        if (ret === true) return;\r\n        if (!this.user) {\r\n            this.nav.openLogin();\r\n            return;\r\n        }\r\n        let cMain = new CMain(this);\r\n        cMain.openMain();\r\n    }\r\n\r\n    isRole(...roles: Role[]): boolean {\r\n        if (roles === undefined) return false;\r\n        for (let r of roles) {\r\n            if (this.meRoles[r] !== undefined) return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    isAdminOrRole(...roles: Role[]): boolean {\r\n        if (this.meAdmin === true) return true;\r\n        return this.isRole(...roles);\r\n    }\r\n\r\n    isPersonMe(person: number): boolean {\r\n        for (let i in this.meRoles) {\r\n            if (person === this.meRoles[Number(i) as Role]) return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    async loadBaseData() {\r\n        let { BzWorkshop } = this.uqs;\r\n        let ret = await Promise.all([\r\n            this.cIds.load(),\r\n            BzWorkshop.AdminIsMe(),\r\n            BzWorkshop.IX<{ ix: number; a: number; b: number; }>({\r\n                IX: BzWorkshop.IxUserPerson,\r\n                IX1: BzWorkshop.IxPersonRole,\r\n                ix: undefined,\r\n            })\r\n        ]);\r\n        this.meRoles = this.buildRoles(ret[2] as any);\r\n        this.meAdmin = ret[1];\r\n    }\r\n\r\n    private buildRoles(typeValues: { type: string; value: string }[]): Roles {\r\n        let { BzWorkshop } = this.uqs;\r\n        let roles: Roles = {} as Roles;\r\n        for (let row of typeValues) {\r\n            let { type, value } = row;\r\n            let v = BzWorkshop.IDValue(type, value);\r\n            switch (type) {\r\n                case 'personrole':\r\n                    let { person, role } = v as any;\r\n                    roles[role as Role] = person;\r\n                    break;\r\n            }\r\n        }\r\n        return roles;\r\n    }\r\n\r\n    renderAdmin(el: JSX.Element): JSX.Element {\r\n        if (this.meAdmin === true) return el;\r\n        return null;\r\n    }\r\n    renderRole(el: JSX.Element, ...roles: number[]): JSX.Element {\r\n        if (this.isRole(...roles) === true) return el;\r\n        return null;\r\n    }\r\n    renderAdminOrRole(el: JSX.Element, ...roles: number[]): JSX.Element {\r\n        if (this.isAdminOrRole(...roles) === true) return el;\r\n        return null;\r\n    }\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\thome: '首页',\r\n\trelation: '关系',\r\n\tdiscover: '发现',\r\n\tsupervise: '团队',\r\n\tids: '基础ID',\r\n\ttest: '测试',\r\n\tdebug: 'Debug',\r\n\tme: '我',\r\n\r\n\tchangePassword: '修改密码',\r\n\taboutTheApp: '关于本APP',\r\n\tlogout: '退出登录',\r\n\tpleaseLogin: '登录',\r\n\tuserQuit: '注销用户',\r\n\r\n\tcontent: '内容',\r\n\tbackend: '后台管理',\r\n\r\n\tlist: '列表',\r\n}\r\n","export const en = {\r\n\thome: 'Home',\r\n\trelation: 'Relation',\r\n\tdiscover: 'Discover',\r\n\tsupervise: 'Supervise',\r\n\tids: 'Items',\r\n\ttest: 'Test',\r\n\tdebug: 'Debug',\r\n\tme: 'Me',\r\n\r\n\tchangePassword: 'Change password',\r\n\taboutTheApp: 'About the APP',\r\n\tlogout: 'Logout',\r\n\tpleaseLogin: 'Login',\r\n\tuserQuit: 'User quit',\r\n\r\n\tcontent: 'Content',\r\n\tbackend: 'Backend Management',\r\n\r\n\tlist: 'List',\r\n}\r\n","import { Nav, Tonwa } from \"tonwa-core\";\r\nimport { Nav as ControlNav } from \"tonwa-contoller\";\r\nimport { start } from \"tonwa\";\r\nimport { App } from \"../App\";\r\nimport { res } from \"./res\";\r\nimport { setUI } from \"uq-app/uqs\";\r\nimport { appConfig } from \"./appConfig\";\r\nimport { CAppBase } from \"tonwa-react\";\r\nimport { UQs } from './uqs';\r\n\r\nexport class CApp extends CAppBase<UQs> {\r\n\tconstructor(tonwa: Tonwa) {\r\n\t\tsuper(tonwa, appConfig);\r\n\t}\r\n\t// app: App;\r\n\r\n\tprotected async internalStart(isUserLogin: boolean) {\r\n\t\tthis.setRes(res);\r\n\t\tsetUI(this.uqs);\r\n\r\n\t\tlet tonwa = this.getTonwa();\r\n\t\tlet appNav = new AppNav(tonwa);\r\n\t\tlet app = new App(this.uqs);\r\n\t\t// this.app = app;\r\n\t\tapp.appNav = appNav;\r\n\t\tapp.user = this.user;\r\n\t\tapp.userApi = this.net.centerApi;\r\n\t\tawait app.loadBaseData();\r\n\r\n\t\tapp.openMain();\r\n\t}\r\n\r\n\tasync initStart() {\r\n\t\tawait this.tonwa.appStart();\r\n\t}\r\n\r\n\trender(loginedOnly: boolean = true): JSX.Element {\r\n\t\tconst onLogined = async (isUserLogin?: boolean) => {\r\n\t\t\tawait start(CApp, this.tonwa, appConfig, isUserLogin);\r\n\t\t}\r\n\t\tlet onNotLogined: () => Promise<void> = undefined;\r\n\t\tif (loginedOnly === false) onNotLogined = onLogined;\r\n\t\treturn this.tonwa.nav.renderNavView(onLogined, onNotLogined);\r\n\t}\r\n}\r\n\r\nexport class AppNav implements ControlNav {\r\n\tprivate readonly nav: Nav;\r\n\tprivate readonly tonwa: Tonwa;\r\n\tconstructor(tonwa: Tonwa) {\r\n\t\tthis.nav = tonwa.nav;\r\n\t\tthis.tonwa = tonwa;\r\n\t}\r\n\r\n\topen(page: JSX.Element, afterClose: () => void): void {\r\n\t\tthis.nav.push(page, afterClose);\r\n\t}\r\n\tclose(level: number = 1): void {\r\n\t\tthis.nav.pop(level);\r\n\t}\r\n\topenLogin(): void {\r\n\t\tthis.tonwa.showLogin(undefined);\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { NavView, start, TonwaReact } from \"tonwa\";\r\nimport { CApp } from './CApp';\r\nimport { appConfig } from './appConfig';\r\n//import { App } from './App';\r\n\r\nexport async function startApp() {\r\n    let tonwa = new TonwaReact();\r\n    //initNav(tonwa);\r\n    tonwa.setSettings(appConfig);\r\n    const onLogined = async (isUserLogin?: boolean) => {\r\n        await start(CApp, tonwa, appConfig, isUserLogin);\r\n    }\r\n    const notLogined: () => Promise<void> = onLogined;\r\n    const userPassword: () => Promise<{ user: string; password: string }> = undefined;\r\n    tonwa.appStart(onLogined);\r\n    ReactDOM.render(\r\n        <React.StrictMode>\r\n            <NavView ref={navView => tonwa.set(navView)}\r\n                onLogined={onLogined}\r\n                notLogined={notLogined}\r\n                userPassword={userPassword} />\r\n        </React.StrictMode>,\r\n        document.getElementById('root')\r\n    );\r\n}\r\n","//import React from 'react';\n//import ReactDOM from 'react-dom';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport './index.css';\nimport { startApp } from './uq-app';\n//import App from './App';\n//import reportWebVitals from './reportWebVitals';\n\n(function () {\n  startApp();\n})();\n/*\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n*/"],"sourceRoot":""}