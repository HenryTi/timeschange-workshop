{"version":3,"sources":["tonwa-core/web/caller.ts","tonwa-core/web/httpChannel.ts","tonwa-core/web/httpChannelUI.ts","tonwa-core/web/apiBase.ts","tonwa-core/web/wsChannel.ts","tonwa-core/web/uqApi.ts","tonwa-core/web/appBridge.ts","tonwa-core/web/centerApi.ts","tonwa-core/web/guestApi.ts","tonwa-core/web/messageHub.ts","tonwa-core/web/host.ts","tonwa-core/web/Web.ts","tonwa-core/uqBuild/TsTemplate.ts","tonwa-core/uqCore/uqMan.ts","tonwa-core/uqBuild/UqBuildContext.ts","tonwa-core/uqCore/entity.ts","tonwa-core/uqCore/caller.ts","tonwa-core/uqCore/tuid/idCache.ts","tonwa-core/uqCore/tuid/tuid.tsx","tonwa-core/uqCore/tuid/tuidsCache.ts","tonwa-core/uqCore/action.ts","tonwa-core/uqCore/sheet.ts","tonwa-core/uqCore/query.ts","tonwa-core/uqCore/book.ts","tonwa-core/uqCore/history.ts","tonwa-core/uqCore/map.ts","tonwa-core/uqCore/pending.ts","tonwa-core/uqCore/enum.ts","tonwa-core/uqCore/ID.ts","tonwa-core/uqCore/IDCache/IDCache.ts","tonwa-core/uqCore/uqsMan.ts","tonwa-core/uqCore/uqsLoader.ts","tonwa-core/uqCore/uqStringify.ts","tonwa-core/res/res.ts","tonwa-core/res/inputRes.ts","tonwa-core/core/Tonwa.ts","tonwa-core/res/listRes.ts","tonwa-core/core/Navigo.ts","tonwa-core/tool/user.ts","tonwa-core/tool/uid.ts","tonwa-core/tool/local.ts","tonwa-core/tool/getObjPropIgnoreCase.ts","tonwa-core/tool/date.ts","tonwa-core/tool/caseString.ts","tonwa-core/tool/rules.ts","tonwa-react/components/inputRules.ts","tonwa-react/components/form/widgets/widget.tsx","tonwa-react/components/form/widgets/textWidget.tsx","tonwa-react/components/form/widgets/textareaWidget.tsx","tonwa-react/components/form/widgets/passwordWidget.tsx","tonwa-react/components/form/widgets/numberWidget.tsx","tonwa-react/components/form/widgets/updownWidget.tsx","tonwa-react/components/form/widgets/dateWidget.tsx","tonwa-react/components/form/widgets/checkBoxWidget.tsx","tonwa-react/components/form/widgets/selectWidget.tsx","tonwa-react/components/form/widgets/radioWidget.tsx","tonwa-react/components/form/widgets/rangeWidget.tsx","tonwa-react/components/form/widgets/idWidget.tsx","tonwa-react/components/form/widgets/unknown.tsx","tonwa-react/components/form/widgets/buttonWidget.tsx","tonwa-react/components/form/context.tsx","tonwa-react/components/form/widgets/arrComponent.tsx","tonwa-react/components/image.tsx","tonwa-react/components/loading.tsx","tonwa-react/components/simple/Badge.tsx","tonwa-react/components/simple/LMR.tsx","tonwa-react/components/simple/FA.tsx","tonwa-react/components/simple/IconText.tsx","tonwa-react/components/resUploader.tsx","tonwa-react/components/edit/itemEdit.tsx","tonwa-react/components/edit/imageItemEdit.tsx","tonwa-react/components/form/widgets/imageWidget.tsx","tonwa-react/components/form/widgets/tagWidget.tsx","tonwa-react/components/form/widgets/pickWidget.tsx","tonwa-react/components/form/widgets/factory.tsx","tonwa-react/components/form/form.tsx","tonwa-react/components/form/field.tsx","tonwa-react/components/edit/stringItemEdit.tsx","tonwa-react/components/edit/radioItemEdit.tsx","tonwa-react/components/edit/selectItemEdit.tsx","tonwa-react/components/edit/idItemEdit.tsx","tonwa-react/components/edit/tagItemEdit.tsx","tonwa-react/components/edit/textAreaItemEdit.tsx","tonwa-react/components/edit/checkBoxItemEdit.tsx","tonwa-react/components/edit/rangeItemEdit.tsx","tonwa-react/components/edit/numberItemEdit.tsx","tonwa-react/components/edit/edit.tsx","tonwa-react/components/list/base.tsx","tonwa-react/components/list/clickable.tsx","tonwa-react/components/list/static.tsx","tonwa-react/components/list/selectable.tsx","tonwa-react/components/list/index.tsx","tonwa-react/components/easyDate/index.tsx","tonwa-react/components/dropDownActions/index.tsx","tonwa-react/components/propGrid/row.tsx","tonwa-react/components/propGrid/propView.tsx","tonwa-react/components/propGrid/PropGrid.tsx","tonwa-react/components/searchBox.tsx","tonwa-react/components/media.tsx","tonwa-react/components/ax/index.tsx","tonwa-react/components/input/input.tsx","tonwa-react/components/input/inputs/inputNumber.tsx","tonwa-react/components/input/inputs/checkBox.tsx","tonwa-core/uqBuild/tools.ts","tonwa-react/vm/ControllerWithWeb.ts","tonwa-react/vm/View.tsx","tonwa-react/vm/VPage.tsx","tonwa-react/vm/components/CStringEdit.tsx","tonwa-react/components/page/page.tsx","tonwa-core/tool/env.ts","tonwa-react/vm/Controller.tsx","tonwa-react/components/page/scrollView.tsx","tonwa-core/tool/localDb.ts","tonwa-react/nav/NavView.tsx","tonwa-react/ui/res.ts","tonwa-react/components/login.tsx","tonwa-core/tool/62.ts","tonwa-react/components/page/pageHeader.tsx","tonwa-react/components/page/tabs.tsx","tonwa-react/nav/FetchErrorView.tsx","tonwa-core/uqBuild/buildFieldItem.ts","tonwa-react/auth/VLogout.tsx","tonwa-react/auth/VLogin.tsx","tonwa-react/auth/VChangePassword.tsx","tonwa-react/auth/VUserQuit.tsx","tonwa-react/auth/CLogin.tsx","tonwa-react/img/logo.svg","tonwa-react/auth/tools.tsx","tonwa-core/uqBuild/TsUqFolder.ts","tonwa-core/uqBuild/TsUQ.ts","tonwa-react/auth/meInfo.tsx","tonwa-react/app/vMain.tsx","tonwa-react/uq/Uq.ts","tonwa-react/uq/createUQsProxy.tsx","tonwa-react/app/CAppBase.ts","tonwa-react/app/start.ts","tonwa-react/app/CBase.ts","tonwa-react/app/WebReact.ts","tonwa-react/views/userIcon.tsx","tonwa-react/app/UqBuildContext.ts","tonwa-react/CStringEdit.tsx","tonwa-react/tool/cacheIds.ts","tonwa-react/components/reloadPage.tsx","tonwa-react/TonwaReact.tsx","uq-app/CBase.ts","Control/View.tsx","Control/Page.tsx","Control/PError.tsx","Control/PWaiting.tsx","Control/Reactive.ts","Control/Control.ts","Control/CIdBase/CIdBase.ts","Control/AppBase.ts","Control/CIdBase/VSelect.tsx","Control/CIdBase/CSelect.ts","Control/CIdBase/VAdd.tsx","Control/CIdBase/VStart.tsx","Control/CIdBase/VEditId.tsx","Control/CIdBase/IdCache.ts","tool/AppNav.ts","tool/mutedSmall.tsx","tool/renderDate.tsx","Control/CEdit/VRef.tsx","Control/CEdit/CEdit.ts","Control/CEdit/CCheckEdit.tsx","Control/CEdit/CInputEdit.tsx","Control/CEdit/CIdEdit.tsx","Control/CEdit/CPickEdit.tsx","Control/CEdit/createEdit.tsx","Control/CAdminBase/CAdminBase.ts","Control/CTagBase/VAddTag.tsx","Control/CTagBase/VAddTagItem.tsx","Control/CTagBase/VDeleteTagItem.tsx","Control/CTagBase/VEditTag.tsx","Control/CTagBase/VStart.tsx","Control/CTagBase/VTagGroup.tsx","Control/CTagBase/CTagBase.ts","Control/CTagBase/VTagInput.tsx","Control/CTagBase/CTagInput.ts","Control/CAdminBase/VMeSysAdmin.tsx","Control/CAdminBase/VStart.tsx","Control/CAdminBase/VUser.tsx","uq-app/uqs/BzWorkshop/BzWorkshop.ts","Control/CUser/VSelectUser.tsx","Control/CUser/CUser.ts","App/CControl.ts","App/CActs/CAct.ts","App/CActs/CClientNotes/VAddNote.tsx","App/CActs/CClientNotes/VClient.tsx","App/CActs/CClientNotes/VStart.tsx","App/CActs/CClientNotes/CClientNotes.ts","App/CActs/CWorkshops/VAttendee.tsx","App/CActs/CWorkshops/VSession.tsx","App/CActs/CWorkshops/CSessionAct.ts","App/CActs/CWorkshops/VStart.tsx","App/CActs/CWorkshops/CWorkshops.ts","App/CActs/VStart.tsx","App/CActs/CActs.ts","App/CIds/CId.ts","uq-app/uqs/BzWorkshop/Workshop.ui.tsx","uq-app/uqs/BzWorkshop/Person.ui.tsx","uq-app/uqs/BzWorkshop/Note.ui.tsx","uq-app/uqs/BzWorkshop/Session.ui.tsx","uq-app/uqs/BzWorkshop/SessionPerson.ui.tsx","uq-app/uqs/BzWorkshop/Tag.ui.tsx","uq-app/uqs/BzWorkshop/TagGroup.ui.tsx","uq-app/uqs/BzWorkshop/TagItem.ui.tsx","App/CIds/CPerson/renderPerson.tsx","App/CIds/CPerson/VEditPerson.tsx","App/CIds/CPerson/CPerson.ts","App/CIds/CPerson/CClient/CClient.ts","Control/CEnumBase/CEnumBase.ts","Control/CEnumBase/VEnumSingle.tsx","App/CIds/CPerson/CStaff/renderStaff.tsx","App/CIds/CPerson/CStaff/VEditStaff.tsx","App/CIds/CPerson/CStaff/CStaff.ts","App/CIds/CWorkshop/renderItem.tsx","App/CIds/CWorkshop/VEditWorkshop.tsx","App/CIds/CWorkshop/VSessionList.tsx","App/CIds/CWorkshop/CSession.ts","App/CIds/CIdPick.tsx","App/CIds/CWorkshop/VAddWorkshop.tsx","App/CIds/CWorkshop/CWorkshop.ts","App/CIds/VStart.tsx","App/CIds/CIds.ts","uq-app/appConfig.ts","App/CMe/VAbout.tsx","App/CMe/VMe.tsx","App/CMe/VEditMe.tsx","App/CAdmin/VRoleSettings.tsx","App/CAdmin/CAdmin.ts","App/CMe/CMe.ts","App/CTag/CTag.ts","App/VMain.tsx","App/CMain.ts","App/pathControls/CPathControl.ts","App/pathControls/CClientSurvey/PClientForm.tsx","App/pathControls/CClientSurvey/PInvalid.tsx","App/pathControls/CClientSurvey/PMain.tsx","App/pathControls/CClientSurvey/CClientSurvey.ts","App/pathControls/pathControls.ts","App/App.ts","uq-app/res/index.ts","uq-app/res/zh.ts","uq-app/res/en.ts","uq-app/uqs/index.ts","uq-app/uqs/BzWorkshop/index.ts","uq-app/CApp.ts","uq-app/startApp.tsx","index.tsx"],"names":["Caller","params","$$user","undefined","waiting","_params","method","this","methodsWithBody","HttpChannel","web","hostUrl","apiToken","ui","timeout","startWait","endWait","url","reject","showError","error","a","env","isDevelopment","post","urlPrefix","caller","options","buildOptions","headers","path","i","h","encodeURI","p","buildParams","indexOf","body","JSON","stringify","innerFetch","ret","res","keys","Object","length","c","k","innerFetchResult","resolve","buildError","err","ex","retErr","key","channel","that","console","log","now","Date","timeOutHandler","setTimeout","fetch","ok","clearTimeout","statusText","ct","get","json","then","retJson","Array","isArray","retError","catch","text","toLowerCase","startsWith","logout","Promise","buildHeaders","language","culture","lang","CenterHttpChannel","u","appBridge","isBridged","bridgeCenterApi","UqHttpChannel","HttpChannelNavUI","onError","refetchApi","subAppWindow","ApiBase","showWaiting","token","getHttpChannel","xcall","callFetch","put","delete","UqApi","basePath","uqOwner","uqName","uq","buildAppUq","channels","channelUIs","channelUI","channelNoUIs","arr","push","uqToken","getUqToken","init","user","role","name","nick","icon","assigned","parts","split","s","trim","theUser","roles","start","page","entities","UnitxApi","unitId","buildChannel","centerAppApi","CenterAppApi","unitxUq","db","urlTest","realUrl","host","getUrlOrTest","CenterApiBase","getCenterChannelUI","getCenterChannel","uqTokensName","UqTokenApi","localMap","localDb","map","un","localCache","child","unit","loginedUserId","remove","nowTick","Math","floor","tick","value","assign","uqParams","testing","set","removeItem","CallCenterApi","call","appOwner","appName","uqs","param","UserApi","decodeUserToken","account","type","oem","verify","password","prop","id","postWsToSubApp","msg","postMessage","WsBase","messageHub","dispatch","wsBaseSeed","WsBridge","wsBaseId","WSChannel","wsHost","ws","WebSocket","centerToken","onopen","ev","onerror","onmessage","wsMessage","onclose","close","event","data","parse","receive","netThis","connect","send","AppBridge","uqTokens","uqTokenActions","brideCenterApis","window","addEventListener","evt","message","subFrameStarted","onWsReceive","initSubWin","navBack","callCenterApiFromMessage","source","bridgeCenterApiReturn","onReceiveAppApiMessage","hash","apiName","onAppApiReturn","clearLocal","self","parent","subWin","hideFrameBack","el","document","getElementById","hidden","setCenterToken","showAppView","uqTokenApi","action","Error","at","opener","callId","uid","from","callCenterapi","directCall","result","bca","CenterApi","app","userName","userId","email","mobile","GuestApi","decodeGuestToken","guest","unitName","MessageHub","handlerSeed","anyHandlers","msgHandlers","handler","seed","args0","handlerId","$type","rootCenterHost","centerHost","process","resHost","uqDebugHost","hosts","centerhost","local","reshost","uqhost","unitxhost","httpArr","urlFromHost","str","isAbsoluteUrl","endsWith","centerUrlFromHost","centerWsFromHost","https","substr","fetchOptions","mode","Host","tryLocal","getCenterHost","getResHost","promises","hostArr","findIndex","v","fetchUrl","debugHostUrl","localCheck","all","results","len","j","hostValue","location","includes","debugHost","testProd","getUrlOrDebug","urlDebug","fetchLocalCheck","e","Web","centerChannelUI","centerChannel","centerApi","userApi","unitxApi","guestApi","wsBridge","isBuildingUQ","_uqs","logoutUqTokens","t","resUrlFromHost","EnumResultType","TsTemplate","buildContext","tsHeader","uiPlatform","UqBuildContext","uqsLoader","uqTsSrcPath","tsTemplate","ln","chars","codeBackSlash","charCodeAt","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","jName","schema","ver","sys","schemaLocal","uqApi","fields","arrFields","returns","face","fieldMaps","item","find","f","loadEntitySchema","buildSchema","loadValues","setSchema","buildFieldsTuid","version","setJName","arrs","setKeys","buildFieldTuid","buildArrFieldsTuid","fieldName","arrName","fn","getTuid","an","fieldArr","tuid","buildFieldsParams","arrResult","pa","rowResult","field","d","val","buildDateTimeParam","getFullYear","getMonth","getDate","_tuid","getIdFromObj","dt","getTime","toISOString","packRow","arrData","getObjPropIgnoreCase","packArr","join","row","r","ch","substring","escape","values","boxId","unpackRow","unpackArr","sep","ch0","fLen","to","reverseNT","n","Number","isNaN","p0","vals","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","uqVersion","en","rebuildSchema","buildEntities","ActionCaller","QueryQueryCaller","unpackReturns","QueryPageCaller","pageStart","pageSize","IdCache","tuidLocal","queue","cache","localArr","waitingIds","tuidInner","tonwa","createObservableMap","initLocalArr","defer","has","cacheTuids","moveToHead","shift","index","splice","_id","getValue","useId","cacheSet","loadIds","tuidValues","cacheIdValues","tuids","unpackTuidIds","tuidValue","cacheValue","cacheTuidFieldValues","ids","loadTuidIdsOrLocal","localedValues","filter","getItem","loadingIds","netIds","loadValuesFromIds","netRet","pos","setItem","IdDivCache","div","divName","UqTuid","noCache","typeName","idName","unique","isImport","TuidBox","obj","id1","ix","Tuid","idValue","TuidInner","divs","cacheFields","idCache","newVersion","removeAll","tuidDiv","TuidDiv","valueFromId","resetCache","assureObj","cacheIds","modifyIds","IdsCaller","request","GetCaller","cacheFieldsInValue","arrValues","mainFields","$create","$update","stampOnMain","unpackTuidIdsOfFields","props","SaveCaller","SavePropCaller","AllCaller","searchArr","owner","SearchCaller","LoadArrCaller","SaveArrCaller","order","ArrPosCaller","TuidNoCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","$order","year","month","date","TuidImport","getObj","assureBox","hasDiv","loadMain","load","save","saveProp","search","loadArr","saveArr","posArr","no","ownerField","alert","TuidBoxDiv","TuidsCache","modifyMax","cacheTimer","clearCacheTimer","localModifyMax","max","seconds","tuidCached","innerPullModify","tuidLists","queueModify","group","modify","UqAction","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","Action","pack","UqSheet","states","ops","op","actions","discription","SaveDirectCaller","flow","state","ActionDirectCaller","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","Sheet","SheetCaller","suffix","resVerify","count","UqQuery","isPaged","pageCaller","queryCaller","query","table","Query","UqBook","queryApiName","BookQueryCaller","Book","UqHistory","History","UqMap","queries","schemaFrom","actionSchema","newAction","querySchema","newQuery","AddCaller","DelCaller","PageCaller","qc","QueryCaller","Map","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","UqPending","Pending","UqEnum","UqID","create","update","ID","global","QueryID","IDX","UqIDX","UqIX","IX","IDCache","uqMan","timeoutHandler","timeOut","TvIdValues","IDTv","UqMan","uqData","enums","idxs","ixs","sheets","books","maps","histories","pendings","tuidsCache","localEntities","proxy","$proxy","config","allRoles","tuidArr","actionArr","queryArr","idArr","idxArr","ixArr","enumArr","sheetArr","bookArr","mapArr","historyArr","pendingArr","Acts","apiActs","retArr","retActs","AdminGetList","getAdmins","AdminSetMe","setMeAdmin","AdminSet","setAdmin","AdminIsMe","isAdmin","IDValue","valueFromString","$Acts","sql","ActIX","apiActIX","$ActIX","ActIXSort","apiActIxSort","$ActIXSort","ActIDProp","ActDetail","apiActDetail","items","main","detail","detail2","detail3","$ActDetail","apiQueryID","$QueryID","apiIDTv","retValues","$tv","nameNoVice","$IDTv","IDNO","apiIDNO","$IDNO","IDDetailGet","apiIDDetailGet","$IDDetailGet","apiID","$ID","KeyID","apiKeyID","$KeyID","apiIX","$IX","IXValues","apiIXValues","IXr","apiIXr","$IXr","KeyIX","apiKeyIX","$KeyIX","IDLog","apiIDLog","$IDLog","IDSum","apiIDSum","$IDSum","IDinIX","apiIDinIX","$IDinIX","IDxID","apiIDxID","$IDxID","IDTree","apiIDTree","$IDTree","getRoles","sheet","loadEntities","access","names","buildTuids","buildIds","buildAccess","newTuid","newID","entityName","allSchemas","forEach","fromType","fromObj","enm","setEntity","book","history","pending","lName","idEntity","idx","newIDX","newIX","newBook","newMap","newHistory","newSheet","newPending","newEnum","buildSheet","build","buildTuidBox","buildTuidDivBox","uqKey","dev","alias","capitalCase","Proxy","target","receiver","lk","func","String","showReload","reloadTick","showReloadPage","reload","api","resultType","apiParam","nv","tv","prototype","toString","apiPost","IXs","after","postParam","toScalars","IDXToString","stamp","IX1","ID2","UQsMan","collection","uqMans","uqDataArr","uqConfigs","localCacheVersion","cacheVersion","retErrors","setTuidImportsLocal","uqConfig","ownerAlias","uqLower","buildUQs","uqsData","promiseInits","uqAlias","uqFullName","uqFull","lower","setUq","createProxy","getUqKey","getUqKeyWithConfig","setInner","tuidImport","fromName","iName","setFrom","buildingUq","UQsLoader","appConfig","uqsMan","loadApp","loadUqs","uqsManApp","UQsManApp","localData","uqAppData","loadUqAppData","loadUqData","buildUqs","appUqs","tonwaAppName","uqStringify","resOptions","$lang","district","$district","resLang","_","l","navigator","languages","toUpperCase","setResOptions","resGlobal","setRes","setGlobalRes","logMark","inputRes","required","number","integer","min","zh","listRes","none","Navigo","useHash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_genericHooks","_historyUpdateMethod","timout","_onLocationChange","isPushStateAvailable","replace","_cLoc","_listen","updatePageLinks","absolute","_getRoot","_historyUpdate","RegExp","href","arg0","arg1","hooks","orderedRoutes","sort","compareUrlDepth","route","on","uses","_add","reduce","current","GETParameters","extractGETParameters","onlyURL","getOnlyURL","already","matched","match","manageHooks","_callLeave","isHashedRoot","m","slice","removeEventListener","_findLinks","link","hasListenerAttached","ctrlKey","metaKey","currentTarget","tagName","getLinkPath","preventDefault","navigate","status","pause","destroy","getAttribute","as","title","pushState","replaceState","cLocRoot","isHashChangeAPIAvailable","cached","check","cleanUrl","querySelectorAll","lastRouteResolved","leave","decodeURIComponent","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","replaceDynamicURLParts","clean","regExpResultToParams","findMatchedRoutes","colonExp","routeExp","fallbackURL","matched0","cleanGETParam","exHooks","before","shouldRoute","logs","Tonwa","LocalData","navigo","navSettings","resUrl","resetAll","hashParam","windowOnError","lineno","colno","windowOnUnhandledRejection","reason","windowOnClick","windowOnMouseMove","userAgent","x","y","windowOnScroll","forceDevelopment","reloadUser","curUser","logined","notLogined","userPassword","onChangeLogin","race","serviceWorker","ready","registration","unregister","plus","webview","webView","navLogin","showLogin","back","navLogout","showLogout","navRegister","showRegister","navForget","showForget","navPageRoutes","doneSysRoutes","sysRoutes","createLogin","login","createWeb","g","unitJsonPath","unitRes","innerText","loadUnitJson","innerHTML","getPredefinedUnitName","unitFromName","settings","htmlTitle","html0","getElementsByTagName","origin","pathname","setCenterUrl","setGuest","onunhandledrejection","onfocus","isMobile","onselectstart","oncontextmenu","nav","clear","pwd","logindUser","isWebNav","historyAPIUpdateMethod","showPage","setNetToken","me","callback","isUserLogin","logoutApis","saveLocalUser","internalLogined","defaultTop","loginTop","logoutClear","toTimeString","step","navPage","queryStr","routeFromNavPage","internalOnNavRoutes","navOns","parser","DOMParser","htmlDoc","parseFromString","elHtml","getLogin","showChangePassword","showUserQuit","withBack","jwtDecode","ALPHABET","rtn","charAt","random","_user","_guest","_unit","minute2020_01_01","dateFromMinuteId","timeZone","envTimezone","pow","firstCharUppercase","camelCase","ACode","ZCode","fromCharCode","firstCharLowercase","aCode","zCode","mobileRegex","emailRegex","Rule","defaultInputRes","RuleCustom","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","isInteger","Widget","context","itemSchema","fieldProps","children","_itemSchema","_ui","defaultValue","rules","readOnly","disabled","errors","contextErrors","visible","isChanging","onInputChange","changeValue","container","observer","form","inNode","align","render","label","requiredFlag","className","FieldContainer","renderBody","makeObservable","observable","hasError","computed","isOk","getUiItem","buildRules","rule","removeErrorWidget","addErrorWidget","initData","newValue","fromElement","onChanging","onChanged","prev","allowChange","setDataValue","setElementValue","fieldClass","classNames","FieldClass","elDiscription","discriptionClassName","uiLabel","Templet","errorList","tag","React","TextWidget","inputType","input","hasFocus","onKeyDown","internalOnKeyDown","keyCode","onEnter","blur","setError","onBlur","runInAction","checkRules","checkContextRules","onFocus","clearError","clearErrors","focus","select","placeholder","renderTemplet","cn","ref","onChange","maxLength","renderErrors","TextAreaWidget","setValue","rows","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","trueValue","falseValue","checked","onClick","cnAlign","defaultChecked","SelectWidget","option","list","radioStyle","height","RadioWidget","inputs","rowKey","isRow","style","RangeWidget","IdWidget","pickId","clearContextError","content","Unknown","dataType","uiType","dataTypes","ButtonWidget","submit","onButtonClick","observerRender","caption","widgetType","widget","button","ButtonClass","Context","uiSchema","subContexts","widgets","errorWidgets","arrRowContexts","itemName","getDisabled","setDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","ew","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","checkHasError","clearContextErrors","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","onDeleted","onRestored","arrLabel","ArrContainer","RowContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","first","rowContent","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","Image","src","altImage","alt","Loading","b","badge","size","color","badgeAlign","badgeVertical","LMR","cursor","left","right","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","IconText","iconClass","textClass","ResUploader","fileInput","fileName","upload","formData","buildFormData","Headers","append","onFilesChange","files","maxSize","FormData","file","multiple","display","formatSize","pointLength","units","toFixed","xlargeSize","mediumSize","ImageUploader","imgBaseSize","imageTypes","resUploader","desImgWidth","desImgHeight","desImgSize","srcImgWidth","srcImgHeight","isChanged","resId","enableUploadButton","srcImage","desImage","fileError","uploaded","onFileChange","lastIndexOf","reader","FileReader","readAsDataURL","onload","setSize","compress","img","width","w","scale","round","canvas","createElement","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","onSaved","showOrgImage","header","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","levelDiv","padding","ItemEdit","fileSize","uploading","AudioUploader","audioTypes","edit","uiItem","_uiItem","internalStart","internalEnd","divValue","labelHide","templet","pop","verifyRule","ImageItemEdit","ImageWidget","imageSrc","end","TagWidget","TagSingleWidget","valuesView","wrapClassName","inputName","renderRadios","TagMultiWidget","defaultArr","def","renderChecks","PickWidget","pick","stringWidget","widgetFactories","string","textarea","datetime","time","updown","checkbox","image","checkboxes","radio","tagSingle","tagMulti","range","typeWidget","getItemSchema","getTypeWidget","hiden","widgetFactory","WidgetClass","Form","formContext","disposer","Container","watch","calcSelectOrDelete","DefaultContainer","onSubmit","DefaultFieldContainer","fieldLabelSize","fieldLabelAlign","labelView","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","autorun","dv","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","FormField","contextType","StringItemEdit","preValue","verifyValue","onSave","inputOptions","element","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","CheckBoxItemEdit","onItemChanged","RangeItemEdit","NumberItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","editInRow","onItemClick","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","ie","createItemEdit","divLabel","requireFlag","ListBase","loading","pageItems","Clickable","Static","Selectable","_items","inputItems","buildItems","itemsArray","isItemSelected","selectedItems","compare","retItems","selected","labelId","comp","selectItem","si","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","some","List","listBase","_$scroll","direct","buildBase","prevProps","prevState","isEqual","forceUpdate","dispose","selectAll","unselectAll","footer","waitingMore","tabIndex","isLoading","staticRow","timeRes","md","ymd","yesterday","today","tomorrow","$zh","$en","tt","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","getMinutes","appendTime","dPart","hm","EasyTime","PropRow","PropBorder","borderTop","PropGap","valueAlignStart","valueAlignCenter","valueAlignEnd","LabeledPropRow","gridProps","_prop","col","labelFixLeft","bk","renderLabel","renderProp","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","component","PropView","buildRows","isGap","setValues","PropGrid","propView","SearchBox","allowEmptySearch","initKey","onSearch","inputSize","autoComplete","inputClassName","buttonText","Ax","axProps","aClassName","naClassName","openSysPage","Input","requiredFlagElement","ruleMessage","defaultRequiredFlagElement","onValueChange","inp","containerClassName","ruleClassName","defaultRuleClassName","valueFromInput","Component","InputNumber","defaultClassName","parseFloat","parseValue","InputCheckBox","red","lastBuildTime","saveSrcTsFileIfNotExists","saveTsFileIfNotExists","saveTsFile","srcFile","tsFile","fs","existsSync","renameSync","writeFileSync","overrideTsFile","tsFilePath","getNameFromUq","devPart","uqPart","devName","ControllerWithWeb","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","webNav","registerReceiveHandler","beforeStart","afterStart","vp","open","Controller","View","controller","getTonwa","shallow","deep","V","bind","vm","afterBack","go","view","onClosePage","openPage","replacePage","backPage","level","closePage","ceasePage","removeCeased","confirmClose","regConfirmClose","popToTopPage","VPage","retOnClosePage","_onClosePage","openPageElement","renderPage","replacePageElement","onScroll","onPageScroll","onScrollTop","scroller","onPageScrollTop","onScrollBottom","onPageScrollBottom","headerClassName","tabsProps","pageWebNav","Page","tabsView","TabsView","inWebNav","pageHeaderProps","center","rph","renderPageHeader","elFooter","errorInfo","renderHeader","renderFooter","pl","decode","exec","sUnit","tc","from62","test","parseInt","getTimezoneOffset","initEnv","browser","detectBrowser","LocalMap","ms","args","handle","setInterval","clearInterval","documentMode","internalT","isDev","topPageKey","buildReactiveProps","ob","beforeInit","getPageWebNav","afterInit","replaceOpen","onEvent","ceaseTop","topKey","popTo","yes","buttons","Scroller","scrollTo","scrollTop","offsetHeight","scrollTimeGap","ScrollViewBase","bottomTime","topTime","refDiv","onResize","sh","scrollHeight","top","Children","eachChild","ScrollView","WebNavScrollView","vHeader","vFooter","navHeader","navRawHeader","navFooter","navRawFooter","__ls","localStorage","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","keyForRemove","ks","unshift","saveIndex","ls","stackKey","notSupportedBrowsers","NavView","stack","waitCount","waitTimeHandler","isHistoryBack","confirm","setState","fetchError","backIcon","closeIcon","notSupportedBrowser","wait","ceased","refresh","backLevel","popAndDispose","elWait","elError","FetchErrorView","zIndex","visibility","position","onLogined","onNotLogined","importCLogin","CLogin","importCRegister","CRegister","CForget","digits","c0","c9","A","Z","z","NaN","onBack","vBack","debugLogout","rightView","Tab","loaded","contentBuilder","notify","onShown","_content","TabCaptionComponent","tabBg","selectedTab","tabArr","tabClick","tab","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","num","displayNone","pageHeader","pageFooter","tabBack","isSelected","reApi","errContent","wordWrap","SystemNotifyPage","buildFieldItem","isKey","$FieldItemType","fieldItemType","VLogout","onLogout","VLogin","onLogin","username","sender","getSender","defaultLoginTop","privacyEntry","VChangePassword","orgPassword","newPassword","newPassword1","waitingTime","VUserQuitBase","button1Caption","onClickButton1","button2Caption","onClickButton2","note","renderButton1","renderButton2","VUserQuit","openVPage","VQuitConfirm","userQuit","VQuitDone","userLogined","vPage","getVChangePassword","changePassword","logo","senders","regex","fieldItemReplaceProps","TsUqFolder","uqsFolder","uqFolder","mkdirSync","tsUq","TsUQ","saveTuidAndIDTsIndexAndRender","imports","sets","coll","sName","cName","tsUI","toLocaleLowerCase","buildFields","tsFieldArr","buildFieldArr","replaceTsFileFields","tsImportFieldItemsBegin","tsImportFieldItemsEnd","replaceTsFileString","begin","tsIndex","readdirSync","fileEntityName","unFile","unlinkSync","buildIDFields","buildIDXFields","buildIXFields","ts","buildIDFieldArr","buildIDXFieldArr","buildIXFieldArr","readFileSync","startStr","lBrace","rBrace","oldText","fieldsText","buildFieldsFromOldText","setFieldOldProp","buildFieldText","fieldStart","fieldText","eval","sec","fieldTypeMap","sysFields","buildTuid","buildTuidInterface","buildAction","buildActionInterface","buildArrs","buildReturns","buildEnumInterface","buildQuery","buildQueryInterface","buildSheetInterface","buildBook","buildBookInterface","buildMap","buildMapInterface","buildHistory","buildHistoryInterface","buildPending","buildPendingInterface","buildID","buildIDX","buildIX","buildIDInterface","schemaKeys","others","buildIDXInterface","exFields","repeat","hasTrack","hasMemo","exField","track","memo","buildIDXActParamInterface","buildIXInterface","tsImport","appendArr","tsBuild","tsLen","uqEntityInterface","buildActsInterface","uqBlock","buildInterface","entityCode","isInID","indent","buildField","q","af","retName","VErrorsPage","VStartError","Uq","$_uqMan","$_uqSql","IDRender","renderIDUnknownType","IDType","IDV","IDLocalV","IDLocalRender","$_createUqSqlProxy","createUQsProxy","TuidView","uqReacts","$_createProxy","onUqProxyError","CAppBase","timezone","unitTimezone","unitBizMonth","unitBizDate","uqsUser","$getTimezone","tz","unitTimeZone","bm","bd","afterBuiltUQs","onNavRoutes","initUQs","resolveRoute","userFromId","userFromKey","userRoles","getUqUserRoles","setUqRoles","CApp","html","cApp","staticUserCache","WebReact","tonwaReact","setFetchError","UserCache","loader","onLoaded","getUserCache","noneImage","idProp","userCache","useUser","use","ReloadPage","timerHandler","ConfirmReloadPage","TonwaReact","navView","showPrivacyPage","privacy","getPrivacyContent","privacyPage","htmlString","__html","dangerouslySetInnerHTML","upgradeUq","setCreateLogin","unauthorized","show","CUqApp","internalInit","control","renderAdmin","renderRole","renderAdminOrRole","beforeWaiting","afterWaiting","offsetWidth","setAttribute","elWaiting","appendChild","removeChild","callValue","renderError","react","openError","PError","PWaiting","deepReact","shallowReact","setReact","EnumSelectType","Control","isWaiting","Pg","afterClose","AppBase","VSelect","cId","VSelectOne","renderItem","vItem","vIcon","valueRender","renderItemOnSelect","callReturn","vNew","allowNew","onNew","shallowData","CSelect","setAfterAdd","loadItemsFromIds","onAdd","listAll","CSelectOne","VAdd","onSaveId","VSucceed","renderForm","onNext","onExit","VStart","renderItemInList","deepData","onEditItem","VEditId","propValueSave","savePropValue","currentItem","vProps","onEdit","cEdit","createEdit","renderEditIcon","renderRef","renderProps","renderTagInput","vTagInput","loadValue","setCache","AppNav","mutedSmall","toDateString","renderHourMinute","CIdBase","initNO","addedIds","afterAddCallback","initAdd","afterAdded","loadToList","beforeEdit","VEdit","getID","isGlobal","loadList","setIDDeepList","saveId","renderIdValue","getIdValue","VRef","shallowValue","VEditIcon","CEdit","CCheckEdit","CEditWithPage","VEditPage","exView","InputType","CStringEdit","VStringPage","CDateEdit","VDatePage","CDateTimeEdit","VDateTimePage","CTimeEdit","VTimePage","CIdEdit","VIdEditPage","CPickEdit","EnumAdminRoleInEdit","VAddTag","onSaveTag","vice","single","VAddTagItem","onSaveTagItem","VDeleteTagItem","stopPropagation","VEditTag","onRemoveTag","currentTag","removeTag","tagItem","onEditTagItem","onAddTagItem","tagPropSave","groups","openTagGroup","VTagGroup","renderTag","onTagClick","onEditTag","currentGroup","onAddTag","tags","CTagBase","tagGroups","groupsLoaded","IxTag","Tag","xi","resetGroups","TagItem","onTagItemChanged","onTagItemDeleted","TagGroup","loadGroups","groupName","tagGroup","tagColl","VTagInput","renderTagItem","radioName","tagMap","onCheckChange","CTagInput","cTag","IxID","itemId","pid","idOfItem","checkValue","tagGroupName","loadGroup","InputView","cnRow","cnBg","cnMYLg","cnSmallMuted","info","VMeSysAdmin","meAdmin","renderQuiting","renderAm","dateUpdate","dateUpdateNextDay","showMeSysAdmin","toLocaleDateString","toLocaleTimeString","onMeSystemAdmin","sysAdmins","renderAdminItem","admin","cUser","renderUser","renderMe","renderSysAdmins","renderAdmins","nSys","renderMeSystemAdmin","quiting","rightAngle","renderAdd","onUser","admins","onAddAdmin","VUser","onDelAdmin","vDel","operator","onEditRemark","Gender","Role","CAdminBase","adminsChanged","onAdmin","removeAdmin","cStringEdit","loadAdmins","retAdmins","openMain","captionSelectUser","listAdd","listDel","VSelectUser","onSelected","searchUser","vContent","CUser","userFromName","userFromCache","loadUser","CControl","CAct","cActs","VAddNote","saveNote","firstName","lastName","sensitive","VClient","renderLog","renderLogContent","showAddNote","notes","renderNote","renderSessionPerson","vLock","noteContent","staff","isPersonMe","sessionPerson","cIds","cWorkshop","cStaff","cSession","session","person","workshop","renderId","cClient","cSelectOne","showClient","clients","CClientNotes","client","BzWorkshop","IxPersonLog","SaveNote","submitReturns","loadClients","MyClients","VAttendee","deleted","changeSessionClient","VSession","renderAttendee","attendee","vChanged","onAddAttendee","addAttendee","span","substitue","done","showAttendee","CSessionAct","cWorkshops","sessionId","clientId","ixValue","SaveSessionAttendee","IxSessionClient","renderWorkshopItem","sessions","onWorkshopClick","renderSessionItem","onSessionClick","openSession","workshopItems","CWorkshops","MySessions","workshopItem","wa","wb","showClientNotes","showRegisterWorkshop","CActs","CId","cTagInput","IxGlobalIdTag","initID","renderInput","hasEntity","middleName","gender","day","mobileCountry","renderPerson","vUser","VEditPerson","rightIcon","onBindUser","renderCurrentUser","VBound","onChangeUser","onRemoveBound","btnRemove","CPerson","IxUserPerson","Person","GetPersonList","personRole","retRoles","mPerson","isInRole","IxPersonRole","PersonSearch","renderSelectPerson","CClient","isAdminOrRole","counselor","CEnumBase","enumCaptions","VInput","CEnumSingle","saveIxEnum","OnEnumChanged","VEnumSingle","roleCaption","volunteer","VEditStaff","renderBindUser","renderRoles","cRoleSingle","staffRoles","staffRoleCaptions","CStaff","onRoleChanged","CRoleSingle","vRole","renderStaff","VEditWorkshop","renderStaffPick","renderList","VSessionList","CSession","Session","IxWorkshopSession","IxSessionStaff","CIdPick","deepValue","renderInit","renderNA","VAddWorkshop","CWorkshop","Workshop","SaveWorkshopStaff","isVisible","CIds","onWorkshop","onClient","onStaff","noUnit","VAbout","VMe","meInfo","showEditMe","userSpan","about","aboutRows","cAdmin","VEditMe","userSetProp","gridRows","VRoleSettings","CAdmin","CMe","unitOwner","rootUnits","backend","myRolesChanged","CTag","IxLocalIdTag","VMain","cMe","CMain","CPathControl","pathParam","PClientForm","PInvalid","PMain","waitingEvent","onStart","CClientSurvey","App","appNav","meRoles","pathControls","openLogin","isRole","buildRoles","typeValues","home","relation","discover","supervise","debug","aboutTheApp","pleaseLogin","setUI","Note","SessionPerson","gaps","timer","refreshTime","gapIndex","callTick","loadBaseData","appStart","loginedOnly","renderNavView","setSettings","ReactDOM","StrictMode","startApp"],"mappings":"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","file":"static/js/main.97194175.chunk.js","sourcesContent":["export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, $$user:number = undefined, waiting: boolean) {\r\n        this._params = params;\r\n        this.$$user = $$user;\r\n        this.waiting = waiting;\r\n    }\r\n    readonly $$user: number;\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","//import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport { FetchError } from './fetchError';\r\nimport { HttpChannelUI } from './httpChannelUI';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\nimport { Web } from './Web';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected web: Web;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(web: Web, hostUrl: string, apiToken: string, ui?: HttpChannelUI) {\r\n        this.web = web;\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true ? 30000 : 50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?: string, reject?: (reason?: any) => void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject(url);\r\n    }\r\n\r\n    private showError = async (error: FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix: string, caller: Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let { headers, path, method } = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n                //h.append(i, encodeURI(headers[i]));\r\n                h[i] = encodeURI(headers[i]);\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve: (value?: any) => any, reject: (reason?: any) => void): Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr: any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(`webapi timeout: ${(Date.now() - now)}ms ${url}`, reject);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');\r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json') >= 0) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonwa json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch (error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true || err.startsWith('$roles') === true) {\r\n                    this.web.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n        };\r\n    }\r\n\r\n    protected abstract innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url: string, method: string, body: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    //private buildOptions(): {method:string; headers:Headers; body:any} {\r\n    private buildOptions(): { method: string; headers: { [name: string]: string }; body: any } {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n    /*\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n    }\r\n    */\r\n    protected buildHeaders(): { [name: string]: string } {\r\n        let { language, culture } = this.web;\r\n        let headers: { [name: string]: string } = {}; //new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        //headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        headers['Content-Type'] = 'application/json;charset=UTF-8';\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        //headers.append('Accept-Language', lang);\r\n        headers['Accept-Language'] = lang;\r\n        if (this.apiToken) {\r\n            //headers.append('Authorization', this.apiToken); \r\n            headers['Authorization'] = this.apiToken;\r\n        }\r\n        return headers;\r\n    }\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        let { appBridge } = this.web;\r\n        if (this.apiToken === undefined && appBridge.isBridged())\r\n            return await appBridge.bridgeCenterApi(u, options.method, options.body);\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import { Web } from './Web';\r\nimport { FetchError } from './fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait(): void;\r\n    endWait(): void;\r\n    showError(error: FetchError): Promise<void>;\r\n    // showUpgradeUq(uq:string, version:number):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    protected readonly web: Web;\r\n\r\n    constructor(web: Web) {\r\n        this.web = web;\r\n    }\r\n\r\n    startWait() {\r\n        this.web.startWait();\r\n    }\r\n    endWait() {\r\n        this.web.endWait();\r\n    }\r\n    async showError(error: FetchError): Promise<void> {\r\n        this.web.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await this.web.onError(error);\r\n    }\r\n    /*\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await this.web.tonwa.nav.showUpgradeUq(uq, version);\r\n    }\r\n    */\r\n}\r\n","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\nimport { Web } from './Web';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected readonly web: Web;\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(web: Web, path: string, showWaiting: boolean) {\r\n        this.web = web;\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import { Web } from \"./Web\";\r\n\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n    protected web: Web;\r\n\t//private messageHub = messageHub;\r\n    constructor(web: Web) {\r\n        this.web = web;\r\n    }\r\n\r\n\t/*\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n\tprivate msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\t*/\r\n\t/*\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n\t}\r\n\t*/\r\n    async receive(msg:any) {\r\n\t\tthis.web.messageHub.dispatch(msg);\r\n\t\t/*\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(web: Web, wsHost: string, token: string) {\r\n        super(web);\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import { HttpChannel, UqHttpChannel } from './httpChannel';\r\nimport { HttpChannelNavUI } from './httpChannelUI';\r\n//import {getUqToken, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport { ApiBase } from './apiBase';\r\n//import { host } from './host';\r\nimport { LocalMap, env, decodeUserToken } from '../tool';\r\nimport { Web, PromiseValue } from './Web';\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\n\r\nexport class UqApi extends ApiBase {\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(web: Web, basePath: string, uqOwner: string, uqName: string, showWaiting?: boolean) {\r\n        super(web, basePath, showWaiting);\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    async init() {\r\n        await this.web.appBridge.buildAppUq(this.uq, this.uqOwner, this.uqName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: { [name: string]: HttpChannel | (PromiseValue<any>[]) };\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = this.web.channelUIs;\r\n            channelUI = new HttpChannelNavUI(this.web);\r\n        }\r\n        else {\r\n            channels = this.web.channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n        if (channel !== undefined) {\r\n            if (Array.isArray(channel) === false) return channel as HttpChannel;\r\n        }\r\n        else {\r\n            channel = channels[this.uq] = [];\r\n        }\r\n        let arr = channel as PromiseValue<any>[];\r\n        return new Promise(async (resolve, reject) => {\r\n            arr.push({ resolve, reject });\r\n            if (arr.length !== 1) return;\r\n            let uqToken = this.web.appBridge.getUqToken(this.uq); //, this.uqOwner, this.uqName);\r\n            if (!uqToken) {\r\n                //debugger;\r\n                await this.init();\r\n                uqToken = this.web.appBridge.getUqToken(this.uq);\r\n            }\r\n            let { url, token } = uqToken;\r\n            this.token = token;\r\n            channel = new UqHttpChannel(this.web, url, token, channelUI);\r\n            channels[this.uq] = channel;\r\n            for (let pv of arr) {\r\n                pv.resolve(channel);\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    /*async update():Promise<string> {\r\n        return await this.get('update');\r\n    }*/\r\n\r\n    /*\r\n    async __loadAccess():Promise<any> {\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n    */\r\n    async loadEntities(): Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        //let acc = this.access === undefined?\r\n        //    '' :\r\n        //    this.access.join('|');\r\n        //let ret = await this.get('access', {acc:acc});\r\n        let ret = await this.get('entities');\r\n        return ret;\r\n    }\r\n    async getAdmins(): Promise<any[]> {\r\n        let ret = await this.get('get-admins');\r\n        return ret;\r\n    }\r\n    async setMeAdmin(): Promise<void> {\r\n        await this.get('set-me-admin');\r\n    }\r\n    async setAdmin(user: number, role: number, name: string, nick: string, icon: string, assigned: string): Promise<void> {\r\n        await this.post('set-admin', { user, role, name, nick, icon, assigned });\r\n    }\r\n    async isAdmin(): Promise<boolean> {\r\n        let ret = await this.get('is-admin');\r\n        return ret;\r\n    }\r\n    async getRoles(): Promise<string[]> {\r\n        let ret = await this.get('get-roles',);\r\n        if (!ret) return null;\r\n        let parts: string[] = (ret as string).split('|');\r\n        let s: string[] = [];\r\n        for (let p of parts) {\r\n            p = p.trim();\r\n            if (!p) continue;\r\n            s.push(p);\r\n        }\r\n        if (s.length === 0) return null;\r\n        return s;\r\n    }\r\n    async getAllRoleUsers(): Promise<{ user: number, admin: number, roles: string }[]> {\r\n        let ret = await this.get('get-all-role-users');\r\n        return ret;\r\n    }\r\n    async setUserRoles(theUser: number, roles: string): Promise<void> {\r\n        await this.post('set-user-roles', { theUser, roles });\r\n    }\r\n    async deleteUserRoles(theUser: number): Promise<void> {\r\n        await this.get('delete-user-roles', { theUser });\r\n    }\r\n\r\n    async allSchemas(): Promise<any> {\r\n        return await this.get('all-schemas');\r\n    }\r\n\r\n    async schema(name: string): Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start: number, page: number, entities: string) {\r\n        return await this.post('queue-modify', { start: start, page: page, entities: entities });\r\n    }\r\n}\r\n\r\n/*\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n*/\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId: number;\r\n    constructor(web: Web, unitId: number) {\r\n        super(web, 'tv/', undefined, undefined, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = this.web.channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return this.web.channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel(): Promise<HttpChannel> {\r\n        let channelUI = new HttpChannelNavUI(this.web);\r\n        let centerAppApi = new CenterAppApi(this.web, 'tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let { token, db, url, urlTest } = ret;\r\n        let realUrl = this.web.host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(this.web, realUrl, token, channelUI);\r\n    }\r\n}\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let ret: HttpChannel;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            ret = this.web.getCenterChannelUI();\r\n        }\r\n        else {\r\n            ret = this.web.getCenterChannel();\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n    static clearLocal() {\r\n        env.localDb.removeItem(uqTokensName);\r\n    }\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: { unit: number, uqOwner: string, uqName: string }): Promise<any> {\r\n        let { uqOwner, uqName } = params;\r\n        let un = uqOwner + '/' + uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken: UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let { unit, user } = uqToken;\r\n                if (unit !== params.unit || user !== this.web.loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let { tick, value } = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24 * 3600) {\r\n                    return Object.assign({}, value);\r\n                }\r\n            }\r\n            let uqParams: any = Object.assign({}, params);\r\n            uqParams.testing = this.web.host.testing;\r\n            let ret = await this.get('uq-token', uqParams);\r\n            if (ret === undefined) {\r\n                let { unit, uqOwner, uqName } = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: this.web.loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return Object.assign({}, ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url: string, method: string, body: any): Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n    ownerAlias: string;\r\n    uqName: string;\r\n    uqAlias: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    async appUqs(appOwner: string, appName: string): Promise<UqAppData> {\r\n        let ret: UqAppData = await this.get('tie/app-uqs', { appOwner, appName });\r\n        return ret;\r\n    }\r\n    async uqs(uqs: { owner: string; name: string; version: string }[]): Promise<UqData[]> {\r\n        return await this.post('tie/pure-uqs', uqs);\r\n    }\r\n    async unitxUq(unit: number): Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', { unit: unit });\r\n    }\r\n    async changePassword(param: { orgPassword: string, newPassword: string }) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n\r\n    async userQuit(): Promise<void> {\r\n        await this.get('tie/user-ask-quit', {});\r\n    }\r\n}\r\n\r\nexport interface RegisterParameter {\r\n    nick: string,\r\n    user: string,\r\n    pwd: string,\r\n    country: number,\r\n    mobile: number,\r\n    mobileCountry: number,\r\n    email: string,\r\n    verify: string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: { user: string, pwd: string, guest: number }): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.post('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let { nick, icon } = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any> {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account: string, type: 'mobile' | 'email', oem: string) {\r\n        return await this.post('user/set-verify', { account: account, type: type, oem: oem });\r\n    }\r\n\r\n    async checkVerify(account: string, verify: string) {\r\n        return await this.post('user/check-verify', { account: account, verify: verify });\r\n    }\r\n\r\n    async isExists(account: string) {\r\n        return await this.get('user/is-exists', { account: account });\r\n    }\r\n\r\n    async resetPassword(account: string, password: string, verify: string, type: 'mobile' | 'email'): Promise<any[]> {\r\n        return await this.post('user/reset-password', { account: account, password, verify, type });\r\n    }\r\n\r\n    async userSetProp(prop: string, value: any) {\r\n        await this.post('tie/user-set-prop', { prop: prop, value: value });\r\n    }\r\n\r\n    async me(): Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id: number): Promise<any> {\r\n        return await this.get('tie/user', { id: id });\r\n    }\r\n\r\n    async fromKey(key: string): Promise<{ id: number, name: string, nick: string, icon: string }> {\r\n        return await this.get('tie/user-from-key', { key });\r\n    }\r\n}\r\n","//import {nav} from '../components';\r\nimport { UqTokenApi } from './uqApi';\r\nimport { setSubAppWindow } from './wsChannel';\r\n//import { host } from './host';\r\nimport { env, uid } from '../tool';\r\nimport { Web } from './Web';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?: any) => any;\r\n    reject: (reason?: any) => void;\r\n}\r\n\r\nexport class AppBridge {\r\n    private readonly web: Web;\r\n    private readonly uqTokens: { [uqName: string]: UqToken } = {};\r\n\r\n    constructor(web: Web) {\r\n        this.web = web;\r\n    }\r\n\r\n    addMessageListener() {\r\n        window.addEventListener('message', async (evt) => {\r\n            var message = evt.data;\r\n            if (!message) return;\r\n            //let {nav} = this.web.tonwa;\r\n            switch (message.type) {\r\n                case 'sub-frame-started':\r\n                    this.subFrameStarted(evt);\r\n                    break;\r\n                case 'ws':\r\n                    //wsBridge.receive(message.msg);\r\n                    await this.web.onWsReceive(message.msg);\r\n                    break;\r\n                case 'init-sub-win':\r\n                    await this.initSubWin(message);\r\n                    break;\r\n                case 'pop-app':\r\n                    window.console.log('///\\\\\\\\\\\\ pop-app');\r\n                    this.web.navBack();\r\n                    break;\r\n                case 'center-api':\r\n                    await this.callCenterApiFromMessage(evt.source as Window, message);\r\n                    break;\r\n                case 'center-api-return':\r\n                    this.bridgeCenterApiReturn(message);\r\n                    break;\r\n                case 'app-api':\r\n                    let ret = await this.onReceiveAppApiMessage(message.hash, message.apiName);\r\n                    (evt.source as Window).postMessage({\r\n                        type: 'app-api-return',\r\n                        apiName: message.apiName,\r\n                        db: ret.db,\r\n                        url: ret.url,\r\n                        token: ret.token\r\n                    } as any, \"*\");\r\n                    break;\r\n                case 'app-api-return':\r\n                    console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n                    console.log('await onAppApiReturn(message);');\r\n                    await this.onAppApiReturn(message);\r\n                    break;\r\n                default:\r\n                    if ((message.source as string)?.startsWith('react-devtools') === true) break;\r\n                    window.console.log('message: %s', JSON.stringify(message));\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n\r\n    logoutUqTokens() {\r\n        for (let i in this.uqTokens) {\r\n            this.uqTokens[i] = undefined;\r\n        }\r\n        UqTokenApi.clearLocal();\r\n    }\r\n\r\n    isBridged(): boolean {\r\n        return window.self !== window.parent;\r\n    }\r\n\r\n    private subFrameStarted(evt: any) {\r\n        var message = evt.data;\r\n        let subWin = evt.source as Window;\r\n        setSubAppWindow(subWin);\r\n        this.hideFrameBack(message.hash);\r\n        let msg: any = Object.assign({}, this.web.user);\r\n        msg.type = 'init-sub-win';\r\n        subWin.postMessage(msg, '*');\r\n    }\r\n\r\n    hideFrameBack(hash: string) {\r\n        let el = document.getElementById(hash);\r\n        if (el !== undefined) el.hidden = true;\r\n    }\r\n\r\n    async initSubWin(message: any) {\r\n        console.log('initSubWin: set nav.user', message);\r\n        let user = this.web.user = message; // message.user;\r\n        this.web.setCenterToken(user.id, user.token);\r\n        await this.web.showAppView();\r\n    }\r\n\r\n    private async onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n        let { unit } = env;\r\n        if (!unit) {\r\n            console.error('no unit defined in unit.json or in index.html, or not logined in', unit);\r\n        }\r\n        let parts = apiName.split('/');\r\n        let param = { unit: unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName: parts[3] };\r\n        console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n        let ret = await this.web.uqTokenApi.uq(param);\r\n        let { db, url, token } = ret;\r\n        return { name: apiName, db: db, url: url, token: token };\r\n    }\r\n\r\n    private async onAppApiReturn(message: any) {\r\n        let { apiName, db, url, urlTest, token } = message;\r\n        let action = this.uqTokenActions[apiName];\r\n        if (action === undefined) {\r\n            throw new Error('error app api return');\r\n            //return;\r\n        }\r\n        let realUrl = this.web.host.getUrlOrTest(db, url, urlTest);\r\n        console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n        //action.url = realUrl;\r\n        //action.token = token;\r\n        action.resolve({\r\n            name: apiName,\r\n            db: db,\r\n            url: realUrl,\r\n            token: token,\r\n        } as UqToken);\r\n    }\r\n\r\n    private readonly uqTokenActions: { [uq: string]: UqTokenAction } = {};\r\n\r\n    async buildAppUq(uq: string, uqOwner: string, uqName: string): Promise<void> {\r\n        if (!this.isBridged()) {\r\n            //let unit = getUnit();\r\n            let { unit } = env;\r\n            let uqToken = await this.web.uqTokenApi.uq({ unit, uqOwner, uqName });\r\n            if (uqToken.token === undefined) uqToken.token = this.web.centerToken;\r\n            let { db, url, urlTest } = uqToken;\r\n            let realUrl = this.web.host.getUrlOrTest(db, url, urlTest);\r\n            console.log('realUrl: %s', realUrl);\r\n            uqToken.url = realUrl;\r\n            this.uqTokens[uq] = uqToken;\r\n            return uqToken;\r\n        }\r\n        //console.log(\"**** before buildAppUq ****\", appInFrame);\r\n        let bp = this.uqTokenActions[uq];\r\n        if (bp !== undefined) return;\r\n        return new Promise<void>((resolve, reject) => {\r\n            this.uqTokenActions[uq] = {\r\n                resolve: async (at: any) => {\r\n                    let { db, url, token } = await at;\r\n                    this.uqTokens[uq] = {\r\n                        name: uq,\r\n                        db: db,\r\n                        url: url,\r\n                        token: token,\r\n                    };\r\n                    this.uqTokenActions[uq] = undefined;\r\n                    //console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                    resolve();\r\n                },\r\n                reject: reject,\r\n            };\r\n            (window.opener || window.parent).postMessage({\r\n                type: 'app-api',\r\n                apiName: uq,\r\n                //hash: appInFrame.hash,\r\n            }, \"*\");\r\n        });\r\n    }\r\n\r\n    getUqToken(uq: string): UqToken {\r\n        let uts = this.uqTokens;\r\n        return uts[uq];\r\n    }\r\n\r\n    private readonly brideCenterApis: { [id: string]: BridgeCenterApi } = {};\r\n    async bridgeCenterApi(url: string, method: string, body: any): Promise<any> {\r\n        console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            let callId: string;\r\n            for (; ;) {\r\n                callId = uid();\r\n                let bca = this.brideCenterApis[callId];\r\n                if (bca === undefined) {\r\n                    this.brideCenterApis[callId] = {\r\n                        id: callId,\r\n                        resolve: resolve,\r\n                        reject: reject,\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n            (window.opener || window.parent).postMessage({\r\n                type: 'center-api',\r\n                callId: callId,\r\n                url: url,\r\n                method: method,\r\n                body: body\r\n            }, '*');\r\n        });\r\n    }\r\n\r\n    async callCenterApiFromMessage(from: Window, message: any): Promise<void> {\r\n        let { callId, url, method, body } = message;\r\n        let result = await this.web.callCenterapi.directCall(url, method, body);\r\n        from.postMessage({\r\n            type: 'center-api-return',\r\n            callId: callId,\r\n            result: result,\r\n        }, '*');\r\n    }\r\n\r\n    bridgeCenterApiReturn(message: any) {\r\n        let { callId, result } = message;\r\n        let bca = this.brideCenterApis[callId];\r\n        if (bca === undefined) return;\r\n        this.brideCenterApis[callId] = undefined;\r\n        bca.resolve(result);\r\n    }\r\n}\r\n","import { User } from '../tool';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app: number): Promise<any[]> {\r\n        return await this.get('tie/user-app-units', { app: app });\r\n    }\r\n    async userFromKey(userName: string): Promise<User> {\r\n        return await this.get('tie/user-from-key', { key: userName });\r\n    }\r\n    async userFromId(userId: number): Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', { userId: userId });\r\n    }\r\n    async userFromName(userName: string): Promise<User> {\r\n        return await this.get('tie/user-from-key', { key: userName });\r\n    }\r\n    async usersFromEmail(email: string): Promise<any> {\r\n        return await this.get('tie/users-from-email', { email });\r\n    }\r\n    async userFromMobile(mobile: string): Promise<User> {\r\n        return await this.get('tie/users-from-mobile', { mobile });\r\n    }\r\n}\r\n","import { decodeGuestToken } from '../tool';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n","import { Web } from \"./Web\";\r\n\r\nexport class MessageHub {\r\n    web: Web;\r\n    constructor(web: Web) {\r\n        this.web = web;\r\n    }\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\tregisterReceiveHandler(handler:(msg:any)=>Promise<void>):number;\r\n\tregisterReceiveHandler(type:string, handler:(msg:any)=>Promise<void>):number;\t\r\n    registerReceiveHandler(...args:any[]):number {\r\n\t\tlet seed = this.handlerSeed++;\r\n\t\tlet args0 = args[0];\r\n\t\tlet handler:(msg:any)=>Promise<void>;\r\n\t\tswitch (typeof args0) {\r\n\t\t\tcase 'string':\r\n\t\t\t\thandler = args[1];\r\n\t\t\t\tthis.msgHandlers[seed] = {type:args0, handler};\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis.anyHandlers[seed] = args0;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn seed;\r\n    }\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async dispatch(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n","import { env } from '../tool';\r\n\r\nconst rootCenterHost = 'https://tv.jkchemical.com';\r\nconst centerHost = process.env['REACT_APP_CENTER_HOST'] ?? rootCenterHost;\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = centerHost ?? rootCenterHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n    local: boolean;\r\n}\r\nconst hosts: { [name: string]: HostValue } = {\r\n    centerhost: {\r\n        value: /*process.env['REACT_APP_CENTER_DEBUG_HOST']*/ undefined || centerDebugHost,\r\n        local: false,\r\n    },\r\n    reshost: {\r\n        value: /*process.env['REACT_APP_RES_DEBUG_HOST']*/ undefined || resDebugHost,\r\n        local: false,\r\n    },\r\n    uqhost: {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_HOST']*/ undefined || uqDebugHost,\r\n        local: false,\r\n    },\r\n    unitxhost: {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_HOST']*/ undefined || uqDebugHost,\r\n        local: false,\r\n    },\r\n    \"uq-build\": {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST']*/ undefined || uqDebugBuilderHost,\r\n        local: false,\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url: string): boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host: string): string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host: string): string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host: string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length - 1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host: string) {\r\n    if (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nexport class Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing: boolean) {\r\n        if (!centerHost) debugger;\r\n        this.testing = testing;\r\n        if (env.isDevelopment === true) {\r\n            await this.tryLocal();\r\n        }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n        this.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host: string) { return `http://${host}/hello` }\r\n    private async tryLocal() {\r\n        let promises: PromiseLike<any>[] = [];\r\n        let hostArr: string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let { value } = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i = 0; i < len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getCenterHost(): string {\r\n        let { value, local } = hosts.centerhost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost(): string {\r\n        let { value, local } = hosts.reshost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url: string, debugHost: string = 'uqhost'): string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let { value, local } = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db: string, url: string, urlTest: string): string {\r\n        if (!urlTest) {\r\n            urlTest = url;\r\n            if (!urlTest) {\r\n                console.error('no server set for ' + db);\r\n                debugger;\r\n            }\r\n        }\r\n        else if (!url) {\r\n            url = urlTest;\r\n        }\r\n        let testProd: string;\r\n        if (this.testing === true) {\r\n            if (urlTest !== '-') url = urlTest;\r\n            testProd = 'test';\r\n        }\r\n        else {\r\n            testProd = 'prod';\r\n        }\r\n        url = this.getUrlOrDebug(url);\r\n        if (url.endsWith('/') === false) {\r\n            url += '/';\r\n        }\r\n        return `${url}uq/${testProd}/${db}/`;\r\n    }\r\n\r\n    async localCheck(urlDebug: string): Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\n//export const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 2000;\r\n\r\nfunction fetchLocalCheck(url: string): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        fetch(url, fetchOptions as any)\r\n            .then(v => {\r\n                v.text().then(resolve).catch(reject);\r\n            })\r\n            .catch(reject);\r\n        const e = new Error(\"Connection timed out\");\r\n        env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url: string): Promise<boolean> {\r\n    try {\r\n        await fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","/* eslint-disable */\r\n//import { Tonwa } from \"../Tonwa\";\r\nimport { AppBridge } from \"./appBridge\";\r\nimport { CenterApi } from \"./centerApi\";\r\nimport { UqData, CallCenterApi, CenterAppApi, UnitxApi, UqAppData, UqTokenApi, UserApi } from \"./uqApi\";\r\nimport { HttpChannel, CenterHttpChannel, UqHttpChannel } from './httpChannel';\r\nimport { GuestApi } from \"./guestApi\";\r\nimport { MessageHub } from \"./messageHub\";\r\nimport { HttpChannelNavUI } from \"./httpChannelUI\";\r\nimport { WsBridge, WSChannel } from \"./wsChannel\";\r\nimport { FetchError } from \"./fetchError\";\r\nimport { Host, resUrlFromHost } from './host';\r\n//import { UQsMan, UQsManApp, TVs } from \"../uq\";\r\n//import { AppConfig, UqConfig } from \"../app\";\r\n\r\nexport interface PromiseValue<T> {\r\n    resolve: (value?: T | PromiseLike<T>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\n\r\nexport abstract class Web {\r\n    // ----- 从nav搬移过来的内容\r\n\r\n\r\n\r\n    // ===== nav搬移内容结束\r\n\r\n    // abstract navInit(): Promise<void>\r\n\r\n    reload() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    showReloadPage(msg: string) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    // 这个应该会去掉\r\n    navBack() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    // 这个是收到websocket消息的处理\r\n    async onWsReceive(msg: any) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    async showAppView() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    logout() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    async onError(error: FetchError) {\r\n        throw error;\r\n    }\r\n    endWait() {\r\n        //throw new Error('Method not implemented.');\r\n    }\r\n    startWait() {\r\n        //throw new Error('Method not implemented.');\r\n    }\r\n    centerHost: string;\r\n    centerToken: string | undefined = undefined;\r\n    loginedUserId: number = 0;\r\n    centerChannelUI: HttpChannel;\r\n    centerChannel: HttpChannel;\r\n\r\n    channelUIs: { [name: string]: HttpChannel | (PromiseValue<any>[]) } = {};\r\n    channelNoUIs: { [name: string]: HttpChannel | (PromiseValue<any>[]) } = {};\r\n    channels: { [unitId: number]: HttpChannel } = {};\r\n\r\n    //    readonly tonwa: Tonwa;\r\n    readonly centerApi: CenterApi;\r\n    readonly appBridge: AppBridge;\r\n    readonly userApi: UserApi;\r\n    readonly uqTokenApi: UqTokenApi;\r\n    readonly callCenterapi: CallCenterApi;\r\n    readonly unitxApi: UnitxApi;\r\n    readonly guestApi: GuestApi;\r\n    readonly messageHub: MessageHub;\r\n    readonly wsBridge: WsBridge;\r\n    readonly host: Host;\r\n\r\n    language: string;\r\n    culture: string;\r\n\r\n    // 下面的变量应该以后会去掉\r\n    isBuildingUQ: boolean;\r\n    _uqs: any;\r\n    user: any;\r\n    // -- end -------------------\r\n\r\n\r\n    constructor() {\r\n        this.centerApi = new CenterApi(this, 'tv/', undefined);\r\n        this.appBridge = new AppBridge(this);\r\n        this.userApi = new UserApi(this, 'tv/', undefined);\r\n        this.uqTokenApi = new UqTokenApi(this, 'tv/tie/', undefined);\r\n        this.callCenterapi = new CallCenterApi(this, '', undefined);\r\n        let unitId: number = 0;\r\n        this.unitxApi = new UnitxApi(this, unitId);\r\n        this.guestApi = new GuestApi(this, 'tv/guest/', undefined);\r\n        this.messageHub = new MessageHub(this);\r\n        this.wsBridge = new WsBridge(this);\r\n        this.host = new Host();\r\n    }\r\n\r\n    logoutApis() {\r\n        this.channelUIs = {};\r\n        this.channelNoUIs = {};\r\n        this.channels = {};\r\n        this.appBridge.logoutUqTokens();\r\n    }\r\n\r\n    setCenterUrl(url: string) {\r\n        console.log('setCenterUrl %s', url);\r\n        this.centerHost = url;\r\n        this.centerChannel = undefined;\r\n        this.centerChannelUI = undefined;\r\n    }\r\n\r\n    setCenterToken(userId: number, t?: string) {\r\n        this.loginedUserId = userId;\r\n        this.centerToken = t;\r\n        this.centerChannel = undefined;\r\n        this.centerChannelUI = undefined;\r\n    }\r\n\r\n    getCenterChannelUI(): HttpChannel {\r\n        if (this.centerChannelUI !== undefined) return this.centerChannelUI;\r\n        return this.centerChannelUI = new CenterHttpChannel(this, this.centerHost, this.centerToken, new HttpChannelNavUI(this));\r\n    }\r\n\r\n    getCenterChannel(): HttpChannel {\r\n        if (this.centerChannel !== undefined) return this.centerChannel;\r\n        return this.centerChannel = new CenterHttpChannel(this, this.centerHost, this.centerToken);\r\n    }\r\n\r\n    setNetToken(userId: number, token: string) {\r\n        this.setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    }\r\n\r\n    clearNetToken() {\r\n        this.setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n\r\n    resUrlFromHost(host: string): string {\r\n        return resUrlFromHost(host);\r\n    }\r\n}\r\n","import { UqBuildContext } from \"./UqBuildContext\";\r\n\r\nexport class TsTemplate {\r\n    private readonly buildContext: UqBuildContext;\r\n\r\n    constructor(buildContext: UqBuildContext) {\r\n        this.buildContext = buildContext;\r\n        this.tsHeader = `//=== UqApp builder created on ${new Date()} ===//`;\r\n    }\r\n\r\n    readonly tsHeader: string;\r\n\r\n    get tsApp(): string {\r\n        return `${this.tsHeader}\r\nimport { NavView, start, nav } from 'tonwa-${this.buildContext.uiPlatform}';\r\nimport { CApp } from './CApp';\r\nimport { appConfig } from './appConfig';\r\n\r\nexport const App: React.FC = () => {\r\n    nav.setSettings(appConfig);\r\n    const onLogined = async (isUserLogin?:boolean) => {\r\n        await start(CApp, appConfig, isUserLogin);\r\n    }\r\n    return <NavView onLogined={onLogined} />;\r\n}\r\n\r\n`;\r\n    }\r\n\r\n    get tsCApp(): string {\r\n        return `${this.tsHeader}\r\nimport { CUqApp } from \"./CBase\";\r\nimport { res } from \"./res\";\r\nimport { VMain } from \"./VMain\";\r\nimport { setUI } from \"./uqs\";\r\n\r\nconst gaps = [10, 3,3,3,3,3,5,5,5,5,5,5,5,5,10,10,10,10,15,15,15,30,30,60];\r\n\r\nexport class CApp extends CUqApp {\r\n    protected async internalStart(isUserLogin: boolean) {\r\n        this.setRes(res);\r\n        setUI(this.uqs);\r\n        \r\n        this.openVPage(VMain, undefined, this.dispose);\r\n    }\r\n\r\n    private timer:any;\r\n    protected onDispose() {\r\n        clearInterval(this.timer);\r\n        this.timer = undefined;\r\n    }\r\n\r\n    private tick = 0;\r\n    private gapIndex = 0;\r\n    private callTick = async () => {\r\n        try {\r\n            if (!this.user) return;\r\n            ++this.tick;\r\n            if (this.tick<gaps[this.gapIndex]) return;\r\n            this.tick = 0;\r\n            if (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n            let ret = await this.uqs.BzHelloTonwa.$poked.query(undefined, false);\r\n            let v = ret.ret[0];\r\n            if (v === undefined) return;\r\n            if (!v.poke) return;\r\n            this.gapIndex = 1;\r\n\r\n            // 数据服务器提醒客户端刷新，下面代码重新调入的数据\r\n            //this.cHome.refresh();\r\n        }\r\n        catch {\r\n        }\r\n    }\r\n}\r\n`;\r\n    }\r\n\r\n    get tsCBase(): string {\r\n        return `${this.tsHeader}\r\nimport { CSub, CBase, CAppBase, IConstructor } from 'tonwa-${this.buildContext.uiPlatform}';\r\nimport { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase<CApp, UQs> {\r\n    protected async internalStart(param?:any, ...params:any[]):Promise<void> {}\r\n}\r\n\r\nexport abstract class CUqSub<A extends CAppBase<U>, U, T extends CBase<A,U>> extends CSub<A, U, T> {\r\n}\r\n\r\nexport abstract class CUqApp extends CAppBase<UQs> {\r\n    newC<T extends CUqBase>(type: IConstructor<T>, ...param:any[]): T {\r\n        let c = new type(this);\r\n        c.internalInit(...param);\r\n        return c;\r\n    }\r\n}\r\n`;\r\n    }\r\n\r\n    get tsIndex(): string {\r\n        return `${this.tsHeader}\r\nexport { CUqApp, CUqBase, CUqSub } from './CBase';\r\nexport { CApp } from './CApp';\r\nexport * from './uqs';\r\nexport * from './App';\r\nexport * from './startApp';\r\n`;\r\n    }\r\n\r\n    get tsVMain(): string {\r\n        return `${this.tsHeader}\r\nimport { VPage, Page } from 'tonwa-${this.buildContext.uiPlatform}';\r\nimport { CApp } from './CApp';\r\n\r\nexport class VMain extends VPage<CApp> {\r\n    header() { return 'TEST'; }\r\n    content() {\r\n        return <div className=\"m-3\">\r\n            <div>{this.renderMe()}</div>\r\n            <div className=\"mb-5\">同花样例主页面</div>\r\n        </div>;\r\n    }\r\n}\r\n`;\r\n    }\r\n}\r\n","/* eslint-disable */\r\n//import { UqApi, UqData, UnitxApi } from '../net';\r\nimport { UqApi, UqData, UnitxApi } from '../web';\r\nimport { Tonwa, UqConfig } from '../core';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\n//import { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache, env, capitalCase } from '../tool';\r\n//import { ReactBoxId } from './tuid/reactBoxId';\r\nimport { UqEnum } from './enum';\r\nimport { Entity } from './entity';\r\nimport { ID, IX, IDX } from './ID';\r\nimport { IDCache } from './IDCache';\r\nimport { Web } from '../web';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'float' | 'double' | 'char' | 'text'\r\n\t| 'datetime' | 'date' | 'time' | 'timestamp' | 'enum';\r\n\r\nexport function fieldDefaultValue(type: FieldType) {\r\n\tswitch (type) {\r\n\t\tcase 'tinyint':\r\n\t\tcase 'smallint':\r\n\t\tcase 'int':\r\n\t\tcase 'bigint':\r\n\t\tcase 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\tcase 'enum':\r\n\t\t\treturn 0;\r\n\t\tcase 'char':\r\n\t\tcase 'text':\r\n\t\t\treturn '';\r\n\t\tcase 'datetime':\r\n\t\tcase 'date':\r\n\t\t\treturn '2000-1-1';\r\n\t\tcase 'time':\r\n\t\t\treturn '0:00';\r\n\t}\r\n}\r\n\r\nexport interface Field {\r\n\tname: string;\r\n\ttype: FieldType;\r\n\ttuid?: string;\r\n\tarr?: string;\r\n\tnull?: boolean;\r\n\tsize?: number;\r\n\towner?: string;\r\n\t_tuid?: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n\tname: string;\r\n\tfields: Field[];\r\n\tid?: string;\r\n\torder?: string;\r\n}\r\nexport interface FieldMap {\r\n\t[name: string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n\towner: string;\r\n\tuq: string;\r\n}\r\nexport interface TuidModify {\r\n\tmax: number;\r\n\tseconds: number;\r\n}\r\n\r\ninterface ParamPage {\r\n\tstart: number;\r\n\tsize: number;\r\n}\r\n\r\nexport interface ParamActIX<T> {\r\n\tIX: IX;\r\n\tID?: ID;\r\n\tIXs?: { IX: IX, ix: number }[];\t\t\t\t// 一次写入多个IX\r\n\tvalues: { ix: number, xi: number | T }[];\r\n}\r\n\r\nexport interface ParamActIXSort {\r\n\tIX: IX;\r\n\tix: number;\r\n\tid: number;\t\t\t\t\t// id to be moved\r\n\tafter: number;\t\t\t\t// insert after id. if before first, then 0\r\n}\r\n\r\nexport interface ParamActDetail<M, D> {\r\n\tmain: {\r\n\t\tID: ID;\r\n\t\tvalue: M;\r\n\t};\r\n\tdetail: {\r\n\t\tID: ID;\r\n\t\tvalues: D[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail {\r\n\tmain: number;\r\n\tdetail: number[];\r\n}\r\n\r\nexport interface ParamActDetail2<M, D, D2> extends ParamActDetail<M, D> {\r\n\tdetail2: {\r\n\t\tID: ID;\r\n\t\tvalues: D2[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail2 extends RetActDetail {\r\n\tdetail2: number[];\r\n}\r\n\r\nexport interface ParamActDetail3<M, D, D2, D3> extends ParamActDetail2<M, D, D2> {\r\n\tdetail3: {\r\n\t\tID: ID;\r\n\t\tvalues: D3[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail3 extends RetActDetail2 {\r\n\tdetail3: number[];\r\n}\r\n\r\nexport interface ParamQueryID {\r\n\tID?: ID;\r\n\tIX?: (IX | string)[];\r\n\tIDX?: (ID | IDX)[];\r\n\tid?: number | number[];\r\n\tkey?: { [key: string]: string | number };\r\n\tix?: number;\r\n\tidx?: number | number[];\r\n\tkeyx?: { [key: string]: string | number };\r\n\tpage?: ParamPage;\r\n\torder?: 'desc' | 'asc';\r\n}\r\n\r\nexport interface ParamIDNO {\r\n\tID: ID;\r\n\tstamp?: undefined,\r\n}\r\n\r\nexport interface ParamIDDetailGet {\r\n\tid: number;\r\n\tmain: ID;\r\n\tdetail: ID;\r\n\tdetail2?: ID;\r\n\tdetail3?: ID;\r\n}\r\n\r\nexport interface ParamID {\r\n\tIDX: (ID | IDX) | (ID | IDX)[];\r\n\tid: number | number[];\r\n\torder?: 'asc' | 'desc',\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyID {\r\n\tID: ID;\r\n\tIDX?: (ID | IDX)[];\r\n\tIX?: IX[];\r\n\tkey: { [key: string]: string | number };\r\n\tix?: number;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIX {\r\n\tIX: IX;\r\n\tIX1?: IX;\r\n\tix: number | number[];\r\n\tIDX?: (ID | IDX)[];\r\n\tpage?: ParamPage;\r\n\torder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface ParamIXValues {\r\n\tIX: IX;\r\n\tix?: number;\r\n\tpage?: ParamPage;\r\n\torder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface ParamKeyIX {\r\n\tID: ID;\r\n\tkey: { [key: string]: string | number };\r\n\tIX: IX;\r\n\tIDX?: (ID | IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDLog {\r\n\tIDX: (ID | IDX);\r\n\tfield: string;\r\n\tid: number;\r\n\tlog: 'each' | 'day' | 'week' | 'month' | 'year';\r\n\ttimeZone?: number;\r\n\tfar?: number;\r\n\tnear?: number;\r\n\tpage: ParamPage;\r\n}\r\n\r\nexport interface ParamIDSum {\r\n\tIDX: IDX;\r\n\tfield: string[];\r\n\tid: number | number[];\r\n\tfar?: number;\t\t\t\t// 以前\r\n\tnear?: number;\t\t\t\t// 最近\r\n}\r\n\r\nexport interface ParamIDxID {\r\n\tID: ID;\r\n\tIX: IX;\r\n\tID2: ID;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface IDXValue {\r\n\tvalue: number;\r\n\ttime?: number | Date;\r\n\tsetAdd: '=' | '+';\r\n}\r\n\r\nexport interface ParamIDinIX {\r\n\tID: ID;\r\n\tid: number;\r\n\tIX: IX;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDTree {\r\n\tID: ID;\r\n\tparent: number;\r\n\tkey: string | number;\r\n\tlevel?: number;\t\t\t\t// 无值，默认1一级\r\n\tpage?: ParamPage;\r\n}\r\n\r\nfunction IDPath(path: string): string { return path; }\r\nenum EnumResultType { data, sql };\r\n\r\nexport interface Uq {\r\n\tAdminGetList(): Promise<any[]>;\r\n\tAdminSetMe(): Promise<void>;\r\n\tAdminSet(user: number, role: number, assigned: string): Promise<void>;\r\n\tAdminIsMe(): Promise<boolean>;\r\n\r\n\tIDValue(type: string, value: string): object;\r\n\t$: Uq;\r\n\tActs(param: any): Promise<any>;\r\n\tActIX<T>(param: ParamActIX<T>): Promise<number[]>;\r\n\tActIXSort(param: ParamActIXSort): Promise<void>;\r\n\tActIDProp(ID: ID, id: number, name: string, value: any): Promise<void>;\r\n\tActDetail<M, D>(param: ParamActDetail<M, D>): Promise<RetActDetail>;\r\n\tActDetail<M, D, D2>(param: ParamActDetail2<M, D, D2>): Promise<RetActDetail2>;\r\n\tActDetail<M, D, D2, D3>(param: ParamActDetail3<M, D, D2, D3>): Promise<RetActDetail3>;\r\n\tQueryID<T>(param: ParamQueryID): Promise<T[]>;\r\n\tIDNO(param: ParamIDNO): Promise<string>;\r\n\tIDDetailGet<M, D>(param: ParamIDDetailGet): Promise<[M[], D[]]>;\r\n\tIDDetailGet<M, D, D2>(param: ParamIDDetailGet): Promise<[M[], D[], D2[]]>;\r\n\tIDDetailGet<M, D, D2, D3>(param: ParamIDDetailGet): Promise<[M[], D[], D2[], D3[]]>;\r\n\tID<T>(param: ParamID): Promise<T[]>;\r\n\tIXr<T>(param: ParamIX): Promise<T[]>; // IX id 反查IX list\r\n\tKeyID<T>(param: ParamKeyID): Promise<T[]>;\r\n\tIX<T>(param: ParamIX): Promise<T[]>;\r\n\tIXValues(param: ParamIXValues): Promise<{ type: string, value: string }[]>;\r\n\tKeyIX<T>(param: ParamKeyIX): Promise<T[]>;\r\n\tIDLog<T>(param: ParamIDLog): Promise<T[]>;\r\n\tIDSum<T>(param: ParamIDSum): Promise<T[]>;\r\n\tIDxID<T, T2>(param: ParamIDxID): Promise<[T[], T2[]]>; // ID list with IX 对应的子集\r\n\tIDinIX<T>(param: ParamIDinIX): Promise<T & { $in: boolean }[]>;\r\n\tIDTree<T>(param: ParamIDTree): Promise<T[]>;\r\n\r\n\tIDTv(ids: number[]): Promise<any[]>;\r\n}\r\n\r\nexport class UqMan {\r\n\treadonly entities: { [name: string]: Entity } = {};\r\n\tprivate readonly enums: { [name: string]: UqEnum } = {};\r\n\tprivate readonly actions: { [name: string]: Action } = {};\r\n\tprivate readonly queries: { [name: string]: Query } = {};\r\n\treadonly ids: { [name: string]: ID } = {};\r\n\tprivate readonly idxs: { [name: string]: IDX } = {};\r\n\tprivate readonly ixs: { [name: string]: IX } = {};\r\n\r\n\tprivate readonly sheets: { [name: string]: Sheet } = {};\r\n\tprivate readonly books: { [name: string]: Book } = {};\r\n\tprivate readonly maps: { [name: string]: Map } = {};\r\n\tprivate readonly histories: { [name: string]: History } = {};\r\n\tprivate readonly pendings: { [name: string]: Pending } = {};\r\n\tprivate readonly tuidsCache: TuidsCache;\r\n\tprivate readonly localEntities: LocalCache;\r\n\t//private readonly tvs:{[entity:string]:(values:any)=>JSX.Element};\r\n\tidCache: IDCache;\r\n\tproxy: any;\r\n\t$proxy: any;\r\n\treadonly localMap: LocalMap;\r\n\treadonly localModifyMax: LocalCache;\r\n\treadonly tuids: { [name: string]: Tuid } = {};\r\n\t//readonly createBoxId: CreateBoxId;\r\n\treadonly newVersion: boolean;\r\n\treadonly uqOwner: string;\r\n\treadonly uqName: string;\r\n\treadonly name: string;\r\n\treadonly uqApi: UqApi;\r\n\treadonly id: number;\r\n\treadonly tonwa: Tonwa;\r\n\treadonly web: Web;\r\n\r\n\tuqVersion: number;\r\n\tconfig: UqConfig;\r\n\r\n\tconstructor(tonwa: Tonwa, uqData: UqData/*, createBoxId:CreateBoxId, tvs:{[entity:string]:(values:any)=>JSX.Element}*/) {\r\n\t\tthis.tonwa = tonwa;\r\n\t\tthis.web = tonwa.web;\r\n\t\t//this.createBoxId = createBoxId;\r\n\t\t/*\r\n\t\tif (createBoxId === undefined) {\r\n\t\t\tthis.createBoxId = this.createBoxIdFromTVs;\r\n\t\t\tthis.tvs = tvs || {};\r\n\t\t}\r\n\t\t*/\r\n\t\tlet { id, uqOwner, uqName, /*access, */newVersion } = uqData;\r\n\t\tthis.newVersion = newVersion;\r\n\t\tthis.uqOwner = uqOwner;\r\n\t\tthis.uqName = uqName;\r\n\t\tthis.id = id;\r\n\t\tthis.name = uqOwner + '/' + uqName;\r\n\t\tthis.uqVersion = 0;\r\n\t\tthis.localMap = env.localDb.map(this.name);\r\n\t\tthis.localModifyMax = this.localMap.child('$modifyMax');\r\n\t\tthis.localEntities = this.localMap.child('$access');\r\n\t\tlet baseUrl = 'tv/';\r\n\r\n\t\tif (this.name === '$$$/$unitx') {\r\n\t\t\t// 这里假定，点击home link之后，已经设置unit了\r\n\t\t\t// 调用 UnitxApi会自动搜索绑定 unitx service\r\n\t\t\tthis.uqApi = new UnitxApi(this.web, env.unit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.uqApi = new UqApi(this.web, baseUrl, uqOwner, uqName, true);\r\n\t\t}\r\n\t\tthis.tuidsCache = new TuidsCache(this);\r\n\t}\r\n\r\n\tgetID(name: string): ID { return this.ids[name.toLowerCase()]; };\r\n\tgetIDX(name: string): IDX { return this.idxs[name.toLowerCase()]; };\r\n\tgetIX(name: string): IX { return this.ixs[name.toLowerCase()]; };\r\n\r\n\t/*\r\n\tprivate createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n\t\tlet {name} = tuid;\r\n\t\treturn new ReactBoxId(id, tuid, this.tvs[name]);\r\n\t}\r\n\t*/\r\n\r\n\tprivate roles: string[];\r\n\tasync getRoles(): Promise<string[]> {\r\n\t\tif (this.roles !== undefined) return this.roles;\r\n\t\tthis.roles = await this.uqApi.getRoles();\r\n\t\treturn this.roles;\r\n\t}\r\n\r\n\ttuid(name: string): Tuid { return this.tuids[name.toLowerCase()] }\r\n\ttuidDiv(name: string, div: string): TuidDiv {\r\n\t\tlet tuid = this.tuids[name.toLowerCase()]\r\n\t\treturn tuid && tuid.div(div.toLowerCase());\r\n\t}\r\n\taction(name: string): Action { return this.actions[name.toLowerCase()] }\r\n\tsheet(name: string): Sheet { return this.sheets[name.toLowerCase()] }\r\n\tquery(name: string): Query { return this.queries[name.toLowerCase()] }\r\n\tbook(name: string): Book { return this.books[name.toLowerCase()] }\r\n\tmap(name: string): Map { return this.maps[name.toLowerCase()] }\r\n\thistory(name: string): History { return this.histories[name.toLowerCase()] }\r\n\tpending(name: string): Pending { return this.pendings[name.toLowerCase()] }\r\n\r\n\tsheetFromTypeId(typeId: number): Sheet {\r\n\t\tfor (let i in this.sheets) {\r\n\t\t\tlet sheet = this.sheets[i];\r\n\t\t\tif (sheet.typeId === typeId) return sheet;\r\n\t\t}\r\n\t}\r\n\r\n\tallRoles: string[];\r\n\treadonly tuidArr: Tuid[] = [];\r\n\treadonly actionArr: Action[] = [];\r\n\treadonly queryArr: Query[] = [];\r\n\treadonly idArr: ID[] = [];\r\n\treadonly idxArr: IDX[] = [];\r\n\treadonly ixArr: IX[] = [];\r\n\treadonly enumArr: UqEnum[] = [];\r\n\treadonly sheetArr: Sheet[] = [];\r\n\treadonly bookArr: Book[] = [];\r\n\treadonly mapArr: Map[] = [];\r\n\treadonly historyArr: History[] = [];\r\n\treadonly pendingArr: Pending[] = [];\r\n\r\n\tasync init() {\r\n\t\tawait this.uqApi.init();\r\n\t}\r\n\r\n\tasync loadEntities(): Promise<string> {\r\n\t\ttry {\r\n\t\t\tlet entities = this.localEntities.get();\r\n\t\t\tif (!entities) {\r\n\t\t\t\tentities = await this.uqApi.loadEntities();\r\n\t\t\t}\r\n\t\t\tif (!entities) return;\r\n\t\t\tthis.buildEntities(entities);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\treturn err as any;\r\n\t\t}\r\n\t}\r\n\r\n\tbuildEntities(entities: any) {\r\n\t\tif (entities === undefined) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tthis.localEntities.set(entities);\r\n\t\tlet { access, tuids, role, version, ids } = entities;\r\n\t\tthis.uqVersion = version;\r\n\t\tthis.allRoles = role?.names;\r\n\t\tthis.buildTuids(tuids);\r\n\t\tthis.buildIds(ids);\r\n\t\tthis.buildAccess(access);\r\n\t}\r\n\r\n\tprivate buildTuids(tuids: any) {\r\n\t\tfor (let i in tuids) {\r\n\t\t\tlet schema = tuids[i];\r\n\t\t\tlet { typeId, from } = schema;\r\n\t\t\tlet tuid = this.newTuid(i, typeId, from);\r\n\t\t\ttuid.sys = true;\r\n\t\t}\r\n\t\tfor (let i in tuids) {\r\n\t\t\tlet schema = tuids[i];\r\n\t\t\tlet tuid = this.getTuid(i);\r\n\t\t\ttuid.setSchema(schema);\r\n\t\t}\r\n\t\tfor (let i in this.tuids) {\r\n\t\t\tlet tuid = this.tuids[i];\r\n\t\t\ttuid.buildFieldsTuid();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildIds(ids: any) {\r\n\t\tfor (let i in ids) {\r\n\t\t\tlet schema = ids[i];\r\n\t\t\tlet { typeId } = schema;\r\n\t\t\tlet ID = this.newID(i, typeId);\r\n\t\t\tID.setSchema(schema);\r\n\t\t}\r\n\t}\r\n\r\n\tasync loadEntitySchema(entityName: string): Promise<any> {\r\n\t\treturn await this.uqApi.schema(entityName);\r\n\t}\r\n\r\n\tasync loadAllSchemas(): Promise<void> {\r\n\t\tlet ret = await this.uqApi.allSchemas();\r\n\t\tlet entities: Entity[][] = [\r\n\t\t\tthis.actionArr,\r\n\t\t\tthis.enumArr,\r\n\t\t\tthis.sheetArr,\r\n\t\t\tthis.queryArr,\r\n\t\t\tthis.bookArr,\r\n\t\t\tthis.mapArr,\r\n\t\t\tthis.historyArr,\r\n\t\t\tthis.pendingArr,\r\n\t\t\tthis.idArr,\r\n\t\t\tthis.idxArr,\r\n\t\t\tthis.ixArr,\r\n\t\t];\r\n\t\tentities.forEach(arr => {\r\n\t\t\tarr.forEach(v => {\r\n\t\t\t\tlet entity = ret[v.name.toLowerCase()];\r\n\t\t\t\tif (!entity) return;\r\n\t\t\t\tlet schema = entity.call;\r\n\t\t\t\tif (!schema) return;\r\n\t\t\t\tv.buildSchema(schema);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tgetTuid(name: string): Tuid {\r\n\t\treturn this.tuids[name];\r\n\t}\r\n\r\n\tprivate buildAccess(access: any) {\r\n\t\tfor (let a in access) {\r\n\t\t\tlet v = access[a];\r\n\t\t\tswitch (typeof v) {\r\n\t\t\t\tcase 'string': this.fromType(a, v); break;\r\n\t\t\t\tcase 'object': this.fromObj(a, v); break;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcacheTuids(defer: number) {\r\n\t\tthis.tuidsCache.cacheTuids(defer);\r\n\t}\r\n\r\n\tprivate setEntity(name: string, entity: Entity) {\r\n\t\tthis.entities[name] = entity;\r\n\t\tthis.entities[name.toLowerCase()] = entity;\r\n\t}\r\n\r\n\tnewEnum(name: string, id: number): UqEnum {\r\n\t\tlet enm = this.enums[name];\r\n\t\tif (enm !== undefined) return enm;\r\n\t\tenm = this.enums[name] = new UqEnum(this, name, id);\r\n\t\tthis.setEntity(name, enm);\r\n\t\tthis.enumArr.push(enm);\r\n\t\treturn enm;\r\n\t}\r\n\tnewAction(name: string, id: number): Action {\r\n\t\tlet action = this.actions[name];\r\n\t\tif (action !== undefined) return action;\r\n\t\taction = this.actions[name] = new Action(this, name, id);\r\n\t\tthis.setEntity(name, action);\r\n\t\tthis.actionArr.push(action);\r\n\t\treturn action;\r\n\t}\r\n\tprivate newTuid(name: string, id: number, from: SchemaFrom): Tuid {\r\n\t\tlet tuid = this.tuids[name];\r\n\t\tif (tuid !== undefined) return tuid;\r\n\t\tif (from !== undefined)\r\n\t\t\ttuid = new TuidImport(this, name, id, from);\r\n\t\telse\r\n\t\t\ttuid = new TuidInner(this, name, id);\r\n\t\tthis.tuids[name] = tuid;\r\n\t\tthis.setEntity(name, tuid);\r\n\t\tthis.tuidArr.push(tuid);\r\n\t\treturn tuid;\r\n\t}\r\n\tnewQuery(name: string, id: number): Query {\r\n\t\tlet query = this.queries[name];\r\n\t\tif (query !== undefined) return query;\r\n\t\tquery = this.queries[name] = new Query(this, name, id)\r\n\t\tthis.setEntity(name, query);\r\n\t\tthis.queryArr.push(query);\r\n\t\treturn query;\r\n\t}\r\n\tprivate newBook(name: string, id: number): Book {\r\n\t\tlet book = this.books[name];\r\n\t\tif (book !== undefined) return book;\r\n\t\tbook = this.books[name] = new Book(this, name, id);\r\n\t\tthis.setEntity(name, book);\r\n\t\tthis.bookArr.push(book);\r\n\t\treturn book;\r\n\t}\r\n\tprivate newMap(name: string, id: number): Map {\r\n\t\tlet map = this.maps[name];\r\n\t\tif (map !== undefined) return map;\r\n\t\tmap = this.maps[name] = new Map(this, name, id)\r\n\t\tthis.setEntity(name, map);\r\n\t\tthis.mapArr.push(map);\r\n\t\treturn map;\r\n\t}\r\n\tprivate newHistory(name: string, id: number): History {\r\n\t\tlet history = this.histories[name];\r\n\t\tif (history !== undefined) return;\r\n\t\thistory = this.histories[name] = new History(this, name, id)\r\n\t\tthis.setEntity(name, history);\r\n\t\tthis.historyArr.push(history);\r\n\t\treturn history;\r\n\t}\r\n\tprivate newPending(name: string, id: number): Pending {\r\n\t\tlet pending = this.pendings[name];\r\n\t\tif (pending !== undefined) return;\r\n\t\tpending = this.pendings[name] = new Pending(this, name, id)\r\n\t\tthis.setEntity(name, pending);\r\n\t\tthis.pendingArr.push(pending);\r\n\t\treturn pending;\r\n\t}\r\n\tprivate newSheet(name: string, id: number): Sheet {\r\n\t\tlet sheet = this.sheets[name];\r\n\t\tif (sheet !== undefined) return sheet;\r\n\t\tsheet = this.sheets[name] = new Sheet(this, name, id);\r\n\t\tthis.setEntity(name, sheet);\r\n\t\tthis.sheetArr.push(sheet);\r\n\t\treturn sheet;\r\n\t}\r\n\tprivate newID(name: string, id: number): ID {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet idEntity = this.ids[lName];\r\n\t\tif (idEntity !== undefined) return idEntity;\r\n\t\tidEntity = this.ids[lName] = new ID(this, name, id);\r\n\t\tthis.setEntity(name, idEntity);\r\n\t\tthis.idArr.push(idEntity);\r\n\t\treturn idEntity;\r\n\t}\r\n\tprivate newIDX(name: string, id: number): IDX {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet idx = this.idxs[lName];\r\n\t\tif (idx !== undefined) return idx;\r\n\t\tidx = this.idxs[lName] = new IDX(this, name, id);\r\n\t\tthis.setEntity(name, idx);\r\n\t\tthis.idxArr.push(idx);\r\n\t\treturn idx;\r\n\t}\r\n\tprivate newIX(name: string, id: number): IX {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet ix = this.ixs[lName];\r\n\t\tif (ix !== undefined) return ix;\r\n\t\tix = this.ixs[lName] = new IX(this, name, id);\r\n\t\tthis.setEntity(name, ix);\r\n\t\tthis.ixArr.push(ix);\r\n\t\treturn ix;\r\n\t}\r\n\tprivate fromType(name: string, type: string) {\r\n\t\tlet parts = type.split('|');\r\n\t\ttype = parts[0];\r\n\t\tlet id = Number(parts[1]);\r\n\t\tswitch (type) {\r\n\t\t\t//case 'uq': this.id = id; break;\r\n\t\t\tcase 'tuid':\r\n\t\t\t\t// Tuid should not be created here!;\r\n\t\t\t\t//let tuid = this.newTuid(name, id);\r\n\t\t\t\t//tuid.sys = false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'id': this.newID(name, id); break;\r\n\t\t\tcase 'idx': this.newIDX(name, id); break;\r\n\t\t\tcase 'ix': this.newIX(name, id); break;\r\n\t\t\tcase 'action': this.newAction(name, id); break;\r\n\t\t\tcase 'query': this.newQuery(name, id); break;\r\n\t\t\tcase 'book': this.newBook(name, id); break;\r\n\t\t\tcase 'map': this.newMap(name, id); break;\r\n\t\t\tcase 'history': this.newHistory(name, id); break;\r\n\t\t\tcase 'sheet': this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'enum': this.newEnum(name, id); break;\r\n\t\t}\r\n\t}\r\n\tprivate fromObj(name: string, obj: any) {\r\n\t\tswitch (obj['$']) {\r\n\t\t\tcase 'sheet': this.buildSheet(name, obj); break;\r\n\t\t}\r\n\t}\r\n\tprivate buildSheet(name: string, obj: any) {\r\n\t\tlet sheet = this.sheets[name];\r\n\t\tif (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n\t\tsheet.build(obj);\r\n\t}\r\n\tbuildFieldTuid(fields: Field[], mainFields?: Field[]) {\r\n\t\tif (fields === undefined) return;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { tuid } = f;\r\n\t\t\tif (tuid === undefined) continue;\r\n\t\t\tlet t = this.getTuid(tuid);\r\n\t\t\tif (t === undefined) continue;\r\n\t\t\tf._tuid = t.buildTuidBox();\r\n\t\t}\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { owner } = f;\r\n\t\t\tif (owner === undefined) continue;\r\n\t\t\tlet ownerField = fields.find(v => v.name === owner);\r\n\t\t\tif (ownerField === undefined) {\r\n\t\t\t\tif (mainFields !== undefined) {\r\n\t\t\t\t\townerField = mainFields.find(v => v.name === owner);\r\n\t\t\t\t}\r\n\t\t\t\tif (ownerField === undefined) {\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tthrow new Error(`owner field ${owner} is undefined`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet { arr, tuid } = f;\r\n\t\t\tlet t = this.getTuid(ownerField._tuid.tuid.name);\r\n\t\t\tif (t === undefined) continue;\r\n\t\t\tlet div = t.div(arr || tuid);\r\n\t\t\tf._tuid = div && div.buildTuidDivBox(ownerField);\r\n\t\t\t/*\r\n\t\t\tif (f._tuid === undefined) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\tthrow new Error(`owner field ${owner} is not tuid`);\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\tbuildArrFieldsTuid(arrFields: ArrFields[], mainFields: Field[]) {\r\n\t\tif (arrFields === undefined) return;\r\n\t\tfor (let af of arrFields) {\r\n\t\t\tlet { fields } = af;\r\n\t\t\tif (fields === undefined) continue;\r\n\t\t\tthis.buildFieldTuid(fields, mainFields);\r\n\t\t}\r\n\t}\r\n\r\n\tpullModify(modifyMax: number) {\r\n\t\tthis.tuidsCache.pullModify(modifyMax);\r\n\t}\r\n\r\n\tgetUqKey() {\r\n\t\tlet uqKey: string = this.uqName.split(/[-._]/).join('').toLowerCase();\r\n\t\treturn uqKey;\r\n\t}\r\n\r\n\tgetUqKeyWithConfig() {\r\n\t\tif (!this.config) return;\r\n\t\tlet uqKey: string = this.uqName.split(/[-._]/).join('').toLowerCase();\r\n\t\tlet { dev, alias } = this.config;\r\n\t\tuqKey = capitalCase(dev.alias || dev.name) + capitalCase(alias ?? uqKey);\r\n\t\treturn uqKey;\r\n\t}\r\n\r\n\thasEntity(name: string): boolean {\r\n\t\treturn this.entities[name] !== undefined\r\n\t\t\t|| this.entities[name.toLowerCase()] !== undefined;\r\n\t}\r\n\r\n\tcreateProxy(): any {\r\n\t\tlet ret = new Proxy(this.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tif (lk === '$') {\r\n\t\t\t\t\treturn this.$proxy;\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet func = (this as any)[key];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tlet err = `entity ${this.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error('UQ错误：' + err);\r\n\t\t\t\tthis.showReload('服务器正在更新');\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.proxy = ret;\r\n\t\tthis.$proxy = new Proxy(this.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet func = (this as any)['$' + (key as string)];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tlet err = `entity ${this.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error('UQ错误：' + err);\r\n\t\t\t\tthis.showReload('服务器正在更新');\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.idCache = new IDCache(this);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tshowReload(msg: string) {\r\n\t\tlet cache = this.localMap.child('$reload-tick');\r\n\t\tlet reloadTick = cache.get();\r\n\t\tif (!reloadTick) reloadTick = 0;\r\n\t\tconsole.error(msg);\r\n\t\tthis.localMap.removeAll();\r\n\t\tlet tick = Date.now();\r\n\t\tcache.set(tick);\r\n\t\tif (tick - reloadTick < 10 * 1000) {\r\n\t\t\tthis.web.showReloadPage(msg);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.web.reload();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async apiPost(api: string, resultType: EnumResultType, apiParam: any): Promise<any> {\r\n\t\tif (resultType === EnumResultType.sql) api = 'sql-' + api;\r\n\t\tlet ret = await this.uqApi.post(IDPath(api), apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async apiActs(param: any, resultType: EnumResultType): Promise<any> {\r\n\t\t// 这边的obj属性序列，也许会不一样\r\n\t\tlet arr: string[] = [];\r\n\t\tlet apiParam: any = {};\r\n\t\tfor (let i in param) {\r\n\t\t\tarr.push(i);\r\n\t\t\tapiParam[i] = (param[i] as any[]).map(v => {\r\n\t\t\t\tlet obj: any = {};\r\n\t\t\t\tfor (let j in v) {\r\n\t\t\t\t\tlet val = v[j];\r\n\t\t\t\t\tif (typeof val === 'object') {\r\n\t\t\t\t\t\tlet nv: any = {};\r\n\t\t\t\t\t\tfor (let n in val) {\r\n\t\t\t\t\t\t\tlet tv = val[n];\r\n\t\t\t\t\t\t\tif (tv && typeof tv === 'object') {\r\n\t\t\t\t\t\t\t\tif (n === 'time') {\r\n\t\t\t\t\t\t\t\t\tif (Object.prototype.toString.call(tv) === '[object Date]') {\r\n\t\t\t\t\t\t\t\t\t\ttv = (tv as Date).getTime();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tlet id = tv['id'];\r\n\t\t\t\t\t\t\t\t\ttv = id;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tnv[n] = tv;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobj[j] = nv;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tobj[j] = val;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn obj;\r\n\t\t\t});\r\n\t\t}\r\n\t\tapiParam['$'] = arr;\r\n\t\tlet ret = await this.apiPost('acts', resultType, apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected Acts = async (param: any): Promise<any> => {\r\n\t\t//let apiParam = this.ActsApiParam(param);\r\n\t\tlet ret = await this.apiActs(param, EnumResultType.data); // await this.apiPost('acts', apiParam);\r\n\t\tlet retArr = (ret[0].ret as string).split('\\n');\r\n\t\tlet arr: string[] = [];\r\n\t\tfor (let i in param) arr.push(i);\r\n\t\tlet retActs: { [key: string]: number[] } = {};\r\n\t\tfor (let i = 0; i < arr.length; i++) {\r\n\t\t\tretActs[arr[i]] = ids(retArr[i].split('\\t'));\r\n\t\t}\r\n\t\treturn retActs;\r\n\t}\r\n\r\n\tprotected AdminGetList = async (): Promise<any[]> => {\r\n\t\treturn await this.uqApi.getAdmins();\r\n\t}\r\n\r\n\tprotected AdminSetMe = async (): Promise<void> => {\r\n\t\treturn await this.uqApi.setMeAdmin();\r\n\t}\r\n\r\n\tprotected AdminSet = async (user: number, role: number, name: string, nick: string, icon: string, assigned: string): Promise<void> => {\r\n\t\treturn await this.uqApi.setAdmin(user, role, name, nick, icon, assigned);\r\n\t}\r\n\r\n\tprotected AdminIsMe = async (): Promise<boolean> => {\r\n\t\treturn await this.uqApi.isAdmin();\r\n\t}\r\n\r\n\tprotected IDValue = (type: string, value: string): object => {\r\n\t\tif (!type) return;\r\n\t\tlet ID = this.ids[type.toLowerCase()];\r\n\t\tif (ID === undefined) return;\r\n\t\t/*\r\n\t\tif (ID.fields === undefined) {\r\n\t\t\tawait ID.loadSchema();\r\n\t\t}\r\n\t\t*/\r\n\t\treturn ID.valueFromString(value)\r\n\t};\r\n\r\n\tprotected $Acts = async (param: any): Promise<any> => {\r\n\t\treturn await this.apiActs(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiActIX(param: any, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, ID, values, IXs } = param;\r\n\t\tlet apiParam: any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIXs: IXs?.map((v: any) => ({ IX: entityName(v.IX), ix: v.ix })),\r\n\t\t\tvalues,\r\n\t\t};\r\n\t\tlet ret = await this.apiPost('act-ix', resultType, apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected ActIX = async (param: ParamActIX<any>): Promise<number[]> => {\r\n\t\tlet ret = await this.apiActIX(param, EnumResultType.data);\r\n\t\treturn (ret[0].ret as string).split('\\t').map(v => Number(v));\r\n\t}\r\n\r\n\tprotected $ActIX = async (param: ParamActIX<any>): Promise<string> => {\r\n\t\tlet ret = await this.apiActIX(param, EnumResultType.sql);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async apiActIxSort(param: ParamActIXSort, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, ix, id, after } = param;\r\n\t\tlet apiParam: any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tix,\r\n\t\t\tid,\r\n\t\t\tafter,\r\n\t\t};\r\n\t\treturn await this.apiPost('act-ix-sort', resultType, apiParam);\r\n\t}\r\n\r\n\tprotected ActIXSort = async (param: ParamActIXSort): Promise<void> => {\r\n\t\treturn await this.apiActIxSort(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $ActIXSort = async (param: ParamActIXSort): Promise<string> => {\r\n\t\treturn await this.apiActIxSort(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprotected ActIDProp = async (ID: ID, id: number, name: string, value: any) => {\r\n\t\tawait this.uqApi.post('act-id-prop', { ID: ID.name, id, name, value });\r\n\t}\r\n\r\n\tprivate async apiActDetail(param: ParamActDetail<any, any>, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { main, detail, detail2, detail3 } = param as unknown as ParamActDetail3<any, any, any, any>;\r\n\t\tlet postParam: any = {\r\n\t\t\tmain: {\r\n\t\t\t\tname: entityName(main.ID),\r\n\t\t\t\tvalue: toScalars(main.value),\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tname: entityName(detail.ID),\r\n\t\t\t\tvalues: detail.values?.map(v => toScalars(v)),\r\n\t\t\t},\r\n\t\t}\r\n\t\tif (detail2) {\r\n\t\t\tpostParam.detail2 = {\r\n\t\t\t\tname: entityName(detail2.ID),\r\n\t\t\t\tvalues: detail2.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (detail3) {\r\n\t\t\tpostParam.detail3 = {\r\n\t\t\t\tname: entityName(detail3.ID),\r\n\t\t\t\tvalues: detail3.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = await this.apiPost('act-detail', resultType, postParam);\r\n\t}\r\n\r\n\tprotected ActDetail = async (param: ParamActDetail<any, any>) => {\r\n\t\tlet ret = await this.apiActDetail(param, EnumResultType.data);\r\n\t\tlet val: string = ret[0].ret;\r\n\t\tlet parts = val.split('\\n');\r\n\t\tlet items = parts.map(v => v.split('\\t'));\r\n\t\tret = {\r\n\t\t\tmain: ids(items[0])[0],\r\n\t\t\tdetail: ids(items[1]),\r\n\t\t\tdetail2: ids(items[2]),\r\n\t\t\tdetail3: ids(items[3]),\r\n\t\t};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected $ActDetail = async (param: ParamActDetail<any, any>) => {\r\n\t\treturn await this.apiActDetail(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiQueryID(param: ParamQueryID, resultType: EnumResultType): Promise<any[]> {\r\n\t\tlet { ID, IX, IDX } = param;\r\n\t\tif (!IDX) {\r\n\t\t\tIDX = [ID];\r\n\t\t}\r\n\t\tlet ret = await this.apiPost('query-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: IX?.map(v => entityName(v)),\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected QueryID = async (param: ParamQueryID) => {\r\n\t\treturn await this.apiQueryID(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $QueryID = async (param: ParamQueryID) => {\r\n\t\treturn await this.apiQueryID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDTv(ids: number[], resultType: EnumResultType): Promise<any[]> {\r\n\t\tlet ret = await this.apiPost('id-tv', resultType, ids);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tIDTv = async (ids: number[]): Promise<any[]> => {\r\n\t\tlet ret = await this.apiIDTv(ids, EnumResultType.data);\r\n\t\tlet retValues: any[] = [];\r\n\t\tfor (let row of ret) {\r\n\t\t\tlet { $type, $tv } = row;\r\n\t\t\tif (!$tv) continue;\r\n\t\t\tlet ID = this.ids[$type];\r\n\t\t\tif (!ID) continue;\r\n\t\t\tlet { schema } = ID;\r\n\t\t\tif (!schema) {\r\n\t\t\t\tawait ID.loadSchema();\r\n\t\t\t\tschema = ID.schema;\r\n\t\t\t}\r\n\t\t\tlet { nameNoVice } = schema;\r\n\t\t\tif (!nameNoVice) continue;\r\n\t\t\tlet values = ($tv as string).split('\\n');\r\n\t\t\tlet len = nameNoVice.length;\r\n\t\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\t\tlet p = nameNoVice[i];\r\n\t\t\t\trow[p] = values[i];\r\n\t\t\t}\r\n\t\t\tdelete row.$tv;\r\n\t\t\tretValues.push(row);\r\n\t\t}\r\n\t\treturn retValues;\r\n\t}\r\n\r\n\tprotected $IDTv = async (ids: number[]): Promise<any> => {\r\n\t\treturn await this.apiIDTv(ids, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDNO(param: ParamIDNO, resultType: EnumResultType): Promise<string> {\r\n\t\tlet { ID, stamp } = param;\r\n\t\tlet ret = await this.apiPost('id-no', resultType, { ID: entityName(ID), stamp });\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected IDNO = async (param: ParamIDNO): Promise<string> => {\r\n\t\treturn await this.apiIDNO(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $IDNO = async (param: ParamIDNO): Promise<string> => {\r\n\t\treturn await this.apiIDNO(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDDetailGet(param: ParamIDDetailGet, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { id, main, detail, detail2, detail3 } = param;\r\n\t\tlet ret = await this.apiPost('id-detail-get', resultType, {\r\n\t\t\tid,\r\n\t\t\tmain: entityName(main),\r\n\t\t\tdetail: entityName(detail),\r\n\t\t\tdetail2: entityName(detail2),\r\n\t\t\tdetail3: entityName(detail3),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tIDDetailGet = async (param: ParamIDDetailGet): Promise<any> => {\r\n\t\treturn await this.apiIDDetailGet(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $IDDetailGet = async (param: ParamIDDetailGet): Promise<any> => {\r\n\t\treturn await this.apiIDDetailGet(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate IDXToString(p: ID | IDX | ((ID | IDX)[])): string | string[] {\r\n\t\tif (Array.isArray(p) === true) return (p as (ID | IDX)[]).map(v => entityName(v));\r\n\t\treturn entityName(p as ID | IDX);\r\n\t}\r\n\tprivate async apiID(param: ParamID, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected ID = async (param: ParamID): Promise<any[]> => {\r\n\t\treturn await this.apiID(param, EnumResultType.data);\r\n\t}\r\n\tprotected $ID = async (param: ParamID): Promise<string> => {\r\n\t\treturn await this.apiID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiKeyID(param: ParamKeyID, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IDX } = param;\r\n\t\tlet ret = await this.apiPost('key-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected KeyID = async (param: ParamKeyID): Promise<any[]> => {\r\n\t\treturn await this.apiKeyID(param, EnumResultType.data);\r\n\t}\r\n\tprotected $KeyID = async (param: ParamKeyID): Promise<string> => {\r\n\t\treturn await this.apiKeyID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIX(param: ParamIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, IX1, IDX } = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.apiPost('ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IX = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IX = async (param: ParamIX): Promise<string> => {\r\n\t\treturn await this.apiIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIXValues(param: ParamIXValues, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX } = param;\r\n\t\tlet ret = await this.apiPost('ix-values', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IXValues = async (param: ParamIXValues): Promise<any[]> => {\r\n\t\treturn await this.apiIXValues(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprivate async apiIXr(param: ParamIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IX, IX1, IDX } = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.apiPost('ixr', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IXr = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIXr(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IXr = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIXr(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiKeyIX(param: ParamKeyIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IX, IDX } = param;\r\n\t\t//this.checkParam(ID, IDX, IX, null, key, page);\r\n\t\tlet ret = await this.apiPost('key-ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected KeyIX = async (param: ParamKeyIX): Promise<any[]> => {\r\n\t\treturn await this.apiKeyIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $KeyIX = async (param: ParamKeyIX): Promise<any[]> => {\r\n\t\treturn await this.apiKeyIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDLog(param: ParamIDLog, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-log', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDLog = async (param: ParamIDLog): Promise<any[]> => {\r\n\t\treturn await this.apiIDLog(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDLog = async (param: ParamIDLog): Promise<string> => {\r\n\t\treturn await this.apiIDLog(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDSum(param: ParamIDSum, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-sum', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDSum = async (param: ParamIDSum): Promise<any[]> => {\r\n\t\treturn await this.apiIDSum(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDSum = async (param: ParamIDSum): Promise<string> => {\r\n\t\treturn await this.apiIDSum(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDinIX(param: ParamIDinIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-in-ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDinIX = async (param: ParamIDinIX): Promise<any | { $in: boolean }[]> => {\r\n\t\treturn await this.apiIDinIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDinIX = async (param: ParamIDinIX): Promise<string> => {\r\n\t\treturn await this.apiIDinIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDxID(param: ParamIDxID, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID, IX, ID2 } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-x-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID2: entityName(ID2),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDxID = async (param: ParamIDxID): Promise<any[]> => {\r\n\t\treturn await this.apiIDxID(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDxID = async (param: ParamIDxID): Promise<string> => {\r\n\t\treturn await this.apiIDxID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDTree(param: ParamIDTree, resultType: EnumResultType): Promise<any> {\r\n\t\tlet { ID } = param;\r\n\t\tlet ret = await this.apiPost('id-tree', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDTree = async (param: ParamIDTree): Promise<any[]> => {\r\n\t\treturn await this.apiIDTree(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDTree = async (param: ParamIDTree): Promise<string> => {\r\n\t\treturn await this.apiIDTree(param, EnumResultType.sql);\r\n\t}\r\n}\r\n\r\nfunction ids(item: string[]): number[] {\r\n\tif (!item) return;\r\n\tlet len = item.length;\r\n\tif (len <= 1) return;\r\n\tlet ret: number[] = [];\r\n\tfor (let i = 0; i < len - 1; i++) ret.push(Number(item[i]));\r\n\treturn ret;\r\n}\r\n\r\nfunction entityName(entity: Entity | string): string {\r\n\tif (!entity) return;\r\n\tif (typeof entity === 'string') return entity;\r\n\treturn entity.name;\r\n}\r\n\r\nfunction toScalars(value: any): any {\r\n\tif (!value) return value;\r\n\tlet ret: any = {};\r\n\tfor (let i in value) {\r\n\t\tlet v = value[i];\r\n\t\tif (typeof v === 'object') v = v['id'];\r\n\t\tret[i] = v;\r\n\t}\r\n\treturn ret;\r\n}\r\n","import { UQsBuildingLoader } from \"../uqCore\";\r\nimport { TsTemplate } from \"./TsTemplate\";\r\n\r\nexport abstract class UqBuildContext {\r\n\treadonly uqsLoader: UQsBuildingLoader;\r\n\treadonly uqTsSrcPath: string;\r\n\treadonly tsTemplate: TsTemplate;\r\n\r\n\tconstructor(uqsLoader: UQsBuildingLoader, uqTsSrcPath: string) {\r\n\t\tthis.uqsLoader = uqsLoader;\r\n\t\tthis.uqTsSrcPath = uqTsSrcPath;\r\n\t\tthis.tsTemplate = new TsTemplate(this);\r\n\t}\r\n\r\n\tabstract get uiPlatform():string;\r\n\tabstract get uiPlatformUpper():string;\r\n\tabstract get uiPlatformCamel():string;\r\n\tabstract get element(): string;\r\n}\r\n","import { UqApi } from '../web';\r\nimport { LocalCache, getObjPropIgnoreCase } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\nconst chars = '\\\\ntbfvr';\r\nconst codeBackSlash = chars.charCodeAt(0);\r\nconst codeN = chars.charCodeAt(1);\r\nconst codeT = chars.charCodeAt(2);\r\nconst codeB = chars.charCodeAt(3);\r\nconst codeF = chars.charCodeAt(4);\r\nconst codeV = chars.charCodeAt(5);\r\nconst codeR = chars.charCodeAt(6);\r\n\r\nconst codes = '\\n\\t\\b\\f\\v\\r';\r\nconst codeBN = codes.charCodeAt(0);\r\nconst codeBT = codes.charCodeAt(1);\r\nconst codeBB = codes.charCodeAt(2);\r\nconst codeBF = codes.charCodeAt(3);\r\nconst codeBV = codes.charCodeAt(4);\r\nconst codeBR = codes.charCodeAt(5);\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly schemaLocal: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName(): string { return this.jName || this.name }\r\n    fields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq: UqMan, name: string, typeId: number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.schemaLocal = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: { [arr: string]: FieldMap } = {};\r\n    fieldMap(arr?: string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields: Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema(): Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.schemaLocal.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        //this.setSchema(schema);\r\n        //this.buildFieldsTuid();\r\n        this.buildSchema(schema);\r\n        await this.loadValues();\r\n    }\r\n\r\n    buildSchema(schema: any) {\r\n        this.setSchema(schema);\r\n        this.buildFieldsTuid();\r\n        //await this.loadValues();\r\n    }\r\n\r\n    protected async loadValues(): Promise<any> { }\r\n\r\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema: any) {\r\n        if (schema === undefined) return;\r\n        let { name, version } = schema;\r\n        this.ver = version || 0;\r\n        this.setJName(name);\r\n        this.schemaLocal.set(schema);\r\n        this.schema = schema;\r\n        this.buildFieldsTuid();\r\n    }\r\n\r\n    protected setJName(name: string) {\r\n        if (name !== this.name) this.jName = name;\r\n    }\r\n\r\n    protected setKeys() {\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        let { fields, arrs, returns } = this.schema;\r\n        this.fields = fields;\r\n        this.setKeys();\r\n        this.uq.buildFieldTuid(fields);\r\n        this.arrFields = arrs;\r\n        this.uq.buildArrFieldsTuid(arrs, fields);\r\n        this.returns = returns;\r\n        this.uq.buildArrFieldsTuid(returns, fields);\r\n    }\r\n\r\n    schemaStringify(): string {\r\n        return JSON.stringify(this.schema, (key: string, value: any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName: string, arrName?: string): Tuid {\r\n        if (this.schema === undefined) return;\r\n        let { fields, arrs } = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn: string, fieldArr: Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params: any): any {\r\n        let result: any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let { name, fields } = arr;\r\n                let paramsArr: any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult: any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result: any, fields: Field[], params: any) {\r\n        for (let field of fields) {\r\n            let { name, type } = field;\r\n            let d = params[name];\r\n            let val: any;\r\n            switch (type) {\r\n                case 'datetime':\r\n                    val = this.buildDateTimeParam(d);\r\n                    break;\r\n                case 'date':\r\n                    if (d instanceof Date) {\r\n                        val = `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;\r\n                    }\r\n                    else {\r\n                        val = d;\r\n                    }\r\n                    break;\r\n                default:\r\n                    switch (typeof d) {\r\n                        default: val = d; break;\r\n                        case 'object':\r\n                            if (d instanceof Date) {\r\n                                val = d;\r\n                                break;\r\n                            }\r\n                            let tuid = field._tuid;\r\n                            if (tuid === undefined) val = d.id;\r\n                            else val = tuid.getIdFromObj(d);\r\n                            break;\r\n                    }\r\n                    break;\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val: any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return undefined;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime() / 1000);\r\n    }\r\n\r\n    buildDateParam(val: any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p > 0 ? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data: any): string {\r\n        let ret: string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let { name, fields } = arr;\r\n                let arrData = getObjPropIgnoreCase(data, name);\r\n                //if (!arrData) arrData = data[name.toLowerCase()];\r\n                this.packArr(ret, fields, arrData);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row: any, field: Field): any {\r\n        let d = row[field.name];\r\n        if (d === null) return '';\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i = 0; i < len; i++) {\r\n                            let c: number = d.charCodeAt(i), ch: string;\r\n                            switch (c) {\r\n                                default: continue;\r\n                                case codeBackSlash: ch = '\\\\\\\\'; break;\r\n                                case codeBT: ch = '\\\\t'; break;\r\n                                case codeBN: ch = '\\\\n'; break;\r\n                                case codeBF: ch = '\\\\f'; break;\r\n                                case codeBV: ch = '\\\\v'; break;\r\n                                case codeBB: ch = '\\\\b'; break;\r\n                                case codeBR: ch = '\\\\r'; break;\r\n                            }\r\n                            r += d.substring(p, i) + ch;\r\n                            p = i + 1;\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result: string[], fields: Field[], data: any) {\r\n        let len = fields.length;\r\n        if (len === 0) {\r\n            result.push(ln);\r\n            return;\r\n        }\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i = 1; i < len; i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result: string[], fields: Field[], data: any[]) {\r\n        if (data !== undefined) {\r\n            if (data.length === 0) {\r\n                result.push(ln);\r\n            }\r\n            else {\r\n                for (let row of data) {\r\n                    this.packRow(result, fields, row);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            result.push(ln);\r\n        }\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values: any, fields: Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let { name, _tuid } = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values: string[], fields: Field[]): any[] {\r\n        if (fields === undefined) {\r\n            return values as any[];\r\n        }\r\n        let ret: any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p < len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data: string): any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackReturns(data: string, returns?: ArrFields[]): { [name: string]: any[] } {\r\n        if (data === undefined) debugger;\r\n        let ret = {} as any;\r\n        let p = 0;\r\n        let arrs = returns || this.returns;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    protected unpackRow(ret: any, fields: Field[], data: string, p: number, sep: number = 9): number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (; p < len; p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === sep) {\r\n                let f = fields[i];\r\n                let { name } = f;\r\n                if (ch0 !== 8) {\r\n                    if (p > c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p + 1;\r\n                ++i;\r\n                if (i >= fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let { name } = f;\r\n                if (ch0 !== 8) {\r\n                    if (p > c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let { name } = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret: any, v: string, f: Field): any {\r\n        switch (f.type) {\r\n            default: return v;\r\n            case 'text':\r\n            case 'char':\r\n                return this.reverseNT(v);\r\n            //case 'time':\r\n            case 'datetime':\r\n            case 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true ? new Date(v) : new Date(n * 1000);\r\n                return date;\r\n            /*\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1]) - 1, Number(parts[2]));\r\n            */\r\n            case 'enum':\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n            case 'float':\r\n            case 'double':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let { _tuid } = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    private reverseNT(text: string): string {\r\n        if (text === undefined) return;\r\n        if (text === null) return;\r\n        let len = text.length;\r\n        let r = '';\r\n        let p = 0;\r\n        for (let i = 0; i < len; i++) {\r\n            let c = text.charCodeAt(i);\r\n            if (c === codeBackSlash) {\r\n                if (i === len - 1) break;\r\n                let c1 = text.charCodeAt(i + 1);\r\n                let ch: string;\r\n                switch (c1) {\r\n                    default: continue;\r\n                    case codeBackSlash: ch = '\\\\'; break;\r\n                    case codeN: ch = '\\n'; break;\r\n                    case codeT: ch = '\\t'; break;\r\n                    case codeB: ch = '\\b'; break;\r\n                    case codeF: ch = '\\f'; break;\r\n                    case codeV: ch = '\\v'; break;\r\n                    case codeR: ch = '\\r'; break;\r\n                }\r\n                r += text.substring(p, i) + ch;\r\n                p = i + 2;\r\n                ++i;\r\n            }\r\n        }\r\n        r += text.substring(p, len);\r\n        return r;\r\n    }\r\n\r\n    private unpackArr(ret: any, arr: ArrFields, data: string, p: number): number {\r\n        let p0 = p;\r\n        let vals: any[] = [], len = data.length;\r\n        let { name, fields } = arr;\r\n        while (p < len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n                if (p === p0) {\r\n                    ch = data.charCodeAt(p);\r\n                    if (ch !== 10) {\r\n                        throw new Error('upackArr: arr第一个字符是10，则必须紧跟一个10，表示整个arr的结束')\r\n                    }\r\n                    ++p;\r\n                }\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import { Caller } from '../web';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params:T, $$user:number = undefined, waiting: boolean = true) {\r\n        super(params, $$user, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity {return this._entity;}\r\n\r\n    //大多的entityCaller都不需要这个\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n    \r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let {$uq, $modify, res} = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            let ret = this.xresult(res);\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res:any):any {return res}\r\n\r\n    get headers(): {[header:string]: string} {\r\n        let {ver, uq} = this.entity;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error(`${schema.entity.name} can not get right uq response schema, 5 tries`);\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let {uq, entity} = schema;\r\n        if (uq !== undefined) {\r\n\t\t\tthis.entity.uq.buildEntities(uq);\r\n\t\t}\r\n        if (entity !== undefined) {\r\n\t\t\tthis.entity.setSchema(entity);\r\n\t\t}\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action {return this._entity as Action;}\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `query/${this.entity.name}`;}\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\r\n\tprotected get entity(): Query {return this._entity as Query};\r\n\t//results: {[name:string]:any[]};\r\n\tget path():string {return `query-page/${this.entity.name}`;}\t\r\n    buildParams() {\r\n        let {pageStart, pageSize, params} = this.params;\r\n        let p:any;\r\n        if (params === undefined) {\r\n            p = {key: ''};\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res:any): {[name:string]:any[]} {\r\n        let ret = this.entity.unpackReturns(res);\r\n\t\t//return this.results.$page;// as any[];\r\n\t\treturn ret;\r\n    }\r\n}\r\n","import { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 10000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];                   // 每次使用，都排到队头\r\n    private readonly cache: Map<number, any>;    // 已经缓冲的\r\n\r\n    protected localArr: LocalArr;\r\n    protected waitingIds: number[] = [];          // 等待loading的\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.cache = tuidLocal.uq.tonwa.createObservableMap();\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.schemaLocal.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    cacheSet(id: number, val: any) {\r\n        this.cache.set(id, val);\r\n    }\r\n\r\n    useId(id: number, defer?: boolean) {\r\n        if (!id) return;\r\n        if (typeof id !== 'number') {\r\n            console.error('id cache ' + id + ' is not number');\r\n            return;\r\n        }\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer === true ? 70 : 20);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n        return;\r\n    }\r\n\r\n    private moveToHead(id: number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id: number) {\r\n        return this.cache.get(id);\r\n    }\r\n\r\n    remove(id: number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id: number | BoxId): any {\r\n        let _id: number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id: number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val: any): boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n        this.cacheSet(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val: any) { return this.tuidInner.getIdFromObj(val) }\r\n\r\n    async cacheIds(): Promise<void> {\r\n        let tuidValues = await this.loadIds();\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    protected cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === true) {\r\n                this.cacheTuidFieldValues(tuidValue);\r\n            }\r\n        }\r\n    }\r\n    async modifyIds(ids: any[]): Promise<void> {\r\n        let tuidValues: string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p < 0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected async loadIds(): Promise<any[]> {\r\n        if (this.waitingIds.length === 0) return;\r\n        let loadingIds = [...this.waitingIds];\r\n        this.waitingIds = [];\r\n        return await this.loadTuidIdsOrLocal(loadingIds);\r\n    }\r\n    protected unpackTuidIds(values: string[]): any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id: number): Promise<object | number> {\r\n        let val = this.cache.get(id);\r\n        if (val !== undefined) return val;\r\n        /*\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            // case 'number': this.cache.set(id, undefined); break;\r\n        }\r\n        */\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        this.cacheIdValues(ret);\r\n    }\r\n\r\n    protected async loadValuesFromIds(netIds: number[]): Promise<any[]> {\r\n        let netRet = await this.tuidInner.loadValuesFromIds(undefined, netIds);\r\n        return netRet;\r\n    }\r\n\r\n    private async loadTuidIdsOrLocal(ids: number[]): Promise<string[]> {\r\n        let ret: string[] = [];\r\n        let netIds: number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // 值不存在或者是空字符串，重新获取\r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len === 0) return ret;\r\n\r\n        let netRet = await this.loadValuesFromIds(netIds);\r\n        for (let i = 0; i < len; i++) {\r\n            //有些id可能没有内容，不会返回\r\n            //let id = netIds[i]; \r\n            let row: string = netRet[i];\r\n            if (!row) continue;\r\n            let p = row.indexOf('\\t');\r\n            if (p < 0) p = row.length;\r\n            let id = Number(row.substr(0, p));\r\n            let pos = netIds.findIndex(v => v === id);\r\n            if (pos >= 0) netIds.splice(pos, 1);\r\n            ret.push(row);\r\n            this.localArr.setItem(id, row);\r\n        }\r\n        len = netIds.length;\r\n        for (let i = 0; i < len; i++) {\r\n            this.localArr.setItem(netIds[i], '');\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName: string;\r\n\r\n    constructor(tuidLocal: TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.schemaLocal.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // 这个不需要，必须去掉\r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val: any) { return this.div.getIdFromObj(val) }\r\n    protected unpackTuidIds(values: string[]): any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n    protected async loadValuesFromIds(netIds: number[]): Promise<any[]> {\r\n        let netRet = await this.tuidInner.loadValuesFromIds(this.divName, netIds);\r\n        return netRet;\r\n    }\r\n}\r\n","import { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport interface TuidNOResult {\r\n\tdate: string;\r\n\tno: number;\r\n}\r\n\r\nexport abstract class UqTuid<M> extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    unique: string[];\r\n\t//render: Render<M>;\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    //abstract tv(id:number, render?:Render<M>):JSX.Element;\r\n    abstract getObj(id:number):M;\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n\tabstract assureBox<T> (id:number|BoxId): Promise<T>;\r\n\tstatic idValue(id: {id:number}|number):number {\r\n\t\tlet t = typeof id;\r\n\t\tswitch (t) {\r\n\t\t\tdefault: debugger; throw new Error('unknown id type: ' + t);\r\n\t\t\tcase 'undefined': return undefined;\r\n\t\t\tcase 'object': return (id as any).id;\r\n\t\t\tcase 'number': return id as number;\r\n\t\t}\r\n\t}\r\n    static equ(id1:{id:number}|number, ix:{id:number}|number): boolean {\r\n        if (id1 === undefined || id1 === null) return false;\r\n\t\tif (ix === undefined || ix === null) return false;\r\n\t\treturn Tuid.idValue(id1) === Tuid.idValue(ix);\r\n\t\t/*\r\n        if (typeof id1 === 'object') {\r\n\t\t\tlet id1Id = id1.id;\r\n            return typeof ix === 'object'? id1Id === ix.id : id1Id === ix;\r\n        }\r\n        if (typeof ix === 'object') {\r\n\t\t\tlet id2Id = ix.id;\r\n            return typeof id1 === 'object'? id2Id === id1.id : id2Id === id1;\r\n        }\r\n\t\treturn id1 === ix;\r\n\t\t*/\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract loadMain(id:number|BoxId):Promise<M>;\r\n\tabstract load(id:number|BoxId):Promise<M>;\r\n    abstract all():Promise<M[]>;\r\n\tabstract save(id:number, props:M):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract search(key:string, pageStart:string|number, pageSize:number):Promise<M[]>;\r\n    abstract searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n\tabstract posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n\tabstract no():Promise<TuidNOResult>;\r\n}\r\n\r\nexport abstract class Tuid extends UqTuid<any> {\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.schemaLocal.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    getObj(id:number):any {\r\n        let obj = this.valueFromId(id);\r\n        if (obj) return obj;\r\n        this.useId(id);\r\n        return {id};\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //let {createBoxId} = this.uq;\r\n        //if (!createBoxId) \r\n        return {id: id} as BoxId;\r\n        //return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadValuesFromIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, undefined, false).request();\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n\t}\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await new TuidNoCaller(this, undefined).request();\r\n\t}\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = Object.assign({}, props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\nclass TuidNoCaller extends TuidCaller<{}> {\r\n    get path():string {\r\n        return `tuid-no/${this.entity.name}/`;\r\n    }\r\n    buildParams():any {\r\n\t\tlet d = new Date();\r\n\t\tlet year = d.getFullYear();\r\n\t\tlet month = d.getMonth() + 1;\r\n\t\tlet date = d.getDate();\r\n        return {year, month, date};\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    getObj(id:number): any {return this.tuidLocal?.getObj(id)}\r\n    /*\r\n\ttv(id:number, render?:Render<any>):JSX.Element {\r\n\t\treturn this.tuidLocal?.tv(id, render);\r\n\t}\r\n    */\r\n\r\n    useId(id:number) {this.tuidLocal?.useId(id);}\r\n    boxId(id:number):BoxId {\r\n\t\tif (!this.tuidLocal) debugger;\r\n\t\treturn this.tuidLocal?.boxId(id);\r\n\t}\r\n    valueFromId(id:number) {return this.tuidLocal?.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal?.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal?.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal?.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await this.tuidLocal.no();\r\n\t}\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\nimport { env } from '../../tool';\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        env.clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n    \r\n    pullModify(modifyMax:number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let {max, seconds} = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached:string[] = [];\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists:string):Promise<void> {\r\n        let {uqApi, tuids} = this.uq;\r\n        let {max} = this.modifyMax;\r\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\r\n        let modifyMax:number = 0;\r\n        for (let modify of ret.queue) {\r\n\t\t\tlet {id, entity, key} = modify;\r\n\t\t\tif (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = {tuid: tuid, ids:[]};\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let {tuid, ids} = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class UqAction<P, R> extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:P, $$user:number = undefined, waiting: boolean = true) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data, $$user, waiting)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:P, $$user:number = undefined):Promise<R> {\r\n       return await new SubmitReturnsCaller(this, data, $$user).request();\r\n    }\r\n    async submitConvert(data:P, $$user:number = undefined) {\r\n        return await new SubmitConvertCaller(this, data, $$user).request();\r\n    }\r\n}\r\n\r\nexport class Action extends UqAction<any, any> {\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {\r\n\t\treturn {\r\n            $$user: this.$$user,\r\n            data: this.entity.pack(this.params)\r\n        };\r\n\t}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            $$user: this.$$user,\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { EntityCaller } from './caller';\r\nimport { ArrFields } from './uqMan';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport interface SheetSaveReturnV<V> {\r\n\tid: number;\r\n\tflow: number;\r\n\tstate: string;\r\n\tverify: V[];\r\n}\r\n\r\nexport interface SheetSaveReturn extends SheetSaveReturnV<any> {\r\n}\r\n\r\ninterface GetSheetReturn<M> {\r\n\tbrief: any;\r\n\tdata: M;\r\n\tflows: any[];\r\n}\r\n\r\nexport class UqSheet<M, V> extends Entity {\r\n    get typeName(): string { return 'sheet';}\r\n\tstates: SheetState[];\r\n\tverify: {returns: ArrFields[]};\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n\t\tthis.states = schema.states;\r\n\t\tthis.verify = schema.verify;\r\n    }\r\n    build(obj:any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({name: op, actions:undefined});\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    async save(discription:string, data:M):Promise<SheetSaveReturnV<V>> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveCaller(this, params).request();\r\n    }\r\n    async saveDebugDirect(discription:string, data:M):Promise<SheetSaveReturn> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveDirectCaller(this, params).request();\r\n    }\r\n    async action(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    async actionDebugDirect(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionDirectCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    private unpack(data:any):GetSheetReturn<M> {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart:number, pageSize:number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {pageStart:pageStart, pageSize:pageSize};\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    //createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\r\n\r\n    async stateSheetCount():Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state:string, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        let params = {state:state, user:user, pageStart:pageStart, pageSize:pageSize};\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\nexport class Sheet extends UqSheet<any, any> {\r\n}\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet {return this._entity as Sheet;}\r\n    protected readonly suffix:string;\r\n    get path():string {return `sheet/${this.entity.name}/${this.suffix}`;}\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{app:number; discription:string; data:any}> {\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    buildParams() {\r\n        let {app, discription, data} = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n    xresult(res:any):any {\r\n\t\tlet {verify} = this.entity;\r\n\t\tif (verify === undefined) return res;\r\n\t\tlet resVerify = res.verify;\r\n\t\tif (resVerify === undefined || resVerify.length === 0) {\r\n\t\t\tres.verify = undefined;\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\tlet {returns} = verify;\r\n\t\tres.verify = this.entity.unpackReturns(resVerify, returns);\r\n        return res;\r\n    }\r\n}\r\n\r\nclass SaveDirectCaller extends SaveCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{id:number, flow:number, state:string, action:string}> {\r\n    method = 'PUT';\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n}\r\n\r\nclass ActionDirectCaller extends ActionCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/get/${this.params}`;}\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/archive/${this.params}`;}\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res:any):any {\r\n        let {states} = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{state:string, user:number, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n/*\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n\t}\r\n\tprotected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\treturn item === undefined? 0 : (item as any).id;\r\n\t}\r\n}\r\n*/\r\n","import { /*Field, */ArrFields } from './uqMan';\r\nimport { Entity } from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class UqQuery<P, R> extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    /*\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    */\r\n    //list:IObservableArray; \r\n    returns: ArrFields[];\r\n\tisPaged: boolean;\r\n\t\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n    /*\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        //this.list = undefined;\r\n    }\r\n    */\r\n    //get hasMore() {return this.more;}\r\n    /*\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = (ret as any).$page;\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n    }\r\n    */\r\n    protected pageCaller(params: any, $$user:number = undefined, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, $$user, showWaiting);\r\n    }\r\n\r\n    async page(params:P, pageStart:any, pageSize:number, $$user:number = undefined, showWaiting: boolean = true):Promise<R> {\r\n        let p = {pageStart, pageSize, params};\r\n        let res = await this.pageCaller(p, $$user, showWaiting).request();\r\n        return res;\r\n    }\r\n    protected queryCaller(params: P, $$user:number = undefined, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, $$user, showWaiting);\r\n    }\r\n    async query(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<R> {\r\n        let res = await this.queryCaller(params, $$user, showWaiting).request();\r\n        return res;\r\n    }\r\n    async table(params:P, $$user:number = undefined, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, $$user, showWaiting);\r\n        for (let i in ret) {\r\n            return (ret as any)[i];\r\n        }\r\n    }\r\n    async obj(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, $$user,showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, $$user, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Query extends UqQuery<any, any> {\r\n}\r\n","import { UqQuery} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class UqBook<P, R> extends UqQuery<P, R> {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class Book extends UqBook<any, any> {\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    get path():string {return `book/${this.entity.name}`;}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqHistory<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n\r\nexport class History extends UqHistory<any, any> {\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class UqMap extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Map extends UqMap {\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqPending<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n\r\nexport class Pending extends UqPending<any, any> {\r\n}\r\n","import { Entity } from \"./entity\";\r\n\r\nexport class UqEnum extends Entity {\r\n    get typeName(): string { return 'enum';}\r\n}","import { Entity } from \"./entity\";\r\nimport { Field, Uq } from \"./uqMan\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqID<M extends { id: number }> extends Entity {\r\n\tget typeName() { return 'id' }\r\n\tcreate: boolean;\r\n\tupdate: boolean;\r\n\towner: boolean;\r\n\tkeys: Field[];\r\n\tasync NO(): Promise<string> {\r\n\t\tlet ret = await this.uqApi.post('id-no', { ID: this.name });\r\n\t\treturn ret;\r\n\t};\r\n\tprotected setKeys() {\r\n\t\tthis.keys = this.schema.keys;\r\n\t}\r\n\tget isGlobal(): boolean {\r\n\t\treturn this.schema.global;\r\n\t}\r\n\tgetIdFromObj(value: any): number { return value['id']; }\r\n\tvalueFromString(str: string): M {\r\n\t\tif (!str) return undefined;\r\n\t\tlet ret: M = {} as M;\r\n\t\tthis.unpackRow(ret, this.fields, str, 0, 12);\r\n\t\treturn ret;\r\n\t}\r\n\tcacheTuids(defer: number): void { }\r\n\tasync loadValuesFromIds(divName: string, ids: number[]): Promise<M[]> {\r\n\t\tlet ret = await (this.uq as unknown as Uq).QueryID<M>({\r\n\t\t\tIDX: [this],\r\n\t\t\tid: ids\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tcacheTuidFieldValues(value: any): void { }\r\n\tunpackTuidIds(values: string[]): any[] { return; }\r\n}\r\n\r\nexport class ID extends UqID<any> {\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIDX<M> extends Entity {\r\n\tget typeName() { return 'idx' }\r\n}\r\n\r\nexport class IDX extends UqIDX<any> {\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIX<M> extends Entity {\r\n\tget typeName() { return 'ix' }\r\n}\r\n\r\nexport class IX extends UqIX<any> {\r\n}\r\n\r\n/* eslint-enable no-unused-vars */\r\n","import { UqMan } from '../uqMan';\r\n\r\nconst maxCacheSize = 1000;\r\nconst delayLoad = 30; \t// 延迟loading的时间\r\nexport class IDCache {\r\n\tprotected uqMan: UqMan;\r\n\tprivate queue: number[] = [];               \t\t\t\t\t\t\t// 每次使用，都排到队头\r\n\tprivate cache: Map<number, object | number>;    // 已经缓冲的, 如果是数值，则是重复取的次数\r\n\tprivate waitingIds: number[] = [];          \t\t\t\t\t\t\t// 等待loading的\r\n\tprivate timeoutHandler: any;\r\n\r\n\tconstructor(uqMan: UqMan) {\r\n\t\tthis.uqMan = uqMan;\r\n\t\tthis.cache = uqMan.tonwa.createObservableMap<number, object | number>();\r\n\t}\r\n\r\n\tgetValue(id: number): object {\r\n\t\tlet ret = this.cache.get(id);\r\n\t\tif (ret === null) return;\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.useId(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (typeof ret === 'number') return;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected async TvIdValues(waitingIds: number[]) {\r\n\t\treturn await this.uqMan.IDTv(waitingIds);\r\n\t}\r\n\r\n\tprivate timeOut = async () => {\r\n\t\tlet waitingIds = this.waitingIds;\r\n\t\tthis.waitingIds = [];\r\n\t\tif (waitingIds.length === 0) return;\r\n\t\tlet values = await this.TvIdValues(waitingIds);\r\n\t\tfor (let val of values) {\r\n\t\t\tlet { id } = val;\r\n\t\t\tif (waitingIds[0] < 0) id = -id;\r\n\t\t\tthis.cache.set(id, val);\r\n\t\t\tlet index = waitingIds.findIndex(v => v === id);\r\n\t\t\tif (index >= 0) waitingIds.splice(index, 1);\r\n\t\t}\r\n\t\tfor (let id of waitingIds) {\r\n\t\t\tthis.cache.set(id, null);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate useId(id: number) {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id !== 'number') {\r\n\t\t\tconsole.error('id cache ' + id + ' is not number');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.cache.has(id) === true) {\r\n\t\t\tthis.moveToHead(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tclearTimeout(this.timeoutHandler);\r\n\t\tthis.timeoutHandler = setTimeout(this.timeOut, delayLoad);\r\n\t\t//this.cache.set(id, 0);\r\n\t\tif (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n\t\t\tthis.moveToHead(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.queue.length >= maxCacheSize) {\r\n\t\t\t// 缓冲已满，先去掉最不常用的\r\n\t\t\tlet r = this.queue.shift();\r\n\t\t\tif (r === id) {\r\n\t\t\t\t// 如果移除的，正好是现在用的，则插入\r\n\t\t\t\tthis.queue.push(r);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t//let rKey = String(r);\r\n\t\t\tif (this.cache.has(r) === true) {\r\n\t\t\t\t// 如果移除r已经缓存\r\n\t\t\t\tthis.cache.delete(r);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// 如果移除r还没有缓存\r\n\t\t\t\tlet index = this.waitingIds.findIndex(v => v === r);\r\n\t\t\t\tthis.waitingIds.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.waitingIds.push(id);\r\n\t\tthis.queue.push(id);\r\n\t\treturn;\r\n\t}\r\n\r\n\tprivate moveToHead(id: number) {\r\n\t\tlet index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.queue.push(id);\r\n\t}\r\n\r\n\tremove(id: number) {\r\n\t\tthis.cache.delete(id);\r\n\t\tlet index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\t//this.localArr.removeItem(id);\r\n\t}\r\n\r\n\tresetCache(id: number) {\r\n\t\tthis.remove(id);\r\n\t\tthis.useId(id);\r\n\t}\r\n}\r\n","import { env } from '../tool';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { Web, UqData } from '../web';\r\nimport { Tonwa, UqConfig } from '../core';\r\n\r\n/*\r\nexport interface TVs {\r\n\t[uqName:string]: {\r\n\t\t[tuidName: string]: (values: any) => JSX.Element;\r\n\t}\r\n}\r\n*/\r\n\r\nexport class UQsMan {\r\n\tprivate readonly tonwa: Tonwa;\r\n\tprivate readonly web: Web;\r\n\tprivate collection: { [uqLower: string]: UqMan };\r\n\t//private readonly tvs: TVs;\r\n\tproxy: any;\r\n\tuqMans: UqMan[] = [];\r\n\r\n\tconstructor(tonwa: Tonwa/*, tvs:TVs*/) {\r\n\t\tthis.tonwa = tonwa;\r\n\t\tthis.web = tonwa.web;\r\n\t\t//this.tvs = tvs || {};\r\n\t\t//this.buildTVs();\r\n\t\tthis.uqMans = [];\r\n\t\tthis.collection = {};\r\n\t}\r\n\r\n\tasync buildUqs(uqDataArr: UqData[], version: string, uqConfigs: UqConfig[], isBuildingUQ: boolean): Promise<string[]> {\r\n\t\tawait this.init(uqDataArr);\r\n\r\n\t\tlet localMap = env.localDb.map('$app');\r\n\t\tlet localCacheVersion = localMap.child('version');\r\n\t\tlet cacheVersion = localCacheVersion.get();\r\n\t\tif (version !== cacheVersion) {\r\n\t\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t\tuqMan.localMap.removeAll();\r\n\t\t\t}\r\n\t\t\tlocalCacheVersion.set(version);\r\n\t\t}\r\n\r\n\t\tlet retErrors = await this.load();\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tif (isBuildingUQ === false) {\r\n\t\t\tthis.setTuidImportsLocal();\r\n\t\t}\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tif (uqConfigs) {\r\n\t\t\tfor (let uqConfig of uqConfigs) {\r\n\t\t\t\tlet { dev, name, alias } = uqConfig;\r\n\t\t\t\tlet { name: owner, alias: ownerAlias } = dev;\r\n\t\t\t\tlet uqLower = (ownerAlias ?? owner).toLowerCase() + '/' + (alias ?? name).toLowerCase();\r\n\t\t\t\tlet uq = this.collection[uqLower];\r\n\t\t\t\tuq.config = uqConfig;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.proxy = this.buildUQs();\r\n\t}\r\n\r\n\tuq(uqName: string): UqMan {\r\n\t\treturn this.collection[uqName.toLowerCase()];\r\n\t}\r\n\r\n\tasync getUqUserRoles(uqLower: string): Promise<string[]> {\r\n\t\tlet uqMan = this.collection[uqLower];\r\n\t\tif (uqMan === undefined) return null;\r\n\t\tlet roles = await uqMan.getRoles();\r\n\t\treturn roles;\r\n\t}\r\n\r\n\t/*\r\n\tprivate buildTVs() {\r\n\t\tif (!this.tvs) return;\r\n\t\tfor (let i in this.tvs) {\r\n\t\t\tlet uqTVs = this.tvs[i];\r\n\t\t\tif (uqTVs === undefined) continue;\r\n\t\t\tlet l = i.toLowerCase();\r\n\t\t\tif (l === i) continue;\r\n\t\t\tthis.tvs[l] = uqTVs;\r\n\t\t\tfor (let j in uqTVs) {\r\n\t\t\t\tlet en = uqTVs[j];\r\n\t\t\t\tif (en === undefined) continue;\r\n\t\t\t\tlet lj = j.toLowerCase();\r\n\t\t\t\tif (lj === j) continue;\r\n\t\t\t\tuqTVs[lj] = en;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t*/\r\n\r\n\tasync init(uqsData: UqData[]): Promise<void> {\r\n\t\tlet promiseInits: PromiseLike<void>[] = [];\r\n\t\tfor (let uqData of uqsData) {\r\n\t\t\tlet { uqOwner, ownerAlias, uqName, uqAlias } = uqData;\r\n\r\n\t\t\t// 原名加入collection\r\n\t\t\tlet uqFullName = uqOwner + '/' + uqName;\r\n\t\t\tlet uqFull = this.collection[uqFullName];\r\n\t\t\tlet uq: UqMan;\r\n\t\t\tif (uqFull) {\r\n\t\t\t\tuq = uqFull;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tuq = new UqMan(this.tonwa, uqData/*, undefined, this.tvs[uqFullName] || this.tvs[uqName]*/);\r\n\t\t\t\tthis.collection[uqFullName] = uq;\r\n\t\t\t\tpromiseInits.push(uq.init());\r\n\t\t\t}\r\n\t\t\tthis.uqMans.push(uq);\r\n\t\t\tlet lower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\r\n\t\t\t// 别名加入collection\r\n\t\t\tif (uqAlias) uqName = uqAlias;\r\n\t\t\tif (ownerAlias) uqOwner = ownerAlias;\r\n\t\t\tuqFullName = uqOwner + '/' + uqName;\r\n\t\t\tlower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\t\t}\r\n\t\tawait Promise.all(promiseInits);\r\n\t}\r\n\r\n\tasync load(): Promise<string[]> {\r\n\t\tlet retErrors: string[] = [];\r\n\t\tlet promises: PromiseLike<string>[] = [];\r\n\t\t//let lowerUqNames:string[] = [];\r\n\t\t// collection有小写名字，还有正常名字\r\n\t\t//for (let i in this.collection) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t//let lower = (i as string).toLowerCase();\r\n\t\t\t//if (lowerUqNames.indexOf(lower) >= 0) continue;\r\n\t\t\t//lowerUqNames.push(lower);\r\n\t\t\t//let uq = this.collection[i];\r\n\t\t\tpromises.push(uqMan.loadEntities());\r\n\t\t}\r\n\t\tlet results = await Promise.all(promises);\r\n\t\tfor (let result of results) {\r\n\t\t\tlet retError = result; // await cUq.loadSchema();\r\n\t\t\tif (retError !== undefined) {\r\n\t\t\t\tretErrors.push(retError);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n\r\n\tprivate buildUQs(): any {\r\n\t\tlet uqs: any = {};\r\n\t\tfunction setUq(uqKey: string, proxy: any): void {\r\n\t\t\tif (!uqKey) return;\r\n\t\t\tlet lower = uqKey.toLowerCase();\r\n\t\t\tuqs[uqKey] = proxy;\r\n\t\t\tif (lower !== uqKey) uqs[lower] = proxy;\r\n\t\t}\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tlet proxy = uqMan.createProxy();\r\n\t\t\tsetUq(uqMan.getUqKey(), proxy);\r\n\t\t\tsetUq(uqMan.getUqKeyWithConfig(), proxy);\r\n\t\t\t/*\r\n\t\t\tlet uqKey = uqMan.getUqKey();\r\n\t\t\tlet lower = uqKey.toLowerCase();\r\n\t\t\tuqs[uqKey] = proxy;\r\n\t\t\tif (lower !== uqKey) uqs[lower] = proxy;\r\n\t\t\tlet uqKeyWithConfig = uqMan.getUqKeyWithConfig();\r\n\t\t\tlet lowerWithConfig = uqKeyWithConfig.toLowerCase();\r\n\t\t\tuqs[uqKeyWithConfig] = proxy;\r\n\t\t\tif (lowerWithConfig !== uqKeyWithConfig) uqs[lowerWithConfig] = proxy;\r\n\t\t\t*/\r\n\t\t}\r\n\t\treturn new Proxy(uqs, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tdebugger;\r\n\t\t\t\tconsole.error(`controller.uqs.${String(key)} undefined`);\r\n\t\t\t\tthis.showReload(`新增 uq ${String(key)}`);\r\n\t\t\t\treturn undefined;\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tgetUqMans() {\r\n\t\treturn this.uqMans;\r\n\t}\r\n\r\n\tprivate showReload(msg: string) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tuqMan.localMap.removeAll();\r\n\t\t}\r\n\t\tthis.web.showReloadPage(msg);\r\n\t}\r\n\r\n\tsetTuidImportsLocal(): string[] {\r\n\t\tlet ret: string[] = [];\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tfor (let tuid of uqMan.tuidArr) {\r\n\t\t\t\tif (tuid.isImport === true) {\r\n\t\t\t\t\tlet error = this.setInner(tuid as TuidImport);\r\n\t\t\t\t\tif (error) ret.push(error);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate setInner(tuidImport: TuidImport): string {\r\n\t\tlet { from } = tuidImport;\r\n\t\tlet fromName = from.owner + '/' + from.uq;\r\n\t\tlet uq = this.collection[fromName];\r\n\t\tif (uq === undefined) {\r\n\t\t\t//debugger;\r\n\t\t\tif (env.buildingUq === false) {\r\n\t\t\t\tconsole.error(`setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet iName = tuidImport.name\r\n\t\tlet tuid = uq.tuid(iName);\r\n\t\tif (tuid === undefined) {\r\n\t\t\t//debugger;\r\n\t\t\treturn `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n\t\t}\r\n\t\tif (tuid.isImport === true) {\r\n\t\t\t//debugger;\r\n\t\t\treturn `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n\t\t}\r\n\t\ttuidImport.setFrom(tuid as TuidInner);\r\n\t}\r\n}\r\n","import { Tonwa, AppConfig as AppConfigCore, UqConfig } from '../core';\r\nimport { UQsMan } from \"./uqsMan\";\r\nimport { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData, UqAppData, CenterAppApi } from '../web';\r\n\r\nexport class UQsLoader {\r\n\treadonly tonwa: Tonwa;\r\n\tprotected readonly appConfig: AppConfigCore;\r\n\tprotected isBuildingUQ: boolean = false;\r\n\tuqsMan: UQsMan;         // value\r\n\r\n\tconstructor(tonwa: Tonwa, appConfig: AppConfigCore) {\r\n\t\tthis.appConfig = appConfig;\r\n\t\tthis.tonwa = tonwa;\r\n\t}\r\n\r\n\tasync build() {\r\n\t\tlet { app, uqs } = this.appConfig;\r\n\t\tlet retErrors: string[];\r\n\t\tif (app) {\r\n\t\t\tretErrors = await this.loadApp();\r\n\t\t}\r\n\t\telse if (uqs) {\r\n\t\t\tretErrors = await this.loadUqs();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('either uqs or app must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n\t/*\r\n\tasync buildUQs(uqsConfig: AppConfig) {\r\n\t\tlet {uqs, tvs, version} = uqsConfig;\r\n\t\tlet retErrors:string[];\r\n\t\tif (uqs) {\r\n\t\t\tUQsMan.isBuildingUQ = true;\r\n\t\t\tretErrors = await this.loadUqs();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('either uqs or app must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n\t*/\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tprivate async loadApp(): Promise<string[]> {\r\n\t\tlet { app, uqs: uqConfigs, version } = this.appConfig;\r\n\r\n\t\tlet { name, dev } = app;\r\n\t\tlet uqsManApp = new UQsManApp(this.tonwa, `${dev.name}/${name}`);\r\n\t\tthis.uqsMan = uqsManApp;\r\n\t\tlet { appOwner, appName, localData } = uqsManApp;\r\n\t\tlet uqAppData: UqAppData = localData.get();\r\n\t\tif (!uqAppData || uqAppData.version !== version) {\r\n\t\t\tuqAppData = await this.loadUqAppData(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}不存在。请仔细检查app全名。`\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\tuqAppData.version = version;\r\n\r\n\t\t\tif (uqConfigs) {\r\n\t\t\t\tlet data = await this.loadUqData(uqConfigs);\r\n\t\t\t\tuqAppData.uqs.push(...data);\r\n\t\t\t}\r\n\r\n\t\t\tlocalData.set(uqAppData);\r\n\t\t\t// \r\n\t\t\tfor (let uq of uqAppData.uqs) uq.newVersion = true;\r\n\t\t}\r\n\t\tlet { id, uqs } = uqAppData;\r\n\t\tuqsManApp.id = id;\r\n\t\treturn await this.uqsMan.buildUqs(uqs, version, uqConfigs, this.isBuildingUQ);\r\n\t}\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tasync loadUqs(/*uqConfigs: UqConfig[], version:string, tvs:TVs*/): Promise<string[]> {\r\n\t\tlet { uqs: uqConfigs, version } = this.appConfig;\r\n\t\tthis.uqsMan = new UQsMan(this.tonwa);\r\n\t\tlet uqs = await this.loadUqData(uqConfigs);\r\n\t\treturn await this.uqsMan.buildUqs(uqs, version, uqConfigs, this.isBuildingUQ);\r\n\t}\r\n\r\n\tprivate async loadUqAppData(appOwner: string, appName: string): Promise<UqAppData> {\r\n\t\tlet centerAppApi = new CenterAppApi(this.tonwa.web, 'tv/', undefined);\r\n\t\tlet ret = await centerAppApi.appUqs(appOwner, appName);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async loadUqData(uqConfigs: UqConfig[]): Promise<UqData[]> {\r\n\t\tlet uqs: { owner: string; ownerAlias: string; name: string; alias: string; version: string }[] = uqConfigs.map(\r\n\t\t\tv => {\r\n\t\t\t\tlet { dev, name, version, alias } = v;\r\n\t\t\t\tlet { name: owner, alias: ownerAlias } = dev;\r\n\t\t\t\treturn { owner, ownerAlias, name, version, alias };\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet centerAppApi = new CenterAppApi(this.tonwa.web, 'tv/', undefined);\r\n\t\tlet ret: UqData[] = uqs.length === 0 ? [] : await centerAppApi.uqs(uqs);\r\n\t\tif (ret.length < uqs.length) {\r\n\t\t\tlet err = `下列UQ：\\n${uqs.map(v => `${v.owner}/${v.name}`).join('\\n')}之一不存在`;\r\n\t\t\tconsole.error(err);\r\n\t\t\tthrow Error(err);\r\n\t\t}\r\n\t\tfor (let i = 0; i < uqs.length; i++) {\r\n\t\t\tlet { ownerAlias, alias } = uqs[i];\r\n\t\t\tret[i].ownerAlias = ownerAlias;\r\n\t\t\tret[i].uqAlias = alias;\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nclass UQsManApp extends UQsMan {\r\n\treadonly appOwner: string;\r\n\treadonly appName: string;\r\n\treadonly localMap: LocalMap;\r\n\treadonly localData: LocalCache;\r\n\tid: number;\r\n\r\n\tconstructor(tonwa: Tonwa, tonwaAppName: string/*, tvs:TVs*/) {\r\n\t\tsuper(tonwa/*, tvs*/);\r\n\t\tlet parts = tonwaAppName.split('/');\r\n\t\tif (parts.length !== 2) {\r\n\t\t\tthrow new Error('tonwaApp name must be / separated, owner/app');\r\n\t\t}\r\n\t\tthis.appOwner = parts[0];\r\n\t\tthis.appName = parts[1];\r\n\t\tthis.localMap = env.localDb.map(tonwaAppName);\r\n\t\tthis.localData = this.localMap.child('uqData');\r\n\t}\r\n}\r\n\r\nexport class UQsBuildingLoader extends UQsLoader {\r\n\tasync build() {\r\n\t\t//nav.forceDevelopment = true;\r\n\t\tenv.isDevelopment = true;\r\n\t\t//await nav.init();\r\n\t\t//await this.tonwa.web.navInit();\r\n\t\tawait this.tonwa.init();\r\n\t\tthis.isBuildingUQ = true;\r\n\t\tlet { uqs } = this.appConfig;\r\n\t\tlet retErrors: string[];\r\n\t\tif (uqs) {\r\n\t\t\tretErrors = await this.loadUqs();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('uqs must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n}\r\n","export function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n","export interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{\r\n\tlang: string;\r\n\t$lang: string;\r\n\tdistrict: string;\r\n\t$district: string;\r\n} = {\r\n\tlang: undefined,\r\n\t$lang: undefined,\r\n\tdistrict: undefined,\r\n\t$district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n\tresOptions.lang = lang;\r\n\tresOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    Object.assign(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    Object.assign(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    Object.assign(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nexport const resGlobal:any = {};\r\nexport function setRes(target: any, res: any):(str:string)=>any {\r\n\tif (res === undefined) return;\r\n\tlet {$lang, $district} = resOptions;\r\n\tObject.assign(target, res);\r\n\tif ($lang !== undefined) {\r\n\t\tlet l = res[$lang];\r\n\t\tif (l !== undefined) {\r\n\t\t\tObject.assign(target, l);\r\n\t\t\tlet d = l[$district];\r\n\t\t\tif (d !== undefined) {\r\n\t\t\t\tObject.assign(target, d);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn function(str:string) {\r\n\t\treturn target[str] || str;\r\n\t}\r\n}\r\nexport function setGlobalRes(res: any) {\r\n\tsetRes(resGlobal, res);\r\n}\r\n/*\r\nexport function t(str:string):string|JSX.Element {\r\n\treturn resGlobal[str] || str;\r\n}\r\nexport type TFunc = (str:string|JSX.Element) => string|JSX.Element;\r\n*/\r\n\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface InputRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const inputRes:Res<InputRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '必须填',\r\n            number: '需要数字',\r\n            integer: '需要整数',\r\n            min: '不能小于${min}',\r\n            max: '不能大于${max}',\r\n        }\r\n    },\r\n}\r\n","import { Navigo, Hooks, NamedRoute, RouteFunc } from \"./Navigo\";\r\nimport { Nav, NavPage } from './Nav';\r\nimport { Web } from '../web';\r\nimport { resOptions } from '../res';\r\nimport { LocalData, env, User, Guest } from '../tool';\r\nimport { Login } from './Login';\r\n\r\nexport interface NavSettings {\r\n\toem?: string;\r\n\tloginTop?: JSX.Element;\r\n\tprivacy?: string;\r\n\thtmlTitle?: string;\r\n}\r\n\r\nlet logMark: number;\r\nconst logs: string[] = [];\r\n\r\nexport let tonwa: Tonwa;\r\n\r\nexport abstract class Tonwa {\r\n\treadonly web: Web;\r\n\tprivate wsHost: string;\r\n\tprivate local: LocalData = new LocalData();\r\n\tprivate navigo: Navigo;\r\n\t//isWebNav:boolean = false;\r\n\tnavSettings: NavSettings;\r\n\tuser: User = null;\r\n\ttesting: boolean;\r\n\tlanguage: string;\r\n\tculture: string;\r\n\tresUrl: string;\r\n\r\n\tconstructor() {\r\n\t\ttonwa = this;\r\n\t\tthis.web = this.createWeb();\r\n\t\tlet { lang, district } = resOptions;\r\n\t\tthis.language = lang;\r\n\t\tthis.culture = district;\r\n\t\tthis.testing = false;\r\n\t}\r\n\r\n\t/*\r\n\tprotected abstract startWait(): void;\r\n\tprotected abstract endWait(): void;\r\n\t*/\r\n\t//protected abstract showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean): Promise<void>;\r\n\tprotected abstract showRegister(): Promise<void>;\r\n\tprotected abstract showForget(): Promise<void>;\r\n\r\n\tabstract createWeb(): Web;\r\n\tabstract createObservableMap<K, V>(): Map<K, V>;\r\n\tabstract get nav(): Nav;\r\n\r\n\tabstract privacyEntry(): void;\r\n\t//abstract showLogout(callback?: ()=>Promise<void>): Promise<void>;\r\n\t//abstract openSysPage(url: string):boolean;\r\n\t//abstract changePassword(): Promise<void>;\r\n\t//abstract userQuit(): Promise<void>;\r\n\tabstract resetAll: () => void;\r\n\tabstract showAppView(isUserLogin?: boolean): Promise<void>;\r\n\t//abstract clear(): void;\r\n\r\n\tget guest(): number {\r\n\t\tlet guest = this.local.guest;\r\n\t\tif (guest === undefined) return 0;\r\n\t\tlet g = guest.get();\r\n\t\tif (g === undefined) return 0;\r\n\t\treturn g.guest;\r\n\t}\r\n\tasync onReceive(msg: any) {\r\n\t\t//if (this.ws === undefined) return;\r\n\t\tawait this.web.messageHub.dispatch(msg);\r\n\t}\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async getPredefinedUnitName() {\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\treturn el.innerText;\r\n\t\t}\r\n\t\tel = document.getElementById('unit.json');\r\n\t\tif (!el) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tlet json = el.innerHTML;\r\n\t\t\tlet res = JSON.parse(json);\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async loadPredefinedUnit() {\r\n\t\tlet envUnit = process.env.REACT_APP_UNIT;\r\n\t\tif (envUnit !== undefined) {\r\n\t\t\treturn Number(envUnit);\r\n\t\t}\r\n\t\tlet unitName: string;\r\n\t\tlet unit = this.local.unit.get();\r\n\t\tif (unit !== undefined) {\r\n\t\t\tif (env.isDevelopment !== true) return unit.id;\r\n\t\t\tunitName = await this.getPredefinedUnitName();\r\n\t\t\tif (unitName === undefined) return;\r\n\t\t\tif (unit.name === unitName) return unit.id;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tunitName = await this.getPredefinedUnitName();\r\n\t\t\tif (unitName === undefined) return;\r\n\t\t}\r\n\t\tlet unitId = await this.web.guestApi.unitFromName(unitName);\r\n\t\tif (unitId !== undefined) {\r\n\t\t\tthis.local.unit.set({ id: unitId, name: unitName });\r\n\t\t}\r\n\t\treturn unitId;\r\n\t}\r\n\r\n\tsetSettings(settings?: NavSettings) {\r\n\t\tthis.navSettings = settings;\r\n\t\tlet { htmlTitle } = settings;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget oem(): string {\r\n\t\treturn this.navSettings && this.navSettings.oem;\r\n\t}\r\n\r\n\thashParam: string;\r\n\tprivate centerHost: string;\r\n\tprivate arrs = ['/test', '/test/'];\r\n\tprivate unitJsonPath(): string {\r\n\t\tlet { origin, pathname } = document.location;\r\n\t\tpathname = pathname.toLowerCase();\r\n\t\tfor (let item of this.arrs) {\r\n\t\t\tif (pathname.endsWith(item) === true) {\r\n\t\t\t\tpathname = pathname.substr(0, pathname.length - item.length);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n\t\t\tpathname = pathname.substr(0, pathname.length - 1);\r\n\t\t}\r\n\t\treturn origin + pathname + '/unit.json';\r\n\t}\r\n\tprivate windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n\t\tdebugger;\r\n\t\tconsole.error('windowOnError');\r\n\t\tconsole.error(error);\r\n\t}\r\n\tprivate windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n\t\tdebugger;\r\n\t\tconsole.error('windowOnUnhandledRejection');\r\n\t\tconsole.error(ev.reason);\r\n\t}\r\n\tprivate windowOnClick = (ev: MouseEvent) => {\r\n\t\tconsole.error('windowOnClick');\r\n\t}\r\n\tprivate windowOnMouseMove = (ev: MouseEvent) => {\r\n\t\tconsole.log('navigator.userAgent: ' + navigator.userAgent);\r\n\t\tconsole.log('mouse move (%s, %s)', ev.x, ev.y);\r\n\t}\r\n\tprivate windowOnScroll = (ev: Event) => {\r\n\t\tconsole.log('scroll event');\r\n\t}\r\n\r\n\tforceDevelopment: boolean;\r\n\r\n\tasync init() {\r\n\t\tthis.testing = env.testing;\r\n\t\tif (this.forceDevelopment === true) {\r\n\t\t\tenv.isDevelopment = true;\r\n\t\t}\r\n\t\tawait this.web.host.start(this.testing);\r\n\t\t/*\r\n\t\tlet hash = document.location.hash;\r\n\t\tif (hash !== undefined && hash.length > 0) {\r\n\t\t\tlet pos = getExHashPos();\r\n\t\t\tif (pos < 0) pos = undefined;\r\n\t\t\tthis.hashParam = hash.substring(1, pos);\r\n\t\t}\r\n\t\t*/\r\n\t\tlet { url, ws, resHost } = this.web.host;\r\n\t\tthis.centerHost = url;\r\n\t\tthis.resUrl = this.web.resUrlFromHost(resHost);\r\n\t\tthis.wsHost = ws;\r\n\t\tthis.web.setCenterUrl(url);\r\n\r\n\t\tlet guest: Guest = this.local.guest.get();\r\n\t\tif (guest === undefined) {\r\n\t\t\tguest = await this.web.guestApi.guest();\r\n\t\t}\r\n\t\tif (!guest) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error('guest can not be undefined');\r\n\t\t}\r\n\t\tthis.setGuest(guest);\r\n\t}\r\n\r\n\treloadUser = () => {\r\n\t\tlet user: User = this.local.user.get();\r\n\t\tlet curUser = this.user;\r\n\t\tif (!user && !curUser) return;\r\n\t\tif (user?.id === curUser?.id) return;\r\n\t\tif (!user) {\r\n\t\t\tthis.logout();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.logined(user);\r\n\t\t}\r\n\t}\r\n\r\n\t//private appStarted:boolean = false;\r\n\tprivate notLogined?: () => Promise<void>;\r\n\tprivate userPassword?: () => Promise<{ user: string; password: string; }>\r\n\tasync appStart(notLogined?: () => Promise<void>, userPassword?: () => Promise<{ user: string; password: string; }>) {\r\n\t\t//if (this.appStarted === true) return;\r\n\t\t//this.appStarted = true;\r\n\t\tthis.notLogined = notLogined;\r\n\t\tthis.userPassword = userPassword;\r\n\t\tawait this.init();\r\n\t\tawait this.start();\r\n\t}\r\n\r\n\tasync start() {\r\n\t\ttry {\r\n\t\t\twindow.onerror = this.windowOnError;\r\n\t\t\twindow.onunhandledrejection = this.windowOnUnhandledRejection;\r\n\t\t\twindow.onfocus = this.reloadUser;\r\n\t\t\tif (env.isMobile === true) {\r\n\t\t\t\tdocument.onselectstart = function () { return false; }\r\n\t\t\t\tdocument.oncontextmenu = function () { return false; }\r\n\t\t\t}\r\n\t\t\tthis.nav.clear();\r\n\t\t\tthis.nav.startWait();\r\n\r\n\t\t\tlet user: User = this.local.user.get();\r\n\t\t\tif (user === undefined) {\r\n\t\t\t\t//throw new Error('user logout to be implemented');\r\n\t\t\t\t//let {userPassword} = this.navView.props;\r\n\t\t\t\tif (this.userPassword) {\r\n\t\t\t\t\tlet ret = await this.userPassword();\r\n\t\t\t\t\tif (ret) {\r\n\t\t\t\t\t\tlet { user: userName, password } = ret;\r\n\t\t\t\t\t\tlet logindUser = await this.web.userApi.login({\r\n\t\t\t\t\t\t\tuser: userName,\r\n\t\t\t\t\t\t\tpwd: password,\r\n\t\t\t\t\t\t\tguest: this.guest,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuser = logindUser;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (user === undefined) {\r\n\t\t\t\t\t//let {notLogined} = this.navView.props;\r\n\t\t\t\t\tif (this.notLogined !== undefined) {\r\n\t\t\t\t\t\tawait this.notLogined();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tawait this.showLogin(undefined);\r\n\t\t\t\t\t\t//nav.navigateToLogin();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tawait this.logined(user);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tfinally {\r\n\t\t\tthis.nav.endWait();\r\n\t\t}\r\n\t}\r\n\r\n\tresolveRoute() {\r\n\t\t//if (this.isRouting === false) return;\r\n\t\tif (this.navigo === undefined) return;\r\n\t\tthis.navigo.resolve();\r\n\t}\r\n\r\n\ton(routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(url: string, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(regex: RegExp, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(options: { [url: string]: RouteFunc | NamedRoute }): Navigo;\r\n\ton(...args: any[]): Navigo {\r\n\t\tif (this.navigo === undefined) {\r\n\t\t\tthis.navigo = new Navigo();\r\n\t\t\tif (this.nav.isWebNav !== true) this.navigo.historyAPIUpdateMethod('replaceState');\r\n\t\t}\r\n\t\treturn this.navigo.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tnavigateToLogin() {\r\n\t\tthis.navigate('/login');\r\n\t}\r\n\r\n\tnavigate(url: string, absolute?: boolean) {\r\n\t\tif (!this.navigo) {\r\n\t\t\talert('Is not in webnav state, cannot navigate to url \"' + url + '\"');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.testing === true) {\r\n\t\t\turl += '#test';\r\n\t\t}\r\n\t\treturn this.navigo.navigate(url, absolute);\r\n\t}\r\n\r\n\tgo(showPage: () => void, url: string, absolute?: boolean) {\r\n\t\tif (this.navigo !== undefined) {\r\n\t\t\tthis.navigate(url, absolute);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshowPage();\r\n\t\t}\r\n\t}\r\n\r\n\tsetGuest(guest: Guest) {\r\n\t\tthis.local.guest.set(guest);\r\n\t\tthis.web.setNetToken(0, guest.token);\r\n\t}\r\n\r\n\tsaveLocalUser() {\r\n\t\tthis.local.user.set(this.user);\r\n\t}\r\n\r\n\tsetUqRoles(uq: string, roles: string[]) {\r\n\t\tlet { roles: userRoles } = this.user;\r\n\t\tif (!userRoles) {\r\n\t\t\tthis.user.roles = {};\r\n\t\t}\r\n\t\tthis.user.roles[uq] = roles;\r\n\t\tthis.local.user.set(this.user);\r\n\t}\r\n\r\n\tasync loadMe() {\r\n\t\tlet me = await this.web.userApi.me();\r\n\t\tthis.user.icon = me.icon;\r\n\t\tthis.user.nick = me.nick;\r\n\t}\r\n\r\n\tprivate async internalLogined(user: User, callback: (user: User) => Promise<void>, isUserLogin: boolean) {\r\n\t\tthis.web.logoutApis();\r\n\t\tthis.user = user;\r\n\t\tthis.saveLocalUser();\r\n\t\tthis.web.setNetToken(user.id, user.token);\r\n\t\tthis.nav.clear();\r\n\r\n\t\tawait this.onChangeLogin?.(this.user);\r\n\t\tif (callback !== undefined) {\r\n\t\t\tawait callback(user);\r\n\t\t}\r\n\t\telse if (this.nav.isWebNav === true) {\r\n\t\t\tthis.navigate('/index');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait this.showAppView(isUserLogin);\r\n\t\t}\r\n\t}\r\n\r\n\tonChangeLogin: (user: User) => Promise<void>;\r\n\r\n\t// 缓冲登录\r\n\tasync logined(user: User, callback?: (user: User) => Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, false);\r\n\t}\r\n\r\n\t// 用户操作之后登录\r\n\tasync userLogined(user: User, callback?: (user: User) => Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, true);\r\n\t}\r\n\r\n\tloginTop(defaultTop: JSX.Element) {\r\n\t\treturn (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n\t}\r\n\r\n\tasync logout(callback?: () => Promise<void>) { //notShowLogin?:boolean) {\r\n\t\tthis.local.logoutClear();\r\n\t\tthis.user = undefined; //{} as User;\r\n\t\tthis.web.logoutApis();\r\n\t\tlet guest = this.local.guest.get();\r\n\t\tthis.web.setCenterToken(0, guest && guest.token);\r\n\t\tthis.nav.clear();\r\n\t\tif (callback === undefined)\r\n\t\t\tawait this.start();\r\n\t\telse\r\n\t\t\tawait callback();\r\n\t\tthis.onChangeLogin?.(undefined);\r\n\t}\r\n\r\n\r\n\tget logs() { return logs };\r\n\tlog(msg: string) {\r\n\t\tlogs.push(msg);\r\n\t}\r\n\tlogMark() {\r\n\t\tlet date = new Date();\r\n\t\tlogMark = date.getTime();\r\n\t\tlogs.push('log-mark: ' + date.toTimeString());\r\n\t}\r\n\tlogStep(step: string) {\r\n\t\tlogs.push(step + ': ' + (new Date().getTime() - logMark));\r\n\t}\r\n\r\n\treload = async () => {\r\n\t\tlet waiting: Promise<void> = new Promise<void>((resolve, reject) => {\r\n\t\t\tsetTimeout(resolve, 100);\r\n\t\t});\r\n\r\n\t\tif ('serviceWorker' in navigator) {\r\n\t\t\tlet registration = await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n\t\t\tif (registration) registration.unregister();\r\n\t\t}\r\n\t\twindow.document.location.reload();\r\n\t\t// dcloud hbuilder里面的app自动升级，需要清webview的缓存\r\n\t\tlet plus = (window as any).plus;\r\n\t\tif (plus) {\r\n\t\t\tlet webview = plus.webview;\r\n\t\t\tif (webview) {\r\n\t\t\t\tif (webview.reload) webview.reload(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet webView = plus.webView;\r\n\t\t\t\tif (webView) {\r\n\t\t\t\t\tif (webView.reload) webView.reload(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//plus.webview.reload(true)\r\n\t\t}\r\n\t}\r\n\r\n\topenSysPage(url: string): boolean {\r\n\t\tlet navPage: NavPage = this.sysRoutes[url];\r\n\t\tif (navPage === undefined) {\r\n\t\t\t//alert(url + ' is not defined in sysRoutes');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tnavPage(undefined);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate navLogin: NavPage = async (params: any) => {\r\n\t\tthis.showLogin(async (user: User) => window.history.back(), false);\r\n\t}\r\n\r\n\tprivate navLogout: NavPage = async (params: any) => {\r\n\t\tthis.showLogout(async () => window.history.back());\r\n\t}\r\n\r\n\tprivate navRegister: NavPage = async (params: any) => {\r\n\t\tthis.showRegister();\r\n\t}\r\n\r\n\tprivate navForget: NavPage = async (params: any) => {\r\n\t\tthis.showForget();\r\n\t}\r\n\r\n\r\n\tprivate navPageRoutes: { [url: string]: NavPage };\r\n\tprivate routeFromNavPage(navPage: NavPage) {\r\n\t\treturn (params: any, queryStr: any) => {\r\n\t\t\tif (navPage) {\r\n\t\t\t\tif (this.nav.isWebNav) this.nav.clear();\r\n\t\t\t\tnavPage(params);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonNavRoute(navPage: NavPage) {\r\n\t\tthis.on(this.routeFromNavPage(navPage));\r\n\t}\r\n\tprivate doneSysRoutes: boolean = false;\r\n\tprivate sysRoutes: { [route: string]: NavPage } = {\r\n\t\t'/login': this.navLogin,\r\n\t\t'/logout': this.navLogout,\r\n\t\t'/register': this.navRegister,\r\n\t\t'/forget': this.navForget,\r\n\t}\r\n\t/*\r\n\tonSysNavRoutes() {\r\n\t\tthis.onNavRoutes(this.sysRoutes);\r\n\t}\r\n\t*/\r\n\tonNavRoutes(navPageRoutes: { [url: string]: NavPage }) {\r\n\t\tif (this.doneSysRoutes === false) {\r\n\t\t\tthis.doneSysRoutes = true;\r\n\t\t\tthis.internalOnNavRoutes(this.sysRoutes);\r\n\t\t}\r\n\t\tthis.internalOnNavRoutes(navPageRoutes);\r\n\t}\r\n\r\n\tprivate internalOnNavRoutes(navPageRoutes: { [url: string]: NavPage }) {\r\n\t\tif (!navPageRoutes) return;\r\n\t\tthis.navPageRoutes = Object.assign(this.navPageRoutes, navPageRoutes);\r\n\t\tlet navOns: { [route: string]: (params: any, queryStr: any) => void } = {};\r\n\t\tfor (let route in navPageRoutes) {\r\n\t\t\tlet navPage = navPageRoutes[route];\r\n\t\t\tnavOns[route] = this.routeFromNavPage(navPage);\r\n\t\t}\r\n\t\tthis.on(navOns);\r\n\t}\r\n\r\n\tasync checkVersion(): Promise<string> {\r\n\t\tlet { href } = document.location;\r\n\t\thref += (href.indexOf('?') >= 0 ? '&' : '?') + '_t_t_=' + new Date().getTime();\r\n\t\tlet ret = await fetch(href);\r\n\t\tlet r = await ret.text();\r\n\t\tlet parser = new DOMParser();\r\n\t\tlet htmlDoc = parser.parseFromString(r, 'text/html');\r\n\t\tlet elHtml = htmlDoc.getElementsByTagName('html');\r\n\t\tlet newVersion = elHtml[0].getAttribute('data-version');\r\n\t\treturn newVersion;\r\n\t}\r\n\r\n\tprivate createLogin: (tonwa: Tonwa) => Promise<Login>;\r\n\tsetCreateLogin(createLogin: (tonwa: Tonwa) => Promise<Login>) {\r\n\t\tthis.createLogin = createLogin;\r\n\t}\r\n\r\n\tasync changePassword() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showChangePassword();\r\n\t}\r\n\r\n\tasync userQuit() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showUserQuit();\r\n\t}\r\n\r\n\tprivate login: Login;\r\n\tprivate async getLogin(): Promise<Login> {\r\n\t\tif (this.login) return this.login;\r\n\t\treturn this.login = await this.createLogin(this);\r\n\t}\r\n\tasync showLogin(callback?: (user: User) => Promise<void>, withBack?: boolean) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogin(callback, withBack);\r\n\t}\r\n\r\n\tasync showLogout(callback?: () => Promise<void>) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogout(callback);\r\n\t}\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[无]',\r\n        }\r\n    },\r\n}\r\n","// typescript version of krasimir/navigo\r\n\r\nexport type RouteFunc = (params?: string | { [name: string]: string }, query?: string) => void;\r\n\r\nexport interface NamedRoute {\r\n\tas: string;\r\n\tuses: RouteFunc;\r\n\thooks?: Hooks;\r\n}\r\nexport interface Hooks {\r\n\tbefore: (done: () => void, params: object) => void;\r\n\tafter: (params: object) => void;\r\n\tleave: (params: object) => void;\r\n\talready: (params: object) => void;\r\n}\r\ninterface Handler {\r\n\thandler: RouteFunc;\r\n\thooks: Hooks;\r\n}\r\ninterface LastResolved {\r\n\turl: string;\r\n\tquery: string;\r\n\thooks: Hooks;\r\n\tparams?: { [name: string]: string };\r\n\tname?: string;\r\n}\r\ninterface Route {\r\n\troute: string | RegExp;\r\n\thandler: RouteFunc,\r\n\tname: string,\r\n\thooks: Hooks\r\n}\r\n\r\nexport class Navigo {\r\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\r\n\tprivate static WILDCARD_REGEXP = /\\*/g;\r\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// 单\\，编译错误 ([^\\/]+)\r\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\r\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// 单\\，编译错误 (?:\\/$|$)\r\n\tprivate static MATCH_REGEXP_FLAGS = '';\r\n\r\n\tprivate static isPushStateAvailable() {\r\n\t\treturn !!(\r\n\t\t\ttypeof window !== 'undefined' &&\r\n\t\t\twindow.history &&\r\n\t\t\twindow.history.pushState\r\n\t\t);\r\n\t}\r\n\r\n\tprivate static clean(s: string | RegExp) {\r\n\t\tif (s instanceof RegExp) return s;\r\n\t\treturn Navigo.cleanUrl(s);\r\n\t}\r\n\tprivate static cleanUrl(s: string) {\r\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\r\n\t}\r\n\r\n\tprivate static regExpResultToParams(match: any[], names: string[]) {\r\n\t\tif (names.length === 0) return null;\r\n\t\tif (!match) return null;\r\n\t\treturn match\r\n\t\t\t.slice(1, match.length)\r\n\t\t\t.reduce((params, value, index) => {\r\n\t\t\t\tif (params === null) params = {};\r\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\r\n\t\t\t\treturn params;\r\n\t\t\t}, null);\r\n\t}\r\n\r\n\tprivate static replaceDynamicURLParts(route: string | RegExp) {\r\n\t\tlet paramNames: string[] = [], regexp: RegExp;\r\n\r\n\t\tif (route instanceof RegExp) {\r\n\t\t\tregexp = route;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregexp = new RegExp(\r\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\r\n\t\t\t\t\tparamNames.push(name);\r\n\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\r\n\t\t\t\t})\r\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\r\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\r\n\t\t}\r\n\t\treturn { regexp, paramNames };\r\n\t}\r\n\r\n\tprivate static getUrlDepth(url: string): number {\r\n\t\treturn url.replace(/\\/$/, '').split('/').length;\r\n\t}\r\n\r\n\tprivate static compareUrlDepth(urlA: string, urlB: string) {\r\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\r\n\t}\r\n\r\n\tprivate static findMatchedRoutes(url: string, routes: Route[] = []) {\r\n\t\treturn routes.map(route => {\r\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\r\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\r\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\r\n\t\t\treturn match ? { match, route, params } : false;\r\n\t\t}).filter(m => m);\r\n\t}\r\n\r\n\tprivate static match(url: string, routes: Route[]) {\r\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\r\n\t}\r\n\r\n\tprivate static root(url: string, routes: Route[]) {\r\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\r\n\t\tconst exp = ''; // '($|\\\\/)';  // 单\\，编译报错 ($|\\/)\r\n\t\tlet matched = routes.map(\r\n\t\t\troute => {\r\n\t\t\t\tlet r = route.route;\r\n\t\t\t\tif (r === '' || r === '*') return url;\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/(\\\\w|%|[\\u4E00-\\u9FCC])+');\r\n\t\t\t\t}\r\n\t\t\t\tlet routeExp = r + exp;\r\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\r\n\t\tlet len = matched.length;\r\n\t\tif (len === 0) return fallbackURL;\r\n\t\tlet matched0 = matched[0];\r\n\t\tif (len === 1) return matched0;\r\n\t\treturn matched.reduce((result, url) => {\r\n\t\t\tif (result.length > url.length) result = url;\r\n\t\t\treturn result;\r\n\t\t}, matched0);\r\n\t}\r\n\r\n\tprivate static isHashChangeAPIAvailable() {\r\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\r\n\t}\r\n\r\n\tprivate static extractGETParameters(url: string): string {\r\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\r\n\t}\r\n\r\n\tprivate static getOnlyURL(url: string, useHash: boolean, hash: string) {\r\n\t\tlet onlyURL = url, split: string[];\r\n\t\tvar cleanGETParam = (str: string) => str.split(/\\?(.*)?$/)[0];\r\n\r\n\t\tif (typeof hash === 'undefined') {\r\n\t\t\t// To preserve BC\r\n\t\t\thash = '#';\r\n\t\t}\r\n\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t\tonlyURL = cleanGETParam(url).split(hash)[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsplit = url.split(hash);\r\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\r\n\t\t}\r\n\t\treturn onlyURL;\r\n\t}\r\n\r\n\tprivate static manageHooks(handler: RouteFunc, hooks: Hooks, params?: any, exHooks?: Hooks) {\r\n\t\tif (hooks && typeof hooks === 'object') {\r\n\t\t\tif (hooks.before) {\r\n\t\t\t\thooks.before((shouldRoute = true) => {\r\n\t\t\t\t\tif (!shouldRoute) return;\r\n\t\t\t\t\thandler();\r\n\t\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\t}, params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (hooks.after) {\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler();\r\n\t}\r\n\r\n\tprivate static isHashedRoot(url: string, useHash: boolean, hash: string) {\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!url.match(hash)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tlet split = url.split(hash);\r\n\r\n\t\treturn split.length < 2 || split[1] === '';\r\n\t}\r\n\r\n\tprivate root: string;\r\n\tprivate _routes: Route[] = [];\r\n\tprivate _useHash: boolean;\r\n\tprivate _hash: string;\r\n\tprivate _paused: boolean;\r\n\tprivate _destroyed: boolean;\r\n\tprivate _lastRouteResolved: LastResolved;\r\n\tprivate _notFoundHandler: Handler;\r\n\tprivate _defaultHandler: Handler;\r\n\tprivate _usePushState: boolean;\r\n\tprivate _genericHooks: Hooks;\r\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\r\n\tprivate timout: any; //NodeJS.Timeout;\r\n\r\n\tconstructor(r: string = null, useHash: boolean = false, hash: string = '#') {\r\n\t\tthis.root = null;\r\n\t\tthis._useHash = useHash;\r\n\t\tthis._hash = (!hash) ? '#' : hash;\r\n\t\tthis._paused = false;\r\n\t\tthis._destroyed = false;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._notFoundHandler = null;\r\n\t\tthis._defaultHandler = null;\r\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\r\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\r\n\t\tthis._genericHooks = null;\r\n\t\tthis._historyUpdateMethod = 'pushState';\r\n\r\n\t\tif (r) {\r\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\r\n\t\t} else if (useHash) {\r\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\r\n\t\t}\r\n\r\n\t\tthis._listen();\r\n\t\tthis.updatePageLinks();\r\n\t}\r\n\r\n\tnavigate(path: string, absolute: boolean = false): Navigo {\r\n\t\tlet to: string;\r\n\t\tpath = path || '';\r\n\t\tif (this._usePushState) {\r\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\r\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\r\n\t\t\tto = to.replace('/#test/', '/');\r\n\t\t\tthis._historyUpdate({}, '', to);\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t\telse if (typeof window !== 'undefined') {\r\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\r\n\t\t\tlet { location } = window;\r\n\t\t\tlocation.href = location.href\r\n\t\t\t\t.replace(/#$/, '')\r\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ton(routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(url: string, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(regex: RegExp, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\ton(options: { [url: string]: RouteFunc | NamedRoute }): Navigo;\r\n\ton(...args: any[]): Navigo {\r\n\t\tlet arg0 = args[0];\r\n\t\tlet arg1 = args[1];\r\n\t\tswitch (typeof arg0) {\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\r\n\t\t\t\tif (!this._notFoundHandler) {\r\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'object':\r\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\r\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (args.length < 2) break;\r\n\t\t\t\tif (arg0 === '/') {\r\n\t\t\t\t\tthis._defaultHandler = {\r\n\t\t\t\t\t\thandler: typeof arg1 === 'object' ? arg1.uses : arg1,\r\n\t\t\t\t\t\thooks: args[2],\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis._add(arg0, arg1, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(handler: RouteFunc): Navigo {\r\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\r\n\t\t\tthis._defaultHandler = null;\r\n\t\t}\r\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\r\n\t\t\tthis._notFoundHandler = null;\r\n\t\t}\r\n\t\tthis._routes = this._routes.reduce((result, r) => {\r\n\t\t\tif (r.handler !== handler) result.push(r);\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnotFound(handler: RouteFunc, hooks: Hooks): Navigo {\r\n\t\tthis._notFoundHandler = { handler, hooks };\r\n\t\treturn this;\r\n\t}\r\n\r\n\tresolve(current?: string) {\r\n\t\tlet c = current || this._cLoc();\r\n\t\tlet root = this._getRoot();\r\n\t\tlet url = c.replace(root, '');\r\n\r\n\t\tif (this._useHash) {\r\n\t\t\tconst exp = '^\\\\/';  // 单\\，编译报错 ^\\/\r\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\r\n\t\t}\r\n\r\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\r\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\r\n\t\tif (onlyURL.startsWith('/') === false) {\r\n\t\t\tonlyURL = '/' + onlyURL;\r\n\t\t}\r\n\r\n\t\tif (this._paused) return false;\r\n\r\n\t\tif (\r\n\t\t\tthis._lastRouteResolved &&\r\n\t\t\tonlyURL === this._lastRouteResolved.url &&\r\n\t\t\tGETParameters === this._lastRouteResolved.query\r\n\t\t) {\r\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\r\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\r\n\r\n\t\tlet manageHooks = (handler: Handler) => {\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\thooks: handler.hooks\r\n\t\t\t\t\t};\r\n\t\t\t\t\thandler.handler(GETParameters);\r\n\t\t\t\t}, handler.hooks);\r\n\t\t\t}, this._genericHooks);\r\n\t\t}\r\n\r\n\t\tif (matched === false) {\r\n\t\t\tif (this._defaultHandler && (\r\n\t\t\t\tonlyURL === '' ||\r\n\t\t\t\tonlyURL === '/' ||\r\n\t\t\t\tonlyURL === this._hash ||\r\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\r\n\t\t\t)) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._defaultHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._defaultHandler);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (this._notFoundHandler) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._notFoundHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._notFoundHandler);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tlet m = matched;\r\n\t\tif (m) {\r\n\t\t\tthis._callLeave();\r\n\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\turl: onlyURL,\r\n\t\t\t\tquery: GETParameters,\r\n\t\t\t\thooks: m.route.hooks,\r\n\t\t\t\tparams: m.params,\r\n\t\t\t\tname: m.route.name\r\n\t\t\t};\r\n\t\t\tlet handler = m.route.handler;\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tm.route.route instanceof RegExp ?\r\n\t\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\r\n\t\t\t\t\t\thandler(m.params, GETParameters);\r\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\r\n\t\t\t}, this._genericHooks, m.params);\r\n\t\t\treturn m;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._routes = [];\r\n\t\tthis._destroyed = true;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._genericHooks = null;\r\n\t\tclearTimeout(this.timout);\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\r\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePageLinks() {\r\n\t\t//var self = this;\r\n\t\tif (typeof document === 'undefined') return;\r\n\t\tthis._findLinks().forEach(link => {\r\n\t\t\tif (!link.hasListenerAttached) {\r\n\t\t\t\tlink.addEventListener('click', (e: any) => {\r\n\t\t\t\t\t// e: React.MouseEvent<HTMLElement>\r\n\t\t\t\t\tif ((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a') { return false; }\r\n\t\t\t\t\tvar location = this.getLinkPath(link);\r\n\r\n\t\t\t\t\tif (!this._destroyed) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlink.hasListenerAttached = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgenerate(name: string, data: any = {}) {\r\n\t\tlet result = this._routes.reduce((result, route) => {\r\n\t\t\tif (route.name === name) {\r\n\t\t\t\tresult = route.route.toString();\r\n\t\t\t\tfor (let key in data) {\r\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}, '');\r\n\r\n\t\treturn this._useHash ? this._hash + result : result;\r\n\t}\r\n\r\n\tlink(path: string) {\r\n\t\treturn this._getRoot() + path;\r\n\t}\r\n\r\n\tpause(status: boolean = true) {\r\n\t\tthis._paused = status;\r\n\t\tif (status) {\r\n\t\t\tthis._historyUpdateMethod = 'replaceState';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tthis.pause(false);\r\n\t}\r\n\r\n\thistoryAPIUpdateMethod(value: 'pushState' | 'replaceState') {\r\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\r\n\t\tthis._historyUpdateMethod = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdisableIfAPINotAvailable() {\r\n\t\tif (!Navigo.isPushStateAvailable()) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tlastRouteResolved() {\r\n\t\treturn this._lastRouteResolved;\r\n\t}\r\n\r\n\tgetLinkPath(link: any) {\r\n\t\treturn link.getAttribute('href');\r\n\t}\r\n\r\n\thooks(hooks: Hooks) {\r\n\t\tthis._genericHooks = hooks;\r\n\t}\r\n\r\n\tprivate _add(route: string | RegExp, handler: RouteFunc | NamedRoute, hooks: Hooks) {\r\n\t\tif (typeof route === 'string') {\r\n\t\t\troute = encodeURI(route);\r\n\t\t}\r\n\t\tthis._routes.push(\r\n\t\t\ttypeof handler === 'object' ?\r\n\t\t\t\t{\r\n\t\t\t\t\troute,\r\n\t\t\t\t\thandler: handler.uses,\r\n\t\t\t\t\tname: handler.as,\r\n\t\t\t\t\thooks: hooks || handler.hooks\r\n\t\t\t\t}\r\n\t\t\t\t:\r\n\t\t\t\t{\r\n\t\t\t\t\troute,\r\n\t\t\t\t\thandler,\r\n\t\t\t\t\tname: undefined,\r\n\t\t\t\t\thooks,\r\n\t\t\t\t}\r\n\t\t);\r\n\t\treturn this._add;\r\n\t}\r\n\r\n\tprivate _historyUpdate(data: any, title: string, url?: string) {\r\n\t\tswitch (this._historyUpdateMethod) {\r\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\r\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\r\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getRoot() {\r\n\t\tif (this.root === null) {\r\n\t\t\tlet cLoc = this._cLoc();\r\n\t\t\tlet cLocRoot = cLoc.split('?')[0];\r\n\t\t\tthis.root = Navigo.root(cLocRoot, this._routes);\r\n\t\t}\r\n\t\tlet root = this.root.replace('#test', '');\r\n\t\treturn root;\r\n\t}\r\n\r\n\tprivate _listen() {\r\n\t\tif (this._usePushState) {\r\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\r\n\t\t}\r\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\r\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cached = this._cLoc();\r\n\r\n\t\t\tlet check = () => {\r\n\t\t\t\tlet current = this._cLoc();\r\n\t\t\t\tif (cached !== current) {\r\n\t\t\t\t\tcached = current;\r\n\t\t\t\t\tthis.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\r\n\t\t\t\tthis.timout = setTimeout(check, 200);\r\n\t\t\t};\r\n\t\t\tcheck();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _cLoc() {\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\r\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\r\n\t\t\t//}\r\n\t\t\tlet { href } = window.location;\r\n\t\t\treturn Navigo.cleanUrl(href);\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate _findLinks() {\r\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\r\n\t}\r\n\r\n\tprivate _onLocationChange = () => {\r\n\t\tconsole.log('_onLocationChange');\r\n\t\tthis.resolve();\r\n\t}\r\n\r\n\tprivate _callLeave() {\r\n\t\tconst lastRouteResolved = this._lastRouteResolved;\r\n\t\tif (lastRouteResolved) {\r\n\t\t\tlet { params, hooks } = lastRouteResolved;\r\n\t\t\tif (hooks) {\r\n\t\t\t\tif (hooks.leave) {\r\n\t\t\t\t\thooks.leave(params);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n\ticon?: string;\r\n\troles?: {[uq:string]: string[]}\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","export function getObjPropIgnoreCase(obj:any, prop:string):any {\r\n\tif (!obj) return;\r\n\tif (!prop) return;\r\n\tlet keys = Object.keys(obj);\r\n\tprop = prop.toLowerCase();\r\n\tfor (let key of keys) {\r\n\t\tif (key.toLowerCase() === prop) return obj[key];\r\n\t}\r\n\treturn;\r\n}\r\n","import { env } from \"./env\";\r\n\r\nconst options:Intl.DateTimeFormatOptions = { \r\n\tweekday: 'long', \r\n\tyear: 'numeric', \r\n\tmonth: 'long', \r\n\tday: 'numeric' \r\n}\r\n\r\nexport function toLocaleDateString(date:Date) {\r\n\tif (!date) return '';\r\n\treturn date.toLocaleDateString('zh-cn', options);\r\n}\r\n\r\nexport const minute2020_01_01 = 26297280;  // 2020-1-1 到 1970-1-1 的毫秒数\r\nexport function dateFromMinuteId(id: number, timeZone?: number): Date {\r\n\tlet envTimezone = env.timeZone;\r\n\tlet m = (id / Math.pow(2, 20)) + (- envTimezone + (timeZone??envTimezone)) * 60;\r\n\treturn new Date((m + minute2020_01_01) * 60000);\r\n}\r\n\r\nexport function dateFromHourId(id: number, timeZone?: number): Date {\r\n\tlet envTimezone = env.timeZone;\r\n\tlet m = id + (- envTimezone + (timeZone??envTimezone));\r\n\treturn new Date((m + minute2020_01_01/60) * 60 * 60000);\r\n}\r\n","export function capitalCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\treturn parts.map(v => firstCharUppercase(v)).join('_');\r\n}\r\n\r\nexport function camelCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\tlet len = parts.length;\r\n\tparts[0] = firstCharLowercase(parts[0]);\r\n\tfor (let i=1; i<len; i++) {\r\n\t\tparts[1] = firstCharUppercase(parts[1]);\r\n\t}\r\n\treturn parts.join('_');\r\n}\r\n\r\nconst aCode = 'a'.charCodeAt(0);\r\nconst zCode = 'z'.charCodeAt(0);\r\nfunction firstCharUppercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= aCode && c <= zCode) {\r\n\t\treturn String.fromCharCode(c - 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\nconst ACode = 'A'.charCodeAt(0);\r\nconst ZCode = 'Z'.charCodeAt(0);\r\nfunction firstCharLowercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= ACode && c <= ZCode) {\r\n\t\treturn String.fromCharCode(c + 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\n","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\r\n}\r\n","import _ from 'lodash';\r\nimport { resLang, inputRes, InputRes } from 'tonwa-core';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy: string[], value: any): void;\r\n}\r\n\r\n//export type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value: any) => string[] | string;\r\n\r\nconst defaultInputRes: InputRes = resLang<InputRes>(inputRes);\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy: string[], value: any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }\r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: InputRes;\r\n    constructor(res?: InputRes) {\r\n        super();\r\n        this.res = res ?? defaultInputRes;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy: string[], value: any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: InputRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(this.res.min);\r\n        this.maxMsg = _.template(this.res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy: string[], value: any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy: string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({ min: this.min }));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({ max: this.max }));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy: string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem } from '../../schema';\r\nimport { ChangingHandler, ChangedHandler } from '../../../ui';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../../inputRules';\r\nimport { computed, makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps: FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n    protected defaultValue: any;\r\n    protected rules: Rule[];\r\n    protected readOnly: boolean;\r\n\r\n    disabled: boolean = false;\r\n    errors: string[] = [];\r\n    contextErrors: string[] = [];\r\n    get hasError(): boolean { return (this.errors.length + this.contextErrors.length) > 0 }\r\n    visible: boolean = null;\r\n    value: any = null;\r\n\r\n    constructor(context: Context, itemSchema: ItemSchema, fieldProps: FieldProps, children: React.ReactNode) {\r\n        makeObservable(this, {\r\n            errors: observable,\r\n            contextErrors: observable,\r\n            hasError: computed,\r\n            visible: observable,\r\n            value: observable,\r\n            disabled: observable,\r\n            isOk: computed,\r\n        });\r\n        this.context = context;\r\n        let { name } = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let { readOnly, disabled, visible } = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);\r\n        }\r\n        this.value = this.defaultValue = context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema { return this._itemSchema };\r\n    protected get ui(): UiItem { return this._ui };\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let { rules } = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy: string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    get isOk() {\r\n        return this.errors.length === 0;\r\n    }\r\n\r\n    setError(err: string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err: string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value: any): any { return value }\r\n\r\n    protected setElementValue(value: any) { }\r\n    protected setDataValue(value: any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value: any) {\r\n        if (this.isChanging === true) return;\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly(): boolean { return this.readOnly }\r\n    getDisabled(): boolean { return this.disabled }\r\n    getVisible(): boolean { return this.visible }\r\n    setReadOnly(value: boolean) { this.readOnly = value }\r\n    setDisabled(value: boolean) {\r\n        this.disabled = value;\r\n    }\r\n    setVisible(value: boolean) { this.visible = value }\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className(): string {\r\n        let fieldClass: string;\r\n        if (this.context.inNode === false && !(this._ui?.align)) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render(): JSX.Element;\r\n\r\n    protected renderBody(): JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let { discription, discriptionClassName } = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer((): JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let { form, inNode } = this.context;\r\n        if (inNode === true || this._ui?.align) return this.render();\r\n        let label: any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label(): string {\r\n        let label: any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet(): JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let { Templet } = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList: string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let { inNode } = this.context;\r\n        let tag = inNode === true ? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag,\r\n            {\r\n                key: err,\r\n                className: 'text-danger d-inline-block my-2 ms-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { UiTextItem, StringSchema, ItemSchema } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\nimport { Widget } from './widget';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    hasFocus: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\thasFocus: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {\r\n\t\tif (this.ui) {\r\n\t\t\tlet {placeholder} = this.ui;\r\n\t\t\tif (placeholder) return placeholder;\r\n\t\t\tlet {label} = this.ui;\r\n\t\t\tif (label) return label;\r\n\t\t}\r\n\t\treturn this.name\r\n\t}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.onInputChange(evt);\r\n\t\t\tthis.checkRules();\r\n\t\t\tthis.context.checkContextRules();\r\n\t\t\tthis.hasFocus = false;\r\n\t\t});\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.context.removeErrorWidget(this);\r\n\t\t\tthis.context.clearErrors();\r\n\t\t\tthis.hasFocus = true;\r\n\t\t});\r\n\t\tsetTimeout(() => {\r\n\t\t\tconsole.log('focus and select');\r\n\t\t\tthis.input.focus();\r\n\t\t\tthis.input.select();\r\n\t\t}, 10)\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n\t\tthis.onInputChange(evt);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={typeof this.placeholder === 'string'? this.placeholder : undefined}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { NumBaseSchema } from '../../schema';\r\nimport { RuleInt, RuleNum } from '../../inputRules';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n            new RuleInt(res, min, max) :\r\n            new RuleNum(res, min, max)\r\n        );\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n        switch (typeof value) {\r\n            default: return;\r\n            case 'undefined': return;\r\n            case 'number': return value;\r\n            case 'string':\r\n                if ((value as string).trim().length === 0) return;\r\n                return Number(value);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem { return this._ui as UiCheckItem };\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let { trueValue, falseValue } = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value: any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value: boolean) { this.input.readOnly = this.readOnly = value }\r\n    setDisabled(value: boolean) { this.input.disabled = this.disabled = value }\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true ? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let { align } = this._ui as UiCheckItem;\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input) => this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue}\r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true || align) {\r\n            let cnAlign: string;\r\n            if (!align) {\r\n                cnAlign = '';\r\n            }\r\n            else {\r\n                cnAlign = ` justify-content-${align} mb-3 `;\r\n            }\r\n            return <label className={cn + cnAlign}>\r\n                {input} {(this.ui && this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn + ' h-100'}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-start ms-2\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiSelect } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    readOnly: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\treadOnly: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { runInAction } from 'mobx';\r\n\r\nconst none = <small className=\"text-muted\">[无]</small>;\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem { return this._ui as UiIdItem };\r\n\r\n    setReadOnly(value: boolean) { this.readOnly = value }\r\n    setDisabled(value: boolean) { this.disabled = value }\r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n        let id = await pickId(this.context, this.name, this.value);\r\n        runInAction(() => {\r\n            this.setDataValue(id);\r\n            this.clearError();\r\n            this.clearContextError();\r\n            this.checkRules();\r\n        });\r\n    }\r\n\r\n    setValue(value: any) {\r\n        super.setValue(value);\r\n    }\r\n\r\n    render() {\r\n        let placeholder: string | JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn: any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || none;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = none; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\nimport { runInAction } from 'mobx';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t})\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n\t\t\tawait this.context.submit(name);\r\n\t\t\treturn;\r\n        }\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n\t\trunInAction(() => {\r\n\t\t\tthis.context.setError(name, ret);\r\n\t\t});\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string|JSX.Element;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = (type==='submit' && hasError) || this.disabled;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed, makeObservable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\n\r\nexport abstract class Context {\r\n    private subContexts:{[name:string]:{[rowKey:string]:Context}};\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\r\n    readonly widgets: {[name:string]: Widget} = {};\r\n    readonly rules: ContextRule[];\r\n\treadonly isRow: boolean;\r\n\t\r\n    errors: string[] = [];\r\n    errorWidgets:Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\terrorWidgets: observable,\r\n\t\t\thasError: computed,\r\n\t\t});\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let {rules} = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data():any;\r\n    abstract getItemSchema(itemName:string):ItemSchema;\r\n    abstract getUiItem(itemName:string):UiItem;\r\n    get arrName():string {return undefined}\r\n    getValue(itemName:string):any {return this.initData[itemName]}\r\n    setValue(itemName:string, value:any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let {onButtonClick} = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName:string, error:string) {\r\n\t\trunInAction(() => {\r\n\t\t\tlet widget = this.widgets[itemName];\r\n\t\t\tif (widget === undefined) return;\r\n\t\t\twidget.setContextError(error);\r\n\t\t\tthis.addErrorWidget(widget);\t\r\n\t\t})\r\n    }\r\n\r\n    clearContextErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearContextError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError():boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    get hasError():boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.errors.splice(0);\r\n\t\t\tthis.errorWidgets.splice(0);\r\n\t\t\tthis.clearContextErrors();\t\r\n\t\t});\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let {errors} = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ms-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed:number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n\treadonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\t\r\n    constructor(parentContext:Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr:UiArr;\r\n        let {uiSchema} = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let {items} = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let {items} = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName():string {return this.arrSchema.name}\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData():any {return this.parentContext.data;}\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form:Form, inNode:boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data():any {return this.form.data}\r\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        let {uiSchema} = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let {items} = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n\tlet ui = parentContext.getUiItem(name) as UiArr;\r\n\tlet {onDeleted, onRestored} = ui;\r\n    let arrLabel:string|JSX.Element = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n\t\t\t\t\t\tif ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n\t\t\t\t\t\tif (onRestored) onRestored(row);\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n\t\t\t\t\t\tif (p>=0) data.splice(p, 1);\r\n\t\t\t\t\t\tif (onDeleted) onDeleted(row);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { tonwa } from 'tonwa-core';\r\n//import { nav } from '../nav';\r\n\r\nexport interface ImageProps {\r\n\tsrc: string;\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n\taltImage?: string;\r\n}\r\n\r\n// src = .src, 表示fontawesome Icon\r\nexport function Image(props: ImageProps) {\r\n\tlet { className, style, src, altImage } = props;\r\n\tlet icon: string;\r\n\tif (src) {\r\n\t\tif (src.indexOf('.') !== 0) {\r\n\t\t\tif (src.startsWith(':') === true) {\r\n\t\t\t\tsrc = tonwa.resUrl + src.substr(1);\r\n\t\t\t}\r\n\t\t\treturn <img src={src} className={className} alt=\"img\"\r\n\t\t\t\tstyle={style}\r\n\t\t\t\tonError={evt => {\r\n\t\t\t\t\tif (altImage) evt.currentTarget.src = altImage;\r\n\t\t\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t\t\t}} />;\r\n\t\t}\r\n\t\ticon = src.substr(1);\r\n\t}\r\n\telse {\r\n\t\ticon = 'file-o'\r\n\t}\r\n\treturn <span className={classNames(className, 'image-none')} style={style}>\r\n\t\t<i className={'fa fa-' + icon} />\r\n\t</span>;\r\n}\r\n","export function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n\tstyle?: React.CSSProperties,\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, style, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)}\r\n\t\t\tstyle={style}\r\n\t\t\tonClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string | JSX.Element;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\n//import { nav } from '../nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { LMR } from './simple';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n    fileName: string = null;\r\n\r\n    constructor(props: ResUploaderProps) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            fileName: observable,\r\n        });\r\n    }\r\n\r\n    buildFormData(): FormData {\r\n        let { maxSize } = this.props;\r\n        if (maxSize === undefined || maxSize <= 0)\r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files: FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i = 0; i < len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n        return data;\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData): Promise<string | { error: any }> => {\r\n        let resUrl = tonwa.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            tonwa.nav.startWait();\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return { error: err };\r\n        }\r\n        finally {\r\n            tonwa.nav.endWait();\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let { onFilesChange } = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names: string[] = [];\r\n        for (let i = 0; i < len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let { className, multiple, label } = this.props;\r\n        return <div>\r\n            <label className=\"btn btn-outline-success\">\r\n                {label || '选择文件'}\r\n                <input\r\n                    className={className}\r\n                    ref={t => this.fileInput = t}\r\n                    onChange={this.onFilesChange}\r\n                    type='file' name='file'\r\n                    multiple={multiple} style={{ display: 'none' }} />\r\n            </label>\r\n            &nbsp;\r\n            {this.fileName}\r\n        </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size: number, pointLength: number = 2, units?: string[]) {\r\n    var unit;\r\n    units = units || ['B', 'K', 'M', 'G', 'TB'];\r\n    while ((unit = units.shift()) && size > 1024) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed(pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw';\r\n    onSaved?: (imageId: string) => Promise<void>;\r\n    imageTypes?: string[];\r\n}\r\n\r\nconst xlargeSize = 1600;\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n    private static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\r\n    private imgBaseSize: number;\r\n    private imageTypes: string[];\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n\r\n    file: File = null;\r\n    desImgWidth: number = null;\r\n    desImgHeight: number = null;\r\n    desImgSize: number = null;\r\n    srcImgWidth: number = null;\r\n    srcImgHeight: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    srcImage: string = null;\r\n    desImage: string = null;\r\n    fileError: string = null;\r\n    uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            file: observable,\r\n            desImgWidth: observable,\r\n            desImgHeight: observable,\r\n            desImgSize: observable,\r\n            srcImgWidth: observable,\r\n            srcImgHeight: observable,\r\n            isChanged: observable,\r\n            resId: observable,\r\n            enableUploadButton: observable,\r\n            srcImage: observable,\r\n            desImage: observable,\r\n            fileError: observable,\r\n            uploaded: observable,\r\n        });\r\n        this.resId = props.id;\r\n        this.imageTypes = props.imageTypes || ImageUploader.imageTypes;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos + 1).toLowerCase();\r\n            if (this.imageTypes.indexOf(this.suffix) < 0) {\r\n                this.fileError = `图片类型必须是 ${this.imageTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n                this.srcImage = reader.result as string;\r\n                switch (this.suffix) {\r\n                    default:\r\n                        await this.setSize(this.props.size);\r\n                        break;\r\n                    case 'svg':\r\n                        this.imgBaseSize = mediumSize;\r\n                        this.desImgSize = this.srcImage.length;\r\n                        this.desImage = this.srcImage;\r\n                        break;\r\n                }\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n                this.imgBaseSize = largeSize; break;\r\n            case 'xl':\r\n                this.imgBaseSize = xlargeSize; break;\r\n            case 'raw':\r\n                this.imgBaseSize = -1; break;\r\n        }\r\n        this.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = (): Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // 默认按比例压缩\r\n                let { width, height } = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n                let w: number, h: number;\r\n                if (this.imgBaseSize < 0) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 默认图片质量为0.7\r\n                //生成canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // 创建属性节点\r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix, quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 3 * 1024 * 1024) {\r\n                    this.fileError = \"图片大于3M，无法上传\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string): Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let { error } = ret;\r\n            let type = typeof error;\r\n            let err: string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let { onSaved } = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        tonwa.nav.push(<Page header=\"原图\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{ maxWidth: '100%' }} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{ caption: '小图', size: 'sm' }];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({ caption: '中图', size: 'md' });\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({ caption: '大图', size: 'lg' });\r\n        }\r\n        if (this.srcImgHeight > xlargeSize || this.srcImgWidth > xlargeSize) {\r\n            arr.push({ caption: '超大图', size: 'xl' });\r\n            arr.push({ caption: '原图', size: 'raw' });\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let { caption, size } = v;\r\n            return <label key={index} className=\"me-3\"><input type=\"radio\" name=\"size\"\r\n                onChange={() => this.setSize(size as any)}\r\n                defaultChecked={index === 0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let { label } = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改图片'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v => this.resUploader = v}\r\n                            multiple={false} maxSize={2048}\r\n                            label=\"选择图片文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {this.imageTypes.join(', ')} 格式图片。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                        {\r\n                            this.uploaded === true ?\r\n                                <div className=\"text-success p-2\">上传成功！</div>\r\n                                :\r\n                                this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                    <div className=\"me-5\">\r\n                                        {this.levelDiv()}\r\n                                        <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\r\n                                            &nbsp; &nbsp;\r\n                                            文件大小：{formatSize(this.desImgSize)}\r\n                                        </div>\r\n                                    </div>\r\n                                    <button className=\"btn btn-primary\"\r\n                                        disabled={!this.enableUploadButton}\r\n                                        onClick={this.upload}>上传</button>\r\n                                </div>\r\n                        }\r\n                        right={this.desImage &&\r\n                            <button className=\"btn btn-link btn-sm text-right mb-3\" onClick={this.showOrgImage}>\r\n                                原图大小: {formatSize(this.file.size)}<br />\r\n                                分辨率：{this.srcImgWidth} x {this.srcImgHeight}\r\n                            </button>\r\n                        }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\"\r\n                    style={{\r\n                        border: (this.uploaded === true ? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{ maxWidth: '100%' }} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId: string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n    private static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n\r\n    content: string = null;\r\n    file: File = null;\r\n    fileSize: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    fileError: string = null;\r\n    uploaded: boolean = false;\r\n    uploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            content: observable,\r\n            file: observable,\r\n            fileSize: observable,\r\n\r\n            isChanged: observable,\r\n            resId: observable,\r\n            enableUploadButton: observable,\r\n            fileError: observable,\r\n            uploaded: observable,\r\n            uploading: observable,\r\n        });\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos + 1).toLowerCase();\r\n            if (AudioUploader.audioTypes.indexOf(this.suffix) < 0) {\r\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n                this.content = reader.result as string;\r\n                this.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string): Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        this.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let { error } = ret;\r\n            let type = typeof error;\r\n            let err: string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let { onSaved } = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let { label } = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改文件'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v => this.resUploader = v}\r\n                            multiple={false} maxSize={2048}\r\n                            label=\"选择音频文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <LMR left=\r\n                {\r\n                    this.uploaded === true ?\r\n                        <div className=\"text-success p-2\">上传成功！</div>\r\n                        :\r\n                        this.uploading === true ?\r\n                            <div className=\"m-3\"><Loading /></div>\r\n                            :\r\n                            this.file && this.content && <div className=\"m-3\">\r\n                                <div className=\"mb-3\">\r\n                                    文件大小：{formatSize(this.fileSize)}\r\n                                </div>\r\n                                <button className=\"btn btn-primary\"\r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}>上传</button>\r\n                            </div>\r\n                }\r\n            />\r\n        </Page>;\r\n    }\r\n}\r\n","import { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Image } from '../image';\r\nimport { Edit } from './edit';\r\nimport { FieldRule } from '../inputRules';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport abstract class ItemEdit {\r\n    protected edit: Edit;\r\n    protected name: string;\r\n    protected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema { return this._itemSchema }\r\n    protected _uiItem: UiItem;\r\n    get uiItem(): UiItem { return this._uiItem }\r\n    value: any;\r\n    label: string | JSX.Element;\r\n    get editInRow(): boolean { return false; }\r\n    protected newValue: any;\r\n\r\n    error: string = null;\r\n    isChanged: boolean = false;\r\n\r\n    constructor(edit: Edit, itemSchema: ItemSchema, uiItem: UiItem, label: string | JSX.Element, value: any) {\r\n        makeObservable(this, {\r\n            error: observable,\r\n            isChanged: observable,\r\n        });\r\n        this.edit = edit;\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let { name } = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n    }\r\n\r\n    init() {\r\n    }\r\n\r\n    async start(): Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart(): Promise<any>;\r\n\r\n    async end(): Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n    renderContent() {\r\n        let { name, type } = this._itemSchema;\r\n        let divValue: any;\r\n        let uiItem = this._uiItem;\r\n        let label: string | JSX.Element, labelHide: boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n            label = uiItem.label;\r\n            labelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n                    if (this.value !== undefined) divValue = templet(this.value);\r\n                }\r\n                else {\r\n                    divValue = { templet };\r\n                }\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let { list } = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value ?\r\n                        <b>{this.value}</b>\r\n                        :\r\n                        <small className=\"text-muted\">[{labelHide === true ? label : '无'}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n        }\r\n        return divValue;\r\n    }\r\n\r\n    protected async internalEnd(): Promise<void> { tonwa.nav.pop(1) }\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let { rules } = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule: FieldRule, value: any): string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { ItemSchema, UiImageItem, UiItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\n//import { nav } from '../../nav';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { Edit } from './edit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem { return this._uiItem as UiImageItem }\r\n    resId: string = null;\r\n\r\n    constructor(edit: Edit, itemSchema: ItemSchema, uiItem: UiItem, label: string | JSX.Element, value: any) {\r\n        super(edit, itemSchema, uiItem, label, value);\r\n        makeObservable(this, {\r\n            resId: observable\r\n        })\r\n    }\r\n\r\n    protected async internalStart(): Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            tonwa.nav.push(React.createElement(this.page, { resolve: resolve, reject: reject }), () => reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let size: any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}>保存</button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader\r\n            label={'更改' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId): Promise<void> => { resolve(resId); return; }} />;\r\n        /*\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div>上传图片：</div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c me-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\">图片预览</div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n\r\n\timageSrc: string = null;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\timageSrc: observable,\r\n\t\t})\r\n\t}\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(undefined, this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import { Widget } from './widget';\r\nimport { UiPick } from '../../schema';\r\nimport { runInAction } from 'mobx';\r\n\r\nexport class PickWidget extends Widget {\r\n    protected get ui(): UiPick { return this._ui as UiPick };\r\n\r\n    setReadOnly(value: boolean) { this.readOnly = value }\r\n    setDisabled(value: boolean) { this.disabled = value }\r\n\r\n    protected onClick = async () => {\r\n        let pick = this.ui?.pick;\r\n        if (pick === undefined) {\r\n            alert('no pick defined!');\r\n            return;\r\n        }\r\n        let id = await pick.pick();\r\n        runInAction(() => {\r\n            this.setDataValue(id);\r\n            this.clearError();\r\n            this.clearContextError();\r\n            this.checkRules();\r\n        });\r\n    }\r\n\r\n    setValue(value: any) {\r\n        super.setValue(value);\r\n    }\r\n\r\n    render() {\r\n        let pick = this.ui?.pick;\r\n        if (pick === undefined) {\r\n            return <span>no pick defined!</span>;\r\n        }\r\n        return <div className={this.className + ' cursor-pointer '} onClick={this.onClick}>{pick.ref()}</div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\nimport { PickWidget } from './pickWidget';\r\n\r\ninterface WidgetFactory {\r\n    widget?: TypeWidget;\r\n    dataTypes?: DataType[];\r\n};\r\n\r\nconst stringWidget: WidgetFactory = {\r\n    dataTypes: ['integer', 'number', 'string'],\r\n    widget: TextWidget\r\n};\r\n\r\nconst widgetFactories: { [type: string]: WidgetFactory } = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    pick: {\r\n        dataTypes: ['id'],\r\n        widget: PickWidget,\r\n    },\r\n    text: stringWidget,\r\n    string: stringWidget,\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n    },\r\n    tagSingle: {\r\n        dataTypes: ['integer'],\r\n        widget: TagSingleWidget\r\n    },\r\n    tagMulti: {\r\n        dataTypes: ['string'],\r\n        widget: TagMultiWidget\r\n    },\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children: React.ReactNode, fieldProps?: FieldProps): JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let { name, type } = itemSchema;\r\n    switch (type) {\r\n        case 'arr':\r\n            let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n            return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n        default:\r\n            break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\r\n    function getTypeWidget(t: DataType): TypeWidget {\r\n        switch (t) {\r\n            default: return TextWidget;\r\n            case 'id': return IdWidget;\r\n            case 'integer': return UpdownWidget;\r\n            case 'number': return NumberWidget;\r\n            case 'string': return TextWidget;\r\n            case 'date': return DateWidget;\r\n            case 'boolean': return CheckBoxWidget;\r\n            case 'button':\r\n            case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) {\r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let { widget: widgetType, hiden } = ui;\r\n        if (hiden === true) return null;\r\n        switch (widgetType) {\r\n            default:\r\n                if (widgetType !== undefined) {\r\n                    let widgetFactory = widgetFactories[widgetType];\r\n                    if (!widgetFactory) {\r\n                        debugger;\r\n                        throw new Error(`unknown widget ${widgetType}`);\r\n                    }\r\n                    typeWidget = widgetFactory.widget;\r\n                }\r\n                if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n                break;\r\n            case 'custom':\r\n                typeWidget = (ui as UiCustom).WidgetClass;\r\n                break;\r\n            case 'group':\r\n                return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n\r\n    let { widgets } = context;\r\n    let widget = widgets[name];\r\n    if (!widget) {\r\n        widget = new typeWidget(context, itemSchema, fieldProps, children);\r\n        widget.init();\r\n        widgets[name] = widget;\r\n    }\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { observable, IReactionDisposer, autorun } from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { InputRes, inputRes, resLang } from 'tonwa-core';\r\nimport { Schema, ItemSchema, ArrSchema, UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\n\r\nexport type FormButtonClick = (name: string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name: string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n    fieldLabelAlign?: 'left' | 'center' | 'right';\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext: FormContext) => void;\r\n    res?: InputRes;\r\n\r\n    Container?: (content: JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label: string | JSX.Element, content: JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: { [name: string]: ItemSchema };\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: InputRes;\r\n    formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data: any;\r\n\r\n    readonly Container: (content: JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label: any, content: JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n\r\n    constructor(props: FormProps) {\r\n        super(props);\r\n        let { schema, uiSchema,\r\n            Container, FieldContainer, FieldClass,\r\n            ButtonClass, res,\r\n        } = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass !== undefined && FieldClass !== '' && FieldClass !== null ? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent(): any {\r\n        this.initData(this.props.formData);\r\n        let { children } = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof (Templet) === 'function' ? Templet(this.data) : Templet;\r\n        }\r\n\r\n        if (!this.formContext) {\r\n            this.formContext = new FormContext(this, false);\r\n        }\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let { items } = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data: any, formData: any): any {\r\n        let { name, type } = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem: ArrSchema = itemSchema as ArrSchema;\r\n        let { arr: arrItems } = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict: any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val: any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr: any[] = [];\r\n        for (let row of val) {\r\n            let { $isSelected, $isDeleted } = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let { formData } = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let { name, type } = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let { arr: arrItems } = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let { $source } = row;\r\n            if ($source === undefined) continue;\r\n            let { $isSelected, $isDeleted } = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let { beforeShow } = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            {React.createElement(this.formContext.renderErrors)}\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName: string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let { onButtonClick } = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content: JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e => e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label: string | JSX.Element, content: JSX.Element): JSX.Element => {\r\n        let { fieldLabelSize, fieldLabelAlign } = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView: any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n                let cnAlign: string;\r\n                switch (fieldLabelAlign) {\r\n                    case 'right': cnAlign = 'text-sm-right'; break;\r\n                    case 'center': cnAlign = 'text-sm-center'; break;\r\n                }\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label', cnAlign)}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"mb-3 row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"mb-3\">\r\n            {label === null ? null : <label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass: string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes: InputRes = resLang<InputRes>(inputRes);\r\n\r\n    ArrContainer = (label: any, content: JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content: JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport interface InputOptions {\r\n    type: string;\r\n    min?: number;\r\n    max?: number;\r\n    step?: number;\r\n}\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem { return this._uiItem as UiTextItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve, reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    protected inputOptions(): InputOptions {\r\n        return {\r\n            type: 'text',\r\n        }\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let onSave = () => {\r\n            this.verifyValue();\r\n            if (!this.error) {\r\n                let val = this.newValue;\r\n                resolve(val);\r\n            }\r\n        }\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n            if (evt.keyCode === 13) onSave();\r\n        }\r\n        let { type, max, min, step } = this.inputOptions();\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <input type={type}\r\n                    onChange={this.onChange}\r\n                    onKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\"\r\n                    defaultValue={this.value} min={min} max={max} step={step} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio { return this._uiItem as UiRadio }\r\n\r\n    init() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem === undefined ? undefined : this._uiItem.defaultValue;\r\n        }\r\n    }\r\n\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve: resolve, reject: reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let { name } = this.itemSchema;\r\n        let { list } = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={() => {\r\n                this.verifyValue();\r\n                if (!this.error) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        let content = list ?\r\n            list.map((v, index: number) => {\r\n                let { title, value } = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value}\r\n                        onClick={() => this.onChange(value)}\r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect { return this._uiItem as UiSelect }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve: resolve, reject: reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let { list } = this.uiItem;\r\n        let content = list ?\r\n            list.map((v, index: number) => {\r\n                let { title, value } = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={() => { this.onChange(value); resolve(this.newValue) }}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem { return this._uiItem as UiIdItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let { pickId } = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd(): Promise<void> { }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'更改' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: { [index: number]: HTMLInputElement } = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n\tget uiItem(): UiTag { return this._uiItem as UiTag };\r\n\r\n\tinit() {\r\n\t\tif (this.value === undefined) {\r\n\t\t\tthis.value = this._uiItem === undefined ? undefined : this._uiItem.defaultValue;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected async internalStart(): Promise<any> {\r\n\t\treturn new Promise<any>((resolve, reject) => {\r\n\t\t\tlet element = React.createElement(this.page, { resolve: resolve, reject: reject });\r\n\t\t\ttonwa.nav.push(element, reject);\r\n\t\t});\r\n\t}\r\n\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs(): JSX.Element;\r\n\tprivate page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n\t\tlet { resolve } = props;\r\n\t\tlet right = <button\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center me-2\"\r\n\t\t\tdisabled={!this.isChanged}\r\n\t\t\tonClick={() => {\r\n\t\t\t\tthis.verifyValue();\r\n\t\t\t\tif (!this.error) resolve(this.newValue);\r\n\t\t\t}}>保存</button>;\r\n\t\t/*\r\n\t\tlet content = list?\r\n\t\t\tlist.map((v, index:number) => {\r\n\t\t\t\tlet {name:itemName, id} = v;\r\n\t\t\t\treturn <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n\t\t\t\t\t<input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n\t\t\t\t\t\tdefaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n\t\t\t\t</label></div>;\r\n\t\t\t})\r\n\t\t\t:\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n\t\treturn <Page header={'更改' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n\t\t</Page>;\r\n\t})\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType: 'radio' | 'checkbox' = 'radio';\r\n\tprotected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet { currentTarget } = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n\t\tthis.newValue = Number(currentTarget.value);\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\r\n\tprotected renderInputs(): JSX.Element {\r\n\t\tlet { valuesView } = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType: 'radio' | 'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values: string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n\t\tthis.newValue = values.join('|');\r\n\t\t//this.newValue = value;\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs(): JSX.Element {\r\n\t\tlet { valuesView } = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class TextAreaItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem { return this._uiItem as UiTextItem }\r\n    protected async internalStart(): Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, { resolve, reject });\r\n            tonwa.nav.push(element, reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props: { resolve: (value: any) => void, reject: (resean?: any) => void }): JSX.Element => {\r\n        let { resolve } = props;\r\n        let onSave = () => {\r\n            this.verifyValue();\r\n            if (!this.error) {\r\n                let val = this.newValue;\r\n                resolve(val);\r\n            }\r\n        }\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n            // if (evt.keyCode === 13) onSave();\r\n        }\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <textarea\r\n                    onChange={this.onChange}\r\n                    onKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\"\r\n                    defaultValue={this.value}\r\n                    rows={6} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import { UiCheckItem } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class CheckBoxItemEdit extends ItemEdit {\r\n\tprivate input: HTMLInputElement;\r\n    get uiItem(): UiCheckItem {return this._uiItem as UiCheckItem}\r\n\tget editInRow(): boolean {return true;}\r\n    protected async internalStart():Promise<any> {\r\n\t\tif (!this.input) return;\r\n\t\tlet uiItem = this.uiItem;\r\n\t\tif (uiItem === undefined) return this.input.checked;\r\n\t\tlet {checked} = this.input;\r\n\t\treturn this.getValue(checked);\r\n    }\r\n\tasync end():Promise<any> {}\r\n\trenderContent() {\r\n\t\tlet {readOnly} = this.uiItem;\r\n\t\tlet disabled = readOnly === true;\r\n\t\tlet onChange:any;\r\n\t\tif (readOnly !== true) onChange = this.onChange;\r\n\t\treturn <input ref={r => this.input=r} type=\"checkbox\" \r\n\t\t\tdefaultChecked={this.value} disabled={disabled}\r\n\t\t\tonChange={onChange} />\r\n\t}\r\n\r\n\tprivate getValue(checked: boolean) {\r\n\t\tlet {trueValue, falseValue} = this.uiItem;\r\n        return checked === true? (trueValue??true) : (falseValue??false);\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = this.getValue(evt.target.checked);\r\n        let preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t\tthis.edit.onItemChanged(this, this.newValue);\r\n    }\r\n}\r\n","import { UiRange } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class RangeItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiRange).min\r\n\t\t\tmax = (this._uiItem as UiRange).max\r\n\t\t\tstep = (this._uiItem as UiRange).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'range',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import { UiNumberItem } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class NumberItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiNumberItem).min\r\n\t\t\tmax = (this._uiItem as UiNumberItem).max\r\n\t\t\tstep = (this._uiItem as UiNumberItem).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'number',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\nimport { TextAreaItemEdit } from './textAreaItemEdit';\r\nimport { CheckBoxItemEdit } from './checkBoxItemEdit';\r\nimport { RangeItemEdit } from './rangeItemEdit';\r\nimport { NumberItemEdit } from './numberItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue:any, preValue:any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder:JSX.Element;\r\n    private bottomBorder:JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep:JSX.Element;\r\n\tprivate uiSchema: {[name:string]: UiItem};\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let {topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema} = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        //if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n\t\tthis.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let {schema} = this.props;\r\n\t\tlet sep:any;\r\n        return <div>\r\n\t\t\t{this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n\t\t\t\tlet {stopEdit} = this.props;\r\n\t\t\t\tlet {name} = itemSchema;\r\n\t\t\t\tlet uiItem = this.uiSchema===undefined? undefined : this.uiSchema[name];\r\n\t\t\t\tlet label:string|JSX.Element, labelHide:any;\r\n\t\t\t\tif (uiItem !== undefined) {\r\n\t\t\t\t\tlabel = uiItem.label || name;\r\n\t\t\t\t\tlabelHide = uiItem.labelHide;\r\n\t\t\t\t};\r\n\t\t\t\tlet value = this.props.data[name];\r\n\t\t\t\tlet itemEdit = createItemEdit(this, itemSchema, uiItem, label, value);\r\n\t\t\t\tlet rowContainerClassName = this.rowContainerClassName;\r\n\t\t\t\tlet {editInRow} = itemEdit;\r\n\t\t\t\tif (editInRow === false) {\r\n\t\t\t\t\tif (stopEdit !== true) editInRow = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (editInRow === false) rowContainerClassName += ' cursor-pointer';\r\n\r\n\t\t\t\tlet {required} = itemSchema;\r\n\t\t\t\tlet requireFlag = required===true && <span className=\"text-danger\">*</span>;\r\n\t\t\t\tlet divLabel:any, cn:string = 'flex-fill d-flex ';\r\n\t\t\t\tif (labelHide === true) {\r\n\t\t\t\t\tdivLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdivLabel = <div>{label} {requireFlag}</div>;\r\n\t\t\t\t\tcn += 'justify-content-end';\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = <React.Fragment key={index}>\r\n\t\t\t\t\t{sep}\r\n\t\t\t\t\t<div className={'d-flex align-items-center' + rowContainerClassName} \r\n\t\t\t\t\t\tonClick={async ()=>await this.rowClick(itemEdit)}>\r\n\t\t\t\t\t\t{divLabel}\r\n\t\t\t\t\t\t<div className={cn}>{\r\n\t\t\t\t\t\t\titemEdit===undefined? undefined: itemEdit.renderContent()\r\n\t\t\t\t\t\t}</div>\r\n\t\t\t\t\t\t{editInRow === false && <div className=\"w-2c text-right\"><i className=\"fa fa-angle-right\" /></div>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>;\r\n\t\t\t\tsep = this.sep;\r\n\t\t\t\treturn ret;\r\n\t\t\t})}\r\n\t\t\t{this.bottomBorder}\r\n\t\t</div>;\r\n    }\r\n\r\n\tasync onItemChanged(itemEdit:ItemEdit, newValue:any) {\r\n\t\tlet {itemSchema, uiItem, value} = itemEdit;\r\n\t\tthis.props.data[itemSchema.name] = newValue;\r\n        let {onItemChanged, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n\t\tif (onItemChanged === undefined) {\r\n\t\t\talert(`${itemSchema.name} value changed, new: ${newValue}, pre: ${value}`);\r\n\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n\t\t\t//this.props.data[itemSchema.name] = changeValue;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait onItemChanged(itemSchema, newValue, value);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rowClick = async (itemEdit:ItemEdit) => {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\talert('item has no edit');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {itemSchema, uiItem, value, editInRow} = itemEdit;\r\n\t\tif (editInRow === true) return;\r\n        let {onItemChanged, onItemClick, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n        let changeValue:any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以移到这里来\r\n\t\t\t\tthis.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n\t\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // 如果直接back，会触发reject，就到这里了\r\n\t\t\tconsole.log('no value changed');\r\n\t\t\tconsole.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any):ItemEdit {\r\n\tlet ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n\t\t\tcase 'text': itemEdit = StringItemEdit; break;\r\n\t\t\tcase 'textarea': itemEdit = TextAreaItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\tcase 'select': itemEdit = SelectItemEdit; break;\r\n\t\t\tcase 'range': itemEdit = RangeItemEdit; break;\r\n\t\t\tcase 'number':\r\n\t\t\tcase 'updown': itemEdit = NumberItemEdit; break;\r\n\t\t\tcase 'checkbox': itemEdit = CheckBoxItemEdit; break;\r\n            case 'radio': \r\n\t\t\t\tie = new RadioItemEdit(edit, itemSchema, uiItem as UiRadio, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagSingle':\r\n\t\t\t\tie = new TagSingleItemEdit(edit, itemSchema, uiItem as UiTagSingle, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagMulti':\r\n\t\t\t\tie = new TagMultiItemEdit(edit, itemSchema, uiItem as UiTagMulti, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t}\r\n\tif (ie === undefined) {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\tswitch (itemSchema.type) {\r\n\t\t\t\tcase 'string': itemEdit = StringItemEdit; break;\r\n\t\t\t\tcase 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\t\tcase 'boolean': itemEdit = CheckBoxItemEdit; break;\r\n\t\t\t\tcase 'number':\r\n\t\t\t\tcase 'integer': itemEdit = RangeItemEdit; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemEdit === undefined) return;\r\n\t\tie = new itemEdit(edit, itemSchema, uiItem, label, value);\r\n\t}\r\n\tie.init();\r\n\treturn ie;\r\n}\r\n","import { IObservableArray, computed, makeObservable } from 'mobx';\r\nimport { IPageItems } from '../../tool/IPageItems';\r\nimport { List } from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n\t\tmakeObservable(this, {\r\n\t\t\tloading: computed,\r\n\t\t});\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as IPageItems<any>).items;\r\n    }\r\n    get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as IPageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import classNames from 'classnames';\r\nimport { uid } from 'tonwa-core';\r\nimport { ListBase } from './base';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item: any, index: number): JSX.Element => {\r\n        let { className, key } = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key === undefined ? index : key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable, IObservableArray, isObservableArray, observe, makeObservable } from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { uid } from 'tonwa-core';\r\nimport { ListBase } from './base';\r\nimport { List } from './index';\r\nimport { IPageItems } from '../../tool';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    _items: SelectableItem[] = null;\r\n    private inputItems: { [uid: string]: HTMLInputElement } = {};\r\n\r\n    constructor(list: List) {\r\n        super(list);\r\n        makeObservable(this, {\r\n            _items: observable\r\n        })\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }\r\n\r\n    private listenArraySplice() {\r\n        let { items } = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray: any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as IPageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {\r\n                if (change.type === 'splice') {\r\n                    let { index, removedCount, added } = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false,\r\n                            item: v,\r\n                            labelId: uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let { items, isItemSelected, selectedItems, compare } = this.list.props;\r\n        let itemsArray: any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as IPageItems<any>).items;\r\n        }\r\n\r\n        if (isItemSelected) {\r\n            let retItems = itemsArray.map(v => {\r\n                return {\r\n                    selected: isItemSelected(v),\r\n                    item: v,\r\n                    labelId: uid()\r\n                };\r\n            });\r\n            this._items = retItems;\r\n        }\r\n        else {\r\n            let comp: ((item: any, selectItem: any) => boolean);\r\n            if (compare === undefined) {\r\n                comp = (item: any, selectItem: any) => item === selectItem;\r\n            }\r\n            else {\r\n                comp = compare;\r\n            }\r\n            let retItems = itemsArray.map(v => {\r\n                //let isObserved = isObservable(v);\r\n                //let obj = isObserved === true? toJS(v) : v;\r\n                //let obj = v;\r\n                let selected = selectedItems === undefined ?\r\n                    false\r\n                    : selectedItems.find(si => comp(v, si)) !== undefined;\r\n                return {\r\n                    selected: selected,\r\n                    item: v,\r\n                    labelId: uid()\r\n                };\r\n            });\r\n            this._items = retItems;\r\n        }\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n\r\n    private get anySelected(): boolean { return this._items.some(v => v.selected) }\r\n    private onSelect(item: SelectableItem, selected: boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n\r\n    get selectedItems(): any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n\r\n    render = (item: SelectableItem, index: number): JSX.Element => {\r\n        let { key } = this.list.props.item;\r\n        return React.createElement(this.row, { item, index, key: key === undefined ? index : key(item) });\r\n    }\r\n\r\n    private row = observer((props: { item: SelectableItem, index: number }): JSX.Element => {\r\n        let { item, index } = props;\r\n        let { className } = this.list.props.item;\r\n        let { labelId, selected, item: obItem } = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input => { if (input) this.inputItems[labelId] = input; }}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e) => {\r\n                        this.onSelect(item, e.target.checked)\r\n                    }\r\n                    } />\r\n                <label className=\"\" style={{ flex: 1, marginBottom: 0 }} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observer } from 'mobx-react';\r\nimport { resLang } from 'tonwa-core';\r\nimport { ListRes, listRes } from 'tonwa-core';\r\nimport _ from 'lodash';\r\nimport { ListBase } from './base';\r\nimport { Clickable } from './clickable';\r\nimport { Static } from './static';\r\nimport { Selectable } from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { IPageItems } from '../../tool';\r\n\r\ntype StaticRow = string | JSX.Element | (() => string | JSX.Element);\r\ninterface ItemProps {\r\n    className?: string | string[];\r\n    render?: (item: any, index: number) => JSX.Element;\r\n    onSelect?: (item: any, isSelected: boolean, anySelected: boolean) => void;\r\n    onClick?: (item: any) => void;\r\n    key?: (item: any) => string | number;\r\n}\r\n\r\nexport interface ListProps {\r\n    className?: string | string[];\r\n    items: any[] | IObservableArray<any> | IPageItems<any>;\r\n    item: ItemProps;\r\n    isItemSelected?: (item: any) => boolean;\r\n    compare?: (item: any, selectItem: any) => boolean;\r\n    selectedItems?: any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n    none?: StaticRow;\r\n    onFocus?: (evt: React.FocusEvent<HTMLUListElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n    private static res: ListRes = resLang<ListRes>(listRes);\r\n\r\n    private listBase: ListBase;\r\n    private selectable: Selectable;\r\n    constructor(props: ListProps) {\r\n        super(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top' | 'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let { item } = this.props;\r\n        let { onClick, onSelect } = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n    }\r\n    componentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\r\n        if (_.isEqual(this.props.item, prevProps.item) === false) {\r\n            this.buildBase();\r\n            this.forceUpdate();\r\n        }\r\n    }\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems(): any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let { className, header, footer, before, loading, none, onFocus } = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        let { items, loading: isLoading } = this.listBase;\r\n        function staticRow(row: StaticRow, type: string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\" + type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\" + type}>{(row as () => string | JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            }\r\n        }\r\n        let content: any, waitingMore: any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n        }\r\n        let tabIndex: number;\r\n        if (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from 'tonwa-core';\r\n\r\nexport interface EasyDateProps {\r\n\tdate: Date | number;\r\n\ttimeZone?: number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes: { [prop: string]: any } = {\r\n\tmd: (month: number, date: number) => `${month}-${date}`,\r\n\tymd: (year: number, month: number, date: number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month: number, date: number) => `${month}月${date}日`,\r\n\t\tymd: (year: number, month: number, date: number) => `${year}年${month}月${date}日`,\r\n\t\tyesterday: '昨天',\r\n\t\ttoday: '今天',\r\n\t\ttomorrow: '明天',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month: number, date: number) => `${month}-${date}`,\r\n\t\tymd: (year: number, month: number, date: number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str: string): any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate: Date | number, withTime: boolean, always: boolean = false) {\r\n\tif (!vDate) return null;\r\n\tlet date: Date;\r\n\tswitch (typeof vDate) {\r\n\t\tdefault: date = vDate as Date; break;\r\n\t\tcase 'string': date = new Date(vDate); break;\r\n\t\tcase 'number': date = new Date((vDate as number) * 1000); break;\r\n\t}\r\n\r\n\tlet now = new Date();\r\n\tlet tick: number, nDate: number, _date: number, month: number, year: number, nowYear: number;\r\n\tlet d = date;\r\n\ttick = now.getTime() - d.getTime();\r\n\tlet hour = d.getHours(), minute = d.getMinutes();\r\n\tnDate = now.getDate();\r\n\t_date = d.getDate();\r\n\tmonth = d.getMonth() + 1;\r\n\tyear = d.getFullYear();\r\n\tnowYear = now.getFullYear();\r\n\r\n\tlet appendTime: boolean = false;\r\n\tlet dPart: string = (function () {\r\n\t\tif (tick < -24 * 3600 * 1000) {\r\n\t\t\tif (year === nowYear) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('md')(month, _date);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('ymd')(year, month, _date);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tick < 24 * 3600 * 1000) {\r\n\t\t\tif (_date !== nDate) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt(tick < 0 ? 'tomorrow' : 'yesterday');\r\n\t\t\t}\r\n\t\t\tif (withTime === true) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn tt('today');\r\n\t\t}\r\n\t\tif (year === nowYear) {\r\n\t\t\treturn tt('md')(month, _date);\r\n\t\t}\r\n\t\treturn tt('ymd')(year, month, _date);\r\n\t})();\r\n\r\n\tlet hm = hour + ((minute < 10 ? ':0' : ':') + minute);\r\n\r\n\t/*\r\n\tif (tick < -24*3600*1000) {\r\n\t\tif (year === nowYear)\r\n\t\t\treturn tt('md')(month, _date) + ' ' + hm;\r\n\t\telse\r\n\t\t\treturn tt('ymd')(year, month, _date) + ' ' + hm;\r\n\t}\r\n\tif (always === true || tick < 24*3600*1000) {\r\n\t\treturn _date!==nDate? \r\n\t\t\ttt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n\t\t\t: withTime===true? hm : tt('today');\r\n\t}\r\n\tif (year === nowYear) {\r\n\t\treturn tt('md')(month, _date);\r\n\t}\r\n\treturn tt('ymd')(year, month, _date);\r\n\t*/\r\n\tif (appendTime === true || always === true) {\r\n\t\treturn dPart + ' ' + hm;\r\n\t}\r\n\treturn dPart;\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n\trender() {\r\n\t\treturn renderDate(this.props.date, false);\r\n\t}\r\n}\r\n\r\ninterface EasyTimeProps extends EasyDateProps {\r\n\talways?: boolean;\r\n}\r\nexport class EasyTime extends React.Component<EasyTimeProps> {\r\n\trender() {\r\n\t\tlet { date, always } = this.props;\r\n\t\treturn renderDate(date, true, always);\r\n\t}\r\n}\r\n\r\ninterface DateProps {\r\n\tdate: Date;\r\n\thideTime?: boolean;\r\n\thideSameYear?: boolean;\r\n}\r\nexport const VDate: React.FunctionComponent<DateProps> = (props) => {\r\n\tlet { date, hideTime, hideSameYear } = props;\r\n\tlet year = date.getFullYear();\r\n\tlet vTime: any;\r\n\tif (hideTime !== true) {\r\n\t\tvTime = <>{date.getHours()}:{String(100 + date.getMinutes()).substr(1, 2)}</>;\r\n\t}\r\n\tlet vDate = <>{date.getMonth() + 1}-{date.getDate()}</>;\r\n\tif (hideSameYear === true && year === new Date().getFullYear()) {\r\n\t}\r\n\telse {\r\n\t\tvDate = <>{year}-{vDate}</>;\r\n\t}\r\n\treturn <>\r\n\t\t{vDate} {vTime}\r\n\t</>;\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n\taction?: () => void;\r\n\ticonClass?: string;\r\n\tcaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n\tcontent?: string|JSX.Element;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n\tclassName?: string;\r\n\tcontainerClass?: string;\r\n\titemIconClass?: string;\r\n\titemCaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props:DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n\t/*\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\t*/\r\n\r\n    private handleDocumentClick = (evt:any) => {\r\n\t\tdocument.removeEventListener('click', this.handleDocumentClick);\r\n\t\tdocument.removeEventListener('touchstart', this.handleDocumentClick);\r\n\t\tif (this.state.dropdownOpen === false) return;\r\n        //if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n\t\tlet {dropdownOpen} = this.state;\r\n\t\tdropdownOpen = !dropdownOpen;\r\n        this.setState({dropdownOpen});\r\n\t\tif (dropdownOpen === true) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tdocument.addEventListener('click', this.handleDocumentClick);\r\n\t\t\t\tdocument.addEventListener('touchstart', this.handleDocumentClick);\t\r\n\t\t\t},10)\r\n\t\t}\r\n    }\r\n\r\n    render() {\r\n        let {icon, content, actions, isRight, className, containerClass, itemIconClass, itemCaptionClass} = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => {\r\n\t\t\tif (!v) return false;\r\n\t\t\treturn v.icon !== undefined\r\n\t\t});\r\n        let {dropdownOpen} = this.state;\r\n\t\t//isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n\t\tlet cn = className || 'cursor-pointer dropdown-toggle btn btn-sm';\r\n\t\t//if (className) cn += className;\r\n        return <div className={classNames('dropdown', containerClass)}>\r\n\t\t\t<button ref={v=>this.button=v} \r\n\t\t\t\tclassName={cn}\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                {icon!==null && <i className={classNames('fa fa-fw ', 'fa-'+(icon||'ellipsis-v'))} />}\r\n\t\t\t\t{content && <span className=\"ms-1\">{content}</span>}\r\n            </button>\r\n            <div ref={v => this.menu=v} className={classNames({\"dropdown-menu\":true, \"dropdown-menu-right\":isRight, \"show\":dropdownOpen})}>\r\n                {\r\n                    actions.map((v,index) => {\r\n\t\t\t\t\t\tif (!v) {\r\n                            return <div className=\"dropdown-divider\" key={index}/>;\r\n\t\t\t\t\t\t}\r\n                        let {icon, caption, action, iconClass, captionClass} = v;\r\n                        if (icon === undefined && caption === undefined) \r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i:any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n\t\t\t\t\t\t\tif (!iconClass) iconClass = 'text-info';\r\n\t\t\t\t\t\t\ti = <i className={classNames('me-2', 'fa', icon, 'fa-fw', iconClass || itemIconClass)}\r\n\t\t\t\t\t\t\t\taria-hidden={true}></i>;\r\n                        }\r\n                        if (action === undefined) \r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt:React.MouseEvent<HTMLAnchorElement>)=>{\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                            // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\" \r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                            >{i} <span className={captionClass || itemCaptionClass}>{caption}</span></a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n\tisInt: boolean;\t\t// 整数\r\n\ttime: boolean;\t\t// 字段log的time可以客户端输入\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string 表示名字，否则就是值\r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { env } from 'tonwa-core';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key: string) => Promise<void>;\r\n    onFocus?: () => void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n    private button: HTMLButtonElement;\r\n    private key: string = null;\r\n\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n        console.log('key = ' + this.key);\r\n        if (this.props.allowEmptySearch === true) {\r\n        }\r\n        else {\r\n            this.button.disabled = this.key === undefined || this.key.length === 0;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n            if (this.button) this.button.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n        if (this.button) this.button.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n        let { className, inputClassName, onFocus,\r\n            label, placeholder, buttonText, maxLength, size } = this.props;\r\n        let inputSize: string;\r\n        switch (size) {\r\n            default:\r\n            case 'sm': inputSize = 'input-group-sm'; break;\r\n            case 'md': inputSize = 'input-group-md'; break;\r\n            case 'lg': inputSize = 'input-group-lg'; break;\r\n        }\r\n        let autoComplete: string;\r\n        if (env.isMobile === true) autoComplete = 'off';\r\n        return <form className={className} onSubmit={this.onSubmit} autoComplete={autoComplete}>\r\n            <div className={classNames(\"input-group\", inputSize)}>\r\n                {label && <div className=\"input-group-addon align-self-center me-2\">{label}</div>}\r\n                <input ref={v => this.input = v} onChange={this.onChange}\r\n                    type=\"text\"\r\n                    name=\"key\"\r\n                    onFocus={onFocus}\r\n                    className={classNames('form-control', inputClassName || 'border-primary')}\r\n                    placeholder={placeholder}\r\n                    defaultValue={this.props.initKey}\r\n                    maxLength={maxLength} />\r\n                <div className=\"input-group-append\">\r\n                    <button ref={v => this.button = v} className=\"btn btn-primary\"\r\n                        type=\"submit\"\r\n                        disabled={this.props.allowEmptySearch !== true}>\r\n                        <i className='fa fa-search' />\r\n                        <i className=\"fa\" />\r\n                        {buttonText}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </form>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from './image';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string|JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let {icon, main, discription, px, py} = this.props;\r\n        let disp:any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media', \r\n            px===undefined? 'px-0':'px-'+px, \r\n            py===undefined? 'py-2':'py-'+py);\r\n        return <div className={cn}>\r\n            <Image className=\"me-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { tonwa } from \"tonwa-core\";\r\n// import { nav } from \"../../nav\";\r\n\r\nexport interface AxProps extends React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement> {\r\n\t//children: React.ReactNode;\r\n\t//href: string;\r\n\t//onClick?: (event:React.MouseEvent) => void;\r\n\t//className?: string;\r\n\taClassName?: string;\r\n\tnaClassName?: string;\r\n\t//target?: string;\r\n\t//props?: any;\r\n}\r\n\r\n// 如果是web方式，用webNav方式route网页\r\n// 如果是app方式，用click方式压栈页面\r\nexport const Ax = (axProps: AxProps) => {\r\n\tlet { href, children, className, onClick } = axProps;\r\n\tif (tonwa.nav.isWebNav === true) {\r\n\t\tlet { aClassName } = axProps;\r\n\t\tif (!href) return <span className=\"text-danger\">Error: href not defined in Ax</span>;\r\n\t\tlet onAxClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tlet ret: boolean;\r\n\t\t\tif (onClick) {\r\n\t\t\t\tret = onClick(evt) as unknown as boolean;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttonwa.navigate(href);\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\treturn <a {...axProps} className={classNames(className, aClassName)} onClick={onAxClick}>{children}</a>;\r\n\t}\r\n\telse {\r\n\t\tlet { naClassName } = axProps;\r\n\t\tif (!onClick) {\r\n\t\t\tonClick = () => {\r\n\t\t\t\tif (tonwa.openSysPage(href) === false) {\r\n\t\t\t\t\ttonwa.navigate(href);\r\n\t\t\t\t};\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <span className={classNames(className, 'cursor-pointer', naClassName)} onClick={onClick}>{children}</span>;\r\n\t}\r\n}\r\n\r\n// 同普通的a tag\r\n// 会自动处理href，处理生产版跟测试版之间的不同\r\nexport const A = (props: React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>) => {\r\n\tlet { children } = props;\r\n\tif (tonwa.nav.isWebNav === false) {\r\n\t\treturn <a {...props}>{children}</a>;\r\n\t}\r\n\tlet { href } = props;\r\n\t//if (nav.testing === true) href += '#test';\r\n\tlet onClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\tevt.preventDefault();\r\n\t\ttonwa.navigate(href);\r\n\t\treturn false;\r\n\t}\r\n\treturn <a {...props} href={href} onClick={onClick}>{children}</a>;\r\n}\r\n","import { action, makeObservable, observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport React, { Component } from \"react\";\r\nimport { Rule, RuleCustom, RuleRequired } from \"../inputRules\";\r\n\r\nexport interface InputProps {\r\n    className?: string;\r\n    defaultValue?: any;\r\n    disabled?: boolean;\r\n    onValueChange?: (newValue:any, preValue:any, ruleMessage:string) => void;\r\n    required?: boolean;\r\n    containerClassName?: string;\r\n    ruleClassName?: string;\r\n    requiredFlagElement?: JSX.Element;\r\n    rules?: ((value:any) => string[] | string)[];\r\n}\r\n\r\nexport abstract class Input<P extends InputProps, V> extends Component<P> {\r\n    static defaultRequiredFlagElement = <span className=\"mx-2 text-danger\">*</span>;\r\n    static defaultRuleClassName = ' mx-2 text-danger ';\r\n    protected readonly rules: Rule[] = [];\r\n    protected value: V = null;\r\n    protected input: HTMLInputElement;\r\n    protected abstract get type(): 'text' | 'number' | 'checkbox' | 'radio';\r\n    protected get placeholder(): string {return undefined;}\r\n    protected get max(): number {return undefined;}\r\n    protected get min(): number {return undefined;}\r\n    protected get maxLength(): number {return undefined;}\r\n    protected get className(): string {return this.props.className}\r\n    protected requiredFlagElement?: JSX.Element;\r\n    ruleMessage: string = null;\r\n    constructor(props: P) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            ruleMessage: observable,\r\n            onChange: action,\r\n            onFocus: action,\r\n            onBlur: action,\r\n        });\r\n        this.init();\r\n    }\r\n\r\n    private init() {\r\n        let {required, rules, requiredFlagElement, defaultValue} = this.props;\r\n        if (required === true) {\r\n            if (requiredFlagElement === undefined) requiredFlagElement = Input.defaultRequiredFlagElement;\r\n            this.requiredFlagElement = requiredFlagElement;\r\n            this.rules.push(new RuleRequired());\r\n        }\r\n        this.buildRules();\r\n        if (rules) {\r\n            for (let rule of rules) {this.rules.push(new RuleCustom(rule))};\r\n        }\r\n        this.value = defaultValue;\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    getValue(): V {return this.value;}\r\n    setValue(v: V) {\r\n        let p = this.value;\r\n        this.value = v;\r\n        this.checkRules();\r\n        let {onValueChange} = this.props;\r\n        if (!onValueChange) return;\r\n        if (v !== p) onValueChange(v, p, this.ruleMessage);\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        let {defaultValue, disabled, required} = this.props;\r\n        let content = <input ref={inp => this.input = inp}\r\n            className={this.className} type={this.type}\r\n            placeholder={this.placeholder}\r\n            defaultValue={defaultValue}\r\n            defaultChecked={defaultValue}\r\n            maxLength={this.maxLength}\r\n            max={this.max}\r\n            min={this.min}\r\n            disabled={disabled}\r\n            onChange={() => this.onChange()}\r\n            onBlur={() => this.onBlur()}\r\n            onFocus={() => this.onFocus()} />;\r\n        if (this.rules.length === 0) return content;\r\n        let {containerClassName, ruleClassName} = this.props;\r\n        return <span className={containerClassName}>\r\n            {required===true && this.requiredFlagElement}\r\n            {content}\r\n            {\r\n                React.createElement(observer(() => {\r\n                    return <span className={ruleClassName ?? Input.defaultRuleClassName}>{this.ruleMessage}</span>\r\n                }))\r\n            }\r\n        </span>;\r\n    }\r\n\r\n    onChange() {\r\n        let preValue = this.value;\r\n        let value = this.value = this.valueFromInput();\r\n        this.checkRules();\r\n        let {onValueChange} = this.props;\r\n        if (!onValueChange) return;\r\n        if (value !== preValue) onValueChange(value, preValue, this.ruleMessage);\r\n    }\r\n\r\n    protected valueFromInput():V {return;}\r\n\r\n    protected checkRules() {\r\n        let defy:string[] = [];\r\n        for (let rule of this.rules) {\r\n            rule.check(defy, this.value);\r\n        }\r\n        if (defy.length === 0) {\r\n            this.ruleMessage = null;\r\n        }\r\n        else {\r\n            this.ruleMessage = defy[0];\r\n        }\r\n    }\r\n\r\n    onBlur() {\r\n        this.checkRules();\r\n    }\r\n\r\n    onFocus() {\r\n        this.ruleMessage = null;\r\n    }\r\n}\r\n","import { RuleInt, RuleNum } from \"../../inputRules\";\r\nimport { Input, InputProps } from \"../input\";\r\n\r\ninterface InputNumberProps extends InputProps {\r\n    placeholder?: string;\r\n    max?: number;\r\n    min?: number;\r\n}\r\n\r\nexport class InputNumber<P extends InputNumberProps> extends Input<P, number> {\r\n    static defaultClassName = 'form-control w-8c d-inline text-right';\r\n\r\n    protected get type(): 'text' | 'number' | 'checkbox' | 'radio' { return 'number' }\r\n    protected get max(): number { return this.props.max; }\r\n    protected get min(): number { return this.props.min; }\r\n    protected get className(): string {\r\n        let { className } = this.props;\r\n        if (className === null) return null;\r\n        if (!className) return InputNumber.defaultClassName;\r\n        return className;\r\n    }\r\n\r\n    protected buildRules() {\r\n        let { max, min } = this.props;\r\n        this.rules.push(new RuleNum(undefined, min, max));\r\n    }\r\n\r\n    protected parseValue(): number {\r\n        return Number.parseFloat(this.input.value);\r\n    }\r\n\r\n    protected valueFromInput(): number {\r\n        let v = this.parseValue();\r\n        if (isNaN(v) === true) return undefined;\r\n        return v;\r\n    }\r\n}\r\n\r\nexport interface InputIntegerProps extends InputNumberProps {\r\n}\r\n\r\nexport class InputInteger<P extends InputIntegerProps> extends InputNumber<P> {\r\n    protected buildRules() {\r\n        let { max, min } = this.props;\r\n        this.rules.push(new RuleInt(undefined, min, max));\r\n    }\r\n\r\n    protected parseValue(): number {\r\n        return Number.parseInt(this.input.value);\r\n    }\r\n}\r\n","import { Input, InputProps } from \"../input\";\r\n\r\nexport interface InputCheckBoxProps extends InputProps {\r\n}\r\n\r\nexport class InputCheckBox extends Input<InputCheckBoxProps, boolean> {\r\n    static defaultClassName = 'form-check-input p-2';\r\n\r\n    protected get type(): 'text' | 'number' | 'checkbox' | 'radio' {return 'checkbox'}\r\n    protected get className(): string {\r\n        let {className} = this.props;\r\n        if (className === null) return null;\r\n        if (!className) return InputCheckBox.defaultClassName;\r\n        return className;\r\n    }\r\n\r\n    protected valueFromInput(): boolean {\r\n        return this.input.checked;\r\n    }\r\n    onBlur() {}\r\n    onFocus() {}\r\n    setValue(v: boolean) {\r\n        super.setValue(v);\r\n        this.input.checked = v;\r\n    }\r\n}\r\n","import fs from 'fs';\r\nimport { capitalCase } from \"../tool\";\r\nimport { UqMan } from \"../uqCore\";\r\nimport { UqBuildContext } from './UqBuildContext';\r\n\r\nexport const red = '\\x1b[41m%s\\x1b[0m';\r\nexport let lastBuildTime:number = 0;\r\n//export const uqTsSrcPath = 'src/UqApp';\r\n\r\nexport function saveSrcTsFileIfNotExists(context:UqBuildContext, fileName:string, suffix:string, content:string) {\r\n\tlet tsFilePath = `${context.uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tsaveTsFileIfNotExists(tsFilePath, content);\r\n\t//if (fs.existsSync(tsFile) === true) return;\r\n\t//saveTsFile(fileName, content, suffix);\r\n}\r\nexport function saveTsFile(context:UqBuildContext, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet {uqTsSrcPath} = context;\r\n\tlet srcFile = `${uqTsSrcPath}/${fileName}.${suffix}.txt`;\r\n\tlet tsFile = `${uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tif (!fs.existsSync(srcFile)) {\r\n\t\tif (fs.existsSync(tsFile)) {\r\n\t\t\tfs.renameSync(tsFile, srcFile);\r\n\t\t}\r\n\t}\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nexport function overrideTsFile(path:string, content:string) {\r\n\t//let tsFile = `${path}/${fileName}.${suffix}`;\r\n\tfs.writeFileSync(path, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${path} is built`);\r\n}\r\n//fileName:string, \r\n//, suffix:string = 'ts'\r\nexport function saveTsFileIfNotExists(tsFilePath:string, content:string) {\r\n\t//let tsFilePath = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFilePath) === true) return;\r\n\toverrideTsFile(tsFilePath, content);\r\n}\r\n\r\n/*\r\nfunction createTsFile(path:string, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet tsFile = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFile) === true) return;\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\n*/\r\nexport function entityName(s:string):string {\r\n\treturn capitalCase(s);\r\n}\r\n\r\nexport function getNameFromUq(uqMan:UqMan):{devName:string; uqName:string} {\r\n\tlet {config} = uqMan;\r\n\tlet devPart:string, uqPart:string;\r\n\tif (config) {\r\n\t\tlet {dev, name, alias} = config;\r\n\t\tlet {name:devName, alias:devAlias} = dev;\r\n\t\tdevPart = devAlias || devName;\r\n\t\tuqPart = alias || name;\r\n\t}\r\n\telse {\r\n\t\tlet {uqOwner, uqName} = uqMan;\r\n\t\tdevPart = uqOwner;\r\n\t\tuqPart = uqName;\r\n\t}\r\n\treturn {\r\n\t\tdevName: capitalCase(devPart),\r\n\t\tuqName: capitalCase(uqPart),\r\n\t};\r\n}\r\n","import { Tonwa, User, Web } from \"tonwa-core\";\r\nimport { VPage } from \"./VPage\";\r\nimport { Controller, WebNav } from \"./Controller\";\r\n\r\nexport abstract class ControllerWithWeb extends Controller {\r\n    readonly web: Web;\r\n    constructor(tonwa: Tonwa) {\r\n        super(tonwa);\r\n        this.web = tonwa.web;\r\n    }\r\n\r\n    private receiveHandlerId: number;\r\n    //private disposer:()=>void;\r\n\r\n    protected dispose = () => {\r\n        // message listener的清理\r\n        //nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.web.messageHub.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n    }\r\n\r\n    protected async internalStart(param?: any, ...params: any[]): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    get user(): User { return this.tonwa.user }\r\n    get isLogined(): boolean {\r\n        let { user } = this.tonwa;\r\n        if (!user) return false;\r\n        return user.id > 0;\r\n    }\r\n\r\n    get webNav(): WebNav<any> { return undefined; }\r\n\r\n    getWebNav(): WebNav<any> { return this.webNav; }\r\n\r\n    get isWebNav(): boolean { return this.nav.isWebNav }\r\n    navigate(url: string) {\r\n        this.navigate(url);\r\n    }\r\n\r\n    isMe(id: any): boolean {\r\n        if (id === null) return false;\r\n        let { user } = this;\r\n        let userId = user.id;\r\n        switch (typeof id) {\r\n            default: return false;\r\n            case 'string': return Number(id) === userId;\r\n            case 'number': return id === userId;\r\n            case 'object': return id.id === userId;\r\n        }\r\n    }\r\n\r\n    protected onMessage(message: any): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message: any): Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart(): Promise<boolean> {\r\n        return true;\r\n    }\r\n    protected async afterStart(): Promise<void> {\r\n    }\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = this.web.messageHub.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    async start(param?: any, ...params: any[]): Promise<void> {\r\n        this.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n        await this.internalStart(param, ...params);\r\n        await this.afterStart();\r\n    }\r\n\r\n    get isCalling(): boolean { return this._resolve_$ !== undefined }\r\n\r\n    private _resolve_$: ((value: any) => void)[];\r\n    async call<T>(param?: any, ...params: any[]): Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T>(async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C) => VPage<C>, param?: any): Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value: any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { Page } from '../components';\r\nimport { env, Nav, Tonwa } from 'tonwa-core';\r\nimport { Controller } from './Controller';\r\nimport { VPage } from './VPage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected readonly tonwa: Tonwa;\r\n    protected readonly controller: C;\r\n    protected readonly nav: Nav;\r\n    protected readonly res: any;\r\n    protected readonly x: any;\r\n    protected readonly t: (str: string) => any;\r\n\r\n    constructor(controller: C) {\r\n        let tonwa = controller.getTonwa();\r\n        this.tonwa = tonwa;\r\n        this.controller = controller;\r\n        this.nav = tonwa.nav;\r\n        this.t = controller.t;\r\n    }\r\n\r\n    protected get isDev() { return env.isDevelopment }\r\n    get isWebNav(): boolean { return this.nav.isWebNav }\r\n    navigate(url: string) { this.tonwa.navigate(url) }\r\n    abstract render(param?: any): JSX.Element;\r\n\r\n    protected shallow<T extends object>(data: T) {\r\n        return this.controller.shallow(data);\r\n    }\r\n\r\n    protected deep<T extends object>(data: T) {\r\n        return this.controller.deep(data);\r\n    }\r\n\r\n    protected runInAction<T>(fn: () => T): T {\r\n        return this.controller.runInAction(fn);\r\n    }\r\n\r\n    protected react(func: () => JSX.Element): JSX.Element {\r\n        let V = observer(func.bind(this));\r\n        return <V />;\r\n    }\r\n\r\n    protected renderVm(vm: new (controller: C) => View<C>, param?: any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C) => VPage<C>, param?: any, afterBack?: () => Promise<void>): Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type: string, value?: any) {\r\n        await this.controller.event(type, value);\r\n    }\r\n\r\n    protected go(showPage: () => void, url: string, absolute?: boolean) {\r\n        this.controller.go(showPage, url, absolute);\r\n    }\r\n    /*\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n    protected renderUser(user:any, imageClassName?:string, textClassName?:string) {\r\n        let renderUser = (user:User) => {\r\n            let {name, nick, icon} = user;\r\n            return <>\r\n                <Image src={icon} className={imageClassName || 'w-1c h-1c me-2'} />\r\n                <span className={textClassName}>{nick || name}</span>\r\n            </>;\r\n        }\r\n        return <UserView user={user} render={renderUser} />\r\n    }\r\n\r\n    protected renderUserText(user:any) {\r\n        let renderUser = (user:User) => {\r\n            let {name, nick} = user;\r\n            return <>{nick || name}</>;\r\n        }\r\n        return <UserView user={user} render={renderUser} />\r\n    }\r\n\r\n    protected renderMe(imageClassName?:string, textClassName?:string) {\r\n        let {user} = this.controller;\r\n        if (!user) return;\r\n        return this.renderUser(user.id, imageClassName, textClassName);\r\n    }\r\n    */\r\n    protected openPage(view: React.StatelessComponent<any>, param?: any, onClosePage?: (ret: any) => void) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param), onClosePage);\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>, onClosePage);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?: any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: () => void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element, onClosePage?: () => void) {\r\n        this.controller.replacePage(page, onClosePage);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?: number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?: number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n    }\r\n\r\n    protected popToTopPage() {\r\n        this.controller.popToTopPage();\r\n    }\r\n}\r\n","import { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./View\";\r\nimport { Controller } from \"./Controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n    replaceOpen(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.replacePageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\tlet logout = this.logout();\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={logout}\r\n\t\t\twebNav={this.controller.pageWebNav}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","import React from 'react';\r\nimport { FA, Page } from '../../components';\r\nimport { Controller } from \"../Controller\";\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport interface CStringEditProps {\r\n\tlabel?: string;\r\n\tplaceholder?: string;\r\n\tmaxLength?: number;\r\n\tonValueChange?: (value: string) => Promise<void>;\r\n}\r\n\r\nexport class CStringEdit extends Controller {\r\n\tprivate props: CStringEditProps = {\r\n\t\tlabel: '编辑'\r\n\t}\r\n\tvalue: string = null;\r\n\tnewValue: string = null;\r\n\tisChanged: boolean = null;\r\n\terror: string = null;\r\n\r\n\tconstructor() {\r\n\t\tsuper(tonwa);\r\n\t\tmakeObservable(this, {\r\n\t\t\tvalue: observable,\r\n\t\t\tnewValue: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\terror: observable,\r\n\t\t});\r\n\t}\r\n\r\n\tprotected async internalStart() { }\r\n\trender(value: string, props?: CStringEditProps) {\r\n\t\tthis.value = value;\r\n\t\tif (props) Object.assign(this.props, props);\r\n\t\treturn React.createElement(observer(() => <>{this.renderValue()}{this.renderPencil()}</>))\r\n\t}\r\n\r\n\tprotected renderValue() { return <>{this.value}</> }\r\n\tprotected renderPencil() {\r\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\r\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\r\n\t\t</span>;\r\n\t}\r\n\r\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.newValue = evt.target.value;\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\r\n\tprivate onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.verifyValue();\r\n\t}\r\n\r\n\tprotected verifyValue() { }\r\n\r\n\tprivate onFocus = () => {\r\n\t\tthis.error = undefined;\r\n\t}\r\n\r\n\tprivate onEdit = () => {\r\n\t\tlet { label, maxLength, placeholder, onValueChange } = this.props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tthis.value = this.newValue;\r\n\t\t\t\tthis.closePage();\r\n\t\t\t\tif (onValueChange) onValueChange(this.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet right = React.createElement(observer(() => <button\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center me-2\"\r\n\t\t\tdisabled={!this.isChanged}\r\n\t\t\tonClick={onSave}>保存</button>));\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tthis.openPage(<Page header={label} right={right}>\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n\t\t\t\t\tonBlur={this.onBlur}\r\n\t\t\t\t\tonFocus={this.onFocus}\r\n\t\t\t\t\tclassName=\"form-control\"\r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t{\r\n\t\t\t\t\tReact.createElement(observer(() => placeholder && <div className=\"small muted m-2\">{placeholder}</div>))\r\n\t\t\t\t}\r\n\t\t\t\t{this.error && <div className=\"text-danger\">{this.error}</div>}\r\n\t\t\t</div>\r\n\t\t</Page>);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { renderPageHeader } from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView, WebNavScrollView } from './scrollView';\r\nimport { PageHeaderProps, PageWebNav, tonwa } from 'tonwa-core';\r\n//import { nav } from '../../nav';\r\n\r\nexport interface IVPage {\r\n\tcontent(): JSX.Element;\r\n\theader(): JSX.Element | string;\r\n\tfooter(): JSX.Element;\r\n}\r\n\r\nexport interface PageProps extends ScrollProps {\r\n\tback?: 'close' | 'back' | 'none';\r\n\theader?: boolean | string | JSX.Element;\r\n\tright?: JSX.Element;\r\n\tfooter?: JSX.Element;\r\n\tlogout?: boolean | (() => Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n\twebNav?: PageWebNav<JSX.Element>;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n\tconstructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet { tabsProps } = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader(webNav?: PageWebNav) {\r\n\t\tconst { back, header, right, headerClassName, afterBack, logout } = this.props;\r\n\t\tif (header === false) return;\r\n\t\t//const {webNav} = this.props;\r\n\t\tlet inWebNav = false;\r\n\t\tlet pageHeaderProps: PageHeaderProps<JSX.Element> = {\r\n\t\t\tback,\r\n\t\t\tcenter: header as any,\r\n\t\t\tright,\r\n\t\t\tlogout,\r\n\t\t\tclassName: headerClassName,\r\n\t\t\tafterBack,\r\n\t\t};\r\n\t\tif (webNav !== undefined) {\r\n\t\t\tinWebNav = true;\r\n\t\t\tlet { renderPageHeader: rph } = webNav;\r\n\t\t\tif (rph) return rph(pageHeaderProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinWebNav = false;\r\n\t\t}\r\n\t\treturn renderPageHeader(pageHeaderProps, inWebNav);\r\n\t}\r\n\r\n\tprivate renderFooter(webNav?: PageWebNav) {\r\n\t\tconst { footer } = this.props;\r\n\t\tif (!footer) return;\r\n\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\tif (webNav) return elFooter;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t{elFooter}\r\n\t\t</>;\r\n\t}\r\n\r\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n\t\t// You can also log the error to an error reporting service\r\n\t\t//logErrorToMyService(error, errorInfo);\r\n\t\tdebugger;\r\n\t}\r\n\r\n\trender() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst { onScroll, onScrollTop, onScrollBottom, children, className, webNav } = this.props;\r\n\t\tlet pageWebNav: PageWebNav;\r\n\t\tif (!webNav) {\r\n\t\t\tpageWebNav = tonwa.nav.pageWebNav;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpageWebNav = webNav;\r\n\t\t}\r\n\t\tlet content = <>\r\n\t\t\t{this.renderHeader(pageWebNav)}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter(pageWebNav)}\r\n\t\t</>;\r\n\t\tif (pageWebNav) {\r\n\t\t\treturn <WebNavScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twebNav={pageWebNav}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</WebNavScrollView>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn <ScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</ScrollView>;\r\n\t\t}\r\n\t}\r\n}\r\n","import { from62 } from './62';\r\nimport { LocalMap } from './localDb';\r\n\r\nexport const env = (function () {\r\n\tlet { unit, testing, buildingUq, params, lang, district, timeZone, isMobile } = initEnv();\r\n\treturn {\r\n\t\tunit,\r\n\t\ttesting,\r\n\t\tbuildingUq,\r\n\t\tparams,\r\n\t\tlang,\r\n\t\tdistrict,\r\n\t\ttimeZone,\r\n\t\tbrowser: detectBrowser(),\r\n\t\tisDevelopment: process.env.NODE_ENV === 'development',\r\n\t\tisMobile,\r\n\t\tlocalDb: new LocalMap(testing === true ? '$$' : '$'),\r\n\t\tsetTimeout: (tag: string, callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n\t\t\treturn global.setTimeout(callback, ms, ...args);\r\n\t\t},\r\n\t\tclearTimeout: (handle: NodeJS.Timer): void => {\r\n\t\t\tglobal.clearTimeout(handle);\r\n\t\t},\r\n\t\tsetInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n\t\t\treturn global.setInterval(callback, ms, ...args);\r\n\t\t},\r\n\t\tclearInterval: (handle: NodeJS.Timer): void => {\r\n\t\t\tglobal.clearInterval(handle);\r\n\t\t}\r\n\t}\r\n}());\r\n\r\nfunction initEnv(): {\r\n\tunit: number;\r\n\ttesting: boolean;\r\n\tbuildingUq: boolean;\r\n\tparams: { [key: string]: string };\r\n\tlang: string;\r\n\tdistrict: string;\r\n\ttimeZone: number;\r\n\tisMobile: boolean;\r\n} {\r\n\tlet pl = /\\+/g,  // Regex for replacing addition symbol with a space\r\n\t\tsearch = /([^&=]+)=?([^&]*)/g,\r\n\t\tdecode = function (s: any) { return decodeURIComponent(s.replace(pl, \" \")); },\r\n\t\tquery = window.location.search.substring(1);\r\n\tlet params: { [key: string]: string } = {};\r\n\tfor (; ;) {\r\n\t\tlet match = search.exec(query);\r\n\t\tif (!match) break;\r\n\t\tparams[decode(match[1])] = decode(match[2]);\r\n\t}\r\n\r\n\tlet testing: boolean; // = isTesting();\r\n\tlet unit: number;\r\n\r\n\tlet sUnit = params['u'] || params['unit'];\r\n\tif (sUnit) {\r\n\t\tlet p = sUnit.indexOf('-');\r\n\t\tif (p >= 0) {\r\n\t\t\tlet tc = sUnit.charCodeAt(p + 1);\r\n\t\t\tconst tt = 'tT';\r\n\t\t\ttesting = tc === tt.charCodeAt(0) || tc === tt.charCodeAt(1);\r\n\t\t\tsUnit = sUnit.substr(0, p);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttesting = false;\r\n\t\t}\r\n\t\tif (sUnit[0] === '0') {\r\n\t\t\tunit = Number(sUnit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tunit = from62(sUnit);\r\n\t\t}\r\n\t\tif (isNaN(unit) === true) unit = undefined;\r\n\t}\r\n\telse {\r\n\t\t// 下面都是为了兼容以前的操作。\r\n\t\t// 整个url上，只要有test作为独立的字符串出现，就是testing\r\n\t\ttesting = /(\\btest\\b)/i.test(document.location.href);\r\n\t\tlet unitName: string;\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\tunitName = el.innerText;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tel = document.getElementById('unit.json');\r\n\t\t\tif (el) {\r\n\t\t\t\tlet json = el.innerHTML;\r\n\t\t\t\tif (json) {\r\n\t\t\t\t\tlet res = JSON.parse(json);\r\n\t\t\t\t\tunitName = res?.unit;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unitName) {\r\n\t\t\tunitName = process.env.REACT_APP_UNIT;\r\n\t\t}\r\n\r\n\t\tif (unitName) {\r\n\t\t\tunit = Number.parseInt(unitName);\r\n\t\t\tif (Number.isInteger(unit) === false) {\r\n\t\t\t\tif (unitName === '百灵威') {\r\n\t\t\t\t\tunit = 24;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unit) unit = 0;\r\n\t}\r\n\tlet lang: string, district: string;\r\n\tlet language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n\t\t|| navigator.language; // ||   // All browsers\r\n\t//navigator.userLanguage; // IE <= 10\r\n\tif (!language) {\r\n\t\tlang = 'zh';\r\n\t\tdistrict = 'CN';\r\n\t}\r\n\telse {\r\n\t\tlet parts = language.split('-');\r\n\t\tlang = parts[0];\r\n\t\tif (parts.length > 1) district = parts[1].toUpperCase();\r\n\t}\r\n\tlet timeZone = -new Date().getTimezoneOffset() / 60;\r\n\tconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n\t\t'BlackBerry|Windows Phone|' +\r\n\t\t'Opera Mini|IEMobile|Mobile',\r\n\t\t'i');\r\n\tconst isMobile = regEx.test(navigator.userAgent);\r\n\treturn { unit, testing, buildingUq: false, params, lang, district, timeZone, isMobile };\r\n}\r\n\r\nfunction detectBrowser() {\r\n\tif ((navigator.userAgent.indexOf(\"Opera\") || navigator.userAgent.indexOf('OPR')) >= 0)\r\n\t\treturn 'Opera';\r\n\tif (navigator.userAgent.indexOf(\"Chrome\") >= 0)\r\n\t\treturn 'Chrome';\r\n\tif (navigator.userAgent.indexOf(\"Safari\") >= 0)\r\n\t\treturn 'Safari';\r\n\tif (navigator.userAgent.indexOf(\"Firefox\") >= 0)\r\n\t\treturn 'Firefox';\r\n\tif ((navigator.userAgent.indexOf(\"MSIE\") >= 0) || (!!(document as any).documentMode === true))\r\n\t\treturn 'IE'; //crap\r\n\treturn 'Unknown';\r\n}\r\n","import { env, resOptions, PageHeaderProps, PageWebNav, Tonwa, Nav } from 'tonwa-core';\r\nimport { t } from '../ui';\r\nimport { Page } from '../components';\r\n//import { nav } from '../nav';\r\nimport { VPage } from './VPage';\r\nimport { View } from './View';\r\nimport { AnnotationsMap, makeObservable, observable, runInAction } from 'mobx';\r\n// import { messageHub } from 'tonwa-core';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport interface WebNav<C extends Controller> {\r\n    VNavHeader?: new (controller: C) => View<C>;\r\n    VNavRawHeader?: new (controller: C) => View<C>;\r\n    VNavFooter?: new (controller: C) => View<C>;\r\n    VNavRawFooter?: new (controller: C) => View<C>;\r\n    renderPageHeader?: (props: PageHeaderProps<JSX.Element>) => JSX.Element;\r\n}\r\n\r\nexport abstract class Controller {\r\n    protected readonly tonwa: Tonwa;\r\n    protected nav: Nav;\r\n    protected res: any = {};\r\n    t = (str: string): string | JSX.Element => this.internalT(str) || str;\r\n    icon: string | JSX.Element;\r\n    label: string | JSX.Element;\r\n    readonly isDev: boolean = env.isDevelopment;\r\n    pageWebNav: PageWebNav<JSX.Element>;\r\n\r\n    constructor(tonwa: Tonwa) {\r\n        this.tonwa = tonwa;\r\n        this.nav = tonwa.nav;\r\n    }\r\n\r\n    shallow<T extends object>(data: T) {\r\n        let ret = makeObservable(data, this.buildReactiveProps(data, observable.shallow));\r\n        return ret;\r\n    }\r\n\r\n    deep<T extends object>(data: T) {\r\n        let ret = makeObservable(data, this.buildReactiveProps(data, observable));\r\n        return ret;\r\n    }\r\n\r\n    private buildReactiveProps<T extends object>(data: T, ob: any): AnnotationsMap<T, never> {\r\n        let ret: AnnotationsMap<T, never> = {};\r\n        for (let i in data) {\r\n            let v = data[i];\r\n            switch (typeof v) {\r\n                default:\r\n                    ob = observable;\r\n                    break;\r\n                case 'object':\r\n                case 'function':\r\n                    break;\r\n            }\r\n            (ret as any)[i] = ob;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    runInAction<T>(fn: () => T): T {\r\n        return runInAction(fn);\r\n    }\r\n\r\n    getTonwa() { return this.tonwa; }\r\n\r\n    protected beforeInit() { }\r\n    protected afterInit() { }\r\n\r\n    internalInit(...param: any[]) {\r\n        this.beforeInit();\r\n        this.init(...param);\r\n        this.pageWebNav = this.getPageWebNav();\r\n        this.afterInit();\r\n    }\r\n\r\n    init(...param: any[]) {\r\n    }\r\n\r\n    internalT(str: string): any {\r\n        return this.res?.[str] ?? t(str);\r\n    }\r\n\r\n    getPageWebNav(): PageWebNav { return undefined; }\r\n\r\n    setRes(res: any) {\r\n        if (res === undefined) return;\r\n        let { $lang, $district } = resOptions;\r\n        Object.assign(this.res, res);\r\n        if ($lang !== undefined) {\r\n            let l = res[$lang];\r\n            if (l !== undefined) {\r\n                Object.assign(this.res, l);\r\n                let d = l[$district];\r\n                if (d !== undefined) {\r\n                    Object.assign(this.res, d);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    getRes(): any { return this.res; }\r\n\r\n    protected async openVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C) => P, param?: any, afterBack?: (ret: any) => void): Promise<P> {\r\n        let ret = new vp((this as any) as C);\r\n        await ret.open(param, afterBack);\r\n        return ret;\r\n    }\r\n\r\n    protected async replaceVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C) => P, param?: any, afterBack?: (ret: any) => void): Promise<P> {\r\n        let ret = new vp((this as any) as C);\r\n        await ret.replaceOpen(param, afterBack);\r\n        return ret;\r\n    }\r\n\r\n    protected renderView<C extends Controller, V extends View<C>>(view: new (controller: C) => V, param?: any): JSX.Element {\r\n        let v = new view((this as any) as C);\r\n        return v.render(param);\r\n    }\r\n\r\n    async event(type: string, value: any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type: string, value: any) {\r\n    }\r\n\r\n    protected msg(text: string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header: string, err: any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string' ? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    openPage(page: JSX.Element, onClosePage?: (ret: any) => void) {\r\n        let disposer: () => void;\r\n        if (onClosePage !== undefined) {\r\n            disposer = () => {\r\n                //if (this.disposer) this.disposer();\r\n                onClosePage(undefined);\r\n            }\r\n        }\r\n\r\n        this.nav.push(page, disposer);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page: JSX.Element, onClosePage?: () => void) {\r\n        this.nav.replace(page, onClosePage);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        this.nav.back(false);\r\n    }\r\n\r\n    closePage(level?: number) {\r\n        this.nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?: number) {\r\n        this.nav.ceaseTop(level);\r\n    }\r\n\r\n    go(showPage: () => void, url: string, absolute?: boolean) {\r\n        this.go(showPage, url, absolute);\r\n    }\r\n\r\n    removeCeased() {\r\n        this.nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        this.nav.regConfirmClose(confirmClose);\r\n    }\r\n\r\n    private topPageKey: any;\r\n    protected startAction() {\r\n        this.topPageKey = this.nav.topKey();\r\n    }\r\n    get TopKey() {\r\n        return this.topPageKey;\r\n    }\r\n    SetTopKey(key: any) {\r\n        this.topPageKey = key;\r\n    }\r\n    public popToTopPage() {\r\n        this.nav.popTo(this.topPageKey);\r\n    }\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok' | 'yes' | 'no' | undefined> {\r\n        return new Promise<'ok' | 'yes' | 'no' | undefined>(async (resolve, reject) => {\r\n            let { caption, message, ok, yes, no, classNames } = options;\r\n            let close = (res: 'ok' | 'yes' | 'no' | undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons: any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary me-3\" onClick={() => close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success me-3\" onClick={() => close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger me-3\" onClick={() => close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            this.nav.regConfirmClose(async (): Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { PageWebNav } from 'tonwa-core';\r\n//import { PageHeaderProps } from './pageHeader';\r\n\r\nconst scrollAfter = 20; // 20ms之后，scroll执行\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop(): void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom(): void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e: any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n    onScrollBottom?: (scroller: Scroller) => Promise<void>;\r\n    className?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nconst scrollEdgeGap = 30;\r\nabstract class ScrollViewBase<T extends ScrollViewProps> extends React.Component<T, null> {\r\n    private bottomTime: number = 0;\r\n    private topTime: number = 0;\r\n    private div: HTMLDivElement;\r\n\r\n    protected refDiv = (div: HTMLDivElement) => {\r\n        if (!div) {\r\n            if (this.div) {\r\n                this.div.removeEventListener('resize', this.onResize)\r\n            }\r\n            return;\r\n        }\r\n        this.div = div;\r\n        this.div.addEventListener('resize', this.onResize);\r\n    }\r\n\r\n    private onResize = (ev: UIEvent) => {\r\n        console.error('div resize');\r\n    };\r\n\r\n    protected onScroll = async (e: any) => {\r\n        let { onScroll, onScrollTop, onScrollBottom } = this.props;\r\n        if (onScroll) onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < scrollEdgeGap) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime - this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n                    onScrollTop(scroller).then(ret => {\r\n                        // has more\r\n                        if (ret === true) {\r\n                            let sh = el.scrollHeight;\r\n                            let top = 200;\r\n                            if (top > sh) top = sh;\r\n                            el.scrollTop = top;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - scrollEdgeGap) {\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c: any, direct: 'top' | 'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let { _$scroll } = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n    }\r\n}\r\n\r\nexport class ScrollView extends ScrollViewBase<ScrollViewProps> {\r\n    render() {\r\n        let { className, style } = this.props;\r\n        return <div ref={this.refDiv} className=\"tv-page\"\r\n            onScroll={this.onScroll} style={style}>\r\n            <article className={className}>\r\n                {this.props.children}\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\ninterface WebNavScrollViewProps extends ScrollViewProps {\r\n    webNav: PageWebNav<JSX.Element>;\r\n}\r\n\r\nexport class WebNavScrollView extends ScrollViewBase<WebNavScrollViewProps> {\r\n    render() {\r\n        let { className, style, webNav } = this.props;\r\n        let { navHeader, navRawHeader, navFooter, navRawFooter } = webNav;\r\n        let vHeader: any, vFooter: any;\r\n        if (navRawHeader) vHeader = navRawHeader;\r\n        else if (navHeader) vHeader = <header><main>{navHeader}</main></header>\r\n        if (navRawFooter) vFooter = navRawFooter;\r\n        else if (navFooter) vFooter = <footer><main>{navFooter}</main></footer>\r\n\r\n        return <div ref={this.refDiv} className=\"tv-page-webnav\"\r\n            onScroll={this.onScroll} style={style}>\r\n            {vHeader}\r\n            <article className={className}>\r\n                {this.props.children}\r\n            </article>\r\n            {vFooter}\r\n        </div>;\r\n    }\r\n}\r\n","class _LocalStorage {\r\n    getItem(key:string) {\r\n        return localStorage.getItem(key)\r\n    }\r\n    setItem(key:string, value:string) {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key:string) {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    //private value: T;\r\n    readonly key: string|number;\r\n\r\n    constructor(local:Local, key:string|number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get():any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value:any) {\r\n\t\tlet t = JSON.stringify(value, (key, value) => {\r\n\t\t\tif (key !== '_tuid') return value;\r\n\t\t});\r\n\t\tthis.local.setItem(this.key, t);\r\n    }\r\n    remove(local?:Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: {[key:string]:LocalCache};\r\n    private readonly locals: {[key:string]:Local};\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key:string|number):string;\r\n    protected abstract keyForSet(key:string|number):string;\r\n    protected abstract keyForRemove(key:string|number):string;\r\n    abstract removeAll():void;\r\n    getItem(key:string|number):string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key:string|number, value: string):void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key:string|number):void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local:Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] =ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index.indexOf(key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index.indexOf(key);\r\n        if (i<0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key:number):string {\r\n        let i = this.index.indexOf(key);\r\n        if (i<0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index:number):LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: {[key:string]:number};\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p<0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p+1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i>this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls:string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key:string|number):string {\r\n        let i = this.index[key];\r\n        if (i===undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key:string):LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { env, FetchError, PageWebNav } from 'tonwa-core';\r\nimport { Loading } from '../components';\r\nimport FetchErrorView from './FetchErrorView';\r\nimport { FA } from '../components';\r\n\r\nexport interface Props {\r\n    onLogined: (isUserLogin?: boolean) => Promise<void>;\r\n    notLogined?: () => Promise<void>;\r\n    userPassword?: () => Promise<{ user: string; password: string }>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: () => Promise<boolean>;\r\n    disposer?: () => void;\r\n}\r\nexport interface NavViewState {\r\n    notSupportedBrowser: boolean;\r\n    stack: StackItem[];\r\n    wait: 0 | 1 | 2;\r\n    fetchError: FetchError;\r\n}\r\n\r\nconst notSupportedBrowsers = ['IE'];\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n    isWebNav: boolean = false;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.stack = [];\r\n        let { browser } = env;\r\n        let notSupportedBrowser = notSupportedBrowsers.findIndex(v => v === browser) >= 0;\r\n        this.state = {\r\n            notSupportedBrowser,\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n        //nav.set(this);\r\n    }\r\n    async componentDidMount() {\r\n        if (this.state.notSupportedBrowser === true) return;\r\n        window.addEventListener('popstate', this.navBack);\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({ wait: 1 });\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({ wait: 2 });\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n                /*\r\n                this.setState({\r\n                    fetchError: undefined,\r\n                });*/\r\n                --this.waitCount;\r\n                if (this.waitCount === 0) {\r\n                    if (this.waitTimeHandler !== undefined) {\r\n                        env.clearTimeout(this.waitTimeHandler);\r\n                        this.waitTimeHandler = undefined;\r\n                    }\r\n                    this.setState({ wait: 0 });\r\n                }\r\n            }, 100);\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: () => void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: () => void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view,\r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: () => void): number {\r\n        let item: StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view,\r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level: number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i = 0; i < level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level: number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length > 0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len - 1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey(): number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len - 1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (; ;) {\r\n            let p = this.stack.length - 1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let { disposer } = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n        if (item === undefined) return;\r\n        //if (nav.isRouting) {\r\n        //\twindow.history.back();\r\n        //}\r\n        let { disposer } = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer: () => void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose: () => Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len - 1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack: boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now() - tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm: boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({ type: 'pop-app' }, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len - 1];\r\n        if (confirm === true && top.confirmClose) {\r\n            if (await top.confirmClose() === true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?: string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({ fetchError: undefined });\r\n    }\r\n\r\n    setFetchError(fetchError: FetchError) {\r\n        this.setState({ fetchError });\r\n    }\r\n\r\n    render() {\r\n        const { notSupportedBrowser, wait, fetchError } = this.state;\r\n        if (notSupportedBrowser === true) {\r\n            return <div className=\"p-3 text-danger\">\r\n                {env.browser} not supported !\r\n            </div>;\r\n        }\r\n        let { stack } = this.state;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError) {\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n            ++top;\r\n        }\r\n        let test = env.testing === true &&\r\n            <span className=\"cursor-pointer position-fixed\" style={{ top: 0, left: '0.2rem', zIndex: 90001 }}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n            </span>;\r\n        return <>\r\n            {stack.map((item, index) => {\r\n                let { key, view } = item;\r\n                return <div key={key} style={index < top ? { visibility: 'hidden', position: 'absolute' } : undefined}>\r\n                    {view}\r\n                </div>\r\n            })}\r\n            {elWait}\r\n            {elError}\r\n            {test}\r\n        </>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({ stack: this.stack });\r\n    }\r\n\r\n    backIcon = <i className=\"fa fa-angle-left\" />;\r\n    closeIcon = <i className=\"fa fa-close\" />;\r\n\r\n    setIsWebNav(): void {\r\n        this.isWebNav = true;\r\n        this.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n        this.closeIcon = <i className=\"fa fa-close\" />;\r\n    }\r\n\r\n    pageWebNav: PageWebNav<JSX.Element>;\r\n\r\n    renderNavView(onLogined: any, onNotLogined?: any): JSX.Element {\r\n        throw new Error('renderNavView');\r\n    }\r\n}\r\n","import { resGlobal } from 'tonwa-core';\r\n\r\nexport function t(str: string): string | JSX.Element {\r\n\treturn resGlobal[str] || str;\r\n}\r\nexport type TFunc = (str: string | JSX.Element) => string | JSX.Element;\r\n","import { Login, Tonwa } from 'tonwa-core';\r\n\r\nexport async function createLogin(tonwa: Tonwa): Promise<Login> {\r\n\tlet importCLogin = await import('../auth/CLogin');\r\n\treturn new importCLogin.CLogin(tonwa);\r\n}\r\n\r\nexport async function showRegister(tonwa: Tonwa): Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CRegister(tonwa);\r\n\tc.start();\r\n}\r\n\r\nexport async function showForget(tonwa: Tonwa): Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CForget(tonwa);\r\n\tc.start();\r\n}\r\n","const digits = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\r\nconst c0 = digits.charCodeAt(0);\r\nconst c9 = digits.charCodeAt(9);\r\nconst A = digits.charCodeAt(10);\r\nconst Z = digits.charCodeAt(35);\r\nconst a = digits.charCodeAt(36);\r\nconst z = digits.charCodeAt(61);\r\nexport function from62(v:string):number {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'string') return Number.NaN;\r\n\tlet len = v.length;\r\n\tif (len === 0) return Number.NaN;\r\n\tlet ret = 0;\r\n\tfor (let i=0; i<len; i++) {\r\n\t\tlet c = v.charCodeAt(i);\r\n\t\tlet n:number;\r\n\t\tif (c < c0) return Number.NaN;\r\n\t\tif (c <= c9) {\r\n\t\t\tn = c - c0;\r\n\t\t}\r\n\t\telse if (c < A) {\r\n\t\t\treturn Number.NaN;\r\n\t\t} \r\n\t\telse if (c <= Z) {\r\n\t\t\tn = c - A + 10;\r\n\t\t}\r\n\t\telse if (c < a) {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\telse if (c <= z) {\r\n\t\t\tn = c - a + 36;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\tret *= 62;\r\n\t\tret += n;\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nexport function to62(v:number):string {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'number') return '';\r\n\tif (v < 0) return '';\r\n\tlet ret = '';\r\n\tfor (;;) {\r\n\t\tret = digits[v % 62] + ret;\r\n\t\tv = Math.floor(v / 62);\r\n\t\tif (v === 0) break;\r\n\t}\r\n\treturn ret;\r\n}\r\n","import * as React from 'react';\r\nimport { PageHeaderProps, tonwa } from 'tonwa-core';\r\n//import {nav} from '../../nav';\r\n\r\nexport function renderPageHeader(props: PageHeaderProps<JSX.Element>, inWebNav?: boolean) {\r\n\tlet onBack = async () => {\r\n\t\tawait tonwa.nav.back(false); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet { afterBack } = props;\r\n\t\tif (afterBack) afterBack();\r\n\t}\r\n\tlet onLogoutClick = () => {\r\n\t\tlet logout = async () => {\r\n\t\t\tlet { logout } = props;\r\n\t\t\tif (typeof logout === 'function') {\r\n\t\t\t\tawait logout();\r\n\t\t\t}\r\n\t\t\tawait tonwa.logout(undefined);\r\n\t\t}\r\n\t\ttonwa.showLogout(logout);\r\n\t}\r\n\r\n\tlet b = tonwa.nav.level > 1 || window.self !== window.top;\r\n\tlet { back, right, center, logout, className, ex } = props;\r\n\tif (inWebNav === true && !back && !right && !center) return;\r\n\tlet vBack: any, debugLogout: any;\r\n\tif (logout !== undefined && window.self === window.top) {\r\n\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t|| typeof logout === 'function') {\r\n\t\t\tlet { user } = tonwa;\r\n\t\t\tif (user !== undefined) {\r\n\t\t\t\tlet { nick, name } = user;\r\n\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t<div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (b) {\r\n\t\tswitch (props.back) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tvBack = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tcase 'back':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{tonwa.nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'close':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{tonwa.nav.closeIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (window.self !== window.top) {\r\n\t\tconsole.log(document.location.href);\r\n\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t}\r\n\tif (vBack === undefined && typeof center === 'string') {\r\n\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t}\r\n\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\tlet header = <header className={className}>\r\n\t\t<nav>\r\n\t\t\t{vBack}\r\n\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t<div>{center}</div>\r\n\t\t\t{rightView}\r\n\t\t</nav>\r\n\t\t{ex}\r\n\t</header>;\r\n\tif (inWebNav === true) return header;\r\n\treturn <>\r\n\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t{header}\r\n\t</>;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps<JSX.Element>> {\r\n\trender() { return renderPageHeader(this.props) }\r\n\t/*\r\n\tprivate back = async () => {\r\n\t\tawait nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n\t}\r\n\topenWindow() {\r\n\t\twindow.open(document.location.href);\r\n\t}\r\n\tprivate logoutClick = () => {\r\n\t\tnav.showLogout(this.logout);\r\n\t}\r\n\tprivate logout = async () => {\r\n\t\tlet {logout} = this.props;\r\n\t\tif (typeof logout === 'function') {\r\n\t\t\tawait logout(); \r\n\t\t}\r\n\t\tawait nav.logout(undefined);\r\n\t}\r\n\trender() {\r\n\t\tlet b = nav.level > 1 || window.self !== window.top;\r\n\t\tlet {right, center, logout, className, ex} = this.props;\r\n\t\tlet back:any, debugLogout:any;\r\n\t\tif (logout !== undefined && window.self === window.top) {\r\n\t\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t\t|| typeof logout === 'function')\r\n\t\t\t{\r\n\t\t\t\tlet {user} = nav;\r\n\t\t\t\tif (user !== undefined) {\r\n\t\t\t\t\tlet {nick, name} = user;\r\n\t\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t\t<div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\t\tonClick={this.logoutClick}>\r\n\t\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (b) {\r\n\t\t\tswitch (this.props.back) {\r\n\t\t\t\tcase 'none':\r\n\t\t\t\t\tback = undefined;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcase 'back':\r\n\t\t\t\t\tback = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'close':\r\n\t\t\t\t\tback = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (window.self !== window.top) {\r\n\t\t\tconsole.log(document.location.href);\r\n\t\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t\t}\r\n\t\tif (back === undefined && typeof center === 'string') {\r\n\t\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t\t}\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number> | number;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\tloaded: boolean = false;\r\n\tselected: boolean = false;\r\n\t\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number> | number;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n\tprivate _content: JSX.Element;\r\n\t\r\n\tconstructor() {\r\n\t\tmakeObservable(this, {\r\n\t\t\tloaded: observable, \r\n\t\t\tselected: observable, \r\n\t\t});\r\n\t}\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\trunInAction(() => {\r\n\t\t\t\t\tthis.loaded = true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string|JSX.Element, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\n//export const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    private sep: string;\r\n    selectedTab: Tab;\r\n    tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n\t\tmakeObservable(this, {\r\n\t\t\tselectedTab: observable, \r\n\t\t\ttabArr: observable,\r\n\t\t});\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabClick(this.selectedTab);\r\n\t\t}, 100);\t\t\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trunInAction(() => {\r\n\t\t\tthis.selectedTab.selected = false;\r\n\t\t\ttab.selected = true;\r\n\t\t\tthis.selectedTab = tab;\r\n\t\t});\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n\t\t\t\tcursor: 'pointer',\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = typeof notify === 'number'? notify : notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} \r\n\t\t\t\t\tstyle={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = React.createElement(this.tabs);\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport { FetchError, refetchApi } from 'tonwa-core';\r\nimport { Page } from '../components';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: () => void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const { channel, url, options, resolve, reject } = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let { error, url } = this.props;\r\n        let errContent: any;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div style={{ wordWrap: \"break-word\" }}>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <div className=\"tv-page\">\r\n            <article>\r\n                <main className=\"va-error p-3\">\r\n                    <div>网络出现问题</div>\r\n                    <div>点击重新访问</div>\r\n                    <div style={{ wordWrap: \"break-word\" }}>url: {url}</div>\r\n                    {errContent}\r\n                    <div className=\"p-3 text-center\">\r\n                        <button className=\"btn btn-primary me-3\" type='button' onClick={this.close}>关闭</button>\r\n                        <button className=\"btn btn-outline-primary\" type='button' onClick={this.reApi}>重试</button>\r\n                    </div>\r\n                </main>\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const SystemNotifyPage = ({ message }: { message: string }): JSX.Element => {\r\n    return <Page header=\"系统提醒\">\r\n        <div className=\"px-3\">{message}</div>\r\n    </Page>;\r\n}","import { capitalCase } from \"../tool\";\r\n//import { FieldItem, FieldUIType } from \"../../tonwa-react/ui\";\r\n\r\nexport function buildFieldItem(field: any, isKey: boolean): any/*FieldItem*/ {\r\n\tlet $FieldItemType: string, fieldItemType: string, widget: any/*FieldUIType*/;\r\n\tlet { name, type } = field;\r\n\tswitch (type) {\r\n\t\tcase 'id':\r\n\t\t\t$FieldItemType = 'FieldItemId';\r\n\t\t\tfieldItemType = 'id';\r\n\t\t\tbreak;\r\n\t\tcase 'char':\r\n\t\t\t$FieldItemType = 'FieldItemString';\r\n\t\t\tfieldItemType = 'string';\r\n\t\t\twidget = 'string';\r\n\t\t\tbreak;\r\n\t\tcase 'smallint':\r\n\t\tcase 'int':\r\n\t\tcase 'bigint':\r\n\t\t\t$FieldItemType = 'FieldItemInt';\r\n\t\t\tfieldItemType = 'integer';\r\n\t\t\twidget = 'updown';\r\n\t\t\tbreak;\r\n\t\tcase 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\t\t$FieldItemType = 'FieldItemNumber';\r\n\t\t\tfieldItemType = 'number';\r\n\t\t\twidget = 'number';\r\n\t\t\tbreak;\r\n\t}\r\n\treturn {\r\n\t\tname,\r\n\t\ttype: fieldItemType,\r\n\t\tisKey,\r\n\t\twidget,\r\n\t\tlabel: capitalCase(name),\r\n\t\t$FieldItemType,\r\n\t} /*as FieldItem*/;\r\n}\r\n","import { VPage } from '../vm';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VLogout extends VPage<CLogin> {\r\n\tprivate onLogout: () => void;\r\n\r\n\tinit(param: any) {\r\n\t\tthis.onLogout = param;\r\n\t}\r\n\theader() { return this.isWebNav === true ? false : '安全退出'; }\r\n\tfooter() {\r\n\t\treturn <div className=\"mt-5 text-center justify-content-center\">\r\n\t\t\t<button className=\"btn btn-outline-warning\" onClick={this.tonwa.resetAll}>升级软件</button>\r\n\t\t</div>;\r\n\t}\r\n\tprotected get back(): 'close' | 'back' | 'none' { return 'close' }\r\n\tcontent() {\r\n\t\treturn <div className=\"m-5 border border-info bg-white rounded-3 p-5 text-center\">\r\n\t\t\t<div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<button className=\"btn btn-danger\" onClick={this.onLogout}>安全退出</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, StringSchema, Ax } from '../components';\r\nimport { defaultLoginTop, getSender } from './tools';\r\nimport { CLogin } from './CLogin';\r\nimport { VPage } from '../vm';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nconst schema: Schema = [\r\n\t{ name: 'username', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n\t{ name: 'password', type: 'string', required: true, maxLength: 100 } as StringSchema,\r\n\t{ name: 'login', type: 'submit' },\r\n];\r\n\r\nexport class VLogin extends VPage<CLogin> {\r\n\tprivate onLogin: (un: string, pwd: string) => Promise<boolean>;\r\n\tprivate withBack: boolean;\r\n\r\n\tinit({ onLogin, withBack }: { onLogin: (un: string, pwd: string) => Promise<boolean>; withBack: boolean; }) {\r\n\t\tthis.onLogin = onLogin;\r\n\t\tthis.withBack = withBack;\r\n\t}\r\n\r\n\tprivate uiSchema: UiSchema = {\r\n\t\titems: {\r\n\t\t\tusername: { placeholder: '手机/邮箱/用户名', label: '登录账号' } as UiTextItem,\r\n\t\t\tpassword: { widget: 'password', placeholder: '密码', label: '密码' } as UiPasswordItem,\r\n\t\t\tlogin: { widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录' } as UiButton,\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onSubmit = async (name: string, context: Context): Promise<string> => {\r\n\t\tlet values = context.form.data;\r\n\t\tlet un = values['username'];\r\n\t\tlet pwd = values['password'];\r\n\t\tif (pwd === undefined) {\r\n\t\t\treturn 'something wrong, pwd is undefined';\r\n\t\t}\r\n\t\tlet ret = await this.onLogin(un, pwd);\r\n\t\tif (ret === true) return;\r\n\r\n\t\tlet sender = getSender(un);\r\n\t\tlet type: string = sender !== undefined ? sender.caption : '用户名';\r\n\t\treturn type + '或密码错！';\r\n\t}\r\n\tprivate onEnter = async (name: string, context: Context): Promise<string> => {\r\n\t\tif (name === 'password') {\r\n\t\t\treturn await this.onSubmit('login', context);\r\n\t\t}\r\n\t}\r\n\r\n\theader() {\r\n\t\tif (this.withBack === true) {\r\n\t\t\treturn '登录';\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontent() {\r\n\t\treturn <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"w-20c\">\r\n\t\t\t\t{this.tonwa.loginTop(defaultLoginTop)}\r\n\t\t\t\t<div className=\"h-2c\" />\r\n\t\t\t\t<Form schema={schema} uiSchema={this.uiSchema}\r\n\t\t\t\t\tonButtonClick={this.onSubmit}\r\n\t\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\t\trequiredFlag={false} />\r\n\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t<Ax className=\"btn btn-link\" href=\"/forget\">\r\n\t\t\t\t\t\t忘记密码\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t\t<Ax href=\"/register\" className=\"btn btn-link\">\r\n\t\t\t\t\t\t注册账号\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t</div>\r\n\t\t\t\t{tonwa.privacyEntry()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { VPage } from '../vm';\r\nimport { Page, Form, ItemSchema, UiSchema, StringSchema, UiPasswordItem, Context, ButtonSchema, UiButton } from '../components';\r\n//import { CenterAppApi } from '../net';\r\nimport { CLogin } from './CLogin';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class VChangePassword extends VPage<CLogin> {\r\n    private schema: ItemSchema[] = [\r\n        { name: 'orgPassword', type: 'string', maxLength: 60, required: true } as StringSchema,\r\n        { name: 'newPassword', type: 'string', maxLength: 60, required: true } as StringSchema,\r\n        { name: 'newPassword1', type: 'string', maxLength: 60, required: true } as StringSchema,\r\n        { name: 'submit', type: 'submit' } as ButtonSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            orgPassword: {\r\n                widget: 'password',\r\n                label: '原密码',\r\n                placeholder: '输入原来的密码'\r\n            } as UiPasswordItem,\r\n            newPassword: {\r\n                widget: 'password',\r\n                label: '新密码',\r\n                placeholder: '输入新设的密码'\r\n            } as UiPasswordItem,\r\n            newPassword1: {\r\n                widget: 'password',\r\n                label: '确认密码',\r\n                placeholder: '再次输入新设密码'\r\n            } as UiPasswordItem,\r\n            submit: {\r\n                widget: 'button',\r\n                label: '提交',\r\n                className: 'btn btn-primary'\r\n            } as UiButton,\r\n        }\r\n    };\r\n\r\n    private onChange: (orgPassword: string, newPassword: string) => Promise<boolean>\r\n    init(onChange: (orgPassword: string, newPassword: string) => Promise<boolean>) {\r\n        this.onChange = onChange;\r\n    }\r\n\r\n    private onSubmit = async (name: string, context: Context): Promise<any> => {\r\n        let { orgPassword, newPassword, newPassword1 } = context.data;\r\n        if (newPassword !== newPassword1) {\r\n            context.setError('newPassword1', '新密码错误，请重新输入');\r\n            return;\r\n        }\r\n        //let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        //let ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n        let ret = await this.onChange(orgPassword, newPassword);\r\n        if (ret === false) {\r\n            context.setError('orgPassword', '原密码错误');\r\n            return;\r\n        }\r\n        tonwa.nav.replace(<Page header=\"修改密码\" back=\"close\">\r\n            <div className=\"m-3  text-success\">\r\n                密码修改成功！\r\n            </div>\r\n        </Page>);\r\n        return;\r\n    }\r\n\r\n    header() { return '修改密码' }\r\n\r\n    content() {\r\n        return <Form\r\n            className=\"m-3\"\r\n            schema={this.schema}\r\n            uiSchema={this.uiSchema}\r\n            onButtonClick={this.onSubmit}\r\n            fieldLabelSize={2} />\r\n    }\r\n}\r\n","import { CLogin } from \"./CLogin\";\r\nimport { VPage } from \"../vm\";\r\nimport { CenterAppApi } from \"tonwa-core\";\r\n\r\nconst waitingTime = '一小时';\r\n\r\nabstract class VUserQuitBase extends VPage<CLogin> {\r\n    protected abstract get note(): any;\r\n    protected get button1Caption(): string { return undefined; }\r\n    protected get button2Caption(): string { return undefined; }\r\n    protected renderButton1(): JSX.Element {\r\n        let caption = this.button1Caption;\r\n        if (caption === null) return null;\r\n        return <button className=\"btn btn-primary\" onClick={() => this.onClickButton1()}>\r\n            {caption ?? '不注销'}\r\n        </button>;\r\n    }\r\n    protected renderButton2(): JSX.Element {\r\n        let caption = this.button2Caption;\r\n        if (caption === null) return null;\r\n        return <button className=\"btn btn-outline-info ms-3\" onClick={() => this.onClickButton2()}>\r\n            {caption ?? '确认注销'}\r\n        </button>;\r\n    }\r\n    header() { return '注销账号' }\r\n    content() {\r\n        return <div className=\"border border-danger rounded mx-auto m-3 w-max-30c bg-white \">\r\n            <div className=\"p-4 border-bottom\">{this.note}</div>\r\n            <div className=\"p-3 text-center\">\r\n                {this.renderButton1()}\r\n                {this.renderButton2()}\r\n            </div>\r\n        </div>\r\n    }\r\n\r\n    protected onClickButton1() {\r\n        this.closePage();\r\n    }\r\n\r\n    protected onClickButton2() {\r\n    }\r\n}\r\n\r\nexport class VUserQuit extends VUserQuitBase {\r\n    protected get note(): any {\r\n        return <>\r\n            注意：账号注销后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。<br />\r\n            请确认！\r\n        </>;\r\n    }\r\n    protected get button2Caption(): string { return '我已了解，仍然注销'; }\r\n\r\n    protected onClickButton2() {\r\n        this.openVPage(VQuitConfirm);\r\n    }\r\n}\r\n\r\nclass VQuitConfirm extends VUserQuitBase {\r\n    protected get note(): any {\r\n        return <>\r\n            账号注销后，如果在{waitingTime}内容重新登录账号，账号自动恢复。\r\n            {waitingTime}之后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。<br />\r\n            请再次确认！\r\n        </>;\r\n    }\r\n    protected get button2Caption(): string { return '确认注销'; }\r\n\r\n    protected onClickButton1() {\r\n        this.closePage(2);\r\n    }\r\n\r\n    protected async onClickButton2() {\r\n        let centerAppApi = new CenterAppApi(this.controller.web, 'tv/', undefined);\r\n        await centerAppApi.userQuit();\r\n        this.openVPage(VQuitDone);\r\n    }\r\n}\r\n\r\nclass VQuitDone extends VUserQuitBase {\r\n    header() { return '注销已账号' }\r\n    protected get back(): 'close' | 'back' | 'none' { return 'none' }\r\n    protected get note(): any {\r\n        return <>\r\n            账号将在{waitingTime}后彻底注销。<br />\r\n            如果在{waitingTime}内容重新登录账号，注销操作自动取消。\r\n            {waitingTime}之后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。\r\n        </>;\r\n    }\r\n    protected get button1Caption(): string { return '退出'; }\r\n    protected get button2Caption(): string { return null; }\r\n    protected onClickButton1() {\r\n        this.tonwa.logout();\r\n    }\r\n}\r\n","import { User, CenterAppApi, Login } from 'tonwa-core';\r\nimport { ControllerWithWeb, VPage } from \"../vm\";\r\nimport { VLogout } from './VLogout';\r\nimport { VLogin } from './VLogin';\r\nimport { VChangePassword } from './VChangePassword';\r\nimport { VUserQuit } from './VUserQuit';\r\n\r\nexport class CLogin extends ControllerWithWeb implements Login {\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync showLogin(callback?: (user: User) => Promise<void>, withBack?: boolean): Promise<void> {\r\n\t\tlet onLogin = async (un: string, pwd: string): Promise<boolean> => {\r\n\t\t\tlet user = await this.web.userApi.login({\r\n\t\t\t\tuser: un,\r\n\t\t\t\tpwd: pwd,\r\n\t\t\t\tguest: this.tonwa.guest,\r\n\t\t\t});\r\n\r\n\t\t\tif (user === undefined) return false;\r\n\t\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n\t\t\tawait this.tonwa.userLogined(user, callback);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.openVPage(VLogin, { onLogin, withBack });\r\n\t}\r\n\r\n\tasync showLogout(callback?: () => Promise<void>) {\r\n\t\tthis.openVPage(VLogout, () => {\r\n\t\t\tthis.tonwa.logout(callback);\r\n\t\t});\r\n\t}\r\n\t/*\r\n\tasync showRegister() {\r\n\t\tlet cRegister = new (await import('./register')).CRegister(this.res);\r\n\t\tawait cRegister.start();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet cForget = new (await import('./register')).CForget(this.res);\r\n\t\tawait cForget.start();\r\n\t}\r\n\t*/\r\n\r\n\tprotected getVChangePassword(): new (cLogin: CLogin) => VPage<CLogin> {\r\n\t\treturn VChangePassword;\r\n\t}\r\n\tasync showChangePassword() {\r\n\t\tlet vPage = this.getVChangePassword();\r\n\t\tthis.openVPage(vPage, async (orgPassword: string, newPassword: string): Promise<boolean> => {\r\n\t\t\tlet centerAppApi = new CenterAppApi(this.web, 'tv/', undefined);\r\n\t\t\tlet ret = await centerAppApi.changePassword({ orgPassword, newPassword });\r\n\t\t\treturn ret;\r\n\t\t});\r\n\t}\r\n\r\n\tasync showUserQuit(): Promise<void> {\r\n\t\tthis.openVPage(VUserQuit);\r\n\t}\r\n}\r\n","export default __webpack_public_path__ + \"static/media/logo.2d27ead7.svg\";","import { mobileRegex, emailRegex } from 'tonwa-core';\r\nimport logo from '../img/logo.svg';\r\n\r\nexport const defaultLoginTop = <div className=\"d-flex align-items-center position-relative\">\r\n    <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\r\n    <div className=\"h3 flex-fill text-center\"><span className=\"text-primary me-3\">同</span>\r\n        <span className=\"text-danger\">花</span>\r\n    </div>\r\n</div>;\r\n\r\ninterface Sender {\r\n    type: string;\r\n    caption: string;\r\n    regex: RegExp;\r\n}\r\n\r\nconst senders: Sender[] = [\r\n    { type: 'mobile', caption: '手机号', regex: mobileRegex },\r\n    { type: 'email', caption: '邮箱', regex: emailRegex }\r\n];\r\n\r\nexport function getSender(un: string): Sender {\r\n    let sender = senders.find(v => v.regex.test(un) === true);\r\n    return sender;\r\n}","import fs from \"fs\";\r\nimport { capitalCase } from \"../tool\";\r\nimport { Entity, ID, IDX, IX, UqMan } from \"../uqCore\";\r\nimport { TsUQ } from \"./TsUQ\";\r\nimport { buildFieldItem } from \"./buildFieldItem\";\r\nimport { overrideTsFile, saveTsFileIfNotExists } from \"./tools\";\r\nimport { UqBuildContext } from \"./UqBuildContext\";\r\n\r\ninterface FieldItem {\r\n\tname: string;\r\n};\r\n\r\ninterface ReplaceSection {\r\n\tbegin: string;\r\n\tend: string;\r\n\tcontent: string;\r\n};\r\n\r\nconst fieldItemReplaceProps = ['label', 'placeholder', 'widget', 'type'];\r\n\r\nexport class TsUqFolder {\r\n\tprivate buildContext: UqBuildContext;\r\n\tprivate readonly uq: UqMan;\r\n\tprivate readonly uqsFolder: string;\r\n\tprivate readonly uqAlias: string;\r\n\r\n\tconstructor(buildContext: UqBuildContext, uq: UqMan, uqsFolder: string, uqAlias: string) {\r\n\t\tthis.buildContext = buildContext;\r\n\t\tthis.uq = uq;\r\n\t\tthis.uqsFolder = uqsFolder;\r\n\t\tthis.uqAlias = uqAlias;\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tlet uqFolder = this.uqsFolder + '/' + this.uqAlias;\r\n\t\tif (fs.existsSync(uqFolder) === false) {\r\n\t\t\tfs.mkdirSync(uqFolder);\r\n\t\t}\r\n\t\tlet tsUq = this.buildContext.tsTemplate.tsHeader;\r\n\t\tlet tsUqBuilder = new TsUQ(this.buildContext, this.uq, this.uqAlias);\r\n\t\t//tsUq += buildUQ(this.uq, this.uqAlias);\r\n\t\ttsUq += tsUqBuilder.build();\r\n\t\toverrideTsFile(`${uqFolder}/${this.uqAlias}.ts`, tsUq);\r\n\t\tthis.saveTuidAndIDTsIndexAndRender(uqFolder);\r\n\t}\r\n\r\n\tprivate saveTuidAndIDTsIndexAndRender(uqFolder: string) {\r\n\t\tlet imports = '', sets = '';\r\n\t\tlet { idArr, idxArr, tuidArr } = this.uq;  // ixArr, \r\n\t\tlet coll: { [name: string]: Entity } = {};\r\n\r\n\t\tfor (let i of tuidArr) {\r\n\t\t\tlet { sName } = i;\r\n\t\t\tcoll[sName.toLowerCase()] = i;\r\n\t\t\tlet cName = capitalCase(sName);\r\n\t\t\tif (cName[0] === '$') continue;\r\n\t\t\timports += `\\nimport * as ${cName} from './${cName}.ui';`;\r\n\t\t\tsets += `\\n\tassign(uq, '${cName}', ${cName});`;\r\n\r\n\t\t\tlet tsUI = `/* eslint-disable */\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-${this.buildContext.uiPlatform}';\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\r\nimport { Tuid${cName} } from \"./${this.uqAlias}\";\r\n\r\nconst resRaw: Res<any> = {\r\n\t$zh: {\r\n\t},\r\n\t$en: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|${this.buildContext.element}): string|${this.buildContext.element} => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: Tuid${cName}):${this.buildContext.element} {\r\n\treturn <>{uqStringify(item)}</>;\r\n};\r\n`;\r\n\r\n\t\t\tlet path = `${uqFolder}/${cName}.ui.tsx`;\r\n\t\t\tsaveTsFileIfNotExists(path, tsUI);\r\n\t\t}\r\n\r\n\t\tfor (let i of [...idArr, ...idxArr]) { // , ...ixArr IX does not need UI\r\n\t\t\tlet { sName } = i;\r\n\t\t\t//coll[sName.toLowerCase()] = i;\r\n\t\t\tlet cName = capitalCase(sName);\r\n\t\t\tif (cName[0] === '$') continue;\r\n\t\t\tcoll[cName.toLocaleLowerCase()] = i;\r\n\t\t\timports += `\\nimport * as ${cName} from './${cName}.ui';`;\r\n\t\t\tsets += `\\n\tassign(uq, '${cName}', ${cName});`;\r\n\r\n\t\t\tlet tsUI = `// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-${this.buildContext.uiPlatform}';\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\r\nimport { ${cName} } from \"./${this.uqAlias}\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"${cName}\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\t$zh: {\r\n\t},\r\n\t$en: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|${this.buildContext.element}): string|${this.buildContext.element} => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: ${cName}):${this.buildContext.element} {\r\n\treturn <>{uqStringify(item)}</>;\r\n};\r\n`;\r\n\r\n\t\t\tlet path = `${uqFolder}/${cName}.ui.tsx`;\r\n\t\t\tsaveTsFileIfNotExists(path, tsUI);\r\n\r\n\t\t\tlet fields = this.buildFields(i);\r\n\t\t\tlet tsFieldArr: string = this.buildFieldArr(i);\r\n\r\n\t\t\tthis.replaceTsFileFields(path, fields);\r\n\t\t\tlet tsImportFieldItemsBegin = 'import { FieldItem, ';\r\n\t\t\tlet tsImportFieldItemsEnd = ` } from \"tonwa-${this.buildContext.uiPlatform}\";`;\r\n\t\t\tlet tsImportFieldItems = 'FieldItemInt, FieldItemNumber, FieldItemString, FieldItemId';\r\n\t\t\tthis.replaceTsFileString(path,\r\n\t\t\t\t{\r\n\t\t\t\t\tbegin: tsImportFieldItemsBegin,\r\n\t\t\t\t\tend: tsImportFieldItemsEnd,\r\n\t\t\t\t\tcontent: tsImportFieldItemsBegin + tsImportFieldItems + tsImportFieldItemsEnd,\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t\tthis.replaceTsFileString(path,\r\n\t\t\t\t{ begin: '\\nconst fieldArr: FieldItem[] = [\\n', end: '\\n];\\n', content: tsFieldArr }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlet tsIndex = `import { UqExt as Uq, assign } from './${this.uqAlias}';${imports}\r\n\t\r\nexport function setUI(uq: Uq) {${sets}\r\n}\r\nexport * from './${this.uqAlias}';\r\n`;\r\n\t\toverrideTsFile(`${uqFolder}/index.ts`, tsIndex);\r\n\r\n\t\tlet files = fs.readdirSync(uqFolder);\r\n\t\tconst suffix = '.ui.tsx';\r\n\t\tfor (let file of files) {\r\n\t\t\tif (file.endsWith(suffix) === false) continue;\r\n\t\t\tlet from = file.length - suffix.length;\r\n\t\t\tlet fileEntityName = file.substring(0, from);\r\n\t\t\tlet entity = coll[fileEntityName.toLocaleLowerCase()];\r\n\t\t\tif (entity === undefined || fileEntityName[0] === '$') {\r\n\t\t\t\tlet unFile = `${uqFolder}/${file}`;\r\n\t\t\t\tfs.unlinkSync(unFile);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildFields(i: ID | IDX | IX): { [name: string]: FieldItem } {\r\n\t\tswitch (i.typeName) {\r\n\t\t\tcase 'id': return this.buildIDFields(i as ID);\r\n\t\t\tcase 'idx': return this.buildIDXFields(i);\r\n\t\t\tcase 'ix': return this.buildIXFields(i);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate buildIDFields(ID: ID): { [name: string]: FieldItem } {\r\n\t\tlet ret: { [name: string]: FieldItem } = {};\r\n\t\tlet { schema } = ID;\r\n\t\tlet { keys, fields } = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate buildIDXFields(IDX: IDX): { [name: string]: FieldItem } {\r\n\t\tlet ret: { [name: string]: FieldItem } = {};\r\n\t\tlet { schema } = IDX;\r\n\t\tlet { keys, fields } = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tprivate buildIXFields(IX: IX): { [name: string]: FieldItem } {\r\n\t\tlet ret: { [name: string]: FieldItem } = {};\r\n\t\tlet { schema } = IX;\r\n\t\tlet { keys, fields } = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tprivate buildFieldArr(i: ID | IDX | IX): string {\r\n\t\tlet ts = '\\nconst fieldArr: FieldItem[] = [\\n\\t';\r\n\t\tswitch (i.typeName) {\r\n\t\t\tcase 'id': ts += this.buildIDFieldArr(i as ID); break;\r\n\t\t\tcase 'idx': ts += this.buildIDXFieldArr(i); break;\r\n\t\t\tcase 'ix': ts += this.buildIXFieldArr(i); break;\r\n\t\t}\r\n\t\treturn ts += '\\n];\\n';\r\n\t}\r\n\r\n\tprivate buildIDFieldArr(i: ID): string {\r\n\t\tlet { schema } = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDXFieldArr(i: IDX): string {\r\n\t\tlet { schema } = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIXFieldArr(i: IX): string {\r\n\t\tlet { schema } = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'ix') continue;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate replaceTsFileFields(path: string, fields: { [name: string]: FieldItem }) {\r\n\t\tlet text = fs.readFileSync(path).toString();\r\n\t\tlet startStr = '\\n/*--fields--*/';\r\n\t\tlet endStr = '\\n/*==fields==*/\\n';\r\n\t\tlet start = text.indexOf(startStr);\r\n\t\tif (start > 0) {\r\n\t\t\tlet end = text.indexOf(endStr, start + startStr.length);\r\n\t\t\tif (end > 0) {\r\n\t\t\t\tlet lBrace = text.indexOf('{', start + startStr.length);\r\n\t\t\t\tlet rBrace = text.lastIndexOf('}', end);\r\n\t\t\t\tlet oldText = text.substring(lBrace, rBrace + 1);\r\n\t\t\t\tlet fieldsText = this.buildFieldsFromOldText(fields, oldText);\r\n\t\t\t\ttext = text.substring(0, start)\r\n\t\t\t\t\t+ startStr + '\\nconst fields = {'\r\n\t\t\t\t\t+ fieldsText\r\n\t\t\t\t\t+ '\\n};'\r\n\t\t\t\t\t+ text.substring(end);\r\n\t\t\t\tfs.writeFileSync(path, text);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildFieldsFromOldText(fields: { [name: string]: FieldItem }, oldText: string): string {\r\n\t\tlet ret = '';\r\n\t\tfor (let i in fields) {\r\n\t\t\tlet field = fields[i];\r\n\t\t\tthis.setFieldOldProp(field, oldText);\r\n\t\t\tret += this.buildFieldText(field);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate setFieldOldProp(field: FieldItem, text: string) {\r\n\t\tlet fieldStart = field.name + ':';\r\n\t\tlet start = text.indexOf('\\t' + fieldStart);\r\n\t\tif (start < 0) start = text.indexOf('\\n' + fieldStart);\r\n\t\tif (start < 0) start = text.indexOf(' ' + fieldStart);\r\n\t\tif (start < 0) return;\r\n\t\t++start;\r\n\t\tlet end = text.indexOf('}', start + fieldStart.length);\r\n\t\tif (end < 0) return;\r\n\t\tlet fieldText = text.substring(start + fieldStart.length, end + 1);\r\n\t\t/* eslint no-eval: 0 */\r\n\t\tlet obj = eval('(' + fieldText + ')');\r\n\t\tfieldItemReplaceProps.forEach(v => {\r\n\t\t\tlet prop = obj[v];\r\n\t\t\tif (!prop) return;\r\n\t\t\tif (v === 'type') return; // 这个是由新的schema决定的\r\n\t\t\t(field as any)[v] = prop;\r\n\t\t});\r\n\t}\r\n\r\n\tprivate buildFieldText(field: FieldItem): string {\r\n\t\tlet { $FieldItemType } = field as any;\r\n\t\tdelete (field as any).$FieldItemType;\r\n\t\tlet ret = '\\n\\t' + field.name + ': ';\r\n\t\tlet json = JSON.stringify(field, null, '\\t\\t');\r\n\t\tjson = json.replace('}', '\\t}');\r\n\t\tret += json;\r\n\t\treturn ret + ' as ' + $FieldItemType + ',';\r\n\t}\r\n\r\n\tprivate replaceTsFileString(path: string, sec: ReplaceSection) {\r\n\t\tlet text = fs.readFileSync(path).toString();\r\n\t\tlet { begin, end, content } = sec;\r\n\t\tlet b = text.indexOf(begin);\r\n\t\tif (b < 0) return;\r\n\t\tlet e = text.indexOf(end, b + begin.length - 1);\r\n\t\tif (e < 0) return;\r\n\t\ttext = text.substring(0, b) + content + text.substr(e + end.length);\r\n\t\tfs.writeFileSync(path, text);\r\n\t}\r\n}\r\n","import { UqBuildContext } from \"./UqBuildContext\";\r\nimport { camelCase, capitalCase } from \"../tool\";\r\nimport {\r\n\tUqMan, Action, Book, Query, Sheet\r\n\t, Tuid, UqEnum, Map, History, Pending\r\n\t, Entity, ID, IX, IDX, ArrFields, Field\r\n} from '../uqCore';\r\nimport { entityName } from \"./tools\";\r\n\r\nconst fieldTypeMap: { [type: string]: string } = {\r\n\t\"char\": \"string\",\r\n\t\"text\": \"string\",\r\n\t\"id\": \"number\",\r\n\t\"textid\": \"string\",\r\n\t\"int\": \"number\",\r\n\t\"bigint\": \"number\",\r\n\t\"smallint\": \"number\",\r\n\t\"tinyint\": \"number\",\r\n\t\"dec\": \"number\",\r\n\t\"float\": \"number\",\r\n\t\"double\": \"number\",\r\n};\r\nconst sysFields = ['id', 'main', 'row', 'no', '$create', '$update', '$owner'];\r\n\r\nexport class TsUQ {\r\n\tprivate buildContext: UqBuildContext;\r\n\tprivate readonly uq: UqMan;\r\n\tprivate readonly uqAlias: string;\r\n\r\n\tconstructor(buildContext: UqBuildContext, uq: UqMan, uqAlias: string) {\r\n\t\tthis.buildContext = buildContext;\r\n\t\tthis.uq = uq;\r\n\t\tthis.uqAlias = uqAlias;\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tlet tsImport = `\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { IDXValue, Uq`;\r\n\t\tlet ts: string = `\\n\\n`;\r\n\t\tts += '\\n//===============================';\r\n\t\tts += `\\n//======= UQ ${this.uq.name} ========`;\r\n\t\tts += '\\n//===============================';\r\n\t\tts += '\\n';\r\n\r\n\t\tlet { enumArr, tuidArr, actionArr, sheetArr\r\n\t\t\t, queryArr, bookArr, mapArr, historyArr\r\n\t\t\t, pendingArr, idArr, idxArr, ixArr\r\n\t\t} = this.uq;\r\n\t\tenumArr.forEach(v => ts += this.uqEntityInterface<UqEnum>(v, this.buildEnumInterface));\r\n\t\ttuidArr.forEach(v => ts += this.uqEntityInterface<Tuid>(v, this.buildTuidInterface));\r\n\t\tactionArr.forEach(v => ts += this.uqEntityInterface<Action>(v, this.buildActionInterface));\r\n\t\tsheetArr.forEach(v => ts += this.uqEntityInterface<Sheet>(v, this.buildSheetInterface));\r\n\t\tqueryArr.forEach(v => ts += this.uqEntityInterface<Query>(v, this.buildQueryInterface));\r\n\t\tbookArr.forEach(v => ts += this.uqEntityInterface<Book>(v, this.buildBookInterface));\r\n\t\tmapArr.forEach(v => ts += this.uqEntityInterface<Map>(v, this.buildMapInterface));\r\n\t\thistoryArr.forEach(v => ts += this.uqEntityInterface<History>(v, this.buildHistoryInterface));\r\n\t\tpendingArr.forEach(v => ts += this.uqEntityInterface<Pending>(v, this.buildPendingInterface));\r\n\t\tidArr.forEach(v => ts += this.uqEntityInterface<ID>(v, this.buildIDInterface));\r\n\t\tidxArr.forEach(v => ts += this.uqEntityInterface<IDX>(v, this.buildIDXInterface));\r\n\t\tidxArr.forEach(v => ts += this.uqEntityInterface<IDX>(v, this.buildIDXActParamInterface));\r\n\t\tixArr.forEach(v => ts += this.uqEntityInterface<IX>(v, this.buildIXInterface));\r\n\r\n\t\tts += this.buildActsInterface(this.uq);\r\n\r\n\t\tts += `\r\n\r\nexport interface UqExt extends Uq {\r\n\tActs(param:ParamActs): Promise<any>;\r\n\tSQL: Uq;\r\n\tIDRender(id:number):${this.buildContext.element};\r\n\tIDLocalRender(id:number):${this.buildContext.element};\r\n`;\r\n\t\tfunction appendArr<T extends Entity>(arr: T[], type: string, tsBuild: (v: T) => string) {\r\n\t\t\tif (arr.length === 0) return;\r\n\t\t\tlet tsLen = ts.length;\r\n\t\t\tarr.forEach(v => ts += tsBuild(v));\r\n\t\t\tif (ts.length - tsLen > 0) {\r\n\t\t\t\ttsImport += ', Uq' + type;\r\n\t\t\t}\r\n\t\t}\r\n\t\tappendArr<Tuid>(tuidArr, 'Tuid', v => this.uqBlock<Tuid>(v, this.buildTuid));\r\n\t\tappendArr<Action>(actionArr, 'Action', v => this.uqBlock<Action>(v, this.buildAction));\r\n\t\tappendArr<Sheet>(sheetArr, 'Sheet', v => this.uqBlock<Sheet>(v, this.buildSheet));\r\n\t\tappendArr<Book>(bookArr, 'Book', v => this.uqBlock<Book>(v, this.buildBook));\r\n\t\tappendArr<Query>(queryArr, 'Query', v => this.uqBlock<Query>(v, this.buildQuery));\r\n\t\tappendArr<Map>(mapArr, 'Map', v => this.uqBlock<Map>(v, this.buildMap));\r\n\t\tappendArr<History>(historyArr, 'History', v => this.uqBlock<History>(v, this.buildHistory));\r\n\t\tappendArr<Pending>(pendingArr, 'Pending', v => this.uqBlock<Pending>(v, this.buildPending));\r\n\t\tappendArr<ID>(idArr, 'ID', v => this.uqBlock<ID>(v, this.buildID));\r\n\t\tappendArr<IDX>(idxArr, 'IDX', v => this.uqBlock<IDX>(v, this.buildIDX));\r\n\t\tappendArr<IX>(ixArr, 'IX', v => this.uqBlock<IX>(v, this.buildIX));\r\n\t\tts += '\\n}\\n';\r\n\t\tts += `\r\nexport function assign(uq: any, to:string, from:any): void {\r\n\tlet hasEntity = uq.hasEntity(to);\r\n\tif (hasEntity === false) {\r\n\t\treturn;\r\n\t}\r\n\tObject.assign((uq as any)[to], from);\r\n}\r\n`;\r\n\r\n\t\ttsImport += ` } from \"tonwa-core\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { Render, IDXEntity } from \"tonwa-${this.buildContext.uiPlatform}\";`;\r\n\r\n\t\treturn tsImport + ts;\r\n\t}\r\n\r\n\tprivate uqEntityInterface<T extends Entity>(entity: T, buildInterface: (entity: T) => string) {\r\n\t\tlet { name } = entity;\r\n\t\tif (name.indexOf('$') > 0) return '';\r\n\t\tlet entityCode = buildInterface(entity);\r\n\t\tif (!entityCode) return '';\r\n\t\treturn '\\n' + entityCode + '\\n';\r\n\t}\r\n\r\n\tprivate uqBlock<T extends Entity>(entity: T, build: (entity: T) => string) {\r\n\t\tlet { name } = entity;\r\n\t\tif (name.indexOf('$') > 0) return '';\r\n\t\tlet entityCode = build(entity);\r\n\t\tif (!entityCode) return '';\r\n\t\treturn '\\n' + entityCode;\r\n\t}\r\n\r\n\tprivate buildFields(fields: Field[], isInID: boolean = false, indent: number = 1) {\r\n\t\tif (!fields) return '';\r\n\t\tlet ts = '';\r\n\t\tfor (let f of fields) {\r\n\t\t\tts += this.buildField(f, isInID, indent);\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildField(field: Field, isInID: boolean, indent: number = 1) {\r\n\t\tlet { name, type } = field;\r\n\t\tlet s = fieldTypeMap[type];\r\n\t\tif (!s) s = 'any';\r\n\t\tlet q: string = (isInID === true && sysFields.indexOf(name) >= 0) ? '?' : '';\r\n\t\treturn `\\n${'\\t'.repeat(indent)}${name}${q}: ${s};`;\r\n\t}\r\n\r\n\tprivate buildArrs(arrFields: ArrFields[]): string {\r\n\t\tif (!arrFields) return '';\r\n\t\tlet ts = '\\n';\r\n\t\tfor (let af of arrFields) {\r\n\t\t\tts += `\\t${camelCase(af.name)}: {`;\r\n\t\t\tts += this.buildFields(af.fields, false, 2);\r\n\t\t\tts += '\\n\\t}[];\\n';\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildReturns(entity: Entity, returns: ArrFields[]): string {\r\n\t\tif (!returns) return;\r\n\t\t//let {typeName} = entity;\r\n\t\t//let type = typeMap[typeName] || typeName;\r\n\t\tlet { sName } = entity;\r\n\t\tsName = capitalCase(sName);\r\n\t\tlet ts = '';\r\n\t\tfor (let ret of returns) {\r\n\t\t\tlet retName = capitalCase(ret.name);\r\n\t\t\tts += `export interface Return${sName}${retName} {`;\r\n\t\t\tts += this.buildFields(ret.fields);\r\n\t\t\tts += '\\n}\\n';\r\n\t\t}\r\n\r\n\t\tts += `export interface Result${sName} {\\n`;\r\n\t\tfor (let ret of returns) {\r\n\t\t\tlet retName = capitalCase(ret.name);\r\n\t\t\tts += `\\t${ret.name}: Return${sName}${retName}[];\\n`;\r\n\t\t}\r\n\t\tts += '}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildTuid = (tuid: Tuid) => {\r\n\t\tlet ts = `\\t${entityName(tuid.sName)}: UqTuid<Tuid${capitalCase(tuid.sName)}>&{tv:(id:number, render?:Render<any>)=>${this.buildContext.element}};`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildTuidInterface = (tuid: Tuid) => {\r\n\t\tlet ts = `export interface Tuid${capitalCase(tuid.sName)} {`;\r\n\t\tts += `\\n\\tid?: number;`;\r\n\t\tts += this.buildFields(tuid.fields);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildAction = (action: Action) => {\r\n\t\tlet ts = `\\t${entityName(action.sName)}: UqAction<Param${capitalCase(action.sName)}, Result${capitalCase(action.sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildActionInterface = (action: Action) => {\r\n\t\tlet ts = `export interface Param${capitalCase(action.sName)} {`;\r\n\t\tts += this.buildFields(action.fields);\r\n\t\tts += this.buildArrs(action.arrFields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(action, action.returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildEnumInterface = (enm: UqEnum) => {\r\n\t\tlet { schema } = enm;\r\n\t\tif (!schema) return;\r\n\t\tlet { values } = schema;\r\n\t\tlet ts = `export enum ${capitalCase(enm.sName)} {`;\r\n\t\tlet first: boolean = true;\r\n\t\tfor (let i in values) {\r\n\t\t\tif (first === false) {\r\n\t\t\t\tts += ',';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfirst = false;\r\n\t\t\t}\r\n\t\t\tlet v = values[i];\r\n\t\t\tts += '\\n\\t' + i + ' = ';\r\n\t\t\tif (typeof v === 'string') {\r\n\t\t\t\tts += '\"' + v + '\"';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tts += v;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ts += '\\n}'\r\n\t}\r\n\r\n\tprivate buildQuery = (query: Query) => {\r\n\t\tlet { sName } = query;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqQuery<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildQueryInterface = (query: Query) => {\r\n\t\tlet ts = `export interface Param${capitalCase(query.sName)} {`;\r\n\t\tts += this.buildFields(query.fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(query, query.returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildSheet = (sheet: Sheet) => {\r\n\t\tlet { sName, verify } = sheet;\r\n\t\tlet cName = capitalCase(sName);\r\n\t\tlet v = verify ? `Verify${cName}` : 'any';\r\n\t\tlet ts = `\\t${entityName(sName)}: UqSheet<Sheet${cName}, ${v}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildSheetInterface = (sheet: Sheet) => {\r\n\t\tlet { sName, fields, arrFields, verify } = sheet;\r\n\t\tlet ts = `export interface Sheet${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += this.buildArrs(arrFields);\r\n\t\tts += '}';\r\n\r\n\t\tif (verify) {\r\n\t\t\tlet { returns } = verify;\r\n\t\t\tts += `\\nexport interface Verify${capitalCase(sName)} {`;\r\n\t\t\tfor (let item of returns) {\r\n\t\t\t\tlet { name: arrName, fields } = item;\r\n\t\t\t\tts += '\\n\\t' + arrName + ': {';\r\n\t\t\t\tts += this.buildFields(fields, false, 2);\r\n\t\t\t\tts += '\\n\\t}[];';\r\n\t\t\t}\r\n\t\t\tts += '\\n}';\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildBook = (book: Book): string => {\r\n\t\tlet { sName } = book;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqBook<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildBookInterface = (book: Book): string => {\r\n\t\tlet { sName, fields, returns } = book;\r\n\t\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(book, returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildMap = (map: Map): string => {\r\n\t\tlet { sName } = map;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqMap;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildMapInterface = (map: Map): string => {\r\n\t\t/*\r\n\t\tlet {sName, fields, returns} = map;\r\n\t\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += buildReturns(map, returns);\r\n\t\treturn ts;\r\n\t\t*/\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate buildHistory = (history: History): string => {\r\n\t\tlet { sName } = history;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqHistory<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildHistoryInterface = (history: History): string => {\r\n\t\tlet { sName, fields, returns } = history;\r\n\t\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(history, returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildPending = (pending: Pending): string => {\r\n\t\tlet { sName } = pending;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqPending<any, any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildPendingInterface = (pending: Pending): string => {\r\n\t\t/*\r\n\t\tlet {sName, fields, returns} = pending;\r\n\t\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += buildReturns(pending, returns);\r\n\t\treturn ts;\r\n\t\t*/\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate buildID = (id: ID): string => {\r\n\t\tlet { sName } = id;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqID<any> & IDXEntity<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDX = (idx: IDX): string => {\r\n\t\tlet { sName } = idx;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqIDX<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIX = (ix: IX): string => {\r\n\t\tlet { sName } = ix;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqIX<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDInterface = (idEntity: ID): string => {\r\n\t\tlet { sName, fields, schema } = idEntity;\r\n\t\tlet { keys: schemaKeys } = schema;\r\n\t\tlet keys: Field[] = [], others: Field[] = [];\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { name } = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tif ((schemaKeys as any[]).find(v => v.name === name)) keys.push(f);\r\n\t\t\telse others.push(f);\r\n\t\t}\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tts += `\\n\\tid?: number;`;\r\n\t\tts += this.buildFields(keys, true);\r\n\t\tts += this.buildFields(others, true);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDXInterface = (idx: IDX): string => {\r\n\t\tlet { sName, fields, schema } = idx;\r\n\t\tlet { exFields } = schema;\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tlet indent = 1;\r\n\t\tfor (let field of fields) {\r\n\t\t\tlet { name, type } = field;\r\n\t\t\tlet s = fieldTypeMap[type];\r\n\t\t\tif (!s) s = 'any';\r\n\t\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\t\tif (name !== 'id') ts += '?';\r\n\t\t\tts += `: ${s};`;\r\n\t\t}\r\n\r\n\t\tts += `\\n\\t$act?: number;`;\r\n\r\n\t\tlet hasTrack: boolean = false;\r\n\t\tlet hasMemo: boolean = false;\r\n\t\tif (exFields) {\r\n\t\t\tfor (let exField of exFields) {\r\n\t\t\t\tlet { track, memo } = exField;\r\n\t\t\t\tif (track === true) hasTrack = true;\r\n\t\t\t\tif (memo === true) hasMemo = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasTrack === true) {\r\n\t\t\tts += `\\n\\t$track?: number;`;\r\n\t\t}\r\n\t\tif (hasMemo === true) {\r\n\t\t\tts += `\\n\\t$memo?: string;`;\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDXActParamInterface = (idx: IDX): string => {\r\n\t\tlet { sName, fields, schema } = idx;\r\n\t\tlet { exFields } = schema;\r\n\t\tlet ts = `export interface ActParam${capitalCase(sName)} {`;\r\n\t\tlet indent = 1;\r\n\t\tfor (let field of fields) {\r\n\t\t\tlet { name, type } = field;\r\n\t\t\tlet s = fieldTypeMap[type];\r\n\t\t\tif (!s) s = 'any';\r\n\t\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\t\tif (name !== 'id') ts += '?';\r\n\t\t\tts += `: ${s}|IDXValue;`;\r\n\t\t}\r\n\r\n\t\tts += `\\n\\t$act?: number;`;\r\n\r\n\t\tlet hasTrack: boolean = false;\r\n\t\tlet hasMemo: boolean = false;\r\n\t\tif (exFields) {\r\n\t\t\tfor (let exField of exFields) {\r\n\t\t\t\tlet { track, memo } = exField;\r\n\t\t\t\tif (track === true) hasTrack = true;\r\n\t\t\t\tif (memo === true) hasMemo = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasTrack === true) {\r\n\t\t\tts += `\\n\\t$track?: number;`;\r\n\t\t}\r\n\t\tif (hasMemo === true) {\r\n\t\t\tts += `\\n\\t$memo?: string;`;\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIXInterface = (ix: IX): string => {\r\n\t\tlet { sName, fields } = ix;\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildActsInterface(uq: UqMan) {\r\n\t\tlet ts = `\\nexport interface ParamActs {`;\r\n\t\tuq.idArr.forEach(v => {\r\n\t\t\tlet { sName } = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tuq.idxArr.forEach(v => {\r\n\t\t\tlet { sName } = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ActParam${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tuq.ixArr.forEach(v => {\r\n\t\t\tlet { sName } = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tts += '\\n}\\n';\r\n\t\treturn ts;\r\n\t}\r\n}","import * as React from 'react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, UiImageItem } from '../components';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    data: any;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            data: observable,\r\n        })\r\n        let { nick, icon } = tonwa.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        //let {name} = itemSchema;        \r\n        //await userApi.userSetProp(name, newValue);\r\n        throw new Error('await userApi.userSetProp(name, newValue);');\r\n        /*\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n        */\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { Page, LMR } from \"../components\";\r\nimport { VPage } from '../vm';\r\n//import { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\n//import { UQsMan } from '../uq';\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase<any>> {\r\n    private params: { predefinedUnit: number, uqsLoadErrors: string[] };\r\n    async open(params: { predefinedUnit: number, uqsLoadErrors: string[] }) {\r\n        this.params = params;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = () => {\r\n        let { predefinedUnit, uqsLoadErrors } = this.params;\r\n        let { user } = this.tonwa;\r\n        let userName: string = user ? user.name : '[未登录]';\r\n        //let {appOwner, appName} = UQsMan.value;\r\n        return <Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\r\n                </div>\r\n                {\r\n                    uqsLoadErrors && uqsLoadErrors.map(v => {\r\n                        return <div className=\"mb-3 row\">\r\n                            <div className=\"col-sm-3 font-weight-bold\">App</div>\r\n                            <div className=\"col-sm text-body\">{v}</div>\r\n                        </div>\r\n                    })\r\n                }\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                        预设小号定义在 public/unit.json 文件中。\r\n                        定义了这个文件的程序，只能由url直接启动。\r\n                        用户第一次访问app之后，会缓存在localStorage里。<br />\r\n                        如果要删去缓存的预定义Unit，logout然后再login。\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n    /*\r\n    <div className=\"mb-3 row\">\r\n        <div className=\"col-sm-3 font-weight-bold\">\r\n            可能原因<FA name=\"exclamation-triangle\" />\r\n        </div>\r\n        <div className=\"col-sm text-body\">\r\n            <ul className=\"p-0\">\r\n                <li>没有小号运行 {appName}</li>\r\n                <li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\r\n                {\r\n                    predefinedUnit && \r\n                    <li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\r\n                }\r\n            </ul>\r\n        </div>\r\n    </div>\r\n    */\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase<any>> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number): JSX.Element => {\r\n        let { id, nick, name } = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (appUnit: any) => {\r\n        //appInFrame.unit = appUnit.id; // 25;\r\n        //this.controller.setAppUnit(appUnit);\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n            <div>this.controller.appUnits appUnits removed</div>\r\n        </Page>\r\n        // <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n    }\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase<any>> {\r\n    async open(errors: string[]) {\r\n        this.openPage(this.page, { errors: errors });\r\n    }\r\n\r\n    private page = (errors: { errors: string[] }) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n                <div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n                    <button className=\"btn btn-danger\" onClick={this.tonwa.resetAll}>重启网页</button>\r\n                </div>\r\n\r\n                <div>Load Uqs 发生错误：</div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase<any>> {\r\n    async open(error: any) {\r\n        this.openPage(this.page, { error });\r\n    }\r\n\r\n    private page = ({ error }: { error: any }) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string' ? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport {\r\n\tUqMan, Uq as UqCore, Web\r\n} from \"tonwa-core\";\r\n\r\nexport class Uq {\r\n\tprivate web: Web;\r\n\tprivate $_uqMan: UqMan;\r\n\tprivate $_uqSql: UqCore;\r\n\tconstructor(web: Web, uqMan: UqMan) {\r\n\t\tthis.web = web;\r\n\t\tthis.$_uqMan = uqMan;\r\n\t\tthis.$_uqSql = this.$_createUqSqlProxy();\r\n\t}\r\n\r\n\t$_createProxy() {\r\n\t\tlet ret = new Proxy(this.$_uqMan.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tif (key === '$') {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tif (key === 'SQL') {\r\n\t\t\t\t\treturn this.$_uqSql;\r\n\t\t\t\t}\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet func = (this.$_uqMan as any)[key];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tfunc = (this as any)[key];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tlet err = `entity ${this.$_uqMan.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error('UQ错误：' + err);\r\n\t\t\t\tthis.showReload('服务器正在更新');\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate $_createUqSqlProxy(): UqCore {\r\n\t\tlet ret = new Proxy(this.$_uqMan, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet ret = (target as any)['$' + (key as string)];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet err = `entity ${this.$_uqMan.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error('UQ错误：' + err);\r\n\t\t\t\tthis.$_uqMan.showReload('服务器正在更新');\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret as unknown as UqCore;\r\n\t}\r\n\r\n\tprivate showReload(msg: string) {\r\n\t\t//console.error('uq proxy error name', msg);\r\n\t\tlet cache = this.$_uqMan.localMap.child('$reload-tick');\r\n\t\tlet reloadTick = cache.get();\r\n\t\tif (!reloadTick) reloadTick = 0;\r\n\t\tconsole.error(msg);\r\n\t\tthis.$_uqMan.localMap.removeAll();\r\n\t\tlet tick = Date.now();\r\n\t\tcache.set(tick);\r\n\t\tif (tick - reloadTick < 10 * 1000) {\r\n\t\t\tthis.web.showReloadPage(msg);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.web.reload();\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\tIDTv(ids: number[]): Promise<any[]> {\r\n\t\treturn this.$_uqMan.IDTv(ids);\r\n\t}\r\n\t*/\r\n\r\n\tprotected IDRender = (id: number, render?: (value: any) => JSX.Element): JSX.Element => {\r\n\t\tif (id === undefined || id === null) return null;\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet ret = this.$_uqMan.idCache.getValue(id);\r\n\t\t\tif (ret === undefined) {\r\n\t\t\t\treturn React.createElement('span', { props: { className: 'text-muted' }, children: ['id=' + id] });\r\n\t\t\t}\r\n\t\t\tlet { $type } = ret as any;\r\n\t\t\tif (!$type) return this.renderIDUnknownType(id);\r\n\t\t\tlet IDType = this.$_uqMan.ids[$type];\r\n\t\t\tif (!IDType) return this.renderIDUnknownType(id);\r\n\t\t\treturn (render ?? (IDType as any).render)(ret);\r\n\t\t}));\r\n\t}\r\n\r\n\tprotected IDV = <T extends object>(id: number): T => {\r\n\t\tlet ret = this.$_uqMan.idCache.getValue(id);\r\n\t\treturn ret as T;\r\n\t}\r\n\r\n\tprivate renderIDUnknownType(id: number) {\r\n\t\treturn React.createElement('span', { props: { className: 'text-muted' }, children: [`id=${id} type undefined`] });\r\n\t}\r\n\t/*\r\n\tIDLocalTv(ids: number[]): Promise<any[]> {\r\n\t\treturn this.IDTv(ids.map(v => -v));\r\n\t}\r\n\t*/\r\n\tprotected IDLocalV = <T extends object>(id: number): T => {\r\n\t\treturn this.IDV(-id);\r\n\t}\r\n\r\n\tprotected IDLocalRender = (id: number, render?: (value: any) => JSX.Element): JSX.Element => {\r\n\t\tif (id === undefined || id === null) return null;\r\n\t\treturn this.IDRender(-id, render);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { UQsMan, TuidInner, uqStringify, TuidImport, Web } from \"tonwa-core\";\r\nimport { Render } from \"../ui\";\r\nimport { Uq } from \"./Uq\";\r\n\r\nexport function createUQsProxy(web: Web, uqsMan: UQsMan) {\r\n    buildTuidTv();\r\n    const uqReacts: { [key: string]: any } = {};\r\n    function setUq(uqKey: string, proxy: any): void {\r\n        if (!uqKey) return;\r\n        let lower = uqKey.toLowerCase();\r\n        uqReacts[uqKey] = proxy;\r\n        if (lower !== uqKey) uqReacts[lower] = proxy;\r\n    }\r\n    for (let uqMan of uqsMan.uqMans) {\r\n        let uqReact = new Uq(web, uqMan);\r\n        let proxy = uqReact.$_createProxy();\r\n        setUq(uqMan.getUqKey(), proxy);\r\n        setUq(uqMan.getUqKeyWithConfig(), proxy);\r\n    }\r\n    function onUqProxyError(key: string) {\r\n        for (let i in uqReacts) {\r\n            let uqReact = uqReacts[i];\r\n            uqReact.localMap.removeAll();\r\n        }\r\n        //this.web.showReloadPage(msg);\r\n        console.error(`uq proxy ${key} error`);\r\n    }\r\n    return new Proxy(uqReacts, {\r\n        get: (target, key, receiver) => {\r\n            let lk = (key as string).toLowerCase();\r\n            let ret = target[lk];\r\n            if (ret !== undefined) return ret;\r\n            debugger;\r\n            console.error(`controller.uqs.${String(key)} undefined`);\r\n            onUqProxyError(String(key));\r\n            return undefined;\r\n        },\r\n    });\r\n}\r\n\r\nfunction buildTuidTv() {\r\n    (TuidInner.prototype as any).tv = function (this: any, id: number, render?: Render<any>): JSX.Element {\r\n        const TuidView = observer(() => {\r\n            let obj = this.valueFromId(id);\r\n            if (obj === undefined) {\r\n                this.useId(id);\r\n                return <>{this.sName}:{id}</>;\r\n            }\r\n            let r: Render<any>;\r\n            if (render) {\r\n                r = render;\r\n            }\r\n            else if (this.render) {\r\n                r = this.render;\r\n            }\r\n            else {\r\n                console.log('render', render, 'this.render', this.render);\r\n                r = (item: any) => {\r\n                    return <>{this.sName}:{uqStringify(item)}</>;\r\n                };\r\n            }\r\n            return r(obj);\r\n        });\r\n        return <><TuidView /></>;\r\n    };\r\n\r\n    (TuidImport.prototype as any).tv = function (this: any, id: number, render?: Render<any>): JSX.Element {\r\n        return this.tuidLocal?.tv(id, render);\r\n    };\r\n}\r\n","import { /*centerApi, logoutApis, */AppConfig as AppConfigCore, Tonwa, UqQuery, Web } from \"tonwa-core\";\r\nimport { User, UqsConfig as UqsConfigCore } from 'tonwa-core';\r\nimport { RouteFunc, Hooks, Navigo, NamedRoute } from \"tonwa-core\";\r\nimport { UQsLoader, UQsMan } from \"tonwa-core\";\r\nimport { setGlobalRes } from 'tonwa-core';\r\nimport { ControllerWithWeb } from '../vm';\r\nimport { VErrorsPage, VStartError } from \"./vMain\";\r\nimport { createUQsProxy } from \"../uq\";\r\nimport { t } from \"../ui\";\r\n\r\nexport interface IConstructor<T> {\r\n\tnew(...args: any[]): T;\r\n}\r\n\r\n/*\r\nexport interface DevConfig {\r\n\tname: string;\r\n\talias?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqConfig {\r\n\tdev: DevConfig;\r\n\tname: string;\r\n\talias?: string;\t\r\n\tversion?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqsConfig {\r\n\tapp?: {\r\n\t\tdev: DevConfig;\r\n\t\tname: string;\r\n\t\tversion?: string;\r\n\t};\r\n\tuqs?: UqConfig[];\r\n}\r\n*/\r\n\r\nexport type UqsConfig = UqsConfigCore;\r\nexport interface AppConfig extends AppConfigCore /*UqsConfig*/ {\r\n\t/*\r\n\tapp?: {\r\n\t\tname: string;\r\n\t\tversion: string;\r\n\t\townerMap?: {[key:string]: string};\r\n\t};\r\n\t*/\r\n\t//appName: string;        // 格式: owner/appName\r\n\tversion: string;        // 版本变化，缓存的uqs才会重载\r\n\t//tvs?: TVs;\r\n\t//uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n\tloginTop?: JSX.Element;\r\n\toem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// app的运行，不跟unit绑定\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id: string]: (element: HTMLElement) => void,\r\n}\r\n\r\nexport abstract class CAppBase<U> extends ControllerWithWeb {\r\n\tprivate appConfig: AppConfig;\r\n\tprivate uqsMan: UQsMan;\r\n\tprotected _uqs: U;\r\n\treadonly web: Web;\r\n\ttimezone: number;\r\n\tunitTimezone: number;\r\n\tunitBizMonth: number;\r\n\tunitBizDate: number;\r\n\r\n\tconstructor(tonwa: Tonwa, config?: AppConfig) {\r\n\t\tsuper(tonwa);\r\n\t\tthis.web = tonwa.web;\r\n\t\t//this.nav = new Nav(tonwa); // nav;\r\n\t\tthis.appConfig = config || (tonwa.navSettings as AppConfig);\r\n\t\tif (this.appConfig) {\r\n\t\t\tlet { app, uqs } = this.appConfig;\r\n\t\t\tif (app === undefined && uqs === undefined) {\r\n\t\t\t\tthrow new Error('app or uqs must be defined in AppConfig');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget uqs(): U { return this._uqs; }\r\n\r\n\tinternalT(str: string): any {\r\n\t\treturn t(str);\r\n\t}\r\n\r\n\tsetRes(res: any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\tprotected afterBuiltUQs(uqs: any) { }\r\n\r\n\tprotected async loadUnitTime($getTimezone: UqQuery<any, any>) {\r\n\t\tlet ret = await $getTimezone.query({});\r\n\t\tlet tz = ret.ret[0];\r\n\t\tthis.timezone = tz.timezone ?? 8;\r\n\t\tthis.unitTimezone = tz.unitTimeZone ?? 8;\r\n\t\tthis.unitBizMonth = (tz.unitBizMonth ?? 1) - 1;\r\n\t\tthis.unitBizDate = tz.unitBizDate ?? 1;\r\n\t}\r\n\r\n\tbizDate(date: Date): Date {\r\n\t\tlet year: number, month: number, d: number;\r\n\t\tyear = date.getFullYear();\r\n\t\tmonth = date.getMonth();\r\n\t\td = date.getDate();\r\n\t\tlet bm = this.unitBizMonth;\r\n\t\tlet bd = this.unitBizDate;\r\n\t\tif (bd < 0) {\r\n\t\t\tif (d < -bd) --month;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (d >= bd) ++month;\r\n\t\t}\r\n\t\tif (bm < 0) {\r\n\t\t\tif (month < -bm) --year;\r\n\t\t\tmonth = (month - bm) % 12;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (month >= bm) ++year;\r\n\t\t\tmonth = (month + bm) % 12;\r\n\t\t}\r\n\t\treturn new Date(year, month, 1);\r\n\t}\r\n\r\n\tprivate uqsUser: any = '';\r\n\tprotected async initUQs(): Promise<any> {\r\n\t\tif (!this.appConfig) return;\r\n\t\tlet { user } = this.tonwa;\r\n\t\tif (user === this.uqsUser) return;\r\n\t\tthis.uqsUser = user;\r\n\t\tthis.web.logoutApis();\r\n\t\tlet uqsLoader = new UQsLoader(this.tonwa, this.appConfig);\r\n\t\tlet retErrors = await uqsLoader.build();\r\n\t\tthis.uqsMan = uqsLoader.uqsMan;\r\n\t\tthis._uqs = createUQsProxy(this.web, uqsLoader.uqsMan) as any; //  this.uqsMan.proxy;\r\n\t\tthis.afterBuiltUQs(this._uqs);\r\n\t\treturn retErrors;\r\n\t}\r\n\r\n\tprotected async beforeStart(): Promise<boolean> {\r\n\t\ttry {\r\n\t\t\tthis.onNavRoutes();\r\n\t\t\tlet retErrors = await this.initUQs();\r\n\t\t\tif (retErrors !== undefined) {\r\n\t\t\t\tthis.openVPage(VErrorsPage, retErrors);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tthis.openVPage(VStartError, err);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\tprotected async afterStart(): Promise<void> {\r\n\t\tthis.tonwa.resolveRoute();\r\n\t\tthis.tonwa.onChangeLogin = (user: User) => this.onChangeLogin(user);\r\n\t\tthis.onChangeLogin(this.user);\r\n\t}\r\n\r\n\tasync userFromId(userId: number): Promise<any> {\r\n\t\treturn await this.web.centerApi.userFromId(userId);\r\n\t}\r\n\r\n\tasync userFromName(userName: string): Promise<any> {\r\n\t\treturn await this.web.centerApi.userFromKey(userName);\r\n\t}\r\n\r\n\tprotected on(routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\tprotected on(url: string, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\tprotected on(regex: RegExp, routeFunc: RouteFunc, hooks?: Hooks): Navigo;\r\n\tprotected on(options: { [url: string]: RouteFunc | NamedRoute }): Navigo;\r\n\tprotected on(...args: any[]): Navigo {\r\n\t\treturn this.tonwa.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprotected onNavRoutes() { return; }\r\n\r\n\tasync getUqRoles(uqName: string): Promise<string[]> {\r\n\t\tlet { user } = this.tonwa;\r\n\t\tif (!user) return null;\r\n\t\tlet { roles: userRoles } = user;\r\n\t\tlet uq = uqName.toLowerCase();\r\n\t\tlet roles: string[];\r\n\t\tif (userRoles) {\r\n\t\t\troles = userRoles[uq];\r\n\t\t}\r\n\t\tif (roles) return roles;\r\n\r\n\t\troles = await this.uqsMan.getUqUserRoles(uq);\r\n\t\tif (!roles) roles = null;\r\n\t\tthis.tonwa.setUqRoles(uq, roles);\r\n\t\treturn roles;\r\n\t}\r\n\t/*\r\n\tisAdmin(roles: string[]): boolean {\r\n\t\treturn this.isRole(roles, '$');\r\n\t}\r\n\r\n\tisRole(roles: string[], role: string): boolean {\r\n\t\tif (!roles) return false;\r\n\t\trole = role.toLowerCase();\r\n\t\treturn roles.indexOf(role) >= 0;\r\n\t}\r\n\t*/\r\n\r\n\tprotected onChangeLogin(user: User): Promise<void> {\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { Tonwa } from 'tonwa-core';\r\nimport { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (tonwa: Tonwa, config: AppConfig) => CAppBase<any>, tonwa: Tonwa, appConfig: AppConfig, isUserLogin?: boolean) {\r\n\tif (appConfig) {\r\n\t\tlet { htmlTitle } = appConfig;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tlet cApp = new CApp(tonwa, appConfig);\r\n\tawait cApp.start(isUserLogin);\r\n}\r\n","import { User, Web } from 'tonwa-core';\r\nimport { ControllerWithWeb, WebNav } from \"../vm\";\r\nimport { CAppBase, IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase<A extends CAppBase<U>, U> extends ControllerWithWeb {\r\n\tconstructor(cApp: A) {\r\n\t\tsuper(cApp.getTonwa());\r\n\t\tthis.cApp = cApp;\r\n\t\tif (cApp) {\r\n\t\t\tlet { uqs, web } = cApp;\r\n\t\t\tthis.uqs = uqs;\r\n\t\t\tthis.web = web;\r\n\t\t\t//this.nav = nav;\r\n\t\t}\r\n\t}\r\n\r\n\treadonly cApp: A;\r\n\treadonly uqs: U;\r\n\treadonly web: Web;\r\n\tget timezone(): number { return this.cApp.timezone; }\r\n\tget unitTimezone(): number { return this.cApp.unitTimezone; }\r\n\tbizDate(date: Date): Date { return this.cApp.bizDate(date); }\r\n\r\n\tasync getUqRoles(uqName: string): Promise<string[]> {\r\n\t\treturn this.cApp?.getUqRoles(uqName);\r\n\t}\r\n\r\n\tprotected async internalStart(param?: any, ...params: any[]): Promise<void> { }\r\n\r\n\tinternalT(str: string): any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r !== undefined) return r;\r\n\t\treturn this.cApp.internalT(str);\r\n\t}\r\n\r\n\tprotected newC<T extends CBase<A, U>>(type: IConstructor<T>, ...param: any[]): T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.internalInit(...param);\r\n\t\treturn c;\r\n\t}\r\n\r\n\tnewSub<O extends CBase<A, U>, T extends CSub<A, U, O>>(type: IConstructor<T>, ...param: any[]): T {\r\n\t\tlet s = new type(this);\r\n\t\ts.internalInit(...param);\r\n\t\treturn s;\r\n\t}\r\n\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this.cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ret = Object.assign({}, wn);\r\n\t\tObject.assign(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync userFromId(userId: number): Promise<User> {\r\n\t\treturn await this.web.centerApi.userFromId(userId);\r\n\t}\r\n\tasync userFromKey(userName: string): Promise<User> {\r\n\t\treturn await this.web.centerApi.userFromKey(userName);\r\n\t}\r\n}\r\n\r\nexport abstract class CSub<A extends CAppBase<U>, U, T extends CBase<A, U>> extends CBase<A, U> {\r\n\tprotected _owner: T;\r\n\r\n\tconstructor(owner: T) {\r\n\t\tsuper(owner.cApp);\r\n\t\tthis._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str: string): any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r !== undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n\tprotected get owner(): T { return this._owner }\r\n\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this.cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ownerWNs: WebNav<any>[] = [];\r\n\t\tfor (let p = this.owner; p !== undefined; p = (p as any)?.owner) {\r\n\t\t\townerWNs.push(p.webNav);\r\n\t\t}\r\n\t\tlet ret = Object.assign({}, wn);\r\n\t\tfor (; ;) {\r\n\t\t\tlet own = ownerWNs.pop();\r\n\t\t\tif (own === undefined) break;\r\n\t\t\tObject.assign(ret, own);\r\n\t\t}\r\n\t\tObject.assign(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { FetchError, Web } from \"tonwa-core\";\r\nimport { TonwaReact } from \"../TonwaReact\";\r\n//import { nav } from '../nav';\r\n\r\nexport class WebReact extends Web {\r\n    private readonly tonwaReact: TonwaReact;\r\n    constructor(tonwaReact: TonwaReact) {\r\n        super();\r\n        this.tonwaReact = tonwaReact;\r\n    }\r\n    /*\r\n    async navInit(): Promise<void> {\r\n        await nav.init();\r\n    }\r\n    */\r\n    async onError(error: FetchError) {\r\n        this.tonwaReact.setFetchError(error);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { nav } from '../nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { tonwa, User, Web } from 'tonwa-core';\r\n\r\nexport type UserLoader = (userId: number) => Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate readonly web: Web;\r\n\tprivate readonly loader: UserLoader;\r\n\tprivate onLoaded: (user: User) => void;\r\n\tprivate map = observable(new Map<number, T | number>());\r\n\r\n\tconstructor(web: Web, loader: UserLoader) {\r\n\t\tthis.web = web;\r\n\t\tif (loader === undefined) loader = (userId: number) => this.web.userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id: number | any, onLoaded?: (user: User) => void) {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tthis.onLoaded = onLoaded;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id: number | any): any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof (id)) {\r\n\t\t\tcase 'object':\r\n\t\t\t\tid = id.id;\r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof (ret)) {\r\n\t\t\tdefault:\r\n\t\t\t\treturn ret;\r\n\t\t\tcase 'number':\r\n\t\t\t\tif (ret < 0) return id;\r\n\t\t\t\tthis.map.set(id, -id);\r\n\t\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\t\tif (!v) v = null;\r\n\t\t\t\t\tthis.map.set(id, v);\r\n\t\t\t\t\tif (this.onLoaded) this.onLoaded(v);\r\n\t\t\t\t}).catch(reason => {\r\n\t\t\t\t\tconsole.error(reason);\r\n\t\t\t\t});\r\n\t\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet staticUserCache: UserCache<any>;\r\nfunction getUserCache(web: Web) {\r\n\tif (staticUserCache === undefined) {\r\n\t\tstaticUserCache = new UserCache(web, undefined);\r\n\t}\r\n\treturn staticUserCache;\r\n}\r\n\r\nexport interface UserIconProps {\r\n\tweb: Web;\r\n\tid: number;\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n\taltImage?: string;\r\n\tnoneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps): JSX.Element => {\r\n\tlet { className, style, id, altImage, noneImage } = props;\r\n\tlet userCache = getUserCache(props.web);\r\n\tlet user = userCache.getValue(id);\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n\t\t\treturn <div className={classNames(className, 'image-none')} style={style}>\r\n\t\t\t\t{noneImage || <i className=\"fa fa-file-o\" />}\r\n\t\t\t</div>;\r\n\t}\r\n\tlet { icon } = user;\r\n\tif (!icon) {\r\n\t\treturn <div className={classNames(className, 'image-none')} style={style}>\r\n\t\t\t<i className=\"fa fa-file-o\" />\r\n\t\t</div>;\r\n\t}\r\n\tif (icon.startsWith(':') === true) {\r\n\t\ticon = tonwa.resUrl + icon.substr(1);\r\n\t}\r\n\treturn <img src={icon} className={className} alt=\"img\"\r\n\t\tstyle={style}\r\n\t\tonError={evt => {\r\n\t\t\tif (altImage) evt.currentTarget.src = altImage;\r\n\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t}} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tweb: Web;\r\n\tid?: number;\r\n\tuser?: number | User;\r\n\trender: (user: User) => JSX.Element;\r\n\tonLoaded?: (user: User) => void\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps): JSX.Element => {\r\n\tlet { web, id: idProp, user, render, onLoaded } = props;\r\n\tif (user === null) return <>null</>;\r\n\tlet userCache = getUserCache(web);\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object':\r\n\t\t\tlet {/*obj, */id } = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\tuseUser(web, id, onLoaded);\r\n\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(web, user as number, onLoaded);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(web, Number(user), onLoaded);\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n\t\t\treturn <>{user}</>;\r\n\t}\r\n\treturn render(user);\r\n});\r\n\r\nexport function useUser(web: Web, id: number | object, onLoaded?: (user: User) => void) {\r\n\tif (!id) return;\r\n\tif (typeof (id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tlet userCache = getUserCache(web);\r\n\tuserCache.use(id, onLoaded);\r\n}\r\n","import { UqBuildContext } from \"tonwa-core\";\r\n\r\nexport class UqBuildContextUI extends UqBuildContext {\r\n\tget uiPlatform(): string { return 'react' };\r\n\tget uiPlatformUpper(): string { return 'REACT' };\r\n\tget uiPlatformCamel(): string { return 'React' }\r\n\tget element(): string { return 'JSX.Element' }\r\n}\r\n","import React from 'react';\r\nimport { FA, Page } from './components';\r\nimport { Controller } from \"./vm/Controller\";\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { tonwa } from 'tonwa-core';\r\n\r\nexport interface CStringEditProps {\r\n\tlabel?: string;\r\n\tplaceholder?: string;\r\n\tmaxLength?: number;\r\n\tonValueChange?: (value: string) => Promise<void>;\r\n}\r\n\r\nexport class CStringEdit extends Controller {\r\n\tprivate props: CStringEditProps = {\r\n\t\tlabel: '编辑'\r\n\t}\r\n\tvalue: string = null;\r\n\tnewValue: string = null;\r\n\tisChanged: boolean = null;\r\n\terror: string = null;\r\n\r\n\tconstructor() {\r\n\t\tsuper(tonwa);\r\n\t\tmakeObservable(this, {\r\n\t\t\tvalue: observable,\r\n\t\t\tnewValue: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\terror: observable,\r\n\t\t});\r\n\t}\r\n\r\n\tprotected async internalStart() { }\r\n\trender(value: string, props?: CStringEditProps) {\r\n\t\tthis.value = value;\r\n\t\tif (props) Object.assign(this.props, props);\r\n\t\treturn React.createElement(observer(() => <>{this.renderValue()}{this.renderPencil()}</>))\r\n\t}\r\n\r\n\tprotected renderValue() { return <>{this.value}</> }\r\n\tprotected renderPencil() {\r\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\r\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\r\n\t\t</span>;\r\n\t}\r\n\r\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.newValue = evt.target.value;\r\n\t\tlet preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\r\n\tprivate onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.verifyValue();\r\n\t}\r\n\r\n\tprotected verifyValue() { }\r\n\r\n\tprivate onFocus = () => {\r\n\t\tthis.error = undefined;\r\n\t}\r\n\r\n\tprivate onEdit = () => {\r\n\t\tlet { label, maxLength, placeholder, onValueChange } = this.props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tthis.value = this.newValue;\r\n\t\t\t\tthis.closePage();\r\n\t\t\t\tif (onValueChange) onValueChange(this.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet right = React.createElement(observer(() => <button\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center me-2\"\r\n\t\t\tdisabled={!this.isChanged}\r\n\t\t\tonClick={onSave}>保存</button>));\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tthis.openPage(<Page header={label} right={right}>\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n\t\t\t\t\tonBlur={this.onBlur}\r\n\t\t\t\t\tonFocus={this.onFocus}\r\n\t\t\t\t\tclassName=\"form-control\"\r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t{\r\n\t\t\t\t\tReact.createElement(observer(() => placeholder && <div className=\"small muted m-2\">{placeholder}</div>))\r\n\t\t\t\t}\r\n\t\t\t\t{this.error && <div className=\"text-danger\">{this.error}</div>}\r\n\t\t\t</div>\r\n\t\t</Page>);\r\n\t}\r\n}\r\n","import {makeObservable, observable} from 'mobx';\r\n\r\nexport interface Id {\r\n    id: number;\r\n}\r\n\r\nexport abstract class CacheIds<T extends Id> {\r\n    constructor(maxCount:number = 100) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tdict: observable,\r\n\t\t})\r\n        this.maxCount = maxCount;\r\n    }\r\n    private maxCount:number;\r\n    private arr:T[] = [];\r\n    dict = new Map<number, T>();\r\n\r\n    loadIds(ids:number[]) {\r\n        let arr:number[] = [];\r\n        for (let id of ids) {\r\n            if (id === null) continue;\r\n            let item = this.dict.get(id);\r\n            if (item === undefined) {\r\n                arr.push(id);\r\n                item = {id:id} as T;\r\n                this.dict.set(id, item);\r\n            }\r\n        }                \r\n        this.loadId(arr);\r\n    }\r\n\r\n    get(id:number):T {\r\n        if (id === undefined || id === null) return null;\r\n        let item = this.dict.get(id);\r\n        if (item === undefined) {\r\n            this.dict.set(id, {id:id} as T);\r\n            this.loadId([id]);\r\n            item = this.dict.get(id);\r\n        }\r\n        return item;\r\n    }\r\n    private setItem(id:number, item:T) {\r\n        if (item === undefined) {\r\n            this.dict.set(id, null);\r\n            this.arr.push({id: id} as T);\r\n        }\r\n        else {\r\n            this.dict.set(id, item);\r\n            this.arr.push(item);\r\n        }\r\n        if (this.arr.length > this.maxCount) {\r\n            item = this.arr.shift();\r\n            this.dict.delete(item.id);\r\n        }\r\n    }\r\n    private async loadId(ids:number[]) {\r\n        let items = await this._loadIds(ids);\r\n        if (items === undefined) {\r\n            for (let id of ids) {\r\n                if (id === null) continue;\r\n                let item = await this._loadId(id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n        else {\r\n            for (let id of ids) {\r\n                let item = items.find(v => v.id === id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract _loadIds(ids:number[]):Promise<T[]>;\r\n    protected abstract _loadId(id:number):Promise<T>;\r\n}\r\n","import * as React from 'react';\r\nimport { tonwa } from 'tonwa-core';\r\n// import { nav } from '../nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler: any;\r\n    constructor(props: Props) {\r\n        super(props);\r\n        let { seconds } = props;\r\n        if (seconds === undefined) return;\r\n        this.state = { seconds };\r\n        if (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n            let { seconds } = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({ seconds: seconds });\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        tonwa.reload();\r\n    }\r\n    render() {\r\n        let { seconds } = this.state;\r\n        let title: string, msg: string;\r\n        if (seconds > 0) {\r\n            title = '程序升级中...';\r\n            msg = this.state.seconds + '秒钟之后自动重启动';\r\n        }\r\n        else {\r\n            title = '程序需要升级';\r\n            msg = '请点击下面按钮重启';\r\n        }\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n                    <span className=\"text-danger\">{title}</span>\r\n                    <br />\r\n                    {msg}\r\n                    <br />\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean) => Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps): JSX.Element => {\r\n    return <Page header=\"升级软件\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger me-3\" onClick={() => props.confirm(true)}>确认升级</button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\r\n}\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { FetchError, Nav, Tonwa, Web } from \"tonwa-core\";\r\nimport { WebReact } from \"./app\";\r\n\r\nimport { Page } from './components';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport './css/va-form.css';\r\nimport './css/va.css';\r\nimport './css/animation.css';\r\nimport { ReloadPage, ConfirmReloadPage } from './components/reloadPage';\r\nimport { createLogin, showForget, showRegister } from './components/login';\r\nimport { SystemNotifyPage } from './nav/FetchErrorView';\r\nimport { NavView } from './nav';\r\n\r\nexport class TonwaReact extends Tonwa {\r\n    navView: NavView;\r\n\r\n    constructor() {\r\n        super();\r\n        makeObservable(this, {\r\n            user: observable,\r\n        });\r\n        this.setCreateLogin(createLogin);\r\n    }\r\n\r\n    createWeb(): Web { return new WebReact(this); }\r\n\r\n    createObservableMap<K, V>(): Map<K, V> {\r\n        return observable.map({}, { deep: false });\r\n    }\r\n\r\n    set(navView: NavView) {\r\n        //this.logo = logo;\r\n        this.navView = navView;\r\n    }\r\n\r\n    get nav(): Nav<JSX.Element> { return this.navView };\r\n\r\n    setFetchError(fetchError: FetchError) {\r\n        this.navView.setFetchError(fetchError);\r\n    }\r\n\r\n    renderNavView(onLogined: (isUserLogin?: boolean) => Promise<void>,\r\n        notLogined?: () => Promise<void>,\r\n        userPassword?: () => Promise<{ user: string; password: string }>,\r\n    ) {\r\n        return <NavView ref={nv => this.navView = nv}\r\n            onLogined={onLogined}\r\n            notLogined={notLogined}\r\n            userPassword={userPassword} />;\r\n    }\r\n\r\n    /*\r\n    setIsWebNav() {\r\n        this.isWebNav = true;\r\n        this.navView.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n        this.navView.closeIcon = <i className=\"fa fa-close\" />;\r\n    }\r\n    */\r\n\r\n    // pageWebNav: PageWebNav;\r\n\r\n    async showAppView(isUserLogin?: boolean): Promise<void> {\r\n        let { onLogined } = this.navView.props;\r\n        if (onLogined === undefined) {\r\n            this.navView.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        this.nav.clear();\r\n        await onLogined(isUserLogin);\r\n    }\r\n\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent(): string {\r\n        if (!this.navSettings) return;\r\n        let { privacy } = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            this.navView.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (htmlString: string) => {\r\n        let content = { __html: htmlString };\r\n        this.navView.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n    async showRegister() {\r\n        showRegister(this);\r\n    }\r\n\r\n    async showForget() {\r\n        showForget(this);\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.navView.push(<ConfirmReloadPage confirm={(ok: boolean): Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n                localStorage.clear();\r\n            }\r\n            else {\r\n                this.navView.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n        this.navView.push(<ReloadPage message={msg} seconds={seconds} />);\r\n    }\r\n\r\n    async onError(fetchError: FetchError) {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n                await this.showLogin(undefined);\r\n                //nav.navigateToLogin();\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await this.showLogin(undefined);\r\n                    //nav.navigateToLogin();\r\n                    return;\r\n                case 'sheet-processing':\r\n                    this.navView.push(<SystemNotifyPage message=\"单据正在处理中。请重新操作！\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.navView.setState({\r\n            fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        this.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq: string, version: number): Promise<void> {\r\n        this.navView.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n}\r\n","//=== UqApp builder created on Tue Feb 15 2022 12:15:55 GMT-0500 (北美东部标准时间) ===//\nimport { CSub, CBase, CAppBase, IConstructor } from 'tonwa-react';\nimport { UQs } from './uqs';\nimport { CApp } from './CApp';\n\nexport abstract class CUqBase extends CBase<CApp, UQs> {\n    protected async internalStart(param?: any, ...params: any[]): Promise<void> { }\n}\n\nexport abstract class CUqSub<A extends CAppBase<U>, U, T extends CBase<A, U>> extends CSub<A, U, T> {\n}\n\nexport abstract class CUqApp extends CAppBase<UQs> {\n    newC<T extends CUqBase>(type: IConstructor<T>, ...param: any[]): T {\n        let c = new type(this);\n        c.internalInit(...param);\n        return c;\n    }\n}\n","import { observer } from \"mobx-react-lite\";\r\nimport React, { SyntheticEvent } from \"react\";\r\nimport { Control } from \"./Control\";\r\n\r\nexport class View<C extends Control = any, P = any> {\r\n    protected readonly control: C;\r\n    protected readonly props: P;\r\n\r\n    constructor(control: C, props: P = undefined) {\r\n        this.control = control;\r\n        this.props = props;\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        return null\r\n    }\r\n\r\n    protected react(func: () => JSX.Element): JSX.Element {\r\n        let V = observer(func);\r\n        return <V />;\r\n    }\r\n\r\n    protected res(t: string): string | JSX.Element {\r\n        return t;\r\n    }\r\n\r\n    async confirm(msg: string): Promise<boolean> {\r\n        return window.confirm(msg);\r\n    }\r\n\r\n    renderAdmin(el: JSX.Element | (() => JSX.Element)): JSX.Element {\r\n        if (typeof (el) === 'function') el = el();\r\n        return this.control.app.renderAdmin(el);\r\n    }\r\n    renderRole(el: JSX.Element | (() => JSX.Element), ...roles: number[]): JSX.Element {\r\n        if (typeof (el) === 'function') el = el();\r\n        return this.control.app.renderRole(el, ...roles);\r\n    }\r\n    renderAdminOrRole(el: JSX.Element | (() => JSX.Element), ...roles: number[]): JSX.Element {\r\n        if (typeof (el) === 'function') el = el();\r\n        return this.control.app.renderAdminOrRole(el, ...roles);\r\n    }\r\n\r\n    waitingEvent<P, E extends SyntheticEvent<any>>(evt: E, handler: (params?: P) => Promise<void>, params?: P) {\r\n        let waiting = this.beforeWaiting(evt.currentTarget);\r\n        try {\r\n            handler(params).then(() => {\r\n                this.afterWaiting(waiting);\r\n            }).catch(reason => {\r\n                this.afterWaiting(waiting);\r\n                this.control.app.setError(reason);\r\n            });\r\n        }\r\n        catch (err) {\r\n            this.control.app.setError(err as any);\r\n        }\r\n    }\r\n\r\n    private beforeWaiting(element: HTMLElement): { target: HTMLElement; el: HTMLDivElement; disabled: boolean; } {\r\n        let width = element.offsetWidth;\r\n        let height = element.offsetHeight;\r\n        //let v = <div style={{ position: 'relative', left: 0, top: 0, width, height }}></div>;\r\n        let disabled = (element as any).disabled;\r\n        let style = element.getAttribute('style');\r\n        (element as any).disabled = true;\r\n        element.setAttribute('style', (style ?? '') + ' position: relative;');\r\n        let elWaiting = document.createElement('div');\r\n        elWaiting.setAttribute('style', `display:flex; position: absolute; opacity:0.5; left: 0; top: 0; width:${width}px; height:${height}px;align-items:center;justify-content:center;`);\r\n        elWaiting.innerHTML = '<i class=\"fa fa-spinner fa-spin\" />';\r\n        element.appendChild(elWaiting);\r\n        return { target: element, el: elWaiting, disabled };\r\n    }\r\n\r\n    private afterWaiting(waiting: { target: HTMLElement; el: HTMLDivElement; disabled: boolean; }) {\r\n        let { target, el, disabled } = waiting;\r\n        (target as any).disabled = disabled;\r\n        target.removeChild(el);\r\n    }\r\n}\r\n","import { FA, LMR, Page as TonwaReactPage, Scroller, TabsProps } from \"tonwa-react\";\r\nimport { Control } from \"./Control\";\r\nimport { View } from \"./View\";\r\n\r\nexport abstract class Page<C extends Control = Control, P = any> extends View<C, P> {\r\n    header(): string | boolean | JSX.Element { return null; }\r\n    right(): JSX.Element { return null; }\r\n    content(): JSX.Element { return <div className=\"p-3\">{this.header}</div>; }\r\n    footer(): JSX.Element { return null; }\r\n    logout(): boolean | (() => Promise<void>) { return false; }\r\n    render(): JSX.Element {\r\n        let header = this.header();\r\n        if (!header) header = false;\r\n        let logout = this.logout();\r\n        return <TonwaReactPage\r\n            header={header} right={this.right()} footer={this.footer()}\r\n            onScroll={(e: any) => this.onPageScroll(e)}\r\n            onScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n            onScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n            back={this.back}\r\n            headerClassName={this.headerClassName}\r\n            className={this.className}\r\n            tabsProps={this.tabsProps}\r\n            logout={logout}\r\n        >\r\n            {this.renderError()}\r\n            {this.content()}\r\n        </TonwaReactPage>;\r\n        //afterBack={() => this.internalAfterBack()}\r\n    }\r\n\r\n    private renderError() {\r\n        return this.react(() => {\r\n            let { app } = this.control;\r\n            let { error } = app.shallow;\r\n            if (!error) return null;\r\n            let { name, message } = error;\r\n            return <LMR className=\"border-bottom bg-light align-items-center text-muted mb-3\"\r\n                left={\r\n                    <div className=\"cursor-pointer px-3 py-2\" onClick={() => app.setError(null)}>\r\n                        <FA name=\"times-circle\" className=\"text-danger\" size=\"lg\" />\r\n                    </div>\r\n                }\r\n                right={<div className=\"cursor-pointer px-3 py-2\" onClick={this.control.openError}><FA name=\"angle-right\" /></div>}\r\n            >\r\n                {name} {message}\r\n            </LMR>;\r\n        });\r\n    }\r\n    /*\r\n    protected internalAfterBack() {\r\n        if (!this.afterBack) return;\r\n        this.afterBack();\r\n    }\r\n    */\r\n\r\n    callValue: any;\r\n    //afterBack: () => void | Promise<void>;\r\n\r\n    protected onPageScroll(e: any) { }\r\n    protected async onPageScrollTop(scroller: Scroller): Promise<boolean> { return false; }\r\n    protected async onPageScrollBottom(scroller: Scroller): Promise<void> { return; }\r\n    // protected afterBack(): void { }\r\n    protected get back(): 'close' | 'back' | 'none' { return 'back' }\r\n    protected get headerClassName(): string { return null; }\r\n    protected get className(): string { return null; }\r\n    protected get tabsProps(): TabsProps { return null; }\r\n}\r\n","import { Control } from \"./Control\";\r\nimport { Page } from \"./Page\";\r\n\r\nexport class PError extends Page<Control, Error> {\r\n    header(): string | boolean | JSX.Element {\r\n        let { name } = this.props;\r\n        return name;\r\n        /*\r\n        return <span>\r\n            <FA name=\"times\" className=\"mx-3 text-danger\" />\r\n            {name}\r\n        </span>;\r\n        */\r\n    }\r\n\r\n    protected get headerClassName(): string {\r\n        return 'text-danger bg-warning bg-gradient'\r\n    }\r\n\r\n    protected get back(): \"close\" | \"back\" | \"none\" {\r\n        return 'close';\r\n    }\r\n\r\n    content() {\r\n        let { message, stack } = this.props;\r\n        return <div className=\"p-3\">\r\n            <div>{message}</div>\r\n            <div>{stack}</div>\r\n        </div>\r\n    }\r\n}","import { FA } from \"tonwa-react\";\r\nimport { Page } from \"./Page\";\r\n\r\nexport class PWaiting extends Page {\r\n    header(): string | boolean | JSX.Element {\r\n        return '...';\r\n    }\r\n\r\n    protected get headerClassName(): string {\r\n        return 'bg-secondary';\r\n    }\r\n\r\n    protected get back(): \"close\" | \"back\" | \"none\" {\r\n        return 'none';\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"p-5 text-center\">\r\n            <FA name=\"spinner\" size=\"lg\" className=\"text-info\" spin={true} />\r\n        </div>;\r\n    }\r\n}\r\n","import { AnnotationsMap, makeObservable, observable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react-lite';\r\nimport React from 'react';\r\n\r\nfunction buildReactiveProps<T extends object>(data: T, ob: any): AnnotationsMap<T, never> {\r\n    let ret: AnnotationsMap<T, never> = {};\r\n    for (let i in data) {\r\n        let v = data[i];\r\n        switch (typeof v) {\r\n            default:\r\n                ob = observable;\r\n                break;\r\n            case 'object':\r\n            case 'function':\r\n                break;\r\n        }\r\n        (ret as any)[i] = ob;\r\n    }\r\n    return ret;\r\n}\r\n\r\nexport function deepReact<T extends object>(data: T): T {\r\n    let ret = makeObservable(data, buildReactiveProps(data, observable));\r\n    return ret;\r\n}\r\n\r\nexport function shallowReact<T extends object>(data: T): T {\r\n    let ret = makeObservable(data, buildReactiveProps(data, observable.shallow));\r\n    return ret;\r\n}\r\n\r\nexport function setReact<T>(fn: () => T): T {\r\n    return runInAction(fn);\r\n}\r\n\r\nexport function react(func: () => JSX.Element): JSX.Element {\r\n    let V = observer(func);\r\n    return React.createElement(V);\r\n}\r\n","import { AppBase } from './AppBase';\r\nimport { Page } from './Page';\r\nimport { PError } from './PError';\r\nimport { PWaiting } from './PWaiting';\r\nimport { setReact } from './Reactive';\r\nimport { View } from './View';\r\n\r\nexport abstract class Control<A extends AppBase = AppBase> {\r\n    readonly app: A;\r\n    constructor(app: A) {\r\n        this.app = app;\r\n    }\r\n\r\n    get waiting(): new (c: Control) => Page { return undefined; }\r\n\r\n    res(t: string): string | JSX.Element {\r\n        return t;\r\n    }\r\n\r\n    open<C extends Control, P = any>(Pg: new (c: C, props: P) => Page<C>, props?: P, afterClose?: (page: Page<C>) => void): void;\r\n    open<C extends Control, P = any>(promise: Promise<void>, Pg: new (c: C, props: P) => Page<C>, props?: P, afterClose?: (page: Page<C>) => void): void;\r\n    open<C extends Control>(...params: any[]): void {\r\n        let p0 = params[0];\r\n        if (typeof p0 === 'object') {\r\n            if (typeof (p0.then) === 'function') {\r\n                let isWaiting = false;\r\n                setTimeout(() => {\r\n                    if (isWaiting === undefined) return;\r\n                    this.open(this.waiting ?? this.app.waiting ?? PWaiting);\r\n                    isWaiting = true;\r\n                }, 100);\r\n                (p0 as Promise<void>).then(() => {\r\n                    if (isWaiting === true) {\r\n                        this.close();\r\n                    }\r\n                    isWaiting = undefined;\r\n                    let Pg = params[1];\r\n                    let props = params[2];\r\n                    let afterClose = params[3];\r\n                    let p: Page<C> = new Pg(this as unknown as C, props) as any;\r\n                    this.app.open(p.render(), () => afterClose?.(p));\r\n                    return;\r\n                });\r\n                return;\r\n            }\r\n        }\r\n\r\n        let Pg = p0;\r\n        let props = params[1];\r\n        let afterClose = params[2];\r\n        let p: Page<C> = new Pg(this as unknown as C, props) as any;\r\n        this.app.open(p.render(), () => afterClose?.(p));\r\n    }\r\n\r\n    close(level: number = 1) {\r\n        this.app.close(level);\r\n    }\r\n\r\n    render<C extends Control, P = any>(V: new (c: this, props: P) => View<C>, props?: P): JSX.Element {\r\n        let v = new V(this as any, props);\r\n        return v.render();\r\n    }\r\n\r\n    // private callPromises: (any | PromiseLike<any>)[] = [];\r\n    call<R, C extends Control = this, P = any>(Pg: new (c: C, props: P) => Page<C>, props?: P): Promise<R> {\r\n        return new Promise<R>(async (resolve, reject) => {\r\n            //this.callPromises.push(resolve);\r\n            this.open(Pg, props, (page: Page<C>) => {\r\n                resolve(page.callValue);\r\n            });\r\n        });\r\n    }\r\n\r\n    callReturn(page: Page<any>, ret: any) {\r\n        page.callValue = ret;\r\n    }\r\n\r\n    async waitFor(ms: number): Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            setTimeout(() => {\r\n                resolve();\r\n            }, ms);\r\n        });\r\n    }\r\n\r\n    openError = () => {\r\n        let { error } = this.app.shallow;\r\n        if (!error) return;\r\n        setReact(() => {\r\n            this.app.shallow.error = null;\r\n            this.open(PError, error);\r\n        });\r\n    }\r\n}\r\n","import { Schema, UiSchema } from \"tonwa-react\";\r\nimport { Uq, ID } from \"tonwa-core\";\r\nimport { Control } from \"../Control\";\r\nimport { deepReact, react, setReact } from \"../Reactive\";\r\nimport { VAdd } from \"./VAdd\";\r\nimport { VStart } from \"./VStart\";\r\nimport { VEditId } from \"./VEditId\";\r\nimport { IdCache } from \"./IdCache\";\r\nimport { AppBase, Page } from \"Control\";\r\nimport { mutedSmall } from \"tool\";\r\n\r\nexport enum EnumSelectType {\r\n    listAll,            // 一次列出所有的项目，供选择\r\n    search,             // 输入文字，再选择\r\n    listAndSearch,      // 列出部分，还可以搜索\r\n};\r\n\r\nexport interface SelectOptions {\r\n    listAll?: boolean;              // default: true\r\n    search?: boolean;               // default: true\r\n    valueRender?: IdValueRender;\r\n    allowNew?: boolean;             // default: allow new\r\n};\r\n\r\nexport interface IdValue {\r\n    id: number;\r\n};\r\n\r\nexport type Render = () => JSX.Element;\r\nexport type IdValueRender = (value: IdValue) => JSX.Element;\r\nexport type ValuesRender = (values: JSX.Element[]) => JSX.Element;\r\nexport type RefRender = (onClick: () => void, content: JSX.Element) => JSX.Element;\r\n\r\ninterface IDDeep {\r\n    list: IdValue[];\r\n    currentItem: any;\r\n}\r\n\r\nconst caches: { [id: string]: IdCache } = {}\r\n\r\nexport abstract class CIdBase<A extends AppBase = AppBase> extends Control<A> {\r\n    private cache: IdCache;\r\n    protected ID: ID;\r\n\r\n    initNO: string;\r\n    readonly deepData = deepReact<IDDeep>({\r\n        list: null,\r\n        currentItem: null,\r\n    });\r\n\r\n    protected initID() {\r\n        this.ID = this.getID();\r\n        let { name } = this.ID;\r\n        this.cache = caches[name];\r\n        if (this.cache === undefined) {\r\n            this.cache = new IdCache(this);\r\n            caches[name] = this.cache;\r\n        }\r\n    }\r\n\r\n    abstract get uq(): Uq;\r\n    abstract getID(): ID;\r\n    abstract get caption(): string;\r\n    abstract get schema(): Schema;\r\n    abstract get uiSchema(): UiSchema;\r\n    abstract renderTagInput(): JSX.Element;\r\n    get icon(): string { return null; }\r\n    get iconClass(): string { return undefined; }\r\n    get isGlobal(): boolean { return this.ID.isGlobal; }\r\n\r\n    getIdValue(id: number): any {\r\n        return this.cache.getValue(id);\r\n    }\r\n\r\n    protected setIDDeepList(list: any[]) {\r\n        this.deepData.list = list;\r\n    }\r\n\r\n    protected async initAdd() {\r\n        let ID = this.ID;\r\n        if (ID) {\r\n            this.initNO = await this.uq.IDNO({ ID });\r\n            setReact(() => {\r\n                this.deepData.currentItem = null;\r\n            });\r\n        }\r\n    }\r\n\r\n    private addedIds: number[];\r\n    private afterAddCallback: (ids: number[]) => Promise<void>;\r\n    setAfterAdd(func: (ids: number[]) => Promise<void>) {\r\n        this.afterAddCallback = func;\r\n    }\r\n\r\n    get VAdd(): new (c: CIdBase) => Page<CIdBase> {\r\n        return VAdd;\r\n    }\r\n    onAdd = async (): Promise<void> => {\r\n        this.addedIds = [];\r\n        await this.initAdd();\r\n        this.open(this.VAdd, this.afterAdded);\r\n    }\r\n\r\n    get ids(): number[] { return this.addedIds; }\r\n\r\n    afterAdded = async () => {\r\n        if (this.afterAddCallback) {\r\n            await this.afterAddCallback(this.addedIds);\r\n            this.afterAddCallback = undefined;\r\n        }\r\n        else {\r\n            await this.loadToList();\r\n        }\r\n    }\r\n\r\n    async loadValue(id: number): Promise<IdValue> {\r\n        let ret = await this.uq.ID({ IDX: this.ID, id: id });\r\n        if (ret.length === 0) return null;\r\n        return ret[0] as IdValue;\r\n    }\r\n\r\n    protected abstract loadList(): Promise<any[]>;\r\n    abstract loadItemsFromIds(ids: number[]): Promise<any[]>;\r\n\r\n    async loadToList() {\r\n        let list = await this.loadList();\r\n        setReact(() => {\r\n            this.setIDDeepList(list);\r\n        });\r\n    }\r\n\r\n    async onSaveId(data: any) {\r\n        let id = await this.saveId(data);\r\n        this.addedIds.push(id);\r\n    }\r\n\r\n    savePropValue(id: number, name: string, value: any): Promise<void> {\r\n        return;\r\n    }\r\n\r\n    protected abstract saveId(data: any): Promise<number>;\r\n\r\n    async search(key: string): Promise<any[]> {\r\n        return null;\r\n    }\r\n\r\n    get VStart(): new (c: CIdBase) => Page<CIdBase> {\r\n        return VStart;\r\n    }\r\n\r\n    async openMain() {\r\n        this.open(this.VStart);\r\n        await this.loadToList();\r\n    }\r\n\r\n    get VEdit(): new (c: CIdBase) => Page<CIdBase> {\r\n        return VEditId;\r\n    }\r\n\r\n    protected async beforeEdit() {\r\n        // await this.waitFor(10);\r\n    }\r\n\r\n    onEditItem = async (item: any) => {\r\n        setReact(async () => {\r\n            this.deepData.currentItem = item;\r\n            this.open(this.beforeEdit(), this.VEdit);\r\n        });\r\n    }\r\n\r\n    renderItemInList(item: any): JSX.Element {\r\n        return this.renderIdValue(item);\r\n    }\r\n\r\n    renderItemOnSelect(item: any): JSX.Element {\r\n        return this.renderItemInList(item);\r\n    }\r\n\r\n    abstract renderIdValue(idValue: IdValue): JSX.Element;\r\n\r\n    renderId(id: number): JSX.Element {\r\n        return react(() => {\r\n            let val = this.getIdValue(id);\r\n            if (val === null || val === undefined) {\r\n                return mutedSmall(id);\r\n            }\r\n            return this.renderIdValue(val);\r\n        });\r\n    }\r\n}\r\n","import { UserApi } from \"./UserApi\";\r\nimport { Nav } from \"./Nav\";\r\nimport { CUser } from \"./CUser\";\r\nimport { Page } from \"./Page\";\r\nimport { setReact, shallowReact } from \"./Reactive\";\r\n\r\nexport abstract class AppBase {\r\n    shallow: {\r\n        error: {\r\n            name: string;\r\n            message: string;\r\n            stack: string;\r\n        };\r\n    } = shallowReact({\r\n        error: null,\r\n    });\r\n\r\n    abstract get cUser(): CUser;\r\n    abstract get userApi(): UserApi;\r\n    abstract get nav(): Nav;\r\n\r\n    open(page: JSX.Element, afterClose?: () => void): void {\r\n        this.nav.open(page, afterClose);\r\n    }\r\n\r\n    close(level: number): void {\r\n        this.nav.close(level);\r\n    }\r\n\r\n    get waiting(): new () => Page { return null; }\r\n\r\n    renderAdmin(el: JSX.Element): JSX.Element { return null; }\r\n    renderRole(el: JSX.Element, ...roles: number[]): JSX.Element { return null; }\r\n    renderAdminOrRole(el: JSX.Element, ...roles: number[]): JSX.Element { return null; }\r\n    setError(error: Error) {\r\n        setReact(() => {\r\n            if (!error) {\r\n                this.shallow.error = null;\r\n            }\r\n            else {\r\n                this.shallow.error = {\r\n                    name: error.name,\r\n                    message: error.message,\r\n                    stack: error.stack,\r\n                };\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { Page } from \"../Page\";\r\nimport { CSelect, CSelectMulti, CSelectOne } from \"./CSelect\";\r\nimport { FA, List, SearchBox } from \"tonwa-react\";\r\nimport { IdValue, SelectOptions } from \".\";\r\n\r\nabstract class VSelect<C extends CSelect<any>> extends Page<C, SelectOptions> {\r\n    header(): string | boolean | JSX.Element {\r\n        return this.control.cId.caption;\r\n    }\r\n\r\n    protected get back(): \"close\" | \"back\" | \"none\" {\r\n        return \"close\";\r\n    }\r\n\r\n    right(): JSX.Element {\r\n        if (this.props?.search === false) return null;\r\n        return <SearchBox className=\"me-2\" onSearch={this.control.search} />;\r\n    }\r\n}\r\n\r\nexport class VSelectOne extends VSelect<CSelectOne> {\r\n    content(): JSX.Element {\r\n        let vNew: any;\r\n        if (this.props?.allowNew !== false) {\r\n            vNew = <div className=\"px-3 py-2 align-items-center cursor-pointer mb-3 bg-white\"\r\n                onClick={this.control.onNew}>\r\n                <FA name=\"plus\" className=\"me-3 text-warning\" fixWidth={true} />\r\n                New {this.control.cId.caption}\r\n            </div>;\r\n        }\r\n        return this.react(() => <div className=\"\">\r\n            {vNew}\r\n            <List items={this.control.shallowData.items} item={{ render: this.renderItem, onClick: this.onItemClick }} />\r\n        </div>);\r\n    }\r\n\r\n    private renderItem = (item: any, index: number) => {\r\n        let { cId } = this.control;\r\n        let vItem: any;\r\n        let valueRender = this.props?.valueRender;\r\n        if (valueRender !== undefined) vItem = valueRender(item);\r\n        else vItem = cId.renderItemOnSelect(item);\r\n        let { icon } = cId;\r\n        let vIcon: any;\r\n        if (icon) {\r\n            vIcon = <FA name=\"user-o\" className=\"me-3 text-primary \" fixWidth={true} />;\r\n        }\r\n        return <div className=\"px-3 py-2 align-items-center\">\r\n            {vIcon}\r\n            {vItem}\r\n        </div>;\r\n    }\r\n\r\n    private onItemClick = (item: any) => {\r\n        this.control.callReturn(this, item);\r\n        this.control.close();\r\n    }\r\n}\r\n\r\nexport class VSelectMulti extends VSelect<CSelectMulti> {\r\n    content(): JSX.Element {\r\n        return <div className=\"p-3\">\r\n            <div>select multi</div>\r\n            <button onClick={this.onSelected}>select 1,2,3</button>\r\n        </div>;\r\n    }\r\n\r\n    private onItemClick = (item: any) => {\r\n\r\n    }\r\n\r\n    private onSelected = () => {\r\n        this.control.callReturn(this, [\r\n            { id: 78905344 } as IdValue,\r\n            { id: 78905346 } as IdValue,\r\n            { id: 78905347 } as IdValue,\r\n        ]);\r\n        this.control.close();\r\n    }\r\n}\r\n","import { setReact, shallowReact } from \"Control\";\r\nimport { IdValue } from \".\";\r\nimport { Control } from \"../Control\";\r\nimport { Page } from \"../Page\";\r\nimport { CIdBase, SelectOptions } from \"./CIdBase\";\r\nimport { VSelectMulti, VSelectOne } from \"./VSelect\";\r\n\r\nexport abstract class CSelect<R extends IdValue | IdValue[]> extends Control {\r\n    cId: CIdBase;\r\n    //resolve: (value: R | PromiseLike<R>) => void;\r\n    shallowData: {\r\n        items: any[];\r\n    } = shallowReact({\r\n        items: null,\r\n    });\r\n\r\n    constructor(cId: CIdBase) {\r\n        super(cId.app);\r\n        this.cId = cId;\r\n    }\r\n\r\n    protected abstract get VSelect(): new (c: any) => Page<any>;\r\n\r\n    async select(options?: SelectOptions): Promise<R> {\r\n        if (options?.listAll !== false) {\r\n            await this.search(undefined);\r\n        }\r\n        return await this.call<R>(this.VSelect, options);\r\n    }\r\n\r\n    search = async (key: string): Promise<void> => {\r\n        let ret = await this.cId.search(key ?? '');\r\n        setReact(() => {\r\n            this.shallowData.items = ret;\r\n        });\r\n    }\r\n\r\n    onNew = async () => {\r\n        this.cId.setAfterAdd(async (ids: number[]) => {\r\n            let ret = await this.cId.loadItemsFromIds(ids);\r\n            setReact(() => {\r\n                this.shallowData.items.unshift(...ret);\r\n            });\r\n        });\r\n        await this.cId.onAdd();\r\n        //this.close();\r\n        //this.resolve(item.id);\r\n    }\r\n}\r\n\r\nexport class CSelectOne extends CSelect<IdValue> {\r\n    protected get VSelect(): new (c: CSelectOne) => Page<CSelectOne> {\r\n        return VSelectOne as any;\r\n    }\r\n}\r\n\r\nexport class CSelectMulti extends CSelect<IdValue[]> {\r\n    protected get VSelect(): new (c: this) => Page<this> {\r\n        return VSelectMulti as any;\r\n    }\r\n}\r\n","import { Context, Form } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CIdBase } from \"./CIdBase\";\r\n\r\nexport class VAdd<C extends CIdBase = any> extends Page<C> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'New ' + this.control.caption;\r\n    }\r\n\r\n    protected renderForm() {\r\n        let { schema, uiSchema } = this.control;\r\n        schema = [...schema, { name: 'submit', type: 'submit' }];\r\n        return <Form schema={schema} uiSchema={uiSchema} fieldLabelSize={2}\r\n            onButtonClick={this.onSave}\r\n        />;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return <div className=\"p-3\">{this.renderForm()}</div>;\r\n    }\r\n\r\n    private onSave = async (name: string, context: Context) => {\r\n        let data = context.data;\r\n        await this.control.onSaveId(data);\r\n        this.control.close();\r\n        this.control.open(VSucceed as any);\r\n    }\r\n}\r\n\r\nclass VSucceed extends Page<CIdBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Saved'\r\n    }\r\n    protected get back(): \"close\" | \"back\" | \"none\" {\r\n        return 'close';\r\n    }\r\n    content(): JSX.Element {\r\n        return <div>\r\n            <div className=\"m-5 border border-warning rounded-3 bg-white w-30c p-5 mx-auto\">\r\n                <div className=\"text-center\">Saved OK! </div>\r\n                <div className=\"mt-5 text-center\">\r\n                    <button className=\"btn btn-primary me-3\" onClick={this.onNext}>Continue Input</button>\r\n                    <button className=\"btn btn-outline-primary\" onClick={this.onExit}>Exit</button>\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n    onNext = async () => {\r\n        this.control.close();\r\n        await this.control.onAdd();\r\n    }\r\n\r\n    onExit = async () => {\r\n        this.control.close();\r\n        // this.afterBack();\r\n    }\r\n    /*\r\n    protected afterBack(): void {\r\n        this.control.afterAdd();\r\n    }\r\n    */\r\n}\r\n","import { FA, List, LMR } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CIdBase } from \"./CIdBase\";\r\n\r\nexport class VStart extends Page<CIdBase> {\r\n    header() { return this.control.caption; }\r\n    right() {\r\n        return <button className=\"btn btn-sm btn-success me-2\" onClick={this.control.onAdd}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n    content() {\r\n        return this.react(() => <List items={this.control.deepData.list}\r\n            item={{ render: this.renderItem, onClick: this.control.onEditItem }} />\r\n        );\r\n    }\r\n\r\n    private renderItem = (item: any, index: number) => {\r\n        let { icon, iconClass } = this.control;\r\n        let vIcon: any;\r\n        if (icon) {\r\n            vIcon = <FA name={icon} className={'me-4 ' + (iconClass ?? 'text-primary')} fixWidth={true} size=\"lg\" />;\r\n        }\r\n        let right = <FA name=\"angle-right\" />\r\n        return <LMR className=\"px-3 py-2 align-items-center\" left={vIcon} right={right}>\r\n            <div>\r\n                {this.control.renderItemInList(item)}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n}\r\n","import { createEdit, setReact } from \"Control\";\r\nimport { LMR, Pick } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CIdBase } from \"./CIdBase\";\r\n\r\n//const cnRow = 'px-3 py-2 bg-white border-bottom cursor-pointer';\r\n\r\nexport class VEditId<C extends CIdBase = any> extends Page<C> {\r\n    header(): string | boolean | JSX.Element {\r\n        return this.control.caption + ' ' + this.control.deepData.currentItem.no;\r\n    }\r\n\r\n    protected renderProps() {\r\n        return this.react(() => {\r\n            let { schema, uiSchema, deepData } = this.control;\r\n            let { currentItem } = deepData;\r\n            if (!uiSchema) {\r\n                uiSchema = { items: {} };\r\n            }\r\n            let vProps = schema.map((v, index) => {\r\n                let { name } = v;\r\n                let uiItem = uiSchema.items[name];\r\n                let label: string | JSX.Element;\r\n                let readOnly: boolean;\r\n                let pick: Pick;\r\n                if (uiItem) {\r\n                    label = uiItem.label ?? name;\r\n                    readOnly = uiItem.readOnly;\r\n                    pick = (uiItem as any).pick;\r\n                }\r\n                else {\r\n                    label = name;\r\n                    readOnly = false;\r\n                }\r\n                let value = currentItem[name];\r\n                let cEdit = createEdit(this.control.app, {\r\n                    pick,\r\n                    itemSchema: v,\r\n                    uiItem,\r\n                    value,\r\n                    onChanged: this.propValueSave\r\n                });\r\n                let right = cEdit.renderEditIcon();\r\n                let onEdit: any;\r\n                let cn = 'mb-3 row bg-white align-items-center ';\r\n                if (readOnly === true) {\r\n                    onEdit = undefined;\r\n                }\r\n                else {\r\n                    onEdit = cEdit.onEdit;\r\n                    cn += 'cursor-pointer ';\r\n                }\r\n                return <div key={index} onClick={onEdit}\r\n                    className={cn}>\r\n                    <label className=\"col-sm-2 col-form-label\">{label}</label>\r\n                    <div className=\"col-sm-10\">\r\n                        <LMR right={readOnly !== true && right}>\r\n                            {cEdit.renderRef()}\r\n                        </LMR>\r\n                    </div>\r\n                </div>\r\n            });\r\n            return <div className=\"container\">{vProps}</div>;\r\n        });\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"py-3\">\r\n            {this.renderProps()}\r\n            {this.renderTagInput()}\r\n        </div>\r\n    }\r\n\r\n    private propValueSave = async (name: string, value: any) => {\r\n        let { deepData } = this.control;\r\n        await this.control.savePropValue(deepData.currentItem.id, name, value);\r\n        setReact(() => {\r\n            deepData.currentItem[name] = value;\r\n        });\r\n    }\r\n\r\n    protected renderTagInput() {\r\n        let vTagInput = this.control.renderTagInput();\r\n        if (!vTagInput) return null;\r\n        return <div className=\"my-3 border rounded-3 pt-2\">\r\n            <div className=\"px-3 pb-2 small text-muted\">Tags</div>\r\n            {vTagInput}\r\n        </div>;\r\n    }\r\n}\r\n","import { setReact, shallowReact } from \"../Reactive\";\r\nimport { CIdBase, IdValue } from \"./CIdBase\";\r\n\r\ninterface ShallowData {\r\n    cache: Map<number, IdValue>;\r\n}\r\n\r\nexport class IdCache {\r\n    private readonly shallowData: ShallowData = shallowReact<ShallowData>({\r\n        cache: new Map<number, IdValue>(),\r\n    });\r\n\r\n    private readonly cId: CIdBase;\r\n    constructor(cId: CIdBase) {\r\n        this.cId = cId;\r\n    }\r\n\r\n    getValue(id: number): IdValue {\r\n        let ret = this.shallowData.cache.get(id);\r\n        if (ret === null) return null;\r\n        if (ret === undefined) {\r\n            this.loadValue(id);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    async loadValue(id: number) {\r\n        try {\r\n            let ret = await this.cId.loadValue(id);\r\n            this.setCache(id, ret);\r\n        }\r\n        catch {\r\n            this.setCache(id, null);\r\n        }\r\n    }\r\n\r\n    setCache(id: number, value: IdValue) {\r\n        setReact(() => this.shallowData.cache.set(id, value));\r\n    }\r\n}\r\n","import { Nav as ControlNav } from \"Control\";\r\nimport { Nav, Tonwa } from \"tonwa-core\";\r\n//import { TonwaReact } from \"tonwa-react\";\r\n\r\nexport class AppNav implements ControlNav {\r\n    private readonly nav: Nav;\r\n    private readonly tonwa: Tonwa;\r\n    constructor(tonwa: Tonwa) {\r\n        this.nav = tonwa.nav;\r\n        this.tonwa = tonwa;\r\n    }\r\n\r\n    open(page: JSX.Element, afterClose: () => void): void {\r\n        this.nav.push(page, afterClose);\r\n    }\r\n    close(level: number = 1): void {\r\n        this.nav.pop(level);\r\n    }\r\n    openLogin(): void {\r\n        this.tonwa.showLogin(undefined);\r\n    }\r\n}\r\n","export function mutedSmall(text: number | string | JSX.Element) {\r\n    return <small className=\"text-muted\">{text}</small>;\r\n}\r\n","export function renderDate(date: string): JSX.Element {\r\n    let parts = date.split('-');\r\n    let d = new Date(Number(parts[0]), Number(parts[1]) - 1, Number(parts[2]));\r\n    return <>{d.toDateString()}</>;\r\n}\r\n\r\nexport function renderHourMinute(time: string): JSX.Element {\r\n    let parts = time.split(':');\r\n    return <>{parts[0]}:{parts[1]}</>;\r\n}","import { View } from \"Control\";\r\nimport { FA } from \"tonwa-react\";\r\nimport { CEdit } from \"./CEdit\";\r\n\r\nexport class VRef extends View<CEdit> {\r\n    render() {\r\n        let { shallowValue, props } = this.control;\r\n        let { pick } = props;\r\n        if (pick) return pick.ref();\r\n        return this.react(() => {\r\n            let { value } = shallowValue;\r\n            return <div>{value ?? <small className=\"text-muted\"> - </small>}</div>;\r\n        });\r\n    }\r\n}\r\n\r\nexport class VEditIcon extends View<CEdit> {\r\n    render() {\r\n        return <FA name=\"pencil-square-o\" className=\"text-primary\" />;\r\n    }\r\n}","import { AppBase, Page, shallowReact } from \"Control\";\r\nimport { FieldRule, ItemSchema, Pick, UiItem } from \"tonwa-react\";\r\nimport { Control } from \"../Control\";\r\nimport { VEditIcon, VRef } from \"./VRef\";\r\n\r\nexport interface EditProps {\r\n    readonly itemSchema: ItemSchema;\r\n    readonly uiItem: UiItem;\r\n    readonly onChanged: (name: string, value: any) => Promise<void>;\r\n    readonly value: any;\r\n    readonly pick?: Pick;\r\n    readonly exView?: JSX.Element;      // can add extra action or message on the bottom of page\r\n}\r\n\r\nexport abstract class CEdit extends Control {\r\n    readonly props: EditProps;\r\n    readonly shallowValue: {\r\n        value: any;\r\n    };\r\n    constructor(nav: AppBase, props: EditProps) {\r\n        super(nav);\r\n        this.props = props;\r\n        this.shallowValue = shallowReact({ value: props.value })\r\n    }\r\n\r\n    renderRef(): JSX.Element { return this.render(VRef); }\r\n\r\n    get label(): string | JSX.Element {\r\n        let { itemSchema, uiItem } = this.props;\r\n        return uiItem?.label ?? itemSchema.name;\r\n    }\r\n\r\n    renderEditIcon() { return this.render(VEditIcon); }\r\n\r\n    verifyValue(value: any): string {\r\n        let { uiItem } = this.props;\r\n        if (uiItem === undefined) return;\r\n        let { rules } = uiItem;\r\n        if (rules === undefined) return;\r\n        function verifyRule(rule: FieldRule, v: any): string {\r\n            let error = rule(v);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, value);\r\n                if (error !== undefined) {\r\n                    return error;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            return verifyRule(rules as FieldRule, value);\r\n        }\r\n    }\r\n\r\n    get Page(): new (c: CEdit) => Page<CEdit> { return undefined; }\r\n\r\n    onEdit = () => {\r\n        this.open(this.Page);\r\n    }\r\n}\r\n","import { ChangeEvent } from 'react';\r\nimport { CEdit } from './CEdit';\r\nimport { setReact } from '../Reactive';\r\nimport { AppBase } from 'Control';\r\nimport { EditProps } from '.';\r\n\r\nexport class CCheckEdit extends CEdit {\r\n    constructor(nav: AppBase, props: EditProps) {\r\n        super(nav, props);\r\n        this.onEdit = undefined;\r\n    }\r\n\r\n    renderRef(): JSX.Element {\r\n        return <label className=\"form-check-inline w-100 h-100\">\r\n            <input type=\"checkbox\" className=\"ms-1\"\r\n                defaultChecked={this.shallowValue.value}\r\n                onChange={this.onChange} />\r\n        </label>;\r\n    }\r\n\r\n    renderEditIcon(): JSX.Element { return null; }\r\n\r\n    private onChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n        let value = e.target.checked;\r\n        let { onChanged, itemSchema } = this.props;\r\n        onChanged(itemSchema.name, value);\r\n        setReact(() => {\r\n            this.shallowValue.value = value;\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CEdit } from './CEdit';\r\nimport { setReact, shallowReact } from '../Reactive';\r\nimport { Page } from '../Page';\r\nimport { UiInputItem } from 'tonwa-react';\r\n\r\nexport interface InputOptions {\r\n    type: string;\r\n    min?: number;\r\n    max?: number;\r\n    step?: number;\r\n}\r\n\r\nabstract class CEditWithPage extends CEdit {\r\n    abstract get Page(): new (c: CEdit) => Page<CEdit>;\r\n}\r\n\r\nabstract class VEditPage<C extends CEditWithPage> extends Page<C> {\r\n    shallowData: {\r\n        isChanged: boolean;\r\n        error: string;\r\n    } = shallowReact({\r\n        isChanged: false,\r\n        error: null,\r\n    });\r\n    value: any;\r\n\r\n    header(): string | boolean | JSX.Element {\r\n        return this.control.label;\r\n    }\r\n\r\n    right() {\r\n        return this.react(() => <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.shallowData.isChanged}\r\n            onClick={this.onSave}>{this.res('Save')}</button>\r\n        );\r\n    }\r\n\r\n    private onSave = async () => {\r\n        let { onChanged, itemSchema } = this.control.props;\r\n        onChanged(itemSchema.name, this.value);\r\n        this.control.close();\r\n    }\r\n\r\n    abstract get InputType(): string;\r\n\r\n    content() {\r\n        let { error } = this.shallowData;\r\n        let { uiItem, exView } = this.control.props;\r\n        let onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n            if (this.shallowData.isChanged === false) return;\r\n            if (evt.key === 'Enter') this.onSave();\r\n        }\r\n        return <div className=\"m-3\">\r\n            <input type={this.InputType}\r\n                onChange={this.onChange}\r\n                onKeyDown={onKeyDown}\r\n                onBlur={this.onBlur}\r\n                onFocus={this.onFocus}\r\n                className=\"form-control\"\r\n                defaultValue={this.control.shallowValue.value} />\r\n            {\r\n                <div className=\"small muted m-2\">{(uiItem as UiInputItem)?.placeholder}</div>\r\n            }\r\n            {error && <div className=\"text-danger\">{error}</div>}\r\n            {exView}\r\n        </div>;\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        setReact(() => {\r\n            this.value = evt.target.value;\r\n            this.shallowData.isChanged = (this.value !== this.control.shallowValue.value);\r\n        });\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        setReact(() => {\r\n            this.shallowData.error = this.control.verifyValue(this.value);\r\n        })\r\n    }\r\n\r\n    private onFocus = () => {\r\n        setReact(() => {\r\n            this.shallowData.error = undefined;\r\n        })\r\n    }\r\n}\r\n\r\nexport class CStringEdit extends CEditWithPage {\r\n    get Page(): new (c: CEdit) => Page<CEdit> {\r\n        return VStringPage;\r\n    }\r\n}\r\n\r\nclass VStringPage extends VEditPage<CStringEdit> {\r\n    get InputType(): string { return 'text' }\r\n}\r\n\r\nexport class CDateEdit extends CEditWithPage {\r\n    get Page(): new (c: CEdit) => Page<CEdit> {\r\n        return VDatePage;\r\n    }\r\n}\r\n\r\nclass VDatePage extends VEditPage<CDateEdit> {\r\n    get InputType(): string { return 'date' }\r\n}\r\n\r\nexport class CDateTimeEdit extends CEditWithPage {\r\n    get Page(): new (c: CEdit) => Page<CEdit> {\r\n        return VDateTimePage;\r\n    }\r\n}\r\n\r\nclass VDateTimePage extends VEditPage<CDateTimeEdit> {\r\n    get InputType(): string { return 'datetime' }\r\n}\r\n\r\nexport class CTimeEdit extends CEditWithPage {\r\n    get Page(): new (c: CEdit) => Page<CEdit> {\r\n        return VTimePage;\r\n    }\r\n}\r\n\r\nclass VTimePage extends VEditPage<CTimeEdit> {\r\n    get InputType(): string { return 'time' }\r\n}\r\n\r\n","import { Page } from \"Control\";\r\nimport { CEdit } from \".\";\r\n\r\nexport class CIdEdit extends CEdit {\r\n    get Page(): new (c: CEdit) => Page<CEdit> {\r\n        return VIdEditPage;\r\n    }\r\n}\r\n\r\nclass VIdEditPage extends Page<CIdEdit> {\r\n    header(): string | boolean | JSX.Element {\r\n        return this.control.label;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return <div>\r\n            select id\r\n        </div>\r\n    }\r\n}","import { CEdit } from \".\";\r\n\r\nexport class CPickEdit extends CEdit {\r\n    renderRef(): JSX.Element {\r\n        let { pick } = this.props;\r\n        if (!pick) {\r\n            return <span>pick is not defined</span>;\r\n        }\r\n        return pick.ref();\r\n    }\r\n\r\n    onEdit: () => Promise<void> = async () => {\r\n        let { pick } = this.props;\r\n        if (!pick) {\r\n            alert('pick not defined in CPickEdit');\r\n            return;\r\n        }\r\n        let ret = await pick.pick();\r\n        let { onChanged } = this.props;\r\n        if (onChanged) {\r\n            let { value } = this.shallowValue;\r\n            if (ret !== value) {\r\n                let { itemSchema } = this.props;\r\n                await onChanged(itemSchema.name, ret);\r\n                this.shallowValue.value = ret;\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { CDateEdit, CDateTimeEdit, CStringEdit, CTimeEdit } from \"./CInputEdit\";\r\nimport { CEdit, EditProps } from \"./CEdit\";\r\nimport { AppBase } from \"../AppBase\";\r\nimport { CIdEdit } from \"./CIdEdit\";\r\nimport { CPickEdit } from \"./CPickEdit\";\r\nimport { CCheckEdit } from \".\";\r\n\r\nexport function createEdit(nav: AppBase, props: EditProps): CEdit {\r\n    let { itemSchema, uiItem } = props;\r\n    if (uiItem === undefined) {\r\n        switch (itemSchema.type) {\r\n            default: return new CStringEdit(nav, props);\r\n        }\r\n    }\r\n    switch (uiItem.widget) {\r\n        case 'date': return new CDateEdit(nav, props);\r\n        case 'datetime': return new CDateTimeEdit(nav, props);\r\n        case 'time': return new CTimeEdit(nav, props);\r\n        case 'id': return new CIdEdit(nav, props);\r\n        case 'pick': return new CPickEdit(nav, props);\r\n        case 'checkbox': return new CCheckEdit(nav, props);\r\n        default: return new CStringEdit(nav, props);\r\n    }\r\n}\r\n","import { AppBase, CStringEdit, deepReact, setReact } from \"Control\";\r\nimport { UiTextItem } from \"tonwa-react\";\r\nimport { Control } from \"../Control\";\r\n// import { VAddUser } from \"./VAddUser\";\r\nimport { VMeSysAdmin } from \"./VMeSysAdmin\";\r\nimport { VStart } from \"./VStart\";\r\nimport { VUser } from \"./VUser\";\r\n\r\nexport enum EnumAdminRoleInEdit { sys = 1, admin = 2, nSys = -1, nAdmin = -2, }\r\n\r\nexport interface Admin {\r\n    id: number;\r\n    role: EnumAdminRoleInEdit;\r\n    operator: number;\r\n    create: number;\r\n    update: number;\r\n    user: number;\r\n    assigned: string;\r\n    // name?: string;\r\n    // nick?: string;\r\n    // icon?: string;\r\n}\r\n\r\nexport abstract class CAdminBase<A extends AppBase = AppBase> extends Control<A> {\r\n    private adminsChanged = true;\r\n    onAdmin: () => Promise<void>;\r\n    deep: {\r\n        meAdmin: Admin;\r\n        sysAdmins: Admin[];\r\n        admins: Admin[];\r\n    } = deepReact({\r\n        meAdmin: null,\r\n        admins: [],\r\n        sysAdmins: [],\r\n    });\r\n\r\n    /*\r\n    constructor(app: AppBase) {\r\n        super(app);\r\n        this.cUser = cUser;\r\n    }\r\n    */\r\n\r\n    abstract get me(): number;\r\n    //abstract userFromName(userName: string): Promise<any>;\r\n    //abstract userFromId(id: number): Promise<any>;\r\n    protected abstract loadAdmins(): Promise<any[]>;\r\n    protected abstract setMeAdmin(): Promise<void>;\r\n    protected abstract setAdmin(user: number, role: number, assigned: string): Promise<void>;\r\n\r\n    async load(): Promise<void> {\r\n        if (this.adminsChanged === false) return;\r\n        this.adminsChanged = false;\r\n        let retAdmins = await this.loadAdmins();\r\n        if (!retAdmins) return;\r\n        //await this.loadUserNames(retAdmins);\r\n        let sysAdmins: Admin[] = [];\r\n        let admins: Admin[] = [];\r\n        let meAdmin: Admin;\r\n        let me = this.me;\r\n        for (let admin of retAdmins) {\r\n            let { id } = admin;\r\n            if (id === me) {\r\n                meAdmin = admin;\r\n                continue;\r\n            }\r\n            let { role } = admin;\r\n            switch (role) {\r\n                case -1:\r\n                    break;\r\n                case 1:\r\n                    sysAdmins.push(admin);\r\n                    break;\r\n                case 2:\r\n                    admins.push(admin);\r\n                    break;\r\n            }\r\n        }\r\n        setReact(() => {\r\n            this.deep.meAdmin = meAdmin;\r\n            this.deep.sysAdmins = sysAdmins;\r\n            this.deep.admins = admins;\r\n        });\r\n        if (meAdmin) {\r\n            this.onAdmin = async () => {\r\n                await this.openMain();\r\n            }\r\n        }\r\n    }\r\n    /*\r\n    private async loadUserNames(admins: Admin[]) {\r\n        let ids: number[] = [];\r\n        for (let admin of admins) {\r\n            let { id, user } = admin;\r\n            if (!user) ids.push(id);\r\n        }\r\n        if (ids.length === 0) return;\r\n        let promises: Promise<any>[] = ids.map(id => this.userFromId(id));\r\n        let users = await Promise.all(promises);\r\n        for (let user of users) {\r\n            let { id } = user;\r\n            let admin = admins.find(v => v.id === id);\r\n            if (admin) Object.assign(admin, user);\r\n        }\r\n    }\r\n    */\r\n    async openMain() {\r\n        await this.load();\r\n        this.open(VStart);\r\n    }\r\n\r\n    showMeSysAdmin = () => {\r\n        this.open(VMeSysAdmin);\r\n    }\r\n\r\n    onMeSystemAdmin = async () => {\r\n        await this.setMeAdmin();\r\n        setReact(() => {\r\n            let { meAdmin } = this.deep;\r\n            let { role } = meAdmin;\r\n            meAdmin.role = -role;\r\n            meAdmin.update = Date.now() / 1000;\r\n            this.adminsChanged = true;\r\n        })\r\n        this.close();\r\n    }\r\n    /*\r\n    async searchUser(key: string): Promise<any> {\r\n        let user = await this.userFromName(key);\r\n        return user;\r\n    }\r\n    */\r\n    async onAddAdmin(role: EnumAdminRoleInEdit) {\r\n        let captionSelectUser = 'Add ' + (role === EnumAdminRoleInEdit.sys ? 'system admin' : 'admin');\r\n        //let cSelectUser = new CUser(this.nav, captionSelectUser, this)\r\n        let ret = await this.app.cUser.select<Admin>(captionSelectUser);\r\n        // let ret = await this.call<any, CAdminBase>(VAddUser, role);\r\n        if (!ret) return;\r\n        let { id: user, assigned } = ret;\r\n        await this.setAdmin(user, role, assigned);\r\n        setReact(() => {\r\n            let tick = Date.now() / 1000;\r\n            let admin: Admin = {\r\n                id: user,\r\n                user,\r\n                role,\r\n                operator: undefined,\r\n                assigned,\r\n                create: tick,\r\n                update: tick,\r\n            }\r\n            let { sysAdmins, admins } = this.deep;\r\n            let listAdd: Admin[], listDel: Admin[];\r\n            if (role === 1) {\r\n                listAdd = sysAdmins;\r\n                listDel = admins;\r\n            }\r\n            else {\r\n                listAdd = admins;\r\n                listDel = sysAdmins;\r\n            }\r\n            listAdd.unshift(admin);\r\n            this.removeAdmin(listDel, admin);\r\n            this.adminsChanged = true;\r\n        });\r\n    }\r\n\r\n    onDelAdmin = async (admin: Admin) => {\r\n        let { role } = admin;\r\n        await this.setAdmin(admin.id, -role, null);\r\n        setReact(() => {\r\n            let list = role === 1 ? this.deep.sysAdmins : this.deep.admins;\r\n            this.removeAdmin(list, admin);\r\n            this.adminsChanged = true;\r\n        });\r\n    }\r\n\r\n    private removeAdmin(list: Admin[], admin: Admin) {\r\n        let p = list.findIndex(v => v.id === admin.id);\r\n        if (p >= 0) list.splice(p, 1);\r\n    }\r\n\r\n    onUser = async (admin: Admin) => {\r\n        this.open(VUser, admin);\r\n    }\r\n\r\n    onEditRemark = async (admin: Admin) => {\r\n        let cStringEdit = new CStringEdit(this.app, {\r\n            itemSchema: { name: 'remark', type: 'string', required: true },\r\n            uiItem: { widget: 'text', maxLength: 100, label: 'Remark' } as UiTextItem,\r\n            value: admin.assigned,\r\n            onChanged: async (fieldName: string, value: any) => {\r\n                admin.assigned = value;\r\n                let { id, role, assigned } = admin;\r\n                await this.setAdmin(id, role, assigned);\r\n                this.adminsChanged = true;\r\n            }\r\n        });\r\n        cStringEdit.onEdit();\r\n    }\r\n}\r\n","import { Context, FA, Form, NumSchema, Schema, StringSchema, UiButton, UiCheckItem, UiTextItem } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CTagBase } from \"./CTagBase\";\r\n\r\nexport class VAddTag extends Page<CTagBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Add tag';\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        let schema: Schema = [\r\n            { name: 'name', type: 'string', maxLength: 50, required: true } as StringSchema,\r\n            { name: 'vice', type: 'string', maxLength: 100 } as StringSchema,\r\n            { name: 'single', type: 'number' } as NumSchema,\r\n            { name: 'submit', type: 'submit' }\r\n        ];\r\n        let uiSchema = {\r\n            items: {\r\n                name: {\r\n                    widget: 'text',\r\n                    label: 'Name',\r\n                } as UiTextItem,\r\n                vice: {\r\n                    widget: 'text',\r\n                    label: 'Discription',\r\n                } as UiTextItem,\r\n                single: {\r\n                    widget: 'checkbox',\r\n                    label: 'Singular',\r\n                    defaultValue: 0,\r\n                    trueValue: 1,\r\n                    falseValue: 0,\r\n                } as UiCheckItem,\r\n                submit: {\r\n                    widget: 'button',\r\n                    label: <><FA name=\"floppy-o\" /> Submit</>,\r\n                    className: 'btn btn-primary',\r\n                } as UiButton,\r\n            }\r\n        }\r\n        return <div className=\"p-3\">\r\n            <Form schema={schema} uiSchema={uiSchema} fieldLabelSize={2}\r\n                onButtonClick={this.onSave}\r\n            />\r\n        </div>;\r\n    }\r\n\r\n    private onSave = async (name: string, context: Context) => {\r\n        await this.control.onSaveTag(context.data);\r\n    }\r\n}","import { Context, FA, Form, Schema, StringSchema, UiButton, UiTextItem } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CTagBase } from \"./CTagBase\";\r\n\r\nexport class VAddTagItem extends Page<CTagBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Add tag';\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        let schema: Schema = [\r\n            { name: 'name', type: 'string', maxLength: 50, required: true } as StringSchema,\r\n            { name: 'submit', type: 'submit' }\r\n        ];\r\n        let uiSchema = {\r\n            items: {\r\n                name: {\r\n                    widget: 'text',\r\n                    label: 'Name',\r\n                } as UiTextItem,\r\n                submit: {\r\n                    widget: 'button',\r\n                    label: <><FA name=\"floppy-o\" /> Submit</>,\r\n                    className: 'btn btn-primary',\r\n                } as UiButton,\r\n            }\r\n        }\r\n        return <div className=\"p-3\">\r\n            <Form schema={schema} uiSchema={uiSchema} fieldLabelSize={2}\r\n                onButtonClick={this.onSave}\r\n            />\r\n        </div>;\r\n    }\r\n\r\n    private onSave = async (name: string, context: Context) => {\r\n        await this.control.onSaveTagItem(context.data);\r\n    }\r\n}","import { MouseEvent } from 'react';\r\nimport { View } from \"Control\";\r\nimport { FA } from \"tonwa-react\";\r\nimport { CTagBase } from \"./CTagBase\";\r\n\r\nexport class VDeleteTagItem extends View<CTagBase, () => Promise<void>> {\r\n    render() {\r\n        return <div className=\"mt-4 d-flex justify-content-end\">\r\n            <div onClick={this.onClick} className=\"px-3 py-2 cursor-pointer text-primary\">\r\n                <FA name=\"trash\" /> Delete the item\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    onClick = async (evt: MouseEvent<HTMLDivElement>) => {\r\n        evt.stopPropagation();\r\n        if (window.confirm('Do you really want to delete?') === true) {\r\n            await this.props();\r\n        }\r\n    }\r\n}","import { createEdit, Page } from \"Control\";\r\nimport { FA, ItemSchema, List, LMR, NumSchema, StringSchema, UiCheckItem, UiSchema } from \"tonwa-react\";\r\nimport { CTagBase, Tag } from \".\";\r\n\r\nexport class VEditTag extends Page<CTagBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Edit ' + this.control.deep.currentTag.name;\r\n    }\r\n\r\n    right() {\r\n        return <button className=\"btn btn-sm btn-light me-2\" onClick={this.onRemoveTag}>\r\n            <FA name=\"trash\" />\r\n        </button>;\r\n    }\r\n\r\n    private onRemoveTag = async () => {\r\n        let { currentTag } = this.control.deep;\r\n        let { name } = currentTag;\r\n        let ret = await this.confirm(`Do you really want to remove tag '${name}'?`);\r\n        if (ret === true) {\r\n            await this.control.removeTag(currentTag);\r\n        }\r\n    }\r\n\r\n    content() {\r\n        let right = <button className=\"btn btn-sm btn-success\"\r\n            onClick={this.control.onAddTagItem}>\r\n            <FA name=\"plus\" /> Item\r\n        </button>;\r\n        return this.react(() => {\r\n            return <div>\r\n                {this.renderProps()}\r\n                <LMR className=\"mt-4 mb-1 px-3\" right={right}>\r\n                    Items\r\n                </LMR>\r\n                <List items={this.control.deep.items} item={{ render: this.renderItem, onClick: this.onItemClick }} />\r\n            </div>;\r\n        });\r\n    }\r\n\r\n    private renderItem = (tagItem: Tag, index: number) => {\r\n        let { name } = tagItem;\r\n        let left = <FA className=\"text-info me-3\" name=\"square-o\" />;\r\n        return <LMR className=\"px-3 py-2 align-items-center\" left={left}>\r\n            {name}\r\n        </LMR>;\r\n    }\r\n\r\n    private onItemClick = (tagItem: Tag) => {\r\n        this.control.onEditTagItem(tagItem);\r\n    }\r\n\r\n    protected renderProps() {\r\n        return this.react(() => {\r\n            let { deep } = this.control;\r\n            let schema: ItemSchema[] = [\r\n                { name: 'name', type: 'string', required: true } as StringSchema,\r\n                { name: 'vice', type: 'string' } as StringSchema,\r\n                { name: 'single', type: 'number' } as NumSchema,\r\n            ];\r\n            let uiSchema: UiSchema = {\r\n                items: {\r\n                    name: {\r\n                        label: 'Name',\r\n                    },\r\n                    vice: {\r\n                        label: 'Discription'\r\n                    },\r\n                    single: {\r\n                        widget: 'checkbox',\r\n                        label: 'Singular',\r\n                        defaultValue: 0,\r\n                        trueValue: 1,\r\n                        falseValue: 0,\r\n                    } as UiCheckItem,\r\n                }\r\n            }\r\n            let { currentTag } = deep;\r\n            if (!uiSchema) {\r\n                uiSchema = { items: {} };\r\n            }\r\n            let vProps = schema.map((v, index) => {\r\n                let { name } = v;\r\n                let uiItem = uiSchema.items[name];\r\n                let label: string | JSX.Element;\r\n                let readOnly: boolean;\r\n                if (uiItem) {\r\n                    label = uiItem.label ?? name;\r\n                    readOnly = uiItem.readOnly;\r\n                }\r\n                else {\r\n                    label = name;\r\n                    readOnly = false;\r\n                }\r\n                let value = (currentTag as any)[name];\r\n                let cEdit = createEdit(this.control.app, {\r\n                    itemSchema: v,\r\n                    uiItem,\r\n                    value,\r\n                    onChanged: this.control.tagPropSave\r\n                });\r\n                let right = cEdit.renderEditIcon();\r\n                let onEdit: any;\r\n                let cn = 'mb-1 row bg-white align-items-center ';\r\n                if (readOnly === true) {\r\n                    onEdit = undefined;\r\n                }\r\n                else {\r\n                    onEdit = cEdit.onEdit;\r\n                    cn += 'cursor-pointer ';\r\n                }\r\n                return <div key={index} onClick={onEdit}\r\n                    className={cn}>\r\n                    <label className=\"col-sm-2 col-form-label\">{label}</label>\r\n                    <div className=\"col-sm-10\">\r\n                        <LMR right={readOnly !== true && right}>\r\n                            {cEdit.renderRef()}\r\n                        </LMR>\r\n                    </div>\r\n                </div>\r\n            });\r\n            return <div className=\"container\">{vProps}</div>;\r\n        });\r\n    }\r\n}","import { FA, LMR } from \"tonwa-react\";\r\nimport { Page } from \"../Page\";\r\nimport { CTagBase } from \"./CTagBase\";\r\n\r\nexport class VStart extends Page<CTagBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Tags admin';\r\n    }\r\n\r\n    content() {\r\n        let { icon, iconClass } = this.control;\r\n        return <div className=\"\">\r\n            {this.control.groups.map((v, index) => {\r\n                let { name, vice } = v;\r\n                let left = <FA name={icon} className={iconClass + ' me-3'} size=\"lg\" />;\r\n                let right = <FA name=\"angle-right\" />;\r\n                return <LMR key={index}\r\n                    onClick={() => this.control.openTagGroup(v)}\r\n                    className=\"px-3 py-2 cursor-pointer mb-1 bg-white align-items-center\"\r\n                    left={left} right={right}>\r\n                    {vice ?? name}\r\n                </LMR>;\r\n            })}\r\n        </div>;\r\n    }\r\n}\r\n","import { FA, List, LMR } from \"tonwa-react\";\r\nimport { Tag } from \".\";\r\nimport { Page } from \"../Page\";\r\nimport { CTagBase } from \"./CTagBase\";\r\n\r\nexport class VTagGroup extends Page<CTagBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        let { name, vice } = this.control.currentGroup;\r\n        return vice ?? name;\r\n    }\r\n\r\n    right(): JSX.Element {\r\n        return <button className=\"btn btn-sm btn-success me-2\"\r\n            onClick={this.control.onAddTag}>\r\n            <FA name=\"plus\" /> Tag\r\n        </button>;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return this.react(() => {\r\n            return <div className=\"\">\r\n                <List items={this.control.deep.tags} item={{ render: this.renderTag, onClick: this.onTagClick }} />\r\n            </div>;\r\n        });\r\n    }\r\n\r\n    private renderTag = (tag: Tag, index: number): JSX.Element => {\r\n        let { name, vice } = tag;\r\n        let left = <FA name={this.control.icon} className=\"text-info me-3\" />;\r\n        let right = <FA name=\"angle-right\" />;\r\n        return <LMR className=\"px-3 py-2 align-items-center\" left={left} right={right}>\r\n            <div>{name}</div>\r\n            <div className=\"small text-muted\">{vice}</div>\r\n        </LMR>\r\n    }\r\n\r\n    private onTagClick = (tag: Tag) => {\r\n        this.control.onEditTag(tag);\r\n    }\r\n}","import { AppBase, CStringEdit, deepReact, Page, setReact } from \"Control\";\r\nimport { Uq, ID, IX } from \"tonwa-core\";\r\nimport { StringSchema, UiTextItem } from \"tonwa-react\";\r\nimport { Control } from \"../Control\";\r\nimport { VAddTag } from \"./VAddTag\";\r\nimport { VAddTagItem } from \"./VAddTagItem\";\r\nimport { VDeleteTagItem } from \"./VDeleteTagItem\";\r\nimport { VEditTag } from \"./VEditTag\";\r\nimport { VStart } from \"./VStart\";\r\nimport { VTagGroup } from \"./VTagGroup\";\r\n\r\nexport interface Tag {\r\n    id?: number;\r\n    name: string;\r\n    vice?: string;\r\n    single?: number;\r\n}\r\n\r\nexport interface TagWithItems extends Tag {\r\n    items: Tag[];\r\n}\r\n\r\nexport interface TagGroup extends Tag {\r\n    tick?: number;\r\n    tags: TagWithItems[];\r\n}\r\n\r\nexport abstract class CTagBase<A extends AppBase = AppBase> extends Control<A> {\r\n    currentGroup: Tag;\r\n    tagGroups: { [group: string]: TagGroup } = {};\r\n    deep: {\r\n        tags: Tag[];\r\n        items: Tag[];\r\n        currentTag: Tag;\r\n    }\r\n        = deepReact({\r\n            tags: null,\r\n            items: null,\r\n            currentTag: null,\r\n        });\r\n\r\n    abstract get uq(): Uq;\r\n    abstract get TagGroup(): ID;\r\n    abstract get Tag(): ID;\r\n    abstract get TagItem(): ID;\r\n    abstract get IxTag(): IX;\r\n\r\n    abstract get groups(): Tag[];\r\n    abstract get caption(): string;\r\n    abstract get icon(): string;\r\n    abstract get iconClass(): string;\r\n\r\n    get VStart(): new (c: CTagBase) => Page<CTagBase> {\r\n        return VStart;\r\n    }\r\n\r\n    private groupsLoaded = false;\r\n    protected resetGroups() {\r\n        for (let i in this.tagGroups) {\r\n            let tagGroup = this.tagGroups[i];\r\n            tagGroup.tick = 0;\r\n        }\r\n        this.groupsLoaded = false;\r\n    }\r\n    protected async loadGroups(): Promise<void> {\r\n        if (this.groupsLoaded === true) return;\r\n        let ret = await this.uq.ID<Tag>({\r\n            IDX: this.TagGroup,\r\n            id: undefined,\r\n        });\r\n        for (let group of this.groups) {\r\n            let g = ret.find(v => v.name === group.name);\r\n            if (!g) {\r\n                throw Error(`${group.name} is not defined in UQ`);\r\n            }\r\n            group.id = g.id;\r\n        }\r\n        this.groupsLoaded = true;\r\n    }\r\n\r\n    async openMain() {\r\n        await this.loadGroups();\r\n        this.open(this.VStart);\r\n    }\r\n\r\n    get VTagGroup(): new (c: CTagBase) => Page<CTagBase> {\r\n        return VTagGroup;\r\n    }\r\n\r\n    async openTagGroup(group: Tag) {\r\n        this.currentGroup = group;\r\n        let ret = await this.uq.IX<Tag>({\r\n            IX: this.IxTag,\r\n            ix: group.id,\r\n            IDX: [this.Tag],\r\n        });\r\n        this.open(this.VTagGroup);\r\n        setReact(() => {\r\n            this.deep.tags = ret;\r\n        });\r\n    }\r\n\r\n    get VAddTag(): new (c: CTagBase) => Page<CTagBase> {\r\n        return VAddTag;\r\n    }\r\n    onAddTag = async () => {\r\n        this.open(this.VAddTag);\r\n    }\r\n\r\n    onSaveTag = async (tag: Tag) => {\r\n        let ret = await this.uq.ActIX<Tag>({\r\n            IX: this.IxTag,\r\n            ID: this.Tag,\r\n            values: [{ ix: this.currentGroup.id, xi: tag }]\r\n        });\r\n        tag.id = ret[0];\r\n        this.close();\r\n        setReact(() => {\r\n            this.deep.tags.push(tag);\r\n            this.resetGroups();\r\n        });\r\n    }\r\n\r\n    get VEditTag(): new (c: CTagBase) => Page<CTagBase> {\r\n        return VEditTag;\r\n    }\r\n    onEditTag = async (tag: Tag) => {\r\n        setReact(() => {\r\n            this.deep.currentTag = tag;\r\n            this.open(this.VEditTag);\r\n        });\r\n        let ret = await this.uq.IX<Tag>({\r\n            IX: this.IxTag,\r\n            ix: tag.id,\r\n            IDX: [this.TagItem],\r\n        });\r\n        setReact(() => {\r\n            this.deep.items = ret;\r\n        });\r\n    }\r\n\r\n    async removeTag(tag: Tag) {\r\n        await this.uq.ActIX({\r\n            IX: this.IxTag,\r\n            values: [{\r\n                ix: this.currentGroup.id,\r\n                xi: -tag.id,\r\n            }],\r\n        })\r\n        this.close();\r\n        setReact(() => {\r\n            this.resetGroups();\r\n            let { tags } = this.deep;\r\n            let p = tags.findIndex(v => v === tag);\r\n            if (p >= 0) tags.splice(p, 1);\r\n        });\r\n    }\r\n\r\n    get VAddTagItem(): new (c: CTagBase) => Page<CTagBase> {\r\n        return VAddTagItem;\r\n    }\r\n    onAddTagItem = async () => {\r\n        this.open(this.VAddTagItem);\r\n    }\r\n\r\n    onSaveTagItem = async (tag: Tag) => {\r\n        let ret = await this.uq.ActIX<Tag>({\r\n            IX: this.IxTag,\r\n            ID: this.TagItem,\r\n            values: [{ ix: this.deep.currentTag.id, xi: tag }]\r\n        });\r\n        tag.id = ret[0];\r\n        this.close();\r\n        setReact(() => {\r\n            this.resetGroups();\r\n            this.deep.items.push(tag);\r\n        });\r\n    }\r\n\r\n    onEditTagItem = async (tagItem: Tag) => {\r\n        let onTagItemChanged = async (name: string, value: any): Promise<void> => {\r\n            tagItem.name = value;\r\n            await this.uq.ActIDProp(this.TagItem, tagItem.id, 'name', value);\r\n        }\r\n        let onTagItemDeleted = async (): Promise<void> => {\r\n            let { currentTag, items } = this.deep;\r\n            await this.uq.ActIX({\r\n                IX: this.IxTag,\r\n                values: [{ ix: currentTag.id, xi: -tagItem.id }]\r\n            });\r\n            this.close();\r\n            setReact(() => {\r\n                let p = items.findIndex(v => v === tagItem);\r\n                if (p >= 0) items.splice(p, 1);\r\n            });\r\n        }\r\n        let cStringEdit = new CStringEdit(this.app, {\r\n            itemSchema: { name: 'name', type: 'string', maxLength: 50, required: true } as StringSchema,\r\n            uiItem: { widget: 'text', label: 'Edit tag item' } as UiTextItem,\r\n            onChanged: onTagItemChanged,\r\n            value: tagItem.name,\r\n            exView: this.render(VDeleteTagItem, onTagItemDeleted),\r\n        });\r\n        cStringEdit.onEdit();\r\n    }\r\n\r\n    tagPropSave = async (name: string, value: any) => {\r\n        let { deep } = this;\r\n        await this.uq.ActIDProp(this.Tag, deep.currentTag.id, name, value);\r\n        setReact(() => {\r\n            (deep.currentTag as any)[name] = value;\r\n            this.resetGroups();\r\n        });\r\n    }\r\n\r\n    async loadGroup(groupName: string): Promise<TagGroup> {\r\n        let tagGroup = this.tagGroups[groupName];\r\n        if (tagGroup !== undefined) {\r\n            let { tick } = tagGroup;\r\n            if (Date.now() - tick < 3600 * 1000) {\r\n                return tagGroup;\r\n            }\r\n            tagGroup = undefined;\r\n            this.tagGroups[groupName] = undefined;\r\n        }\r\n        await this.loadGroups();\r\n        let group = this.groups.find(v => v.name === groupName);\r\n        if (group === undefined) return;\r\n        let ret = await this.uq.IX<Tag>({\r\n            IX: this.IxTag,\r\n            ix: group.id,\r\n            IDX: [this.Tag],\r\n        });\r\n        let retItems = await this.uq.IX<Tag>({\r\n            IX: this.IxTag,\r\n            IX1: this.IxTag,\r\n            ix: group.id,\r\n            IDX: [this.TagItem],\r\n        });\r\n        let tagColl: { [tag: number]: TagWithItems } = {};\r\n        let tags: TagWithItems[] = [];\r\n        for (let row of ret) {\r\n            let tag: TagWithItems = {\r\n                items: [],\r\n                ...row\r\n            };\r\n            tagColl[row.id] = tag;\r\n            tags.push(tag);\r\n        }\r\n        for (let row of retItems) {\r\n            let { ix } = row as any;\r\n            let tag = tagColl[ix];\r\n            if (!tag) continue;\r\n            tag.items.push(row);\r\n        }\r\n        tagGroup = {\r\n            name: group.name,\r\n            tick: Date.now(),\r\n            tags,\r\n        };\r\n        return this.tagGroups[groupName] = tagGroup;\r\n    }\r\n}\r\n","import { TagWithItems } from \".\";\r\nimport { View } from \"../View\";\r\nimport { Tag } from \"./CTagBase\";\r\nimport { CTagInput } from \"./CTagInput\";\r\n\r\nexport class VTagInput extends View<CTagInput> {\r\n    render(): JSX.Element {\r\n        let { tagGroup } = this.control;\r\n        if (!tagGroup) return null;\r\n        let { tags } = tagGroup;\r\n        if (tags.length === 0) return null;\r\n        return <div className=\"container\">\r\n            {tagGroup.tags.map((v, index) => {\r\n                let { name, items } = v;\r\n                return <div key={index} className=\"row mb-1 py-2 bg-white\">\r\n                    <div className=\"col-2 ps-3 pt-1\">{name}</div>\r\n                    <div className=\"col-10\">\r\n                        {items.map((item: Tag, index: number) => this.renderTagItem(v, item, index))}\r\n                    </div>\r\n                </div>\r\n            })}\r\n        </div>;\r\n    }\r\n\r\n    private renderTagItem = (tag: TagWithItems, item: Tag, index: number): JSX.Element => {\r\n        let { shallow } = this.control;\r\n        let { single, name } = tag;\r\n        let type: string;\r\n        let radioName: string;\r\n        if (single === 1) {\r\n            type = 'radio';\r\n            radioName = 'tag-radio-' + name;\r\n        }\r\n        else {\r\n            type = 'checkbox';\r\n        }\r\n        return this.react(() => {\r\n            let { id, name } = item;\r\n            let { tagMap } = shallow;\r\n            let checked = tagMap.get(id);\r\n            return <label key={index} className=\"w-min-8c me-3 my-2\">\r\n                <input className=\"form-check-input\"\r\n                    type={type}\r\n                    name={radioName}\r\n                    defaultChecked={checked}\r\n                    value={id}\r\n                    onChange={evt => this.control.onCheckChange(tag, item, evt.currentTarget.checked)} /> {name}\r\n            </label>;\r\n        });\r\n    }\r\n}\r\n","import { CIdBase, Control, setReact, shallowReact, View } from \"Control\";\r\nimport { IX } from \"tonwa-core\";\r\nimport { Tag, TagGroup, TagWithItems } from \".\";\r\nimport { CTagBase } from \"./CTagBase\";\r\nimport { VTagInput } from \"./VTagInput\";\r\n\r\nexport class CTagInput extends Control {\r\n    readonly cTag: CTagBase;\r\n    readonly cId: CIdBase;\r\n    readonly IxID: IX;\r\n    tagGroup: TagGroup;\r\n    id: number;\r\n    shallow: {\r\n        tagMap: Map<number, boolean>;\r\n    } = shallowReact({\r\n        tagMap: new Map<number, boolean>(),\r\n    });\r\n\r\n    constructor(cTag: CTagBase, cId: CIdBase, IxID: IX) {\r\n        super(cTag.app);\r\n        this.cTag = cTag;\r\n        this.cId = cId;\r\n        this.IxID = IxID;\r\n    }\r\n\r\n    async beforeEdit(tagGroupName: string, id: number): Promise<void> {\r\n        this.tagGroup = await this.cTag.loadGroup(tagGroupName);\r\n        this.id = id;\r\n        let ret = await this.cId.uq.IX<{ ix: number, xi: number }>({\r\n            IX: this.IxID,\r\n            ix: id,\r\n        });\r\n        setReact(() => {\r\n            let { tagMap } = this.shallow;\r\n            tagMap.clear();\r\n            for (let row of ret) {\r\n                let { xi } = row;\r\n                tagMap.set(xi, true);\r\n            }\r\n            // assure radio box only show single value\r\n            for (let tag of this.tagGroup.tags) {\r\n                let { single, items } = tag;\r\n                if (single !== 1) continue;\r\n                let checked = false;\r\n                for (let item of items) {\r\n                    let { id } = item;\r\n                    if (checked === true) {\r\n                        if (tagMap.get(id) === true) {\r\n                            tagMap.set(id, false);\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (tagMap.get(id) === true) {\r\n                            checked = true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    get InputView(): new (c: CTagInput) => View<CTagInput> {\r\n        return VTagInput;\r\n    }\r\n\r\n    renderInput(): JSX.Element {\r\n        return this.render(this.InputView);\r\n    }\r\n\r\n    onCheckChange = async (tag: TagWithItems, item: Tag, checked: boolean) => {\r\n        let { tagMap } = this.shallow;\r\n        let itemId = item.id;\r\n        let values: { ix: number; xi: number; }[] = [];\r\n        if (tag.single === 1) {\r\n            for (let p of tag.items) {\r\n                if (p === item) continue;\r\n                let pid = p.id;\r\n                if (tagMap.get(pid) === true) {\r\n                    values.push({ ix: this.id, xi: -pid });\r\n                }\r\n            }\r\n            if (checked === false) throw Error('radio should not be false');\r\n            values.push({ ix: this.id, xi: itemId });\r\n        }\r\n        else {\r\n            values.push({ ix: this.id, xi: checked === true ? itemId : -itemId });\r\n        }\r\n        await this.cTag.uq.ActIX({\r\n            IX: this.IxID,\r\n            values,\r\n        });\r\n        setReact(() => {\r\n            for (let v of values) {\r\n                let { xi } = v;\r\n                let idOfItem: number;\r\n                let checkValue: boolean;\r\n                if (xi < 0) {\r\n                    idOfItem = -xi;\r\n                    checkValue = false;\r\n                }\r\n                else {\r\n                    idOfItem = xi;\r\n                    checkValue = true;\r\n                }\r\n                tagMap.set(idOfItem, checkValue);\r\n            }\r\n        });\r\n    }\r\n}","import { CAdminBase } from \"./CAdminBase\";\r\nimport { Page } from \"../Page\";\r\nimport { FA, LMR } from \"tonwa-react\";\r\n\r\nconst cnRow = ' px-3 py-2 ';\r\nconst cnBg = ' bg-white ';\r\nconst cnMYLg = ' my-2 ';\r\n//const cnMYSm = ' my-1 ';\r\nconst cnSmallMuted = ' small text-muted ';\r\nconst info = <FA className=\"text-primary me-3 mt-1\" name=\"info-circle\" size=\"lg\" />;\r\n\r\nexport class VMeSysAdmin extends Page<CAdminBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'System admin';\r\n    }\r\n\r\n    content() {\r\n        let { meAdmin } = this.control.deep;\r\n        switch (meAdmin.role) {\r\n            default: return null;\r\n            case -1: return this.renderQuiting();\r\n            case 1: return this.renderAm();\r\n        }\r\n    }\r\n\r\n    private renderQuiting() {\r\n        let { update } = this.control.deep.meAdmin;\r\n        let dateUpdate = new Date(update * 1000);\r\n        let dateUpdateNextDay = new Date((update + 24 * 3600) * 1000);\r\n        return <div>\r\n            <LMR className={cnRow + cnBg + cnMYLg + ' text-danger cursor-pointer'}\r\n                onClick={this.control.showMeSysAdmin}>\r\n                <div className=\"d-flex justify-content-center p-3\">\r\n                    {info}<b>I am quiting system admim</b>\r\n                </div>\r\n                <div className={cnSmallMuted + ' my-3 d-flex justify-content-center '}>\r\n                    You quit at {dateUpdate.toLocaleDateString()} {dateUpdate.toLocaleTimeString()},\r\n                    can restore before {dateUpdateNextDay.toLocaleDateString()} {dateUpdateNextDay.toLocaleTimeString()}\r\n                </div>\r\n            </LMR>\r\n            <div className=\"pt-3\">\r\n                <div className=\"d-flex justify-content-center my-3\">\r\n                    <button className=\"btn btn-outline-primary\"\r\n                        onClick={this.control.onMeSystemAdmin}>\r\n                        Restore system admin\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private renderAm() {\r\n        return <div>\r\n            <LMR className={cnRow + cnBg + cnMYLg + ' text-danger cursor-pointer'}\r\n                onClick={this.control.showMeSysAdmin}>\r\n                <div className=\"d-flex justify-content-center p-3\">\r\n                    {info}<b>I am a system admim</b>\r\n                </div>\r\n            </LMR>\r\n            <div className=\"pt-3\">\r\n                <div className=\"d-flex justify-content-center my-3\">\r\n                    <button className=\"btn btn-outline-primary\"\r\n                        disabled={this.control.deep.sysAdmins.length === 0}\r\n                        onClick={this.control.onMeSystemAdmin}>\r\n                        Quit system admin\r\n                    </button>\r\n                </div>\r\n                <div className=\"d-flex justify-content-center my-3\">\r\n                    <div className={cnSmallMuted}>You can restore in 24 hours after quiting</div>\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n","import { User } from \"Control\";\r\nimport { FA, Image, List, LMR } from \"tonwa-react\";\r\nimport { Admin, EnumAdminRoleInEdit } from \".\";\r\nimport { Page } from \"../Page\";\r\nimport { CAdminBase } from \"./CAdminBase\";\r\n\r\nconst cnRow = ' px-3 py-2 ';\r\nconst cnBg = ' bg-white ';\r\nconst cnMYLg = ' my-2 ';\r\nconst cnMYSm = ' my-1 ';\r\n//const cnSmallMuted = ' small text-muted ';\r\nconst info = <FA className=\"text-primary me-3\" name=\"info-circle\" size=\"lg\" />;\r\n\r\nexport class VStart extends Page<CAdminBase> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Admin';\r\n    }\r\n\r\n    content() {\r\n        return this.react(() => {\r\n            return <div>\r\n                {this.renderMe()}\r\n                {this.renderSysAdmins()}\r\n                {this.renderAdmins()}\r\n            </div>\r\n        });\r\n    }\r\n\r\n    private renderMe(): JSX.Element {\r\n        let { deep } = this.control;\r\n        let { meAdmin } = deep;\r\n        switch (meAdmin.role) {\r\n            default: return null;\r\n            case EnumAdminRoleInEdit.nSys: return this.renderMeSystemAdmin(true);\r\n            case EnumAdminRoleInEdit.sys: return this.renderMeSystemAdmin(false);\r\n            case EnumAdminRoleInEdit.admin:\r\n                return <div className={cnRow + cnBg + cnMYLg}>\r\n                    {info} I am an admin\r\n                </div>;\r\n        }\r\n    }\r\n\r\n    private renderMeSystemAdmin(quiting: boolean) {\r\n        let rightAngle = <FA name=\"angle-right\" />;\r\n        let msg = quiting === true ?\r\n            'I am quiting system admin'\r\n            :\r\n            'I am a system admin';\r\n        return <LMR className={cnRow + cnBg + cnMYLg + ' text-danger cursor-pointer'}\r\n            onClick={this.control.showMeSysAdmin}\r\n            right={rightAngle}>\r\n            {info}\r\n            <b>{msg}</b>\r\n        </LMR>;\r\n    }\r\n\r\n    private renderSysAdmins(): JSX.Element {\r\n        let { deep } = this.control;\r\n        let { meAdmin } = deep;\r\n        switch (meAdmin.role) {\r\n            case EnumAdminRoleInEdit.nSys: return null;\r\n            case EnumAdminRoleInEdit.admin: return null;\r\n        }\r\n\r\n        let { sysAdmins } = deep;\r\n        return <div className=\"mt-3\">\r\n            <div className={cnRow + ' small '}>\r\n                <LMR right={this.renderAdd(EnumAdminRoleInEdit.sys)} className=\"align-items-end\">\r\n                    <div>System admins</div>\r\n                    <div className=\"small text-muted\">System admin is an admin, and can add or delete admin</div>\r\n                </LMR>\r\n            </div>\r\n            <List items={sysAdmins} item={{ render: this.renderAdminItem, onClick: this.control.onUser }} />\r\n        </div>;\r\n    }\r\n\r\n    private renderAdmins(): JSX.Element {\r\n        let { deep } = this.control;\r\n        let { meAdmin } = deep;\r\n        switch (meAdmin.role) {\r\n            case EnumAdminRoleInEdit.nSys: return null;\r\n            case EnumAdminRoleInEdit.admin: return null;\r\n        }\r\n        let { admins } = deep;\r\n        return <div className=\"mt-3\">\r\n            <div className={cnRow + ' small'}>\r\n                <LMR right={this.renderAdd(EnumAdminRoleInEdit.admin)} className=\"align-items-end\">\r\n                    <div>Admins</div>\r\n                    <div className=\"small text-muted\">Admin can define user roles</div>\r\n                </LMR>\r\n            </div>\r\n            <List items={admins} item={{ render: this.renderAdminItem, onClick: this.control.onUser }} />\r\n        </div>;\r\n    }\r\n\r\n    private renderAdminItem = (admin: Admin, index: number) => {\r\n        let { id, assigned } = admin;\r\n        return this.control.app.cUser.renderUser(id, (user: User) => {\r\n            let { name, nick, icon } = user;\r\n            let right = <FA name=\"angle-right\" className=\"cursor-pointer\" />;\r\n            return <LMR key={id}\r\n                className={cnRow + cnMYSm + cnBg}\r\n                left={<Image src={icon} className=\"me-4 align-self-start w-2-5c h-2-5c\" />}\r\n                right={right}>\r\n                {\r\n                    assigned && <div>\r\n                        <small className=\"text-muted me-3\">Remark:</small>\r\n                        {assigned}\r\n                    </div>\r\n                }\r\n                <div><small className=\"text-muted me-3\">Name:</small>{name}</div>\r\n                <div><small className=\"text-muted me-3\">Nick:</small>{nick}</div>\r\n            </LMR>;\r\n        });\r\n    }\r\n\r\n    renderAdd(role: EnumAdminRoleInEdit): JSX.Element {\r\n        return <button className=\"btn btn-sm btn-outline-success\" onClick={() => this.control.onAddAdmin(role)}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n}\r\n","import { Page } from \"Control\";\r\nimport { User } from \"../CUser\";\r\nimport { FA, Image } from \"tonwa-react\";\r\nimport { Admin, CAdminBase, EnumAdminRoleInEdit } from \".\";\r\n\r\nexport class VUser extends Page<CAdminBase, Admin> {\r\n    header() {\r\n        return ' ';\r\n    }\r\n    content() {\r\n        let vDel: any;\r\n        let { id, role, operator, update } = this.props;\r\n        return this.control.app.cUser.renderUser(id, (user: User) => {\r\n            let { name, nick, icon } = user;\r\n            if ((role === EnumAdminRoleInEdit.sys && Date.now() / 1000 - update < 24 * 3600)\r\n                || operator === this.control.me\r\n                || role === EnumAdminRoleInEdit.admin) {\r\n                vDel = <button className=\"btn btn-sm btn-outline-secondary\" onClick={this.onDelAdmin}>\r\n                    Remove {role === EnumAdminRoleInEdit.sys ? 'system admin' : 'admin'}\r\n                </button>;\r\n            }\r\n\r\n            return <div>\r\n                <div className=\"d-flex border m-3 rounded-3 bg-white px-5 py-4\">\r\n                    <Image src={icon} className=\"me-4 w-2-5c h-2-5c\" />\r\n                    <div>\r\n                        <div className=\"cursor-pointer\"\r\n                            onClick={() => this.control.onEditRemark(this.props)}>\r\n                            <small className=\"text-muted me-3\">Remark:</small>\r\n                            {this.react(() => {\r\n                                let { assigned } = this.props;\r\n                                return <>{assigned ?? '-'}</>;\r\n                            })}\r\n                            <span className=\"ms-3\">\r\n                                <FA name=\"pencil-square-o\" className=\"text-primary\" />\r\n                            </span>\r\n                        </div>\r\n                        <div><small className=\"me-3 text-muted\">Name:</small> {name}</div>\r\n                        <div><small className=\"me-3 text-muted\">Nick:</small> {nick}</div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"d-flex m-3 mt-4 justify-content-end\">\r\n                    {vDel}\r\n                </div>\r\n            </div>\r\n        });\r\n    }\r\n\r\n    private onDelAdmin = async () => {\r\n        let ret = await this.confirm('do you really want to delete the admin?');\r\n        if (ret === true) {\r\n            this.control.onDelAdmin(this.props);\r\n            this.control.close();\r\n        }\r\n    }\r\n}\r\n","//=== UqApp builder created on Tue Feb 15 2022 12:15:55 GMT-0500 (北美东部标准时间) ===//\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { IDXValue, Uq, UqTuid, UqAction, UqQuery, UqID, UqIX } from \"tonwa-core\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Render, IDXEntity } from \"tonwa-react\";\n\n\n//===============================\n//======= UQ BizDev/workshop ========\n//===============================\n\nexport enum Gender {\n\tfemale = 0,\n\tmale = 1\n}\n\nexport enum Role {\n\tstaff = 10,\n\tcounselor = 11,\n\tvolunteer = 12,\n\tboard = 13,\n\tclient = 20,\n\tdonator = 30\n}\n\nexport interface Tuid$user {\n\tid?: number;\n\tname: string;\n\tnick: string;\n\ticon: string;\n\tassigned: string;\n\tpoke: number;\n\ttimezone: number;\n}\n\nexport interface Tuid$sheet {\n\tid?: number;\n\tno: string;\n\tuser: number;\n\tdate: any;\n\tsheet: number;\n\tversion: number;\n\tflow: number;\n\tapp: number;\n\tstate: number;\n\tdiscription: string;\n\tdata: string;\n\tprocessing: number;\n}\n\nexport interface Param$setMyTimezone {\n\t_timezone: number;\n}\nexport interface Result$setMyTimezone {\n}\n\nexport interface ParamSaveNote {\n\tid: number;\n\tstaff: number;\n\tclient: number;\n\tnote: string;\n\tsensitive: number;\n}\nexport interface ReturnSaveNoteRet {\n\tid: number;\n}\nexport interface ResultSaveNote {\n\tret: ReturnSaveNoteRet[];\n}\n\nexport interface ParamSetSessionStaff {\n\tsession: number;\n\tstaff: number;\n\town: number;\n\tsubstitue: number;\n\tdone: number;\n}\nexport interface ResultSetSessionStaff {\n}\n\nexport interface ParamSaveWorkshopStaff {\n\tid: number;\n\tstaff: number;\n}\nexport interface ResultSaveWorkshopStaff {\n}\n\nexport interface ParamSaveSessionAttendee {\n\tsession: number;\n\tclient: number;\n\tdeleted: number;\n}\nexport interface ResultSaveSessionAttendee {\n}\n\nexport interface Param$poked {\n}\nexport interface Return$pokedRet {\n\tpoke: number;\n}\nexport interface Result$poked {\n\tret: Return$pokedRet[];\n}\n\nexport interface Param$getUnitTime {\n}\nexport interface Return$getUnitTimeRet {\n\ttimezone: number;\n\tunitTimeZone: number;\n\tunitBizMonth: number;\n\tunitBizDate: number;\n}\nexport interface Result$getUnitTime {\n\tret: Return$getUnitTimeRet[];\n}\n\nexport interface ParamPersonSearch {\n\trole: any;\n\tkey: string;\n}\nexport interface ReturnPersonSearchRet {\n\tid: number;\n\tno: string;\n\tname: string;\n\tvice: string;\n\tfirstName: string;\n\tlastName: string;\n\tmiddleName: string;\n\tgender: any;\n\tyear: number;\n\tmonth: number;\n\tday: number;\n\temail: string;\n\tmobile: string;\n\tmobileCountry: string;\n}\nexport interface ResultPersonSearch {\n\tret: ReturnPersonSearchRet[];\n}\n\nexport interface ParamMyClients {\n}\nexport interface ReturnMyClientsRet {\n\tid: number;\n\tno: string;\n\tname: string;\n\tvice: string;\n\tfirstName: string;\n\tlastName: string;\n\tmiddleName: string;\n\tgender: any;\n\tyear: number;\n\tmonth: number;\n\tday: number;\n\temail: string;\n\tmobile: string;\n\tmobileCountry: string;\n}\nexport interface ResultMyClients {\n\tret: ReturnMyClientsRet[];\n}\n\nexport interface ParamMySessions {\n}\nexport interface ReturnMySessionsRet {\n\tid: number;\n\tdate: any;\n\tvice: string;\n\ttime: any;\n\tspan: number;\n\tworkshop: number;\n\town: number;\n\tsubstitue: number;\n\tdone: number;\n}\nexport interface ResultMySessions {\n\tret: ReturnMySessionsRet[];\n}\n\nexport interface ParamGetPersonLog {\n\tperson: number;\n}\nexport interface ReturnGetPersonLogRet {\n\tlog: number;\n\ttype: string;\n\tvalue: string;\n}\nexport interface ResultGetPersonLog {\n\tret: ReturnGetPersonLogRet[];\n}\n\nexport interface ParamGetPersonList {\n\trole: any;\n}\nexport interface ReturnGetPersonListRet {\n\tid: number;\n\tno: string;\n\tname: string;\n\tvice: string;\n\tfirstName: string;\n\tlastName: string;\n\tmiddleName: string;\n\tgender: any;\n\tyear: number;\n\tmonth: number;\n\tday: number;\n\temail: string;\n\tmobile: string;\n\tmobileCountry: string;\n\tuser: number;\n}\nexport interface ReturnGetPersonListRoles {\n\tperson: number;\n\trole: any;\n}\nexport interface ResultGetPersonList {\n\tret: ReturnGetPersonListRet[];\n\troles: ReturnGetPersonListRoles[];\n}\n\nexport interface Workshop {\n\tid?: number;\n\tno?: string;\n\tname: string;\n\tvice: string;\n\tstaff: number;\n}\n\nexport interface Person {\n\tid?: number;\n\tno?: string;\n\tname: string;\n\tvice: string;\n\tfirstName: string;\n\tlastName: string;\n\tmiddleName: string;\n\tgender: any;\n\tyear: number;\n\tmonth: number;\n\tday: number;\n\temail: string;\n\tmobile: string;\n\tmobileCountry: string;\n}\n\nexport interface Note {\n\tid?: number;\n\tstaff: number;\n\tclient: number;\n\tnote: string;\n\tsensitive: number;\n}\n\nexport interface Session {\n\tid?: number;\n\tdate: any;\n\tvice: string;\n\ttime: any;\n\tspan: number;\n}\n\nexport interface SessionPerson {\n\tid?: number;\n\tsession: number;\n\tperson: number;\n\tworkshop: number;\n\tdeleted: number;\n}\n\nexport interface Tag {\n\tid?: number;\n\tname: string;\n\tvice: string;\n\tsingle: number;\n}\n\nexport interface TagGroup {\n\tid?: number;\n\tname: string;\n}\n\nexport interface TagItem {\n\tid?: number;\n\tname: string;\n}\n\nexport interface IxStaffClient {\n\ttick: number;\n\tix: number;\n\txi: number;\n}\n\nexport interface IxSessionClient {\n\tdeleted: number;\n\tix: number;\n\txi: number;\n}\n\nexport interface IxWorkshopSession {\n\tix: number;\n\txi: number;\n}\n\nexport interface IxSessionStaff {\n\town: number;\n\tsubstitue: number;\n\tdone: number;\n\tix: number;\n\txi: number;\n}\n\nexport interface IxPersonLog {\n\tix: number;\n\txi: number;\n}\n\nexport interface IxTag {\n\tix: number;\n\txi: number;\n}\n\nexport interface IxGlobalIdTag {\n\tix: number;\n\txi: number;\n}\n\nexport interface IxLocalIdTag {\n\tix: number;\n\txi: number;\n}\n\nexport interface IxPersonRole {\n\tix: number;\n\txi: number;\n}\n\nexport interface IxUserPerson {\n\tix: number;\n\txi: number;\n}\n\nexport interface ParamActs {\n\tworkshop?: Workshop[];\n\tperson?: Person[];\n\tnote?: Note[];\n\tsession?: Session[];\n\tsessionPerson?: SessionPerson[];\n\ttag?: Tag[];\n\ttagGroup?: TagGroup[];\n\ttagItem?: TagItem[];\n\tixStaffClient?: IxStaffClient[];\n\tixSessionClient?: IxSessionClient[];\n\tixWorkshopSession?: IxWorkshopSession[];\n\tixSessionStaff?: IxSessionStaff[];\n\tixPersonLog?: IxPersonLog[];\n\tixTag?: IxTag[];\n\tixGlobalIdTag?: IxGlobalIdTag[];\n\tixLocalIdTag?: IxLocalIdTag[];\n\tixPersonRole?: IxPersonRole[];\n\tixUserPerson?: IxUserPerson[];\n}\n\n\nexport interface UqExt extends Uq {\n\tActs(param:ParamActs): Promise<any>;\n\tSQL: Uq;\n\tIDRender(id:number):JSX.Element;\n\tIDLocalRender(id:number):JSX.Element;\n\n\t$user: UqTuid<Tuid$user>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\t$sheet: UqTuid<Tuid$sheet>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\t$setMyTimezone: UqAction<Param$setMyTimezone, Result$setMyTimezone>;\n\tSaveNote: UqAction<ParamSaveNote, ResultSaveNote>;\n\tSetSessionStaff: UqAction<ParamSetSessionStaff, ResultSetSessionStaff>;\n\tSaveWorkshopStaff: UqAction<ParamSaveWorkshopStaff, ResultSaveWorkshopStaff>;\n\tSaveSessionAttendee: UqAction<ParamSaveSessionAttendee, ResultSaveSessionAttendee>;\n\t$poked: UqQuery<Param$poked, Result$poked>;\n\t$getUnitTime: UqQuery<Param$getUnitTime, Result$getUnitTime>;\n\tPersonSearch: UqQuery<ParamPersonSearch, ResultPersonSearch>;\n\tMyClients: UqQuery<ParamMyClients, ResultMyClients>;\n\tMySessions: UqQuery<ParamMySessions, ResultMySessions>;\n\tGetPersonLog: UqQuery<ParamGetPersonLog, ResultGetPersonLog>;\n\tGetPersonList: UqQuery<ParamGetPersonList, ResultGetPersonList>;\n\tWorkshop: UqID<any> & IDXEntity<any>;\n\tPerson: UqID<any> & IDXEntity<any>;\n\tNote: UqID<any> & IDXEntity<any>;\n\tSession: UqID<any> & IDXEntity<any>;\n\tSessionPerson: UqID<any> & IDXEntity<any>;\n\tTag: UqID<any> & IDXEntity<any>;\n\tTagGroup: UqID<any> & IDXEntity<any>;\n\tTagItem: UqID<any> & IDXEntity<any>;\n\tIxStaffClient: UqIX<any>;\n\tIxSessionClient: UqIX<any>;\n\tIxWorkshopSession: UqIX<any>;\n\tIxSessionStaff: UqIX<any>;\n\tIxPersonLog: UqIX<any>;\n\tIxTag: UqIX<any>;\n\tIxGlobalIdTag: UqIX<any>;\n\tIxLocalIdTag: UqIX<any>;\n\tIxPersonRole: UqIX<any>;\n\tIxUserPerson: UqIX<any>;\n}\n\nexport function assign(uq: any, to:string, from:any): void {\n\tlet hasEntity = uq.hasEntity(to);\n\tif (hasEntity === false) {\n\t\treturn;\n\t}\n\tObject.assign((uq as any)[to], from);\n}\n","import { Page, setReact, shallowReact } from \"Control\";\r\nimport { FA, Image, SearchBox } from \"tonwa-react\";\r\nimport { mutedSmall } from \"tool\";\r\nimport { CUser, User } from \"./CUser\";\r\n\r\nexport class VSelectUser extends Page<CUser> {\r\n    shallow: {\r\n        user: any;\r\n    } = shallowReact({\r\n        user: null,\r\n    });\r\n    header(): string | boolean | JSX.Element {\r\n        return this.control.caption;\r\n    }\r\n\r\n    protected get back(): \"close\" | \"back\" | \"none\" {\r\n        return 'close';\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"p-3 d-flex align-items-center flex-column\">\r\n            <div className=\"mx-auto mb-3\">\r\n                <SearchBox className=\"w-min-20c\"\r\n                    onFocus={() => setReact(() => this.shallow.user = null)}\r\n                    onSearch={this.onSearch}\r\n                    placeholder=\"user account\" />\r\n            </div>\r\n            {this.react(() => {\r\n                let { user } = this.shallow;\r\n                if (user === null) return null;\r\n                let vContent: any;\r\n                if (user === undefined) {\r\n                    vContent = <div><FA name=\"info-o\" className=\"me-3 text-info\" /> No user</div>;\r\n                }\r\n                else {\r\n                    let { name, nick, icon } = user;\r\n                    vContent = <>\r\n                        <div className=\"d-flex\">\r\n                            <Image src={icon} className=\"me-4 w-2-5c h-2-5c\" />\r\n                            <div>\r\n                                <div>{mutedSmall('Name:')} &nbsp; {name}</div>\r\n                                <div>{mutedSmall('Nick:')} &nbsp; {nick}</div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"text-center mt-5\">\r\n                            <button className=\"btn btn-primary\" onClick={() => this.onSelected(user)}>\r\n                                {this.header()}\r\n                            </button>\r\n                        </div>\r\n                    </>;\r\n                }\r\n                return <div className=\"border rounded-3 bg-white p-5 mx-auto w-min-20c\">\r\n                    {vContent}\r\n                </div>;\r\n            })}\r\n        </div>;\r\n    }\r\n\r\n    private onSelected = (user: User) => {\r\n        this.control.callReturn(this, user);\r\n        this.control.close();\r\n    }\r\n\r\n    private onSearch = async (key: string) => {\r\n        let ret = await this.control.searchUser(key);\r\n        setReact(() => {\r\n            this.shallow.user = ret;\r\n        });\r\n    }\r\n}\r\n","import { Control, react, setReact, shallowReact } from \"Control\";\r\nimport { mutedSmall } from \"tool\";\r\nimport { VSelectUser } from \"./VSelectUser\";\r\n\r\ninterface ShallowData {\r\n    cache: Map<number, User>;\r\n}\r\n\r\nexport interface User {\r\n    id: number;\r\n    name: string;\r\n    nick: string;\r\n    icon: string;\r\n}\r\n\r\nexport class CUser extends Control {\r\n    private readonly shallow: ShallowData = shallowReact<ShallowData>({\r\n        cache: new Map<number, User>(),\r\n    });\r\n    //private readonly userApi: UserApi;\r\n    caption: string;\r\n    /*\r\n    constructor(app: AppBase, userApi: UserApi) {\r\n        super(app);\r\n        this.userApi = userApi;\r\n    }\r\n    */\r\n\r\n    async select<T>(caption: string): Promise<T> {\r\n        this.caption = caption;\r\n        let ret = await this.call<any, CUser>(VSelectUser);\r\n        return ret;\r\n    }\r\n\r\n    async searchUser(key: string): Promise<any> {\r\n        let user = await this.app.userApi.userFromName(key);\r\n        this.setCache(user.id, user);\r\n        return user;\r\n    }\r\n\r\n    renderUser(id: number, render: (user: User) => JSX.Element): JSX.Element {\r\n        return react(() => {\r\n            if (!id) return null;\r\n            let user = this.userFromCache(id);\r\n            if (!user) return mutedSmall(id);\r\n            return render(user);\r\n        });\r\n    }\r\n\r\n    private userFromCache(id: number): User {\r\n        let ret = this.shallow.cache.get(id);\r\n        if (ret === null) return null;\r\n        if (ret === undefined) {\r\n            this.loadUser(id);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private async loadUser(id: number) {\r\n        try {\r\n            let ret = await this.app.userApi.userFromId(id);\r\n            this.setCache(id, ret);\r\n        }\r\n        catch {\r\n            this.setCache(id, null);\r\n        }\r\n    }\r\n\r\n    private setCache(id: number, user: User) {\r\n        setReact(() => this.shallow.cache.set(id, user));\r\n    }\r\n}\r\n","import { Control } from \"Control\";\r\nimport { UQs } from \"uq-app\";\r\nimport { App } from \"./App\";\r\n\r\nexport abstract class CControl extends Control<App> {\r\n    readonly uqs: UQs;\r\n    constructor(app: App) {\r\n        super(app);\r\n        this.uqs = app.uqs;\r\n    }\r\n\r\n    openMain() {\r\n        alert('openMain not defined');\r\n    }\r\n}\r\n","import { CControl } from \"../CControl\";\r\nimport { CActs } from \"./CActs\";\r\n\r\nexport abstract class CAct extends CControl {\r\n    readonly cActs: CActs;\r\n    constructor(cActs: CActs) {\r\n        super(cActs.app);\r\n        this.cActs = cActs;\r\n    }\r\n    abstract openMain(): Promise<void>;\r\n}","import { Page } from \"Control\";\r\nimport { BoolSchema, ButtonSchema, Context, Form, Schema, StringSchema, UiButton, UiCheckItem, UiSchema, UiTextAreaItem } from \"tonwa-react\";\r\nimport { CClientNotes } from \".\";\r\n\r\nexport class VAddNote extends Page<CClientNotes> {\r\n    header(): string | boolean | JSX.Element {\r\n        let { firstName, lastName, no } = this.props;\r\n        return <>{firstName} {lastName} &nbsp; <small className=\"text-muted\">{no}</small></>;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        let schema: Schema = [\r\n            { name: 'note', type: 'string' } as StringSchema,\r\n            { name: 'sensitive', type: 'boolean' } as BoolSchema,\r\n            { name: 'submit', type: 'submit' } as ButtonSchema,\r\n        ];\r\n        let uiSchema: UiSchema = {\r\n            items: {\r\n                note: { widget: 'textarea', placeholder: 'input note here', label: 'Note', rows: 10 } as UiTextAreaItem,\r\n                sensitive: { widget: 'checkbox', label: 'Sensitive', align: 'start' } as UiCheckItem,\r\n                submit: { widget: 'button', className: 'btn btn-primary', label: 'Submit' } as UiButton,\r\n            }\r\n        };\r\n        return <div className=\"p-3\">\r\n            <Form schema={schema} uiSchema={uiSchema} onButtonClick={this.onSubmit} />\r\n        </div>\r\n    }\r\n\r\n    private onSubmit = async (name: string, context: Context): Promise<void> => {\r\n        await this.control.saveNote(this.props, context.data);\r\n        this.control.close();\r\n    }\r\n}","import { Page } from \"Control\";\r\nimport { EasyTime, FA, List } from \"tonwa-react\";\r\nimport { dateFromMinuteId } from \"tonwa-core\";\r\nimport { Note, SessionPerson } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CClientNotes } from \".\";\r\n\r\nexport class VClient extends Page<CClientNotes> {\r\n    header(): string | boolean | JSX.Element {\r\n        let { firstName, lastName, no } = this.props;\r\n        return <>{firstName} {lastName} &nbsp; <small className=\"text-muted\">{no}</small></>;\r\n    }\r\n\r\n    right(): JSX.Element {\r\n        return <button className=\"btn btn-sm btn-success me-2\" onClick={() => this.control.showAddNote(this.props)}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return <div className=\"\">\r\n            <List items={this.control.deepData.notes}\r\n                item={{ render: this.renderLog, className: \"mt-1 mb-3\", key: (item) => item.id }} />\r\n        </div>;\r\n    }\r\n\r\n    private renderLog = (log: any, index: number) => {\r\n        let { id } = log;\r\n        return <div className=\"d-block\">\r\n            <div className=\"px-3 py-1 border-bottom small text-muted\"><EasyTime date={dateFromMinuteId(id)} /></div>\r\n            <div className=\"px-3 py-2\">{\r\n                this.renderLogContent(log)\r\n            }</div>\r\n        </div>;\r\n    }\r\n\r\n    private renderLogContent(log: any) {\r\n        let { $type } = log;\r\n        switch ($type) {\r\n            default: return <>unknown type {$type}</>;\r\n            case 'note': return this.renderNote(log);\r\n            case 'sessionperson': return this.renderSessionPerson(log);\r\n        }\r\n    }\r\n\r\n    private renderNote(note: Note) {\r\n        let { note: noteContent, staff, sensitive } = note;\r\n        let vLock: any;\r\n        if (sensitive === 1) {\r\n            vLock = <FA name=\"lock\" className=\"text-danger me-3\" />\r\n            if (this.control.app.isPersonMe(staff) === true) {\r\n                return <div className=\"text-muted small\">{vLock} #sensitive</div>;\r\n            }\r\n        }\r\n        return <>{noteContent.split('\\n').map((v, index) =>\r\n            <div key={index} className=\"my-1\">{vLock} {v}</div>\r\n        )}</>;\r\n    }\r\n\r\n    private renderSessionPerson(sessionPerson: SessionPerson) {\r\n        let { cWorkshop, cStaff } = this.control.app.cIds;\r\n        let { cSession } = cWorkshop;\r\n        let { session, person, workshop } = sessionPerson;\r\n        return <>\r\n            <div>{cWorkshop.renderId(workshop)}</div>\r\n            <div>{cSession.renderId(session)}</div>\r\n            <div>{cStaff.renderId(person)}</div>\r\n        </>;\r\n    }\r\n}\r\n","import { CSelectOne, Page } from \"Control\";\r\nimport { FA, List, LMR } from \"tonwa-react\";\r\nimport { CClientNotes } from \"./CClientNotes\";\r\n\r\nexport class VStart extends Page<CClientNotes> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Client notes';\r\n    }\r\n\r\n    right(): JSX.Element {\r\n        return <button className=\"btn btn-sm btn-primary me-2\" onClick={this.onSearch}>\r\n            <FA name=\"search\" />\r\n        </button>;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        //let { cClient } = this.control;\r\n        let { clients } = this.control.deepData;\r\n        return <div className=\"\">\r\n            <List items={clients}\r\n                item={{ render: this.renderItem, onClick: this.control.showClient }} />\r\n        </div>;\r\n    }\r\n\r\n    private renderItem = (item: any, index: number) => {\r\n        let { icon } = this.control.cClient;\r\n        let vIcon: any;\r\n        if (icon) {\r\n            vIcon = <FA name=\"user-o\" className=\"me-3 text-primary \" fixWidth={true} />;\r\n        }\r\n        let right = <FA name=\"angle-right\" />\r\n        return <LMR className=\"px-3 py-2 align-items-center\" left={vIcon} right={right}>\r\n            <div>\r\n                {this.control.cClient.renderItemInList(item)}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private onSearch = async () => {\r\n        let cSelectOne = new CSelectOne(this.control.cClient);\r\n        let ret = await cSelectOne.select(); //this.control.cClient.selectOne();\r\n        if (!ret) return;\r\n        this.control.showClient(ret as any);\r\n    }\r\n}\r\n","import { CClient } from \"../../CIds\";\r\nimport { deepReact, setReact } from \"Control\";\r\nimport { Note, Person, SessionPerson } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CAct } from \"../CAct\";\r\nimport { VAddNote } from \"./VAddNote\";\r\nimport { VClient } from \"./VClient\";\r\nimport { VStart } from \"./VStart\";\r\n\r\nexport class CClientNotes extends CAct {\r\n    readonly deepData: {\r\n        notes: (Note | SessionPerson)[];\r\n        clients: Person[];\r\n    } = deepReact({\r\n        notes: null,\r\n        clients: null,\r\n    });\r\n    cClient: CClient;\r\n\r\n    async openMain(): Promise<void> {\r\n        let { cClient } = this.app.cIds;\r\n        this.cClient = cClient;\r\n        await this.loadClients();\r\n        this.open(VStart);\r\n    }\r\n\r\n    private async loadClients() {\r\n        let { BzWorkshop } = this.uqs;\r\n        //let { UserObject, IxStaffClient, Person } = BzWorkshop;\r\n        let ret = await BzWorkshop.MyClients.query({});\r\n        /*\r\n        let ret = await BzWorkshop.QueryID<Person>({\r\n            IX: [UserObject, IxStaffClient],\r\n            IDX: [Person],\r\n        });*/\r\n        setReact(() => {\r\n            this.deepData.clients = ret.ret;\r\n        });\r\n    }\r\n\r\n    showClient = async (client: Person) => {\r\n        let { BzWorkshop } = this.uqs;\r\n        /*\r\n        let ret = await BzWorkshop.QueryID<Note>({\r\n            IX: [BzWorkshop.IxPersonLog],\r\n            ix: client.id,\r\n            IDX: [BzWorkshop.Note],\r\n            order: 'desc'\r\n        });\r\n        */\r\n        //let ret = await BzWorkshop.GetPersonLog.query({ person: client.id });\r\n        let ret = await BzWorkshop.IXValues({\r\n            IX: BzWorkshop.IxPersonLog,\r\n            ix: client.id,\r\n            order: 'desc',\r\n        })\r\n        let notes: any[] = [];\r\n        for (let row of ret) {\r\n            let { type, value } = row;\r\n            let obj: any = BzWorkshop.IDValue(type, value);\r\n            if (obj !== undefined) {\r\n                obj['$type'] = type;\r\n                notes.push(obj);\r\n            }\r\n        }\r\n        setReact(() => {\r\n            this.deepData.notes = notes;\r\n        });\r\n        this.open(VClient, client);\r\n    }\r\n\r\n    showAddNote = (client: Person) => {\r\n        this.open(VAddNote, client);\r\n    }\r\n\r\n    saveNote = async (client: Person, data: any) => {\r\n        let note: Note = {\r\n            id: undefined,\r\n            staff: 10,\r\n            client: client.id,\r\n            note: data.note,\r\n            sensitive: data.sensitive === true ? 1 : 0,\r\n        };\r\n        let { BzWorkshop } = this.uqs;\r\n        let ret = await BzWorkshop.SaveNote.submitReturns(note as any);\r\n        note.id = ret.ret[0].id;\r\n        (note as any)['$type'] = 'note';\r\n        setReact(() => {\r\n            let { notes, clients } = this.deepData;\r\n            notes.unshift(note);\r\n            let index = clients.findIndex(v => v.id === client.id);\r\n            if (index >= 0) {\r\n                clients.splice(index, 1);\r\n            }\r\n            clients.unshift(client);\r\n        });\r\n    }\r\n}\r\n","import { Page } from \"Control\";\r\nimport { FA } from \"tonwa-react\";\r\nimport { CSessionAct } from \"./CSessionAct\";\r\n\r\nexport class VAttendee extends Page<CSessionAct> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Attendee';\r\n    }\r\n\r\n    right(): JSX.Element {\r\n        let { deleted } = this.props;\r\n        let onClick = () => this.control.changeSessionClient(this.props);\r\n        let cn = 'btn btn-sm me-2 ';\r\n        let content: any;\r\n        if (deleted === 0) {\r\n            cn += ' btn-light';\r\n            content = <FA name=\"trash\" />;\r\n        }\r\n        else {\r\n            cn += ' btn-info';\r\n            content = <><FA name=\"repeat\" /> Restore</>;\r\n        }\r\n        return <button className={cn} onClick={onClick}>\r\n            {content}\r\n        </button>;\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"p-3\">\r\n            {this.control.cClient.renderId(this.props.xi)}\r\n        </div>;\r\n    }\r\n}","import { Page } from \"Control\";\r\nimport { EasyTime, FA, List, LMR } from \"tonwa-react\";\r\nimport { renderDate, renderHourMinute } from \"tool\";\r\nimport { CSessionAct } from \"./CSessionAct\";\r\n\r\nexport class VSession extends Page<CSessionAct> {\r\n    header() {\r\n        return 'Session';\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        let { cWorkshop, session, deep: shallow } = this.control;\r\n        let { icon, iconClass } = cWorkshop;\r\n        let { date, time, span, substitue, done, workshop } = session;\r\n        let right = <button className=\"btn btn-sm btn-outline-primary\" onClick={this.onAddAttendee}>\r\n            <FA name=\"plus\" />\r\n        </button>;\r\n        return <div>\r\n            <div className=\"fs-5 px-3 py-2 d-flex align-items-center\">\r\n                <FA name={icon} className={iconClass + ' me-3'} size=\"lg\" />\r\n                {cWorkshop.renderId(workshop)}\r\n            </div>\r\n            <div className=\"px-3 py-2 d-block\">\r\n                <div>{renderDate(date)} {renderHourMinute(time)} {span}</div>\r\n                <div>\r\n                    {done > 0 && <FA className=\"text-danger\" name=\"check-circle-o\" />}\r\n                    {substitue > 0 && <FA className=\"text-primary\" name=\"star-o\" />}\r\n                </div>\r\n            </div>\r\n            <div className=\"mt-3\">\r\n                <LMR className=\"px-3 mb-2 align-items-end\"\r\n                    right={right}>\r\n                    Attendees\r\n                </LMR>\r\n                <List items={shallow.list} item={{ render: this.renderAttendee, onClick: this.control.showAttendee }} />\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private renderAttendee = (attendee: any, index: number) => {\r\n        let { $create, $update, deleted } = attendee;\r\n        let cn = 'px-3 py-2 align-items-center';\r\n        if (deleted > 0) cn += ' text-decoration-line-through text-muted';\r\n        let vChanged: any;\r\n        if ($create !== $update) {\r\n            vChanged = <span className=\"ms-3\">\r\n                change at: <EasyTime date={new Date($update * 1000)} />\r\n            </span>;\r\n        }\r\n        let right = <div>\r\n            <EasyTime date={new Date($create * 1000)} />\r\n            {vChanged}\r\n        </div>;\r\n        return <LMR className={cn} right={right}>\r\n            <div className=\"d-flex align-items-center\">\r\n                {this.control.cClient.renderId(attendee.xi)}\r\n            </div>\r\n        </LMR>;\r\n    }\r\n\r\n    private onAddAttendee = () => {\r\n        this.control.addAttendee();\r\n    }\r\n}\r\n","import { CClient, CWorkshop } from \"../../CIds\";\r\nimport { CActs } from \"../CActs\";\r\nimport { CSelectOne, deepReact, setReact } from \"Control\";\r\nimport { CWorkshops, MSession } from \".\";\r\nimport { CAct } from \"../CAct\";\r\nimport { VAttendee } from \"./VAttendee\";\r\nimport { VSession } from \"./VSession\";\r\n\r\nexport class CSessionAct extends CAct {\r\n    readonly cWorkshops: CWorkshops;\r\n    readonly cWorkshop: CWorkshop;\r\n    readonly cClient: CClient;\r\n    readonly session: MSession;\r\n    readonly deep: {\r\n        list: any[];\r\n    } = deepReact({ list: null });\r\n\r\n    constructor(cActs: CActs, cWorkshops: CWorkshops, session: MSession) {\r\n        super(cActs);\r\n        this.cWorkshops = cWorkshops;\r\n        this.cWorkshop = cWorkshops.cWorkshop;\r\n        this.cClient = cWorkshops.app.cIds.cClient;\r\n        this.session = session;\r\n    }\r\n\r\n    async openMain(): Promise<void> {\r\n        let { BzWorkshop } = this.uqs;\r\n        let ret = await BzWorkshop.IX({\r\n            IX: BzWorkshop.IxSessionClient,\r\n            ix: this.session.id,\r\n        });\r\n        setReact(() => {\r\n            this.deep.list = ret;\r\n        });\r\n        this.open(VSession);\r\n    }\r\n\r\n    addAttendee = async () => {\r\n        let { BzWorkshop } = this.uqs;\r\n        let cSelectOne = new CSelectOne(this.cClient);\r\n        let ret = await cSelectOne.select();\r\n        let sessionId = this.session.id;\r\n        let clientId = ret.id;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        let ixValue = {\r\n            ix: sessionId,\r\n            xi: clientId,\r\n            deleted: 0,\r\n            $create: now,\r\n            $update: now,\r\n        };\r\n        await BzWorkshop.SaveSessionAttendee.submit({\r\n            session: sessionId,\r\n            client: clientId,\r\n            deleted: 0,\r\n        });\r\n        /*\r\n        await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxSessionClient,\r\n            values: [ixValue],\r\n        });\r\n        */\r\n        setReact(() => {\r\n            let { list } = this.deep;\r\n            let index = list.findIndex(v => v.xi === clientId);\r\n            if (index >= 0) {\r\n                list.splice(index, 1);\r\n            }\r\n            list.unshift(ixValue);\r\n        });\r\n    }\r\n\r\n    showAttendee = async (row: any) => {\r\n        this.open(VAttendee, row);\r\n    }\r\n\r\n    changeSessionClient = async (row: any) => {\r\n        let { BzWorkshop } = this.uqs;\r\n        let { ix, xi, deleted } = row;\r\n        deleted = 1 - deleted;\r\n        /*\r\n        await BzWorkshop.Acts({\r\n            ixSessionClient: [{\r\n                ix, xi, deleted,\r\n            }],\r\n        });\r\n        */\r\n        await BzWorkshop.SaveSessionAttendee.submit({\r\n            session: ix,\r\n            client: xi,\r\n            deleted,\r\n        });\r\n        let ixVal = this.deep.list.find(v => v.xi === xi);\r\n        ixVal.deleted = deleted;\r\n        this.close();\r\n    }\r\n}\r\n","import { Page } from \"Control\";\r\nimport { FA, List } from \"tonwa-react\";\r\nimport { renderDate, renderHourMinute } from \"tool\";\r\nimport { CWorkshops, MSession, WorkshopItem } from \".\";\r\n\r\nexport class VStart extends Page<CWorkshops> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Workshops';\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return this.react(() => {\r\n            let { workshopItems } = this.control.shallow;\r\n            return <div>\r\n                <List items={workshopItems} item={{ render: this.renderWorkshopItem }} />\r\n            </div>;\r\n        });\r\n    }\r\n\r\n    private renderWorkshopItem = (item: WorkshopItem, index: number) => {\r\n        let { workshop, sessions } = item;\r\n        let { cWorkshop } = this.control;\r\n        let { icon, iconClass } = cWorkshop;\r\n        return <div className=\"px-3 py-2 d-block mb-3\">\r\n            <div onClick={() => this.onWorkshopClick(workshop)}\r\n                className=\"fs-5 my-2 d-flex align-items-center cursor-pointer\">\r\n                <FA name={icon} className={iconClass + ' me-3'} size=\"lg\" />\r\n                {cWorkshop.renderId(workshop)}\r\n            </div>\r\n            <List className=\"ms-4\" items={sessions}\r\n                item={{ render: this.renderSessionItem, onClick: this.onSessionClick }} />\r\n        </div>\r\n    }\r\n\r\n    private renderSessionItem = (item: MSession, index: number) => {\r\n        let { date, time, span, substitue, done } = item;\r\n        return <div className=\"px-3 py-2 d-block\">\r\n            <div>{renderDate(date)} {renderHourMinute(time)} {span}</div>\r\n            <div>\r\n                {done > 0 && <FA className=\"text-danger\" name=\"check-circle-o\" />}\r\n                {substitue > 0 && <FA className=\"text-primary\" name=\"star-o\" />}\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private onWorkshopClick = (workshop: number) => {\r\n        alert(workshop);\r\n    }\r\n\r\n    private onSessionClick = (session: MSession) => {\r\n        this.control.openSession(session);\r\n    }\r\n}","import { CActs } from \"App/CActs\";\r\nimport { CWorkshop } from \"App/CIds\";\r\nimport { setReact, shallowReact } from \"Control\";\r\nimport { Session } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CAct } from \"../CAct\";\r\nimport { CSessionAct } from \"./CSessionAct\";\r\nimport { VStart } from \"./VStart\";\r\n\r\nexport interface WorkshopItem {\r\n    workshop: number;\r\n    sessions: MSession[];\r\n}\r\n\r\nexport interface MSession extends Session {\r\n    workshop: number;\r\n    own: number;\r\n    substitue: number;\r\n    done: number;\r\n}\r\n\r\nexport class CWorkshops extends CAct {\r\n    readonly cWorkshop: CWorkshop;\r\n    shallow: {\r\n        workshopItems: WorkshopItem[];\r\n    } = shallowReact({ workshopItems: null });\r\n\r\n    constructor(cActs: CActs) {\r\n        super(cActs);\r\n        this.cWorkshop = cActs.app.cIds.cWorkshop;\r\n    }\r\n\r\n    async openMain(): Promise<void> {\r\n        await this.loadList();\r\n        this.open(VStart);\r\n    }\r\n\r\n    private async loadList() {\r\n        let ret = await this.uqs.BzWorkshop.MySessions.query({});\r\n        let coll: { [id: number]: WorkshopItem } = {};\r\n        let workshopItems: WorkshopItem[] = [];\r\n        for (let row of ret.ret) {\r\n            let { workshop } = row;\r\n            let workshopItem = coll[workshop];\r\n            if (!workshopItem) {\r\n                workshopItem = { workshop, sessions: [] };\r\n                coll[workshop] = workshopItem;\r\n                workshopItems.push(workshopItem);\r\n            }\r\n            workshopItem.sessions.push(row);\r\n        }\r\n        workshopItems.sort((a, b) => {\r\n            let { workshop: wa } = a;\r\n            let { workshop: wb } = b;\r\n            if (wa > wb) return -1;\r\n            if (wa === wb) return 0;\r\n            return 1;\r\n        })\r\n        setReact(() => {\r\n            this.shallow.workshopItems = workshopItems;\r\n        });\r\n    }\r\n\r\n    async openSession(session: MSession) {\r\n        let cSessionAct = new CSessionAct(this.cActs, this, session);\r\n        cSessionAct.openMain();\r\n    }\r\n}","import { Page } from \"Control\";\r\nimport { FA, LMR } from \"tonwa-react\";\r\nimport { CActs } from \"./CActs\";\r\n\r\ninterface DirItem {\r\n    icon: string;\r\n    caption: string;\r\n    onClick: () => void;\r\n}\r\n\r\nexport class VStart extends Page<CActs> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Home';\r\n    }\r\n\r\n    content() {\r\n        let { showClientNotes, showRegisterWorkshop } = this.control;\r\n        let arr: DirItem[] = [\r\n            { icon: 'user-o', caption: 'Client notes', onClick: showClientNotes },\r\n            { icon: 'user-o', caption: 'Workshops', onClick: showRegisterWorkshop },\r\n        ];\r\n        return <div className=\"\">\r\n            {\r\n                arr.map((v, index) => this.renderAdminOrRole(() => {\r\n                    let { onClick, caption, icon } = v;\r\n                    let right = <FA name=\"angle-right\" />;\r\n                    let vIcon = <FA name={icon} className=\"text-primary me-3\" fixWidth={true} />;\r\n                    return <LMR key={index}\r\n                        className=\"cursor-pointer bg-white border-bottom py-2 px-3 align-items-center\"\r\n                        left={vIcon}\r\n                        right={right}\r\n                        onClick={onClick}>{caption}</LMR>\r\n                }))\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n","import { CControl } from \"../CControl\";\r\nimport { CClientNotes } from \"./CClientNotes\";\r\nimport { CWorkshops } from \"./CWorkshops\";\r\nimport { VStart } from \"./VStart\";\r\n\r\nexport class CActs extends CControl {\r\n    load = async () => {\r\n    }\r\n\r\n    main() {\r\n        return this.render(VStart);\r\n    }\r\n\r\n    showRegisterWorkshop = async () => {\r\n        let cRegisterWorkshop = new CWorkshops(this);\r\n        cRegisterWorkshop.openMain();\r\n    }\r\n\r\n    showClientNotes = async () => {\r\n        let cClientNotes = new CClientNotes(this);\r\n        cClientNotes.openMain();\r\n    }\r\n}\r\n","import { App } from \"App\";\r\nimport { CIdBase, CTagInput } from \"Control\";\r\nimport { UQs } from \"uq-app\";\r\nimport { CIds } from \"./CIds\";\r\n\r\nexport abstract class CId extends CIdBase<App> {\r\n    readonly cIds: CIds;\r\n    readonly uqs: UQs;\r\n    protected readonly cTagInput: CTagInput;\r\n    constructor(cIds: CIds) {\r\n        super(cIds.app);\r\n        this.cIds = cIds;\r\n        this.uqs = cIds.uqs;\r\n        this.cTagInput = new CTagInput(this.cIds.app.cTag, this, this.uqs.BzWorkshop.IxGlobalIdTag);\r\n        this.initID();\r\n    }\r\n\r\n    get tagGroupName(): string { return undefined; }\r\n\r\n    isVisible(): boolean {\r\n        return this.app.meAdmin;\r\n    }\r\n\r\n    async loadItemsFromIds(ids: number[]): Promise<any[]> {\r\n        let list = await this.uqs.BzWorkshop.ID({\r\n            IDX: this.ID,\r\n            id: ids,\r\n        });\r\n        return list;\r\n    }\r\n\r\n    async savePropValue(id: number, name: string, value: any): Promise<void> {\r\n        await this.uqs.BzWorkshop.ActIDProp(this.ID, id, name, value);\r\n    }\r\n\r\n    protected async beforeEdit() {\r\n        await super.beforeEdit();\r\n        let tagGroupName = this.tagGroupName;\r\n        if (tagGroupName !== undefined) {\r\n            await this.cTagInput.beforeEdit(tagGroupName, this.deepData.currentItem.id);\r\n        }\r\n    }\r\n\r\n    renderTagInput() {\r\n        return this.cTagInput.renderInput();\r\n    }\r\n}\r\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { Workshop } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Vice\"\n\t} as undefined,\n\tstaff: {\n\t\t\"name\": \"staff\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Staff\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, fields.name, fields.vice, fields.staff, \n];\n\nexport const ui: UI = {\n\tlabel: \"Workshop\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t: TFunc = (str: string | JSX.Element): string | JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Workshop): JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { Person } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n\tfirstName: {\n\t\t\"name\": \"firstName\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"FirstName\"\n\t} as FieldItemString,\n\tlastName: {\n\t\t\"name\": \"lastName\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"LastName\"\n\t} as FieldItemString,\n\tmiddleName: {\n\t\t\"name\": \"middleName\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"MiddleName\"\n\t} as FieldItemString,\n\tgender: {\n\t\t\"name\": \"gender\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Gender\"\n\t} as undefined,\n\tyear: {\n\t\t\"name\": \"year\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Year\"\n\t} as FieldItemInt,\n\tmonth: {\n\t\t\"name\": \"month\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Month\"\n\t} as undefined,\n\tday: {\n\t\t\"name\": \"day\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Day\"\n\t} as undefined,\n\temail: {\n\t\t\"name\": \"email\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Email\"\n\t} as FieldItemString,\n\tmobile: {\n\t\t\"name\": \"mobile\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Mobile\"\n\t} as FieldItemString,\n\tmobileCountry: {\n\t\t\"name\": \"mobileCountry\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"MobileCountry\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, fields.name, fields.vice, fields.firstName, fields.lastName, fields.middleName, fields.gender, fields.year, fields.month, fields.day, fields.email, fields.mobile, fields.mobileCountry, \n];\n\nexport const ui: UI = {\n\tlabel: \"Person\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Person):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { Note } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tstaff: {\n\t\t\"name\": \"staff\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Staff\"\n\t} as FieldItemId,\n\tclient: {\n\t\t\"name\": \"client\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Client\"\n\t} as FieldItemId,\n\tnote: {\n\t\t\"name\": \"note\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Note\"\n\t} as undefined,\n\tsensitive: {\n\t\t\"name\": \"sensitive\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Sensitive\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.staff, fields.client, fields.note, fields.sensitive, \n];\n\nexport const ui: UI = {\n\tlabel: \"Note\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Note):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { Session } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tdate: {\n\t\t\"name\": \"date\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Date\"\n\t} as undefined,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n\ttime: {\n\t\t\"name\": \"time\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Time\"\n\t} as undefined,\n\tspan: {\n\t\t\"name\": \"span\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Span\"\n\t} as FieldItemInt,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.date, fields.vice, fields.time, fields.span, \n];\n\nexport const ui: UI = {\n\tlabel: \"Session\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Session):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { SessionPerson } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tsession: {\n\t\t\"name\": \"session\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Session\"\n\t} as FieldItemId,\n\tperson: {\n\t\t\"name\": \"person\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Person\"\n\t} as FieldItemId,\n\tworkshop: {\n\t\t\"name\": \"workshop\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Workshop\"\n\t} as FieldItemId,\n\tdeleted: {\n\t\t\"name\": \"deleted\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Deleted\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.session, fields.person, fields.workshop, fields.deleted, \n];\n\nexport const ui: UI = {\n\tlabel: \"SessionPerson\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: SessionPerson):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { Tag } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tvice: {\n\t\t\"name\": \"vice\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Vice\"\n\t} as FieldItemString,\n\tsingle: {\n\t\t\"name\": \"single\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Single\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, fields.vice, fields.single, \n];\n\nexport const ui: UI = {\n\tlabel: \"Tag\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Tag):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { TagGroup } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, \n];\n\nexport const ui: UI = {\n\tlabel: \"TagGroup\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TagGroup):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonwa-react';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonwa-core\";\nimport { TagItem } from \"./BzWorkshop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, \n];\n\nexport const ui: UI = {\n\tlabel: \"TagItem\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TagItem):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","import { CUser, User } from \"Control\";\r\nimport { LMR } from \"tonwa-react\";\r\n\r\nexport function renderPerson(item: any, cUser?: CUser) {\r\n    let { no, name, firstName, lastName, middleName, user } = item;\r\n    let vUser: any;\r\n    if (cUser && user) {\r\n        vUser = cUser.renderUser(user, (user: User) => {\r\n            let { name } = user;\r\n            return <span className=\"ms-4\">\r\n                user:  {name}\r\n            </span>;\r\n        });\r\n    }\r\n    return <>\r\n        <div className=\"small text-muted me-3\">{no} {vUser}</div>\r\n        <div>\r\n            {name ?? <>{lastName} {middleName} {firstName}</>}\r\n        </div>\r\n    </>;\r\n}\r\n\r\nexport function renderSelectPerson(item: any) {\r\n    let { no, name, firstName, lastName, middleName } = item;\r\n    let right = <span className=\"small text-muted\">{no}</span>;\r\n    return <LMR className=\"w-100\" right={right}>\r\n        {name ?? <>{lastName} {middleName} {firstName}</>}\r\n    </LMR>;\r\n}\r\n","import { Page, VEditId } from \"Control\";\r\nimport { FA, LMR } from \"tonwa-react\";\r\nimport { CPerson } from \"./CPerson\";\r\n\r\nexport class VEditPerson<C extends CPerson = CPerson> extends VEditId<C> {\r\n    content() {\r\n        return <div className=\"py-3\">\r\n            {this.renderProps()}\r\n            {this.renderTagInput()}\r\n        </div>;\r\n        //{this.renderBindUser()}\r\n    }\r\n\r\n    protected renderBindUser(): JSX.Element {\r\n        return this.renderAdmin(() => {\r\n            let rightIcon = this.control.deepData.currentItem.user ? 'angle-right' : 'pencil-square-o';\r\n            return <div className=\"container\">\r\n                <div onClick={this.control.onBindUser}\r\n                    className=\"mb-3 row bg-white align-items-center cursor-pointer\">\r\n                    <label className=\"col-sm-2 col-form-label\">Bind user</label>\r\n                    <div className=\"col-sm-10\">\r\n                        <LMR right={<FA name={rightIcon} className=\"text-primary\" />}>\r\n                            {this.control.renderCurrentUser((user => {\r\n                                let { name } = user;\r\n                                return <>{name}</>;\r\n                            }))}\r\n                        </LMR>\r\n                    </div>\r\n                </div>\r\n            </div>;\r\n        });\r\n    }\r\n}\r\n\r\nexport class VBound extends Page<CPerson> {\r\n    header() { return 'User bound'; }\r\n    content() {\r\n        let btnRemove = <button className=\"btn btn-outline-secondary\"\r\n            onClick={this.onRemoveBound}>\r\n            Remove bound\r\n        </button>;\r\n        return <div className=\"m-5 rouned-3 border bg-white w-max-30c p-5 mx-auto\">\r\n            <div className=\"mb-5 text-center\">\r\n                The person has bound to website user account:\r\n                <br /><br />\r\n                {this.control.renderCurrentUser((user => {\r\n                    let { name } = user;\r\n                    return <b className=\"text-primary ms-3\">{name}</b>;\r\n                }))}\r\n            </div>\r\n            <LMR className=\"\" right={btnRemove}>\r\n                <button className=\"btn btn-primary\" onClick={this.onChange}>Change user</button>\r\n            </LMR>\r\n        </div>\r\n    }\r\n\r\n    private onChange = async () => {\r\n        if (await this.confirm('Change user account bound is not recommented. Still want to do so?') === true) {\r\n            await this.control.onChangeUser();\r\n        }\r\n    }\r\n\r\n    private onRemoveBound = async () => {\r\n        await this.control.onRemoveBound();\r\n    }\r\n}\r\n","import { Schema, UiSchema, UiTextItem } from \"tonwa-react\";\r\nimport { Uq } from \"tonwa-core\";\r\nimport { CId } from \"../CId\";\r\nimport { renderPerson, renderSelectPerson } from \"./renderPerson\";\r\nimport { CIdBase, IdValue, Page, react, setReact, User } from \"Control\";\r\nimport { Role, Person } from \"uq-app/uqs/BzWorkshop\";\r\nimport { VBound, VEditPerson } from \"./VEditPerson\";\r\n\r\nexport interface MPerson extends Person {\r\n    user: number;\r\n    role: Role;\r\n}\r\n\r\nexport abstract class CPerson extends CId {\r\n    abstract get personRole(): Role;\r\n    get uq(): Uq { return this.uqs.BzWorkshop; };\r\n    getID() { return this.uqs.BzWorkshop.Person; }\r\n    get caption() { return 'Staff' }\r\n    get schema(): Schema {\r\n        return this.uqs.BzWorkshop.Person.ui.fieldArr;\r\n    }\r\n    get uiSchema(): UiSchema {\r\n        return {\r\n            items: {\r\n                no: {\r\n                    \"name\": \"no\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": true,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"No\",\r\n                    \"defaultValue\": this.initNO,\r\n                } as UiTextItem,\r\n                name: {\r\n                    \"name\": \"name\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Name\",\r\n                } as UiTextItem,\r\n                firstName: {\r\n                    \"name\": \"firstName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"First Name\",\r\n                } as UiTextItem,\r\n                lastName: {\r\n                    \"name\": \"lastName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Last Name\",\r\n                } as UiTextItem,\r\n                middleName: {\r\n                    \"name\": \"middleName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Middle Name\",\r\n                } as UiTextItem,\r\n                submit: {\r\n                    \"label\": \"Save \" + this.caption,\r\n                    \"widget\": \"button\",\r\n                    \"className\": \"btn btn-primary\",\r\n                }\r\n            }\r\n        }\r\n    }\r\n    abstract isInRole(role: Role): boolean;\r\n    protected async loadList(): Promise<any[]> {\r\n        let { BzWorkshop } = this.uqs;\r\n        /*\r\n        let list = await BzWorkshop.QueryID({\r\n            IX: [BzWorkshop.IxPersonRole],\r\n            ix: this.personRole,\r\n            IDX: [this.ID],\r\n            page: { start: 0, size: 10000 },\r\n            order: 'desc',\r\n        });\r\n        */\r\n        /*\r\n        let list = await BzWorkshop.IXr({\r\n            IX: BzWorkshop.IxPersonRole,\r\n            IDX: [BzWorkshop.Person],\r\n            ix: this.personRole,\r\n            page: { start: 0, size: 10000 },\r\n            order: 'desc',\r\n        });\r\n        */\r\n        let result = await BzWorkshop.GetPersonList.query({ role: this.personRole });\r\n        let { ret, roles: retRoles } = result;\r\n        let mPerson: MPerson;\r\n        for (let row of ret) {\r\n            let { id } = row;\r\n            mPerson = row as any;\r\n            for (let r of retRoles) {\r\n                let { person, role } = r;\r\n                if (person !== id) continue;\r\n                if (this.isInRole(role as Role) === true) {\r\n                    mPerson.role = role as Role;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    async saveId(data: any) {\r\n        let { BzWorkshop } = this.uqs;\r\n        let ret = await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxPersonRole,\r\n            ID: BzWorkshop.Person,\r\n            values: [{\r\n                ix: this.personRole,\r\n                xi: data,\r\n            }],\r\n        });\r\n        return ret[0];\r\n    }\r\n\r\n    async search(key: string): Promise<any[]> {\r\n        let ret = await this.uqs.BzWorkshop.PersonSearch.query({\r\n            role: this.personRole,\r\n            key,\r\n        });\r\n        return ret.ret;\r\n    }\r\n\r\n    renderItemInList(item: any): JSX.Element {\r\n        return renderPerson(item, this.app.cUser);\r\n    }\r\n\r\n    renderItemOnSelect(item: any): JSX.Element {\r\n        return renderSelectPerson(item);\r\n    }\r\n\r\n    renderIdValue(item: IdValue): JSX.Element {\r\n        return renderPerson(item);\r\n    }\r\n\r\n    get VEdit(): new (c: CIdBase) => Page<CPerson> {\r\n        return VEditPerson as any;\r\n    }\r\n\r\n    renderCurrentUser(render: (user: User) => JSX.Element) {\r\n        return react(() => {\r\n            let { currentItem } = this.deepData;\r\n            if (!currentItem) return null;\r\n            let { user } = currentItem;\r\n            return this.app.cUser.renderUser(user, render);\r\n        });\r\n    }\r\n\r\n    onBindUser = async () => {\r\n        if (this.deepData.currentItem.user) {\r\n            this.open(VBound);\r\n            return;\r\n        }\r\n        await this.onChangeUser();\r\n    }\r\n\r\n    onChangeUser = async () => {\r\n        let ret = await this.app.cUser.select<User>('Bind user');\r\n        if (!ret) return;\r\n        let { currentItem } = this.deepData;\r\n        let userId = ret.id;\r\n        let { BzWorkshop } = this.uqs;\r\n        await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxUserPerson,\r\n            values: [\r\n                { ix: userId, xi: currentItem.id }\r\n            ]\r\n        })\r\n        setReact(() => {\r\n            currentItem.user = userId;\r\n        });\r\n    }\r\n\r\n    onRemoveBound = async () => {\r\n        let { currentItem } = this.deepData;\r\n        let { BzWorkshop } = this.uqs;\r\n        await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxUserPerson,\r\n            values: [\r\n                { ix: currentItem.user, xi: -currentItem.id }\r\n            ]\r\n        })\r\n        this.close();\r\n        setReact(() => {\r\n            currentItem.user = undefined;\r\n        });\r\n    }\r\n}\r\n","import { Role } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CPerson } from \"../CPerson\";\r\n\r\nexport class CClient extends CPerson {\r\n    get tagGroupName() { return 'client-tags'; }\r\n    get personRole(): Role { return Role.client; }\r\n    get caption() { return 'Client' }\r\n    get icon() { return 'user-o' }\r\n    get iconClass(): string { return 'text-info'; }\r\n    isInRole(role: Role): boolean { return undefined; }\r\n    isVisible(): boolean {\r\n        return this.app.isAdminOrRole(Role.counselor);\r\n    }\r\n}\r\n","import { Control, AppBase, View } from \"Control\";\r\nimport { Uq, IX } from \"tonwa-core\";\r\nimport { VEnumMulti, VEnumSingle } from \".\";\r\n\r\nexport abstract class CEnumBase<E extends number> extends Control {\r\n    abstract get enums(): E[];\r\n    abstract get enumCaptions(): { [e in E]?: string }\r\n\r\n    abstract get caption(): string;\r\n    abstract get uq(): Uq;\r\n    abstract get IX(): IX;\r\n    abstract get VInput(): new (c: this) => View<this>;\r\n    abstract get OnEnumChanged(): (vale: E) => Promise<void>;\r\n\r\n    isInEnum(e: E): boolean { return this.enumCaptions[e] !== undefined; }\r\n    renderInput(): JSX.Element {\r\n        return this.render(this.VInput as any);\r\n    }\r\n}\r\n\r\nexport abstract class CEnumSingle<E extends number> extends CEnumBase<E> {\r\n    readonly id: number;\r\n    value: E;\r\n    constructor(nav: AppBase, id: number, value: E) {\r\n        super(nav);\r\n        this.id = id;\r\n        this.value = value;\r\n    }\r\n\r\n    get VInput(): new (c: this) => View<this> {\r\n        return VEnumSingle as any;\r\n    }\r\n\r\n    saveIxEnum = async (e: E) => {\r\n        let values = this.enums.map(v => (\r\n            { ix: this.id, xi: v as number }\r\n        ));\r\n        // delete all other roles\r\n        for (let v of values) {\r\n            if (v.xi !== e) {\r\n                v.xi = -v.xi;\r\n            }\r\n        }\r\n        await this.uq.ActIX({\r\n            IX: this.IX,\r\n            values\r\n        });\r\n        if (this.OnEnumChanged) this.OnEnumChanged(e);\r\n    }\r\n}\r\n\r\nexport abstract class CEnumMulti<E extends number> extends CEnumBase<E> {\r\n    readonly id: number;\r\n    values: E[];\r\n    constructor(nav: AppBase, id: number, values: E[]) {\r\n        super(nav);\r\n        this.id = id;\r\n        this.values = values;\r\n    }\r\n\r\n    get VInput(): new (c: this) => View<this> {\r\n        return VEnumMulti as any;\r\n    }\r\n\r\n    saveIxEnum = async (e: E) => {\r\n        let values = this.enums.map(v => (\r\n            { ix: this.id, xi: v as number }\r\n        ));\r\n        // delete all other roles\r\n        for (let v of values) {\r\n            if (v.xi !== e) {\r\n                v.xi = -v.xi;\r\n            }\r\n        }\r\n        await this.uq.ActIX({\r\n            IX: this.IX,\r\n            values\r\n        });\r\n    }\r\n}\r\n","import { View } from \"Control\";\r\nimport { CEnumSingle } from \"./CEnumBase\";\r\n\r\nexport class VEnumSingle<E extends number, C extends CEnumSingle<E>> extends View<C> {\r\n    render() {\r\n        let { caption, enums, enumCaptions, value } = this.control;\r\n        return <div className=\"container\">\r\n            <div\r\n                className=\"mb-3 row bg-white align-items-center cursor-pointer\">\r\n                <label className=\"col-sm-2 col-form-label\">{caption}</label>\r\n                <div className=\"col-sm-10\">\r\n                    {enums.map(v => {\r\n                        return <label key={v} className=\"me-4 form-check-inline\">\r\n                            <input type=\"radio\" name=\"staff-role\"\r\n                                onChange={this.onChange}\r\n                                defaultChecked={v === value}\r\n                                defaultValue={v} /> {enumCaptions[v]}\r\n                        </label>;\r\n                    })}\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    onChange = async (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let { currentTarget } = evt;\r\n        await this.control.saveIxEnum(Number(currentTarget.value) as E);\r\n    }\r\n}\r\n","import { CUser, User } from \"Control\";\r\nimport { FA } from \"tonwa-react\";\r\nimport { Role } from \"uq-app/uqs/BzWorkshop\";\r\nimport { MPerson } from \"../CPerson\";\r\n\r\nconst roleCaption: { [role in Role]?: string } = {\r\n    [Role.counselor]: 'Counselor',\r\n    [Role.volunteer]: 'Volunteer',\r\n};\r\n\r\nexport function renderStaff(item: MPerson, cUser?: CUser) {\r\n    let { no, name, firstName, lastName, middleName, user, role } = item;\r\n    let vUser: any;\r\n    if (cUser && user) {\r\n        vUser = cUser.renderUser(user, (user: User) => {\r\n            let { name } = user;\r\n            return <span className=\"ms-4\">\r\n                user:  {name}\r\n            </span>;\r\n        });\r\n    }\r\n    let vRole: any;\r\n    if (role) {\r\n        vRole = <span className=\"ms-3\"><FA name='dot' /> {roleCaption[role]}</span>;\r\n    }\r\n    return <>\r\n        <div className=\"small text-muted me-3\">{no} {vUser}</div>\r\n        <div>\r\n            {name ?? <>{lastName} {middleName} {firstName}</>}\r\n            {vRole}\r\n        </div>\r\n    </>;\r\n}\r\n","//import React from \"react\";\r\n//import { Role } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CStaff/*, staffRoles*/ } from \"./CStaff\";\r\nimport { VEditPerson } from \"../VEditPerson\";\r\n//import { MPerson } from \"../CPerson\";\r\n//import { staffRoleCaptions } from \".\";\r\n\r\nexport class VEditStaff extends VEditPerson<CStaff> {\r\n    content() {\r\n        return <div className=\"py-3\">\r\n            {this.renderBindUser()}\r\n            {this.renderRoles()}\r\n            {this.renderProps()}\r\n            {this.renderTagInput()}\r\n        </div>;\r\n    }\r\n\r\n    protected renderRoles() {\r\n        return this.control.cRoleSingle.renderInput();\r\n        /*\r\n        let { currentItem } = this.control.deepData;\r\n        let { role } = currentItem as MPerson;\r\n        return <div className=\"container\">\r\n            <div\r\n                className=\"mb-3 row bg-white align-items-center cursor-pointer\">\r\n                <label className=\"col-sm-2 col-form-label\">Role</label>\r\n                <div className=\"col-sm-10\">\r\n                    {staffRoles.map(v => {\r\n                        return <label className=\"me-4 form-check-inline\">\r\n                            <input type=\"radio\" name=\"staff-role\"\r\n                                onChange={this.onChange}\r\n                                defaultChecked={v === role}\r\n                                defaultValue={v} /> {staffRoleCaptions[v]}\r\n                        </label>;\r\n                    })}\r\n                </div>\r\n            </div>\r\n        </div>;\r\n        */\r\n    }\r\n    /*\r\n    private onChange = async (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let { currentTarget } = evt;\r\n        await this.control.saveStaffRole(Number(currentTarget.value) as Role);\r\n    }\r\n    */\r\n}\r\n","import { CIdBase, Page, setReact } from \"Control\";\r\nimport { CEnumSingle } from \"Control/CEnumBase\";\r\nimport { IX } from \"tonwa-core\";\r\nimport { Role } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CPerson, MPerson } from \"../CPerson\";\r\nimport { renderStaff } from \"./renderStaff\";\r\nimport { VEditStaff } from \"./VEditStaff\";\r\n\r\nexport const staffRoles = [Role.counselor, Role.volunteer];\r\nexport const staffRoleCaptions: { [role in Role]?: string } = {\r\n    [Role.counselor]: 'Counselor',\r\n    [Role.volunteer]: 'Volunteer',\r\n};\r\n\r\nexport class CStaff extends CPerson {\r\n    cRoleSingle: CRoleSingle;\r\n    get tagGroupName() { return 'staff-tags'; }\r\n    get personRole(): Role { return Role.staff; }\r\n    get caption() { return 'Staff' }\r\n    get icon() { return 'user' }\r\n    isInRole(role: Role): boolean { return staffRoleCaptions[role] !== undefined; }\r\n\r\n    protected async beforeEdit() {\r\n        this.cRoleSingle = new CRoleSingle(this);\r\n        await super.beforeEdit();\r\n    }\r\n\r\n    get VEdit(): new (c: CIdBase) => Page<CPerson> {\r\n        return VEditStaff as any;\r\n    }\r\n    /*\r\n    saveStaffRole = async (role: Role) => {\r\n        let { BzWorkshop } = this.uqs;\r\n        let { currentItem } = this.deepData;\r\n        let personId = currentItem.id;\r\n        let values = staffRoles.map(v => (\r\n            { ix: personId, xi: v }\r\n        ));\r\n        // delete all other roles\r\n        for (let v of values) {\r\n            if (v.xi !== role) {\r\n                v.xi = -v.xi;\r\n            }\r\n        }\r\n        await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxPersonRole,\r\n            values\r\n        });\r\n        setReact(() => {\r\n            currentItem.role = role;\r\n        });\r\n    }\r\n    */\r\n    onRoleChanged = async (value: Role): Promise<void> => {\r\n        setReact(() => {\r\n            let { currentItem } = this.deepData;\r\n            currentItem.role = value;\r\n        });\r\n    }\r\n\r\n    renderItemInList(item: any): JSX.Element {\r\n        return renderStaff(item, this.cIds.app.cUser);\r\n    }\r\n}\r\n\r\nclass CRoleSingle extends CEnumSingle<Role> {\r\n    private readonly cStaff: CStaff;\r\n    constructor(cStaff: CStaff) {\r\n        let { currentItem } = cStaff.deepData;\r\n        super(cStaff.app, currentItem?.id, (currentItem as MPerson).role);\r\n        this.cStaff = cStaff;\r\n    }\r\n    get enums() { return staffRoles; }\r\n    get enumCaptions() { return staffRoleCaptions; }\r\n\r\n    get caption() { return 'Role' }\r\n    get uq() { return this.cStaff.uqs.BzWorkshop; }\r\n    get IX(): IX { return this.uq.IxPersonRole; }\r\n    get OnEnumChanged(): (value: Role) => Promise<void> {\r\n        return this.cStaff.onRoleChanged;\r\n    }\r\n}\r\n","import { Workshop } from \"uq-app/uqs/BzWorkshop\";\r\n\r\nexport function renderWorkshopItem(item: Workshop) {\r\n    let { no, name } = item;\r\n    return <>\r\n        <div className=\"small text-muted me-3\">{no}</div>\r\n        <div>{name}</div>\r\n    </>;\r\n}\r\n","import { VEditId } from \"Control\";\r\nimport { CWorkshop } from \"./CWorkshop\";\r\n\r\nexport class VEditWorkshop extends VEditId<CWorkshop> {\r\n    content() {\r\n        return <div className=\"\">\r\n            <div className=\"my-3 border rounded-3 pt-1\">\r\n                {this.renderProps()}\r\n            </div>\r\n            {this.renderStaffPick()}\r\n\r\n            {this.renderTagInput()}\r\n\r\n            <div className=\"my-3 border rounded-3\">\r\n                {this.control.cSession.renderList()}\r\n            </div>\r\n        </div>\r\n    }\r\n\r\n    renderStaffPick(): JSX.Element {\r\n        return null;\r\n        /*\r\n        let { cIds, staff } = this.control;\r\n        let value = staff;\r\n        let pick = new CIdPick(cIds.cStaff, value);\r\n        let itemSchema: IdSchema = {\r\n            name: \"staff\",\r\n            type: \"id\",\r\n        }\r\n        let uiItem: UiPick = {\r\n            widget: 'pick',\r\n            label: 'Staff',\r\n            pick,\r\n        };\r\n        let cEdit = createEdit(this.control.nav, {\r\n            pick,\r\n            itemSchema,\r\n            uiItem,\r\n            value,\r\n            onChanged: this.control.saveWorkshopStaff\r\n        });\r\n        return <div className=\"container border rounded-3 bg-white py-2\">\r\n            <div onClick={cEdit.onEdit}\r\n                className=\"row align-items-center cursor-pointer\">\r\n                <label className=\"col-sm-2 col-form-label\">Staff</label>\r\n                <div className=\"col-sm-10\">\r\n                    <LMR right={this.renderEditIcon()}>\r\n                        {cEdit.renderRef()}\r\n                    </LMR>\r\n                </div>\r\n            </div>\r\n        </div>;\r\n        */\r\n    }\r\n}\r\n","import { FA, List, LMR } from \"tonwa-react\";\r\nimport { View } from \"Control\";\r\nimport { CSession } from \"./CSession\";\r\nimport { Session } from \"uq-app/uqs/BzWorkshop\";\r\nimport { renderDate } from \"tool\";\r\n\r\nexport class VSessionList extends View<CSession> {\r\n    render() {\r\n        return this.react(() => {\r\n            let right = <span className=\"text-success cursor-pointer\" onClick={this.control.onAdd}>\r\n                <FA name=\"plus\" fixWidth={true} />\r\n            </span>;\r\n            return <>\r\n                <LMR right={right} className=\"px-3 py-1 small text-muted\">\r\n                    Sessions\r\n                </LMR>\r\n                <List items={this.control.deepData.list} className=\"my-1\"\r\n                    item={{ render: this.renderItem, onClick: this.control.onEditItem }}\r\n                    none={<small className=\" px-3 py-2 text-muted\">Click {right} to add session</small>} />\r\n            </>\r\n        });\r\n    }\r\n\r\n    private renderItem = (item: any, index: number) => {\r\n        return <div className=\"px-3 py-2\">\r\n            {this.control.renderItemInList(item)}\r\n        </div>\r\n    }\r\n}\r\n\r\nexport function renderSessionItem(item: Session) {\r\n    let { date, vice, time, span } = item;\r\n    return <div>\r\n        <div>\r\n            {renderDate(date)} &nbsp; &nbsp;\r\n            start at {time} &nbsp; &nbsp;\r\n            for {span} minutes &nbsp; &nbsp;\r\n        </div>\r\n        <div>{vice}</div>\r\n    </div>;\r\n}\r\n","import { CWorkshop } from \"App/CIds\";\r\nimport { IdValue, setReact } from \"Control\";\r\nimport { Uq, ID } from \"tonwa-core\";\r\nimport { Schema, UiDate, UiNumberItem, UiSchema, UiTextItem, UiTime } from \"tonwa-react\";\r\nimport { Session } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CId } from \"../CId\";\r\nimport { renderSessionItem, VSessionList } from \"./VSessionList\";\r\n\r\nexport class CSession extends CId {\r\n    readonly cWorkshop: CWorkshop;\r\n    readonly tick: number;\r\n    constructor(cWorkshop: CWorkshop) {\r\n        super(cWorkshop.cIds);\r\n        this.cWorkshop = cWorkshop;\r\n        this.tick = Date.now();\r\n        let { fields } = this.uqs.BzWorkshop.Session.ui;\r\n        fields['date'].required = true;\r\n        fields['time'].required = true;\r\n        fields['span'].required = true;\r\n    }\r\n\r\n    get uq(): Uq {\r\n        return this.uqs.BzWorkshop;\r\n    }\r\n    getID(): ID {\r\n        return this.uqs.BzWorkshop.Session;\r\n    }\r\n    get caption(): string {\r\n        return 'Session';\r\n    }\r\n    get schema(): Schema {\r\n        return this.uqs.BzWorkshop.Session.ui.fieldArr;\r\n    }\r\n    get uiSchema(): UiSchema {\r\n        return {\r\n            items: {\r\n                date: {\r\n                    widget: 'date',\r\n                    label: 'Date',\r\n                } as UiDate,\r\n                vice: {\r\n                    widget: 'text',\r\n                    label: 'Discription',\r\n                } as UiTextItem,\r\n                time: {\r\n                    widget: 'time',\r\n                    label: 'Time',\r\n                } as UiTime,\r\n                span: {\r\n                    widget: 'number',\r\n                    label: 'Duration',\r\n                } as UiNumberItem,\r\n                submit: {\r\n                    \"label\": \"Save Session\",\r\n                    \"widget\": \"button\",\r\n                    \"className\": \"btn btn-primary\",\r\n                }\r\n            }\r\n        };\r\n    }\r\n    protected async loadList(): Promise<any[]> {\r\n        let { deepData } = this.cWorkshop;\r\n        let { currentItem } = deepData;\r\n        if (!currentItem) {\r\n            debugger;\r\n            return undefined;\r\n        }\r\n        let { BzWorkshop } = this.uqs;\r\n        let { id } = currentItem;\r\n        let ret = await BzWorkshop.QueryID<Session>({\r\n            IX: [BzWorkshop.IxWorkshopSession],\r\n            IDX: [BzWorkshop.Session],\r\n            ix: id,\r\n        });\r\n        return ret;\r\n    }\r\n    protected async saveId(data: any): Promise<number> {\r\n        let { BzWorkshop } = this.uqs;\r\n        let { deepData } = this.cWorkshop;\r\n        let { currentItem } = deepData;\r\n        let ret = await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxWorkshopSession,\r\n            ID: BzWorkshop.Session,\r\n            values: [\r\n                {\r\n                    ix: currentItem.id,\r\n                    xi: data,\r\n                }\r\n            ]\r\n        });\r\n        let id = ret[0];\r\n        await BzWorkshop.ActIX({\r\n            IX: BzWorkshop.IxSessionStaff,\r\n            values: [\r\n                { ix: id, xi: currentItem.staff }\r\n            ]\r\n        })\r\n        setReact(() => {\r\n            data.id = id;\r\n            let { list } = this.deepData;\r\n            list.push(data);\r\n        });\r\n        return id;\r\n    }\r\n\r\n    renderItemInList(item: Session): JSX.Element {\r\n        return renderSessionItem(item);\r\n    }\r\n\r\n    renderList(): JSX.Element {\r\n        return this.render(VSessionList);\r\n    }\r\n\r\n    renderIdValue(idValue: IdValue): JSX.Element {\r\n        return renderSessionItem(idValue as Session);\r\n    }\r\n}\r\n","import { Control, CSelectOne, deepReact, react, setReact } from \"Control\";\r\nimport { Pick } from \"tonwa-react\";\r\nimport { mutedSmall } from \"tool\";\r\nimport { CId } from \"./CId\";\r\n\r\nexport class CIdPick<C extends CId> extends Control implements Pick<number> {\r\n    protected readonly cId: C;\r\n    // protected id: number;\r\n    deepValue: {\r\n        id: number;\r\n    } = deepReact({ id: null, });\r\n    constructor(c: C, id: number) {\r\n        super(c.app);\r\n        this.cId = c;\r\n        this.deepValue.id = id;\r\n    }\r\n\r\n    pick = async (): Promise<number> => {\r\n        let cSelectOne = new CSelectOne(this.cId);\r\n        let ret = await cSelectOne.select();\r\n        let id = ret.id;\r\n        setReact(() => {\r\n            this.deepValue.id = id;\r\n        })\r\n        return id;\r\n    }\r\n\r\n    ref() {\r\n        return react(() => {\r\n            let { id } = this.deepValue;\r\n            if (id === null) {\r\n                return this.renderInit();\r\n            }\r\n            if (id === undefined) {\r\n                return this.renderNA();\r\n            }\r\n            return this.cId.renderId(id);\r\n        });\r\n    }\r\n\r\n    protected renderInit() {\r\n        return mutedSmall(`Pick ${this.cId.caption}`);\r\n    }\r\n\r\n    protected renderNA() {\r\n        return mutedSmall(' - ');\r\n    }\r\n}\r\n","import { VAdd } from \"Control\";\r\nimport { CWorkshop } from \"./CWorkshop\";\r\n\r\nexport class VAddWorkshop extends VAdd<CWorkshop> {\r\n    content(): JSX.Element {\r\n        return <div className=\"p-3\">\r\n            {this.renderForm()}\r\n        </div>;\r\n    }\r\n}\r\n","import { Schema, UiSchema, UiTextAreaItem, UiTextItem, UiPick } from \"tonwa-react\";\r\nimport { Uq } from \"tonwa-core\";\r\nimport { CId } from \"../CId\";\r\nimport { renderWorkshopItem } from \"./renderItem\";\r\nimport { CIds } from \"App/CIds\";\r\nimport { VEditWorkshop } from \"./VEditWorkshop\";\r\nimport { CSession } from \"./CSession\";\r\nimport { CIdPick } from \"../CIdPick\";\r\nimport { IdValue } from \"Control\";\r\nimport { Workshop } from \"uq-app/uqs/BzWorkshop\";\r\nimport { VAddWorkshop } from \"./VAddWorkshop\";\r\n\r\nexport class CWorkshop extends CId {\r\n    readonly cSession: CSession;\r\n\r\n    constructor(cIds: CIds) {\r\n        super(cIds);\r\n        this.cSession = new CSession(this);\r\n    }\r\n    get tagGroupName() { return 'workshop-tags'; }\r\n    get uq(): Uq { return this.uqs.BzWorkshop; };\r\n    getID() { return this.uqs.BzWorkshop.Workshop; }\r\n    get caption() { return 'Workshop' }\r\n    get icon() { return 'book'; }\r\n    get iconClass(): string { return 'text-warning'; }\r\n    get schema(): Schema {\r\n        return this.uqs.BzWorkshop.Workshop.ui.fieldArr;\r\n    }\r\n    get uiSchema(): UiSchema {\r\n        return {\r\n            items: {\r\n                no: {\r\n                    \"name\": \"no\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": true,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"No\",\r\n                    \"defaultValue\": this.initNO,\r\n                    readOnly: true,\r\n                } as UiTextItem,\r\n                name: {\r\n                    \"name\": \"name\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Name\",\r\n                } as UiTextItem,\r\n                vice: {\r\n                    \"name\": \"vice\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"textarea\",\r\n                    \"label\": \"Discription\",\r\n                    \"placeholder\": \"Workshop discription\",\r\n                    \"rows\": 6,\r\n                } as UiTextAreaItem,\r\n                staff: {\r\n                    name: 'staff',\r\n                    widget: 'pick',\r\n                    label: 'Staff',\r\n                    pick: new CIdPick(this.cIds.cStaff, this.deepData.currentItem?.staff),\r\n                } as UiPick,\r\n                submit: {\r\n                    \"label\": \"Save Workshop\",\r\n                    \"widget\": \"button\",\r\n                    \"className\": \"btn btn-primary\",\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    protected async beforeEdit() {\r\n        await super.beforeEdit();\r\n        await this.cTagInput.beforeEdit(this.tagGroupName, this.deepData.currentItem.id);\r\n        await this.cSession.loadToList()\r\n    }\r\n\r\n    protected async loadList(): Promise<any[]> {\r\n        let list = await this.uqs.BzWorkshop.QueryID({\r\n            ID: this.ID,\r\n            page: { start: 0, size: 10 },\r\n            order: 'desc',\r\n        });\r\n        return list;\r\n    }\r\n\r\n    async saveId(data: any) {\r\n        let ret = await this.uqs.BzWorkshop.Acts({\r\n            workshop: [data],\r\n        });\r\n        return ret.workshop[0];\r\n    }\r\n\r\n    renderItemInList(item: any): JSX.Element {\r\n        return renderWorkshopItem(item);\r\n    }\r\n\r\n    get VAdd() { return VAddWorkshop as any; }\r\n    get VEdit() { return VEditWorkshop as any; }\r\n\r\n    renderIdValue(idValue: IdValue): JSX.Element {\r\n        return renderWorkshopItem(idValue as Workshop);\r\n    }\r\n\r\n    async savePropValue(id: number, name: string, value: any): Promise<void> {\r\n        let { BzWorkshop } = this.uqs;\r\n        switch (name) {\r\n            default:\r\n                await BzWorkshop.ActIDProp(this.ID, id, name, value);\r\n                break;\r\n            case 'staff':\r\n                await BzWorkshop.SaveWorkshopStaff.submit({ id, staff: value });\r\n                break;\r\n        }\r\n    }\r\n}\r\n","import { Page } from \"Control\";\r\nimport { FA, LMR } from \"tonwa-react\";\r\nimport { CIds } from \"./CIds\";\r\n\r\nexport class VStart extends Page<CIds> {\r\n    header(): string | boolean | JSX.Element {\r\n        return 'Items';\r\n    }\r\n\r\n    content() {\r\n        let { cWorkshop, cStaff, cClient, app } = this.control;\r\n        return <div>{\r\n            [cWorkshop, cStaff, cClient, app.cTag].map((v, index) => {\r\n                if (v.isVisible() === false) return null;\r\n                let { caption, icon, iconClass } = v;\r\n                let right = <FA name=\"angle-right\" />;\r\n                let vIcon = <FA name={icon} className={(iconClass ?? 'text-primary') + ' me-4'} fixWidth={true} size=\"lg\" />;\r\n                return <LMR key={index}\r\n                    className=\"cursor-pointer bg-white border-bottom py-2 px-3 align-items-center\"\r\n                    left={vIcon}\r\n                    right={right}\r\n                    onClick={() => v.openMain()}>{caption}</LMR>\r\n            })\r\n        }</div>;\r\n    }\r\n}\r\n","import { App } from \"../App\";\r\nimport { CControl } from \"../CControl\";\r\nimport { CClient } from \"./CPerson/CClient\";\r\nimport { CStaff } from \"./CPerson/CStaff\";\r\nimport { CWorkshop } from \"./CWorkshop\";\r\nimport { VStart } from \"./VStart\";\r\n\r\nexport class CIds extends CControl {\r\n    readonly cWorkshop: CWorkshop;\r\n    readonly cClient: CClient;\r\n    readonly cStaff: CStaff;\r\n    //readonly cTag: CTag;\r\n\r\n    // personCategories: PersonCategory[];\r\n    //personCatClient: PersonCategory;\r\n    //personCatStaff: PersonCategory;\r\n\r\n    constructor(app: App) {\r\n        super(app);\r\n        this.cWorkshop = new CWorkshop(this);\r\n        this.cClient = new CClient(this);\r\n        this.cStaff = new CStaff(this);\r\n        //this.cTag = app.cTag;\r\n    }\r\n\r\n    load = async () => {\r\n        /*\r\n        if (this.personCategories) return;\r\n        let { BzWorkshop } = this.uqs;\r\n        this.personCategories = await BzWorkshop.QueryID({ ID: BzWorkshop.PersonCategory });\r\n        this.personCatStaff = this.personCategories.find(v => v.name === 'staff');\r\n        this.personCatClient = this.personCategories.find(v => v.name === 'client');\r\n        */\r\n    }\r\n\r\n    onWorkshop = (): void => {\r\n        this.cWorkshop.openMain();\r\n    }\r\n\r\n    onClient = (): void => {\r\n        this.cClient.openMain();\r\n    }\r\n\r\n    onStaff = (): void => {\r\n        this.cStaff.openMain();\r\n    }\r\n\r\n    main() {\r\n        return this.render(VStart);\r\n    }\r\n}\r\n","//=== UqApp builder created on Tue Jan 12 2021 23:14:51 GMT-0500 (GMT-05:00) ===//\r\nimport { AppConfig } from \"tonwa\";\r\nimport { DevConfig } from 'tonwa-core';\r\n\r\nconst bz: DevConfig = {\r\n\tname: 'bizdev',\r\n\talias: 'bz',\r\n}\r\n\r\nexport const appConfig: AppConfig = {\r\n\tversion: '0.1.0',\r\n\tapp: undefined,\r\n\tuqs: [\r\n\t\t{\r\n\t\t\tdev: bz,\r\n\t\t\tname: 'workshop',\r\n\t\t\talias: 'Workshop',\r\n\t\t\tversion: '0.1.0',\r\n\t\t},\r\n\t],\r\n\tnoUnit: true,\r\n\toem: undefined,\r\n\thtmlTitle: 'Timeschange Workshop',\r\n};\r\n","import { Page } from \"Control\";\r\nimport { appConfig } from \"../../uq-app/appConfig\";\r\nimport { CMe } from \"./CMe\";\r\n\r\nexport class VAbout extends Page<CMe> {\r\n\theader() { return 'about APP'; }\r\n\tcontent() {\r\n\t\treturn <div className=\"py-5 px-3 my-3 w-max-30c mx-auto bg-white\">\r\n\t\t\t<div className=\"text-center mb-5 position-relative\">\r\n\t\t\t\t<small className=\"text-muted position-absolute\"\r\n\t\t\t\t\tstyle={{ right: '0', top: '-2.8rem' }}>\r\n\t\t\t\t\tversion: {appConfig.version}\r\n\t\t\t\t</small>\r\n\t\t\t\t<b className=\"text-danger h5 mb-0\">About</b>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t\t/*\r\n\t\t\t<button className=\"btn btn-primary\" onClick={evt => this.waitingEvent(evt, async (params) => {\r\n\t\t\t\tthrow new Error('error throw');\r\n\t\t\t\tawait this.control.waitFor(1000);\r\n\t\t\t\talert(params);\r\n\t\t\t}, 'a')}>dddd</button>\r\n\t\t*/\r\n\t}\r\n}\r\n","import { observer } from 'mobx-react';\r\nimport { Image, PropGrid, LMR, FA, Prop } from \"tonwa\";\r\nimport { CMe } from './CMe';\r\nimport { appConfig } from '../../uq-app/appConfig';\r\nimport { VAbout } from './VAbout';\r\nimport { tonwa } from 'tonwa-core';\r\nimport { View } from 'Control';\r\n\r\nexport class VMe extends View<CMe> {\r\n    render(): JSX.Element {\r\n        const { user } = tonwa;\r\n        let aboutRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <LMR className=\"w-100 py-2\" onClick={this.about}\r\n                    right={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n                    <FA className=\"text-info me-3\" name=\"smile-o\" fixWidth={true} size=\"lg\" />\r\n                    <b className=\"\">{this.res('aboutTheApp')} <small>{this.res('version')} {appConfig.version}</small></b>\r\n                </LMR>,\r\n            },\r\n        ];\r\n\r\n        let rows: Prop[];\r\n        if (user === undefined) {\r\n            rows = aboutRows;\r\n            rows.push(\r\n                {\r\n                    type: 'component',\r\n                    component: <button className=\"btn btn-success w-100 my-2\" onClick={() => tonwa.logout()}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.res('pleaseLogin')}\r\n                    </button>\r\n                },\r\n            );\r\n        }\r\n        else {\r\n            let logOutRows: Prop[] = [\r\n            ];\r\n\r\n            rows = [\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: <this.meInfo />\r\n                },\r\n            ]\r\n\r\n            let { onAdmin } = this.control.cAdmin;\r\n            if (onAdmin) {\r\n                rows.push('');\r\n                rows.push({\r\n                    type: 'component',\r\n                    component: <LMR className=\"w-100 py-3\" onClick={onAdmin}\r\n                        right={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n                        <FA className=\"text-primary me-3\" name=\"cogs\" fixWidth={true} size=\"lg\" />\r\n                        <b className=\"text-danger\">{this.res('admin')}</b>\r\n                    </LMR>,\r\n                })\r\n            }\r\n\r\n            rows.push(...aboutRows, ...logOutRows);\r\n        }\r\n        return <PropGrid rows={[...rows]} values={{}} />;\r\n    }\r\n\r\n    private meInfo = observer(() => {\r\n        let { user } = tonwa;\r\n        if (!user) return null;\r\n        let { id, name, nick, icon } = user;\r\n        return <LMR className=\"py-2 cursor-pointer w-100\"\r\n            left={<Image className=\"w-3c h-3c me-3\" src={icon || '.user-o'} />}\r\n            right={<FA className=\"align-self-end\" name=\"angle-right\" />}\r\n            onClick={this.control.showEditMe}>\r\n            <div>\r\n                <div>{userSpan(name, nick)}</div>\r\n                <div className=\"small\"><span className=\"text-muted\">ID:</span> {id > 10000 ? id : String(id + 10000).substr(1)}</div>\r\n            </div>\r\n        </LMR>;\r\n    });\r\n\r\n    private about = () => {\r\n        this.control.open(VAbout);\r\n    }\r\n}\r\n\r\nfunction userSpan(name: string, nick: string): JSX.Element {\r\n    return nick ?\r\n        <><b>{nick} &nbsp; <small className=\"muted\">{name}</small></b></>\r\n        : <b>{name}</b>\r\n}\r\n","import { makeObservable, observable } from 'mobx';\r\nimport {\r\n    ItemSchema, StringSchema, ImageSchema, UiTextItem, UiImageItem,\r\n    Edit, UiSchema, Prop, FA, IconText, PropGrid\r\n} from \"tonwa\";\r\nimport { tonwa } from 'tonwa-core';\r\nimport { Page } from 'Control';\r\nimport { CMe } from './CMe';\r\n\r\nexport class VEditMe extends Page<CMe>{\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema,\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    data: any = undefined;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            data: observable\r\n        })\r\n        let { nick, icon } = tonwa.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        };\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        await tonwa.web.userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        tonwa.user.name = newValue;\r\n        tonwa.saveLocalUser();\r\n    }\r\n\r\n    private onExit = () => {\r\n        tonwa.showLogout();\r\n    }\r\n\r\n    private changePassword = async () => {\r\n        await tonwa.changePassword();\r\n    }\r\n\r\n    private userQuit = async () => {\r\n        await tonwa.userQuit();\r\n    }\r\n\r\n    header(): string | boolean | JSX.Element {\r\n        return '个人信息';\r\n    }\r\n\r\n    content() {\r\n        let { schema, uiSchema, data, onItemChanged } = this;\r\n        let gridRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <IconText iconClass=\"text-info me-2\" icon=\"key\" text={this.res('changePassword')} />,\r\n                onClick: this.changePassword\r\n            },\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <IconText iconClass=\"text-info me-2\" icon=\"key\" text={this.res('quitUser')} />,\r\n                onClick: this.userQuit\r\n            },\r\n            '',\r\n            '',\r\n            {\r\n                type: 'component',\r\n                bk: '',\r\n                component: <div className=\"w-100 text-center\">\r\n                    <button className=\"btn btn-danger w-100 w-max-20c\" onClick={this.onExit}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.res('logout')}\r\n                    </button>\r\n                </div>\r\n            },\r\n        ];\r\n\r\n\r\n        /*\r\n        let vAdmin: any;\r\n    \t\r\n        let { role } = this.controller;\r\n        if ((role & 2) === 2) {\r\n            vAdmin = <div className=\"px-3 py-2 cursor-pointer bg-white border-bottom\" onClick={this.controller.showAdmin}>管理员</div>;\r\n        }\r\n        {vAdmin}\r\n        */\r\n        return <div>\r\n            <Edit schema={schema} uiSchema={uiSchema}\r\n                data={data}\r\n                onItemChanged={onItemChanged} />\r\n            <PropGrid rows={gridRows} values={{}} />\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const webUserSchema: ItemSchema[] = [\r\n    { name: 'firstName', type: 'string', required: true } as StringSchema,\r\n    { name: 'gender', type: 'string' } as StringSchema,\r\n    { name: 'salutation', type: 'string' } as StringSchema,\r\n    { name: 'organizationName', type: 'string', required: true } as StringSchema,\r\n    { name: 'departmentName', type: 'string' } as StringSchema,\r\n];\r\n\r\n","import { View } from \"Control\";\r\nimport { CAdmin } from \"./CAdmin\";\r\n\r\nconst cnRow = ' px-3 py-2 ';\r\nconst cnBg = ' bg-white ';\r\n//const cnMYLg = ' my-2 ';\r\nconst cnMYSm = ' my-1 ';\r\nconst cnSmallMuted = ' small text-muted ';\r\n\r\nexport class VRoleSettings extends View<CAdmin> {\r\n    render(): JSX.Element {\r\n        return <div className=\"mt-3\">\r\n            <div className={cnRow + cnSmallMuted}>counselor</div>\r\n            <div className={cnRow + cnBg + cnMYSm}></div>\r\n        </div>\r\n    }\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { App } from \"../App\";\r\nimport { CAdminBase } from \"Control\";\r\nimport { VRoleSettings } from \"./VRoleSettings\";\r\n\r\nexport class CAdmin extends CAdminBase<App> {\r\n    readonly uqs: UQs;\r\n\r\n    constructor(app: App) {\r\n        super(app);\r\n        //this.cApp = cApp;\r\n        this.uqs = app.uqs;\r\n    }\r\n\r\n    protected async loadAdmins(): Promise<any[]> {\r\n        return await this.uqs.BzWorkshop.AdminGetList();\r\n    }\r\n\r\n    protected async setMeAdmin(): Promise<void> {\r\n        await this.uqs.BzWorkshop.AdminSetMe();\r\n    }\r\n\r\n    protected async setAdmin(user: number, role: number, assigned: string): Promise<void> {\r\n        await this.uqs.BzWorkshop.AdminSet(user, role, assigned);\r\n    }\r\n\r\n    get me(): number {\r\n        return this.app.user?.id;\r\n    }\r\n\r\n    renderRoleSettings(): JSX.Element {\r\n        return this.render(VRoleSettings);\r\n    }\r\n}\r\n","import { User } from \"tonwa-core\";\r\nimport { QueryPager } from \"tonwa\";\r\nimport { VMe } from \"./VMe\";\r\nimport { VEditMe } from \"./VEditMe\";\r\nimport { CAdmin } from \"../CAdmin\";\r\nimport { CControl } from \"../CControl\";\r\nimport { App } from \"../App\";\r\n\r\nexport interface RootUnitItem {\r\n\tid: number;\t\t\t\t\t// root unit id\r\n\towner: any;\r\n\tname: string;\t\t\t\t// 唯一\r\n\tcontent: string;\r\n\ttonwaUnit: number;\t\t\t// 跟tonwa机构对应的值\r\n\tx: number;\r\n}\r\n\r\nexport class CMe extends CControl {\r\n\trole: number;\r\n\tunitOwner: User;\r\n\trootUnits: QueryPager<any>;\r\n\tcAdmin: CAdmin;\r\n\r\n\tconstructor(app: App) {\r\n\t\tsuper(app);\r\n\t\tthis.cAdmin = new CAdmin(this.app);\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => {\r\n\t\treturn this.render(VMe);\r\n\t}\r\n\r\n\tshowEditMe = async () => {\r\n\t\t//let result = await this.uqs.Notes.GetSystemRole.query({});\r\n\t\t//this.role = result.ret[0]?.role;\r\n\t\tthis.open(VEditMe);\r\n\t}\r\n\r\n\tload = async () => {\r\n\t\tawait this.cAdmin.load();\r\n\t\t//this.roles = await this.getUqRoles(this.uq.name);\r\n\t}\r\n\r\n\tbackend = async () => {\r\n\t\t//let cRoles = new CRoles(this.uq, this.res);\r\n\t\t//await cRoles.start();\r\n\t}\r\n\r\n\tprivate myRolesChanged = (roles: string[]) => {\r\n\t\t//this.roles = roles;\r\n\t\t//this.user.roles[this.uq.name] = roles;\r\n\t\t//nav.saveLocalUser();\r\n\t}\r\n}\r\n","import { App } from \"../App\";\r\nimport { CTagBase, Tag } from \"Control\";\r\nimport { ID, IX } from \"tonwa-core\";\r\nimport { UQs } from \"uq-app\";\r\nimport * as BzWorkshop from 'uq-app/uqs/BzWorkshop';\r\n\r\nexport class CTag extends CTagBase<App> {\r\n    readonly uqs: UQs;\r\n    readonly uq: BzWorkshop.UqExt;\r\n    readonly TagGroup: ID;\r\n    readonly Tag: ID;\r\n    readonly TagItem: ID;\r\n    readonly IxTag: IX;\r\n    readonly IxLocalIdTag: IX;\r\n    readonly IxGlobalIdTag: IX;\r\n    readonly groups: Tag[] = [\r\n        { name: 'workshop-tags', vice: 'Workshop tags' },\r\n        { name: 'client-tags', vice: 'Client tags' },\r\n        { name: 'staff-tags', vice: 'Staff tags' },\r\n    ];\r\n\r\n    constructor(app: App) {\r\n        super(app);\r\n        this.uqs = app.uqs;\r\n        this.uq = this.uqs.BzWorkshop;\r\n        this.TagGroup = this.uq.TagGroup;\r\n        this.Tag = this.uq.Tag;\r\n        this.TagItem = this.uq.TagItem;\r\n        this.IxTag = this.uq.IxTag;\r\n        this.IxLocalIdTag = this.uq.IxLocalIdTag;\r\n        this.IxGlobalIdTag = this.uq.IxGlobalIdTag;\r\n    }\r\n\r\n    get caption(): string { return 'Tags admin'; }\r\n    get icon(): string { return 'tag'; }\r\n    get iconClass(): string { return 'text-danger'; }\r\n\r\n    isVisible(): boolean {\r\n        return this.app.meAdmin;\r\n    }\r\n}\r\n","import { TabProp, TabCaptionComponent, TabsProps, t } from \"tonwa\";\r\nimport { Page } from 'Control';\r\nimport { CMain } from './CMain';\r\n\r\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\r\nfunction caption(label: string | JSX.Element, icon: string) {\r\n\treturn (selected: boolean) => TabCaptionComponent(label, icon, color(selected));\r\n}\r\n\r\nexport class VMain extends Page<CMain> {\r\n\tprotected get tabsProps(): TabsProps {\r\n\t\tlet { cActs, cIds, cMe } = this.control.app;\r\n\t\tlet tabs: TabProp[] = [\r\n\t\t\t// { name: 'home', caption: caption(t('home'), 'home'), content: cHome.tab },\r\n\t\t\t{ name: 'acts', caption: caption(t('home'), 'home'), content: () => cActs.main(), load: cActs.load },\r\n\t\t\t{ name: 'ids', caption: caption(t('ids'), 'file-text-o'), content: () => cIds.main(), load: cIds.load },\r\n\t\t]\r\n\t\ttabs.push(\r\n\t\t\t{ name: 'me', caption: caption(t('me'), 'user-o'), content: cMe.tab, load: cMe.load },\r\n\t\t);\r\n\t\treturn { tabs };\r\n\t}\r\n}\r\n","import { CControl } from \"./CControl\";\r\nimport { VMain } from \"./VMain\";\r\n\r\nexport class CMain extends CControl {\r\n    async openMain() {\r\n        this.open(VMain);\r\n    }\r\n}","import { CControl } from \"../CControl\";\r\n\r\nexport class CPathControl extends CControl {\r\n    pathParam: string;\r\n}\r\n","import { Page } from \"Control\";\r\nimport { Form, UiSchema, UiTextItem } from \"tonwa-react\";\r\nimport { Person } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CClientSurvey } from \"./CClientSurvey\";\r\n\r\nexport class PClientForm extends Page<CClientSurvey, Person> {\r\n    header(): string | boolean | JSX.Element {\r\n        return null;\r\n    }\r\n\r\n    content() {\r\n        const schema = [\r\n            ...this.control.uqs.BzWorkshop.Person.ui.fieldArr as any[],\r\n            { name: 'submit', type: 'submit' }\r\n        ];\r\n        const uiSchema: UiSchema = {\r\n            items: {\r\n                no: {\r\n                    \"name\": \"no\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": true,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"No\",\r\n                    \"defaultValue\": this.props.no,\r\n                } as UiTextItem,\r\n                name: {\r\n                    \"name\": \"name\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Name\",\r\n                    \"defaultValue\": this.props.name,\r\n                } as UiTextItem,\r\n                firstName: {\r\n                    \"name\": \"firstName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"First Name\",\r\n                    \"defaultValue\": this.props.firstName,\r\n                } as UiTextItem,\r\n                lastName: {\r\n                    \"name\": \"lastName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Last Name\",\r\n                    \"defaultValue\": this.props.lastName,\r\n                } as UiTextItem,\r\n                middleName: {\r\n                    \"name\": \"middleName\",\r\n                    \"type\": \"string\",\r\n                    \"isKey\": false,\r\n                    \"widget\": \"text\",\r\n                    \"label\": \"Middle Name\",\r\n                    \"defaultValue\": this.props.middleName,\r\n                } as UiTextItem,\r\n                submit: {\r\n                    \"label\": \"Submit\",\r\n                    \"widget\": \"button\",\r\n                    \"className\": \"btn btn-primary\",\r\n                }\r\n            }\r\n        }\r\n        return <div className=\"p-3\">\r\n            <Form schema={schema} uiSchema={uiSchema} fieldLabelSize={2} />\r\n        </div>;\r\n    }\r\n}\r\n","import { Page } from \"Control\";\r\nimport { CClientSurvey } from \"./CClientSurvey\";\r\n\r\nexport class PInvalid extends Page<CClientSurvey> {\r\n    header(): string | boolean | JSX.Element {\r\n        return null;\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"p-3\">\r\n            invalid\r\n        </div>;\r\n    }\r\n}\r\n","import { Page } from \"Control\";\r\nimport { CClientSurvey } from \"./CClientSurvey\";\r\n\r\nexport class PMain extends Page<CClientSurvey> {\r\n    header(): string | boolean | JSX.Element {\r\n        return null;\r\n    }\r\n\r\n    content(): JSX.Element {\r\n        return <div className=\"p-3\">\r\n            <div className=\"my-5 text-center text-success\">\r\n                Welcome to the servey!\r\n            </div>\r\n            <div className=\"my-5 text-center\">\r\n                {this.control.pathParam}\r\n            </div>\r\n            <div className=\"my-5 text-center\">\r\n                <button className=\"btn btn-primary\" onClick={evt => this.waitingEvent(evt, this.control.onStart)}>Next &gt;</button>\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n","import { Person } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CPathControl } from \"../CPathControl\";\r\nimport { PClientForm } from \"./PClientForm\";\r\nimport { PInvalid } from \"./PInvalid\";\r\nimport { PMain } from \"./PMain\";\r\n\r\nexport class CClientSurvey extends CPathControl {\r\n    async openMain() {\r\n        this.open(PMain);\r\n    }\r\n\r\n    onStart = async () => {\r\n        let { BzWorkshop } = this.uqs;\r\n        let id = Number(this.pathParam);\r\n        if (isNaN(id) === true) {\r\n            this.open(PInvalid);\r\n            return\r\n        }\r\n        let ret = await BzWorkshop.ID<Person>({\r\n            IDX: BzWorkshop.Person,\r\n            id: Number(this.pathParam),\r\n        });\r\n        if (ret.length === 0) {\r\n            this.open(PInvalid);\r\n            return;\r\n        }\r\n\r\n        this.open(PClientForm, ret[0]);\r\n    }\r\n}\r\n","import { App } from \"../App\";\r\nimport { CClientSurvey } from \"./CClientSurvey\";\r\nimport { CPathControl } from \"./CPathControl\";\r\n\r\nconst coll: {\r\n    [name: string]: new (a: App) => CPathControl\r\n} = {\r\n    '/client/survey/': CClientSurvey,\r\n};\r\n\r\nexport function pathControls(app: App): boolean {\r\n    let { pathname } = document.location;\r\n    let path = pathname.toLowerCase();\r\n    for (let i in coll) {\r\n        let p = path.indexOf(i.toLowerCase());\r\n        if (p >= 0) {\r\n            let Control = coll[i];\r\n            let param = path.substring(p + i.length);\r\n            let c = new Control(app);\r\n            c.pathParam = param;\r\n            c.openMain();\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n","import { User } from \"tonwa-core\";\r\nimport { AppBase, CUser, Nav, UserApi } from \"Control\";\r\nimport { UQs } from \"uq-app\";\r\nimport { Role } from \"uq-app/uqs/BzWorkshop\";\r\nimport { CActs } from \"./CActs\";\r\nimport { CIds } from \"./CIds\";\r\nimport { CMe } from \"./CMe\";\r\nimport { CTag } from \"./CTag\";\r\nimport { AppNav } from \"../tool\";\r\nimport { CMain } from \"./CMain\";\r\nimport { pathControls } from \"./pathControls\";\r\n\r\ntype Roles = { [role in Role]: number };\r\n\r\nexport class App extends AppBase {\r\n    appNav: AppNav;\r\n    user: User;\r\n    meAdmin: boolean;\r\n    meRoles: Roles;\r\n    readonly uqs: UQs;\r\n    readonly cTag: CTag;\r\n    readonly cActs: CActs;\r\n    readonly cIds: CIds;\r\n    readonly cMe: CMe;\r\n    readonly cUser: CUser;\r\n\r\n    userApi: UserApi;\r\n    get nav(): Nav {\r\n        return this.appNav;\r\n    }\r\n\r\n    constructor(uqs: UQs) {\r\n        super();\r\n        this.uqs = uqs;\r\n        this.cTag = new CTag(this);\r\n        this.cActs = new CActs(this);\r\n        this.cIds = new CIds(this);\r\n        this.cMe = new CMe(this);\r\n        this.cUser = new CUser(this);\r\n    }\r\n\r\n    openMain() {\r\n        let ret = pathControls(this);\r\n        if (ret === true) return;\r\n        if (!this.user) {\r\n            this.nav.openLogin();\r\n            return;\r\n        }\r\n        let cMain = new CMain(this);\r\n        cMain.openMain();\r\n    }\r\n\r\n    isRole(...roles: Role[]): boolean {\r\n        if (roles === undefined) return false;\r\n        for (let r of roles) {\r\n            if (this.meRoles[r] !== undefined) return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    isAdminOrRole(...roles: Role[]): boolean {\r\n        if (this.meAdmin === true) return true;\r\n        return this.isRole(...roles);\r\n    }\r\n\r\n    isPersonMe(person: number): boolean {\r\n        for (let i in this.meRoles) {\r\n            if (person === this.meRoles[Number(i) as Role]) return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    async loadBaseData() {\r\n        let { BzWorkshop } = this.uqs;\r\n        let ret = await Promise.all([\r\n            this.cIds.load(),\r\n            BzWorkshop.AdminIsMe(),\r\n            BzWorkshop.IX<{ ix: number; a: number; b: number; }>({\r\n                IX: BzWorkshop.IxUserPerson,\r\n                IX1: BzWorkshop.IxPersonRole,\r\n                ix: undefined,\r\n            })\r\n        ]);\r\n        this.meRoles = this.buildRoles(ret[2] as any);\r\n        this.meAdmin = ret[1];\r\n    }\r\n\r\n    private buildRoles(typeValues: { type: string; value: string }[]): Roles {\r\n        let { BzWorkshop } = this.uqs;\r\n        let roles: Roles = {} as Roles;\r\n        for (let row of typeValues) {\r\n            let { type, value } = row;\r\n            let v = BzWorkshop.IDValue(type, value);\r\n            switch (type) {\r\n                case 'personrole':\r\n                    let { person, role } = v as any;\r\n                    roles[role as Role] = person;\r\n                    break;\r\n            }\r\n        }\r\n        return roles;\r\n    }\r\n\r\n    renderAdmin(el: JSX.Element): JSX.Element {\r\n        if (this.meAdmin === true) return el;\r\n        return null;\r\n    }\r\n    renderRole(el: JSX.Element, ...roles: number[]): JSX.Element {\r\n        if (this.isRole(...roles) === true) return el;\r\n        return null;\r\n    }\r\n    renderAdminOrRole(el: JSX.Element, ...roles: number[]): JSX.Element {\r\n        if (this.isAdminOrRole(...roles) === true) return el;\r\n        return null;\r\n    }\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\thome: '首页',\r\n\trelation: '关系',\r\n\tdiscover: '发现',\r\n\tsupervise: '团队',\r\n\tids: '基础ID',\r\n\ttest: '测试',\r\n\tdebug: 'Debug',\r\n\tme: '我',\r\n\r\n\tchangePassword: '修改密码',\r\n\taboutTheApp: '关于本APP',\r\n\tlogout: '退出登录',\r\n\tpleaseLogin: '登录',\r\n\tuserQuit: '注销用户',\r\n\r\n\tcontent: '内容',\r\n\tbackend: '后台管理',\r\n\r\n\tlist: '列表',\r\n}\r\n","export const en = {\r\n\thome: 'Home',\r\n\trelation: 'Relation',\r\n\tdiscover: 'Discover',\r\n\tsupervise: 'Supervise',\r\n\tids: 'Items',\r\n\ttest: 'Test',\r\n\tdebug: 'Debug',\r\n\tme: 'Me',\r\n\r\n\tchangePassword: 'Change password',\r\n\taboutTheApp: 'About the APP',\r\n\tlogout: 'Logout',\r\n\tpleaseLogin: 'Login',\r\n\tuserQuit: 'User quit',\r\n\r\n\tcontent: 'Content',\r\n\tbackend: 'Backend Management',\r\n\r\n\tlist: 'List',\r\n}\r\n","//=== UqApp builder created on Tue Feb 15 2022 12:15:55 GMT-0500 (北美东部标准时间) ===//\nimport * as BzWorkshop from './BzWorkshop';\n\nexport interface UQs {\n\tBzWorkshop: BzWorkshop.UqExt;\n}\n\nexport * as BzWorkshop from './BzWorkshop';\n\nexport function setUI(uqs:UQs) {\n\tBzWorkshop.setUI(uqs.BzWorkshop);\n}\n","import { UqExt as Uq, assign } from './BzWorkshop';\nimport * as Workshop from './Workshop.ui';\nimport * as Person from './Person.ui';\nimport * as Note from './Note.ui';\nimport * as Session from './Session.ui';\nimport * as SessionPerson from './SessionPerson.ui';\nimport * as Tag from './Tag.ui';\nimport * as TagGroup from './TagGroup.ui';\nimport * as TagItem from './TagItem.ui';\n\t\nexport function setUI(uq: Uq) {\n\tassign(uq, 'Workshop', Workshop);\n\tassign(uq, 'Person', Person);\n\tassign(uq, 'Note', Note);\n\tassign(uq, 'Session', Session);\n\tassign(uq, 'SessionPerson', SessionPerson);\n\tassign(uq, 'Tag', Tag);\n\tassign(uq, 'TagGroup', TagGroup);\n\tassign(uq, 'TagItem', TagItem);\n}\nexport * from './BzWorkshop';\n","import { makeObservable, observable, runInAction } from \"mobx\";\r\nimport { Tonwa } from \"tonwa-core\";\r\nimport { start } from \"tonwa\";\r\nimport { App } from \"../App\";\r\nimport { AppNav } from \"../tool\";\r\nimport { CUqApp } from \"./CBase\";\r\nimport { res } from \"./res\";\r\n//import { VMain } from \"./VMain\";\r\nimport { setUI } from \"uq-app/uqs\";\r\nimport { appConfig } from \"./appConfig\";\r\n//import { Role } from \"./uqs/BzWorkshop\";\r\n\r\nconst gaps = [10, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5, 10, 10, 10, 10, 15, 15, 15, 30, 30, 60];\r\n\r\nexport interface Title {\r\n\ttitle: string;\r\n\tvice?: string;\r\n\tunit?: string;\r\n\tfixed?: number;\r\n}\r\n\r\n//type Roles = { [role in Role]: number };\r\n\r\nexport class CApp extends CUqApp {\r\n\tconstructor(tonwa: Tonwa) {\r\n\t\tsuper(tonwa, appConfig);\r\n\t}\r\n\t/*\r\n\tappNav: AppNav;\r\n\tmeAdmin: boolean;\r\n\tmeRoles: Roles;\r\n\tcTag: CTag;\r\n\tcHome: CHome;\r\n\tcActs: CActs;\r\n\tcIds: CIds;\r\n\tcMe: CMe;\r\n\tcUser: CUser;\r\n\t*/\r\n\tapp: App;\r\n\r\n\tprotected async internalStart(isUserLogin: boolean) {\r\n\t\tmakeObservable(this, {\r\n\t\t\trefreshTime: observable\r\n\t\t});\r\n\t\tthis.setRes(res);\r\n\t\tsetUI(this.uqs);\r\n\t\t/*\r\n\t\tthis.cUser = new CUser(this, this.web.centerApi);\r\n\r\n\t\tthis.cTag = new CTag(this);\r\n\t\tthis.cHome = this.newC(CHome);\r\n\t\tthis.cActs = new CActs(this);\r\n\t\tthis.cIds = new CIds(this);\r\n\t\tthis.cMe = new CMe(this);\r\n\t\tthis.cHome.load();\r\n\t\t*/\r\n\r\n\t\tlet tonwa = this.getTonwa();\r\n\t\tlet appNav = new AppNav(tonwa);\r\n\t\tlet app = new App(this.uqs);\r\n\t\tthis.app = app;\r\n\t\tapp.appNav = appNav;\r\n\t\tapp.user = this.user;\r\n\t\tapp.userApi = this.web.centerApi;\r\n\t\tawait app.loadBaseData();\r\n\r\n\t\tapp.openMain();\r\n\t\t//this.openVPage(VMain, undefined, this.dispose);\r\n\t\t// 加上下面一句，可以实现主动页面刷新\r\n\t\tthis.timer = setInterval(this.callTick, 1000);\r\n\t\t// uq 里面加入这一句，会让相应的$Poked查询返回poke=1：\r\n\t\t// TUID [$User] ID (member) SET poke=1;\r\n\t}\r\n\r\n\tprivate timer: any;\r\n\tprotected onDispose() {\r\n\t\tclearInterval(this.timer);\r\n\t\tthis.timer = undefined;\r\n\t}\r\n\r\n\tasync initStart() {\r\n\t\tawait this.tonwa.appStart();\r\n\t}\r\n\r\n\trender(loginedOnly: boolean = true): JSX.Element {\r\n\t\tconst onLogined = async (isUserLogin?: boolean) => {\r\n\t\t\tawait start(CApp, this.tonwa, appConfig, isUserLogin);\r\n\t\t}\r\n\t\tlet onNotLogined: () => Promise<void> = undefined;\r\n\t\tif (loginedOnly === false) onNotLogined = onLogined;\r\n\t\treturn this.tonwa.nav.renderNavView(onLogined, onNotLogined);\r\n\t}\r\n\r\n\t// 数据服务器提醒客户端刷新，下面代码重新调入的数据\r\n\trefresh = async () => {\r\n\t\tlet d = Date.now() / 1000;\r\n\t\tif (d - this.refreshTime < 30) return;\r\n\t\tawait Promise.all([\r\n\t\t\t//this.cHome.load(),\r\n\t\t]);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.refreshTime = d;\r\n\t\t});\r\n\t}\r\n\r\n\trefreshTime: number = Date.now() / 1000;\r\n\r\n\tprivate tick = 0;\r\n\tprivate gapIndex = 0;\r\n\tprivate callTick = async () => {\r\n\t\ttry {\r\n\t\t\tif (!this.user) return;\r\n\t\t\t++this.tick;\r\n\t\t\tif (this.tick < gaps[this.gapIndex]) return;\r\n\t\t\tthis.tick = 0;\r\n\t\t\tif (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n\t\t\t/*\r\n\t\t\tlet ret = await this.uqs.JkMe.$poked.query(undefined, undefined, false);\r\n\t\t\tlet v = ret.ret[0];\r\n\t\t\tif (v === undefined) return;\r\n\t\t\tif (!v.poke) return;\r\n\t\t\tthis.gapIndex = 1;\r\n\t\t\tawait this.refresh();\r\n\t\t\t*/\r\n\t\t}\r\n\t\tcatch {\r\n\t\t}\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { NavView, start, TonwaReact } from \"tonwa\";\r\nimport { CApp } from './CApp';\r\nimport { appConfig } from './appConfig';\r\n// import { App } from './App';\r\n\r\nexport async function startApp() {\r\n    let tonwa = new TonwaReact();\r\n    //initNav(tonwa);\r\n    tonwa.setSettings(appConfig);\r\n    const onLogined = async (isUserLogin?: boolean) => {\r\n        await start(CApp, tonwa, appConfig, isUserLogin);\r\n    }\r\n    const notLogined: () => Promise<void> = onLogined;\r\n    const userPassword: () => Promise<{ user: string; password: string }> = undefined;\r\n    tonwa.appStart(onLogined);\r\n    ReactDOM.render(\r\n        <React.StrictMode>\r\n            <NavView ref={navView => tonwa.set(navView)}\r\n                onLogined={onLogined}\r\n                notLogined={notLogined}\r\n                userPassword={userPassword} />\r\n        </React.StrictMode>,\r\n        document.getElementById('root')\r\n    );\r\n}\r\n","//import React from 'react';\n//import ReactDOM from 'react-dom';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport './index.css';\nimport { startApp } from './uq-app';\n//import App from './App';\n//import reportWebVitals from './reportWebVitals';\n\n(function () {\n  startApp();\n})();\n/*\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n*/"],"sourceRoot":""}